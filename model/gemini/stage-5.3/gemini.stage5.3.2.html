<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <style>
        :root {
            /* Stage 5.3: Colour Semantics - Soft-Warm Neutral Base */
            --c-bg-page: #F9F8F6;
            --c-bg-surface: #FFFFFF;
            --c-bg-details: #F7F6F4;

            /* Text Colors */
            --c-text-primary: #2D2D2A;
            --c-text-secondary: #565654;
            --c-text-quiet: #757572;

            /* Override 5.3.2: Non-Semantic Accent (Focus/Links/Nav State) */
            --c-accent: #2B4C5D;
            /* Desaturated Slate Blue */

            /* Dividers & Borders */
            --c-divider: #E0E0DE;
            --c-divider-subtle: #ECEBE9;

            /* Override: Stage 3 Display Math Underlay */
            --c-math-underlay: rgba(0, 0, 0, 0.03);

            /* Typography */
            --font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;

            /* Spacing Rhythm */
            --space-xs: 4px;
            --space-s: 8px;
            --space-m: 16px;
            --space-l: 24px;
            --space-xl: 48px;
            --space-xxl: 64px;

            /* Layout */
            --layout-max-width: 980px;
            --nav-width: 160px;
            --header-height: 60px;
        }

        /* Reset & Base */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
            background-color: var(--c-bg-page);
            color: var(--c-text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* App Shell - Single Centered Frame */
        #app-shell {
            max-width: var(--layout-max-width);
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--c-bg-surface);
            /* Unification of surface */
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.02);
            /* Very subtle lift */
        }

        /* Top Bar / Paper Selector */
        #top-control-area {
            height: var(--header-height);
            border-bottom: 1px solid var(--c-divider);
            display: flex;
            align-items: center;
            padding: 0 var(--space-l);
            position: sticky;
            top: 0;
            background-color: var(--c-bg-surface);
            z-index: 100;
        }

        .paper-selector-label {
            font-size: 0.9rem;
            color: var(--c-text-secondary);
            margin-right: var(--space-m);
        }

        select#paper-select {
            font-family: var(--font-family);
            font-size: 0.95rem;
            padding: var(--space-s) var(--space-m);
            border: 1px solid var(--c-divider);
            border-radius: 4px;
            color: var(--c-text-primary);
            background-color: var(--c-bg-page);
            cursor: pointer;
        }

        select#paper-select:focus {
            outline: 2px solid var(--c-accent);
            outline-offset: 1px;
        }

        /* Main Layout: Nav + Content */
        #main-layout {
            display: flex;
            flex: 1;
            position: relative;
        }

        /* Navigation Rail (Desktop) */
        #nav-rail {
            width: var(--nav-width);
            padding: var(--space-l) var(--space-m) var(--space-l) var(--space-l);
            border-right: 1px solid var(--c-divider-subtle);
            /* Minimal separation */
            /* Sticky Logic */
            position: sticky;
            top: var(--header-height);
            height: calc(100vh - var(--header-height));
            overflow-y: auto;
            /* Scrollbar hiding (Add-on) */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        #nav-rail::-webkit-scrollbar {
            display: none;
        }

        /* Navigation List */
        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .nav-section-label {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--c-text-quiet);
            margin-top: var(--space-m);
            margin-bottom: var(--space-xs);
            padding-left: var(--space-s);
            font-weight: 600;
        }

        .nav-item {
            font-size: 0.9rem;
            color: var(--c-text-secondary);
            text-decoration: none;
            padding: 4px var(--space-s);
            border-radius: 2px;
            transition: color 0.1s ease, font-weight 0.1s ease;
            cursor: pointer;
            display: block;
        }

        .nav-item:hover {
            color: var(--c-text-primary);
            background-color: rgba(0, 0, 0, 0.02);
            /* Extremely subtle hover */
            text-decoration: underline;
            text-decoration-color: var(--c-divider);
        }

        .nav-item:focus-visible {
            outline: 2px solid var(--c-accent);
        }

        /* Active State: Weight + Marker (Override 5.4.3) */
        .nav-item.active {
            font-weight: 700;
            color: var(--c-accent);
            /* Permitted by Override 5.3.2 for Nav */
            position: relative;
        }

        .nav-item.active::before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 14px;
            background-color: var(--c-accent);
            border-radius: 1px;
        }

        /* Paper Content Column */
        #paper-content {
            flex: 1;
            padding: var(--space-xl) var(--space-l) var(--space-xxl) var(--space-l);
            /* KaTeX Containment Invariant */
            max-width: calc(100% - var(--nav-width));
            /* Ensure no overflow */
            min-width: 0;
            /* Flexbox containment hack */
        }

        /* Typography Hierarchy */
        h1,
        h2,
        h3,
        h4 {
            margin: 0;
            font-weight: 600;
        }

        /* Question Blocks */
        .question-block {
            margin-bottom: var(--space-xxl);
            /* Rhtyhm Rule 1.2 */
            scroll-margin-top: calc(var(--header-height) + var(--space-m));
        }

        .question-block.sub-question {
            margin-bottom: var(--space-l);
            margin-left: var(--space-l);
            /* Indentation for nesting */
            border-left: 2px solid transparent;
            /* Placeholder to keep alignment */
        }

        .question-block.sub-sub-question {
            margin-left: var(--space-xl);
        }

        /* Question Header */
        .question-header {
            display: flex;
            align-items: baseline;
            gap: var(--space-m);
            margin-bottom: var(--space-m);
        }

        .q-id {
            font-weight: 600;
            color: var(--c-text-secondary);
            min-width: 2.5em;
            /* Alignment */
            font-size: 1.1rem;
        }

        .q-text {
            font-size: 1.1rem;
            color: var(--c-text-primary);
            line-height: 1.6;
            flex: 1;
        }

        /* Diagrams */
        .diagram-container {
            margin: var(--space-m) 0;
            padding: var(--space-m);
            background: var(--c-bg-page);
            border: 1px dashed var(--c-divider);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .diagram-svg {
            max-width: 100%;
            height: auto;
            fill: none;
            stroke: var(--c-text-secondary);
            stroke-width: 1.5;
        }

        /* Answer Section */
        .answer-section {
            margin-left: calc(2.5em + var(--space-m));
            /* Align with text */
            margin-bottom: var(--space-m);
            display: flex;
            flex-direction: column;
            gap: var(--space-s);
        }

        .answer-label {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .answer-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--c-text-primary);
        }

        /* Solution Details Region */
        .solution-details {
            margin-left: calc(2.5em + var(--space-m));
        }

        /* Disclosure Control */
        .disclosure-control {
            background: none;
            border: none;
            padding: 0;
            font-family: var(--font-family);
            font-size: 0.95rem;
            color: var(--c-accent);
            /* Override 5.3.2 permitted */
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            margin-bottom: var(--space-s);
            transition: opacity 0.2s ease;
        }

        .disclosure-control:hover {
            text-decoration: underline;
        }

        .disclosure-control:focus-visible {
            outline: 2px solid var(--c-accent);
            border-radius: 2px;
        }

        .chevron {
            transition: transform 0.2s ease;
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .disclosure-control[aria-expanded="true"] .chevron {
            transform: rotate(180deg);
        }

        /* Content Container (Collapsible) */
        .details-content {
            display: none;
            /* Default state */
            background-color: var(--c-bg-details);
            /* Option C */
            padding: var(--space-m);
            border-top: 1px solid var(--c-divider);
            /* Option C hairline */
            margin-top: var(--space-xs);
        }

        .details-content[data-visible="true"] {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Derived Sections: Keep in mind / Formulas */
        .derived-section {
            margin-bottom: var(--space-m);
        }

        .derived-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .derived-label svg {
            width: 14px;
            height: 14px;
            fill: var(--c-text-quiet);
        }

        .derived-body {
            font-size: 0.95rem;
            color: var(--c-text-secondary);
            line-height: 1.5;
        }

        .derived-body ul {
            margin: 0;
            padding-left: var(--space-m);
        }

        .formulas-list {
            font-family: var(--font-family);
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* Working Section */
        .working-section {
            margin-top: var(--space-m);
            padding-top: var(--space-m);
            border-top: 1px solid var(--c-divider-subtle);
            /* Minimal separation */
        }

        .working-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            margin-bottom: var(--space-s);
            text-transform: uppercase;
        }

        .working-body {
            font-size: 1rem;
            color: var(--c-text-primary);
        }

        .working-body p {
            margin-top: 0;
            margin-bottom: var(--space-m);
            /* Phase spacing */
        }

        /* KaTeX Override: Display Math Underlay (Stage 3) */
        .katex-display {
            background-color: var(--c-math-underlay);
            border-radius: 0;
            padding: 0.5em;
            width: fit-content;
            max-width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: var(--space-s) 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            :root {
                --nav-width: 0px;
                --space-l: 16px;
                --space-xxl: 32px;
            }

            #app-shell {
                overflow-x: hidden;
            }

            #nav-rail {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 280px;
                background: var(--c-bg-surface);
                border-right: 1px solid var(--c-divider);
                z-index: 200;
                transform: translateX(-100%);
                transition: transform 0.2s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
                height: 100vh;
            }

            #nav-rail.mobile-open {
                transform: translateX(0);
            }

            #paper-content {
                max-width: 100%;
                padding-top: var(--space-l);
            }

            /* Jump To Button for Mobile (Stage 6.0.6) */
            #mobile-nav-toggle {
                display: flex;
            }

            .question-header {
                gap: var(--space-s);
            }

            .answer-section,
            .solution-details {
                margin-left: 0;
                padding-left: var(--space-m);
                border-left: 2px solid var(--c-divider-subtle);
                /* Mobile alignment aid */
            }
        }

        /* Mobile Nav Toggle Button (Initially Hidden on Desktop) */
        #mobile-nav-toggle {
            display: none;
            margin-left: auto;
            background: none;
            border: 1px solid var(--c-divider);
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--c-text-secondary);
            cursor: pointer;
        }

        #mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.2);
            z-index: 150;
        }

        #mobile-overlay.active {
            display: block;
        }

        @media (min-width: 769px) {

            #mobile-nav-toggle,
            #mobile-overlay {
                display: none !important;
            }
        }
    </style>
</head>

<body>

    <div id="app-shell">
        <div id="top-control-area">
            <label class="paper-selector-label" for="paper-select">Select Paper:</label>
            <select id="paper-select">
                <option value="short">Short Paper (6 Qs)</option>
                <option value="standard">Standard Paper (35 Qs)</option>
                <option value="standard-expanded">Standard (Workings Expanded)</option>
                <option value="diagram">Diagram-heavy Paper (20 Qs)</option>
                <option value="sectioned">Sectioned Paper</option>
            </select>

            <button id="mobile-nav-toggle">Jump to...</button>
        </div>

        <div id="main-layout">
            <div id="mobile-overlay"></div>

            <nav id="nav-rail" aria-label="Question Navigation">
                <ul class="nav-list" id="nav-list-container">
                </ul>
            </nav>

            <main id="paper-content">
            </main>
        </div>
    </div>

    <script>
        // --- Data: Exemplar Content (Verbatim Extraction) ---
        // A subset of questions parsed from the provided exemplars.md

        const questionBank = [
            {
                id: "1", type: "top", text: "Fill in the missing numbers in the boxes.", answer: "68",
                working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
55 + a                              &= 82 \\\\
a                                   &= 82 - 55 \\\\
a                                   &= 27
\end{aligned}
$
Missing number $= 27$`,
                children: [
                    {
                        id: "1a", text: "$55 + \\boxed{\\phantom{55}} = 82$", answer: "27", working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
55 + a                              &= 82 \\\\
a                                   &= 82 - 55 \\\\
a                                   &= 27
\end{aligned}
$
Missing number $= 27$` },
                    {
                        id: "1b", text: "$\\boxed{\\phantom{23}} - 23 = 45$", answer: "68", working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
a - 23                              &= 45 \\\\
a                                   &= 45 + 23 \\\\
a                                   &= 68
\end{aligned}
$
Missing number $= 68$` },
                    {
                        id: "1c", text: "$60 \\div \\boxed{\\phantom{45}} = 12$", answer: "5", working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
60 \div a                           &= 12 \\\\
60                                  &= 12 \times a \\\\
a                                   &= \dfrac {60} {12}\\\\
a                                   &= \dfrac {5 \times 12} {12} \\\\
a                                   &= \dfrac {5 \times \cancel{12}} {\cancel{12}} \\\\
a                                   &= 5
\end{aligned}
$
Missing number $= 5$` },
                    {
                        id: "1d", text: "$32 \\times \\boxed{\\phantom{45}} = 640$", answer: "20", working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
32 \times a                         &= 640 \\\\
a                                   &= \dfrac {640} {32} \\\\
a                                   &= \dfrac {20 \times 32} {32} \\\\
a                                   &= \dfrac {20 \times \cancel{32}} {\cancel{32}} \\\\
a                                   &= 20
\end{aligned}
$
Missing number $= 20$` },
                    {
                        id: "1e", text: "$0.75 \\div \\dfrac{3}{4} = \\boxed{\\phantom{45}}$", answer: "1", working: String.raw`$
\begin{aligned}
&= 0.75 \div {\dfrac {3} {4}} \\\\
&= 0.75 \times \dfrac {4} {3} \\\\
&= \dfrac {75} {100} \times \dfrac {4} {3} \\\\
&= \dfrac {75 \times 4} {100 \times 3} \\\\
&= \dfrac {3 \times 25 \times 4} {4 \times 25 \times 3} \\\\
&= \dfrac {\cancel{3} \times \cancel{25} \times \cancel{4}} {\cancel{4} \times \cancel{25} \times \cancel{3}} \\\\
&= 1
\end{aligned}
$` }
                ]
            },
            {
                id: "2", type: "top", text: "Add together $308, 86$ and $4444$.", answer: "4838", working: String.raw`$
\begin{array}{cccccccccccccc}
    &       &   3   &   0   &   8 \\
    &       &       &   8   &   6 \\
{}+ &   4   &   4   &   4   &   4 \\
\hline
    &   4   &   8   &   3   &   8
\end{array}
$` },
            {
                id: "3", type: "top", text: "Subtract three hundred and three from six thousand and sixty.", answer: "5757", working: String.raw`$
\begin{aligned}
&= 6060 - 303  \\\\
&= 5757
\end{aligned}
$` },
            {
                id: "4", type: "top", text: "Multiply $345$ by $67$.", answer: "23115", working: String.raw`$
\begin{array}{cccccccccccccc}
    &                &    3    &    4    &   5 \\
    &    {}\times    &         &    6    &   7 \\
\hline
    &        2       &    4    &    1    &   5 \\
2   &        0       &    7    &    0    &   0 \\
\hline
2   &        3       &    1    &    1    &   5
\end{array}
$` },
            {
                id: "5", type: "top", text: "Divide $3112$ by $8$.", answer: "389", working: String.raw`$
\begin{aligned}
&= \dfrac{3112}{8} \\\\
&= \dfrac{389 \times 8}{8} \\\\
&= \dfrac{389 \times \cancel{8}}{\cancel{8}} \\\\
&= 389
\end{aligned}
$` },
            {
                id: "6", type: "top", text: "Fill in the missing numbers.", answer: "68", working: String.raw`Let the missing number $= a$
As per the question,
$
\begin{aligned}
55 + a                              &= 82 \\\\
a                                   &= 82 - 55 \\\\
a                                   &= 27
\end{aligned}
$
Missing number $= 27$`, children: [
                    {
                        id: "6a", text: "Angus and his six friends have collected $756$ football stickers, which they all share out equally. How many stickers do they each get?", answer: "108", working: String.raw`$
\begin{aligned}
\text{Stickers each get}                 &= \dfrac {\text{Total stickers}} {\text{Total people}} \\\\
                                              &= \dfrac {756} {7} \\\\
                                              &= \dfrac {7 \times 108} {7} \\\\
                                              &= \dfrac {\cancel{7} \times 108} {\cancel{7}} \\\\
                                              &= 108
\end{aligned}
$`},
                    {
                        id: "6b", text: "Today is Emma's $29 ^ \\text{th}$ birthday. How many months old is she?", answer: "348 months", working: String.raw`$
\begin{aligned}
\text{Emma's age in month}                    &= 29 \times 12 \\\\
                                              &= 348 \ \text{months}
\end{aligned}
$`},
                    {
                        id: "6c", text: "Amar works for $45$ weeks each year. His total cost of travelling to and from work is $\\pounds 630$ each year. How much is that per week?", answer: "£14", working: String.raw`$
\begin{aligned}
\text{Travelling cost per week}        &= \dfrac {\text{Total cost each year}} {\text{No. of weeks}} \\\\
                                              &= \dfrac {630} {45} \\\\
                                              &= \dfrac {14 \times 45} {45} \\\\
                                              &= \dfrac {14 \times \cancel{45}} {\cancel{45}} \\\\
                                              &= \pounds 14
\end{aligned}
$` }
                ]
            },
            {
                id: "7", type: "top", text: "Decimals and number lines.", answer: "27", working: String.raw`Let the missing number $= a$`, children: [
                    {
                        id: "7a", text: "Look at these four decimals: $0.86 \\quad 0.9 \\quad 0.17 \\quad 0.73$", answer: "27", working: "Working shown below", children: [
                            { id: "7ai", text: "Write down the largest amount.", answer: "0.9", working: "0.9" },
                            {
                                id: "7aii", text: "Find the difference between the largest and smallest amounts.", answer: "0.73", working: String.raw`$
\begin{aligned}
\text{Difference}  &= 0.9 - 0.17 \\\\
                   &= 0.73
\end{aligned}
$`}
                        ]
                    },
                    {
                        id: "7b", text: "Here is a part of a number line. Write the two missing numbers in the boxes. \n Diagram: [Coordinate Grid Placeholder]", answer: "1.5, 2.5", working: String.raw`$
\begin{aligned}
\text{1} ^ \text{st} \text{ missing number}     &= 2 - \dfrac{1}{4} - \dfrac{1}{4} \\\\
                                                &= 2 - 0.5 \\\\
                                                &= 1.5 \\\\
\text{2} ^ \text{nd} \text{ missing number}     &= 2 + 0.25 + 0.25 \\\\
                                                &= 2 + 0.5 \\\\
                                                &= 2.5
\end{aligned}
$`, diagram: "coordinate"
                    }
                ]
            },
            {
                id: "8", type: "top", text: "The jug contains some orange squash. How much water must be added to make $500 \\ \\text{millilitres}$ of drink? \n Diagram: [Bar/Jug Placeholder]", diagram: "bar", answer: "360 ml", working: String.raw`As per the diagram,
$
\begin{aligned}
\text{Water required}                         &= 500 - 140 \\\\
                                              &= 360 \ \text{ml}
\end{aligned}
$` },
            {
                id: "10b", type: "top", text: "Jo and Aisha bought identical jeans. Jo got $10\\%$ discount. Aisha got $15\\%$ discount. Jo paid $\\pounds 1.20$ more. What was the full price?", answer: "£24", working: String.raw`Let the full price of the jeans $= p$
Jo got $10 \%$ discount and Aisha got $15 \%$ discount. So Jo paid $15 - 10 = 5 \%$ more of the full price.
As per the question,
$
\begin{aligned}
5 \% \ \text{of} \ p        &= 1.20 \\\\
\dfrac {5} {100} \times p   &= 1.20 \\\\
p                           &= \dfrac {1.20 \times 100} {5} \\\\
p                           &= \dfrac {1.20 \times 20 \times 5} {5} \\\\
p                           &= \dfrac {1.20 \times 20 \times \cancel{5}} {\cancel{5}} \\\\
p                           &= 1.20 \times 20 \\\\
p                           &= \pounds 24
\end{aligned}
$
Full price of the jeans $= \pounds 24$`, alternativeWorking: String.raw`Let the full price of the jeans $= p$
As per the question,
$
\begin{aligned}
(p - 10 \% \ \text{of} \ p)  - (p - 15 \% \ \text{of} \ p)  &= 1.20 \\\\
p - 10 \% \ \text{of} \ p  - p + 15 \% \ \text{of} \ p      &= 1.20 \\\\
15 \% \ \text{of} \ p - 10 \% \ \text{of} \ p               &= 1.20 \\\\
5 \% \ \text{of} \ p                                        &= 1.20 \\\\
\dfrac {5} {100} \times p                                   &= 1.20 \\\\
p                                                           &= \dfrac {1.20 \times 100} {5} \\\\
p                                                           &= \dfrac {1.20 \times 20 \times 5} {5} \\\\
p                                                           &= \dfrac {1.20 \times 20 \times \cancel{5}} {\cancel{5}} \\\\
p                                                           &= 1.20 \times 20 \\\\
p                                                           &= \pounds 24
\end{aligned}
$
Full price of the jeans $= \pounds 24$` },
            {
                id: "26", type: "top", text: "Planet Cash Addition sum.", diagram: "table", answer: "68", working: "See subparts", children: [
                    {
                        id: "26a", text: "How many Tinkles make one Clink?", answer: "6", working: String.raw`From the Tinkles column, the sum given in the table is less than $15$, so there is a carry of $15 - 3 = 12$ Tinkles.
From the Clinks column, the sum given in the table is more than $6$, so there is a carry of $8 - 6 = 2$ Clinks.
This means that $12$ Tinkles make $2$ Clinks.
$
\begin{aligned}
\text{Total Clinks}             &= 2 + 2 + 1 + 1 \\\\
                                &= 6 \\\\
\text{Total Tinkles}            &= 5 + 4 + 3 + 3 \\\\
                                &= 15 \\\\
\text{Carry over Tinkles}        &= 15 - 3 \\\\
                                &= 12 \\\\
\text{Carry over Clinks}         &= 8 - 6 \\\\
                                &= 2 \\\\
\text{Tinkles per Clink}      &= \dfrac {12} {2} \\\\
                                        &= 6
\end{aligned}
$
Answer: $6$ Tinkles make $1$ Clink`},
                    {
                        id: "26b", text: "Work out the answer to this subtraction.", answer: "1 Clink + 4 Tinkles", working: String.raw`$
\begin{aligned}
1 \text{st number}                     &= 4 \ \text{Clinks} + 3 \ \text{Tinkles} \\\\
                                        &= 4 \times 6 \ \text{Tinkles} + 3 \ \text{Tinkles} \\\\
                                        &= 24 + 3 \\\\
                                        &= 27 \ \text{Tinkles} \\\\
2 \text{nd number}                    &= 2 \ \text{Clinks} + 5 \ \text{Tinkles} \\\\
                                        &= 2 \times 6 \ \text{Tinkles} + 5 \ \text{Tinkles} \\\\
                                        &= 12 + 5 \\\\
                                        &= 17 \ \text{Tinkles} \\\\
\text{Difference}                      &= 27 - 17 \\\\
                                        &= 10 \ \text{Tinkles} \\\\
                                        &= 1 \ \text{Clink} + 4 \ \text{Tinkles}
\end{aligned}
$`},
                    {
                        id: "26c", text: "Work out the answer to this division.", answer: "1 Clink + 5 Tinkles", working: String.raw`$
\begin{aligned}
\text{Number}                     &= 7 \ \text{Clinks} + 2 \ \text{Tinkles} \\\\
                                        &= 7 \times 6 \ \text{Tinkles} + 2 \ \text{Tinkles} \\\\
                                        &= 42 + 2 \\\\
                                        &= 44 \ \text{Tinkles} \\\\
\text{Answer}                       &= \dfrac {44} {4} \\\\
                                        &= \dfrac {4 \times 11} {4} \\\\
                                        &= \dfrac {\cancel 4 \times 11} {\cancel 4} \\\\
                                        &= 11 \ \text{Tinkles} \\\\
                                        &= 1 \ \text{Clink} + 5 \ \text{Tinkles}
\end{aligned}
$`}
                ]
            },
            {
                id: "49", type: "top", text: "A company makes bricks... What is the maximum number of bricks which can be fitted into the packing case?", diagram: "geometry", answer: "480", working: String.raw`$
\begin{aligned}
\text{Maximum number of blocks}                                                    &= \dfrac {\text{Volume of case}} {\text{Volume of brick}} \\\\
                                                                                   &= \dfrac {200 \times 180 \times 120} {30 \times 20 \times 15} \\\\
                                                                                   &= \dfrac {20 \times 2 \times 5 \times 30 \times 3 \times 2 \times 120} {30 \times 20 \times 5 \times 3} \\\\
                                                                                   &= \dfrac {\cancel{20} \times 2 \times \cancel{5} \times \cancel{30} \times \cancel{3} \times 2 \times 120} {\cancel{30} \times \cancel{20} \times \cancel{5} \times \cancel{3}} \\\\
                                                                                   &= 2 \times 2 \times 120 \\\\
                                                                                   &= 480
\end{aligned}
$` },
            {
                id: "50", type: "top", text: "There are 3 moos in a quack and 13 quacks in an oink.", answer: "", working: "", children: [
                    {
                        id: "50a", text: "How many moos are there in 3 quacks and 1 oink?", answer: "48 moos", working: String.raw`$
\begin{aligned}
&= 3 \ \text {quacks} + 1 \ \text {oink} \\\\
&= 3 \ \text {quacks} + 13 \ \text {quacks} \\\\
&= 16 \ \text {quacks} \\\\
&= 16 \times 3 \ \text {moos} \\\\
&= 48 \ \text {moos}
\end{aligned}
$`},
                    {
                        id: "50b", text: "What fraction of an oink does 9 moos represent?", answer: "3/13", working: String.raw`$
\begin{aligned}
1 \ \text {oink}           &= 13 \ \text {quacks} \\\\
1 \ \text {quack}           &= 3 \ \text {moos} \\\\
1 \ \text {oink}            &= 13 \times (3 \ \text {moos}) \\\\
1 \ \text {oink}            &= 39 \ \text {moos} \\\\
1 \ \text {moo}             &= \dfrac {1} {39} \ \text {oink} \\\\
9 \ \text {moos}            &= 9 \times \dfrac {1} {39} \ \text {oink} \\\\
9 \ \text {moos}            &= \dfrac {9} {39} \ \text {oink} \\\\
                          &= \dfrac {3 \times 3} {3 \times 13} \\\\
                          &= \dfrac {3} {13} \ \text {oink}
\end{aligned}
$`},
                    {
                        id: "50c", text: "800 moos are sorted into piles 2 oinks high. How many complete piles... left over?", answer: "10 piles, 6 quacks, 2 moos", working: String.raw`$
\begin{aligned}
\text{1 oink}             &= 39 \ \text{moos} \\\\
\text{1 pile (2 oinks)}   &= 2 \times 39 \\\\
                          &= 78 \ \text{moos} \\\\
\text{Number of piles}    &= \dfrac{\text{Total number of Moos}}{\text{Number of moos per pile}} \\\\
                          &= \dfrac{800}{78} \\\\
                          &= 10 \ \text{remainder} \ 20 \\\\
\text{Complete piles}     &= 10 \\\\
\text{Leftover}           &= 20 \ \text{moos} \\\\
                          &= \dfrac{20}{3} \ \text{quacks} \\\\
                          &= 6 \ \text{quacks} + 2 \ \text{moos}
\end{aligned}
$
piles $= 10$
quacks $= 6$
moos $= 2$`}
                ]
            },
            // Additional generic placeholders for bulk generation
            { id: "Generic", type: "top", text: "Calculate $123 \times 45$.", answer: "5535", working: "$123 \\times 45 = 5535$" }
        ];

        // --- Derived Section Content (Closed Sets) ---
        const keepInMindOptions = [
            "Use the correct order of operations (BIDMAS).",
            "Check units and convert if needed.",
            "Line up digits carefully when adding or subtracting.",
            "When dividing by a fraction, multiply by the reciprocal.",
            "Show each step clearly; don’t do too much in one line.",
            "Write the final answer with the correct unit."
        ];

        const formulasOptions = [
            "Percentage = (part ÷ whole) × 100%",
            "Area of triangle = ½ × base × height",
            "Area of square = side²",
            "Perimeter of square = 4 × side",
            "Speed = distance ÷ time",
            "1 m = 100 cm",
            "1 kg = 1000 g"
        ];

        // --- Logic ---

        // SVG Generators
        const getDiagram = (type) => {
            if (!type) return '';
            let svgContent = '';
            if (type === 'bar') {
                svgContent = `<rect x="10" y="10" width="40" height="80" fill="#f0f0f0" stroke="#999"/><rect x="60" y="30" width="40" height="60" fill="#e0e0e0" stroke="#999"/>`;
            } else if (type === 'geometry') {
                svgContent = `<path d="M50 10 L90 90 L10 90 Z" fill="#f9f9f9" stroke="#555"/><circle cx="150" cy="50" r="40" stroke="#555" fill="none"/>`;
            } else if (type === 'coordinate') {
                svgContent = `<line x1="10" y1="50" x2="190" y2="50" stroke="#555"/><line x1="100" y1="10" x2="100" y2="90" stroke="#555"/><circle cx="130" cy="30" r="3" fill="#333"/>`;
            } else {
                svgContent = `<rect x="10" y="10" width="180" height="80" fill="none" stroke="#ddd"/><line x1="10" y1="40" x2="190" y2="40" stroke="#ddd"/>`;
            }
            return `<div class="diagram-container"><svg class="diagram-svg" viewBox="0 0 200 100" width="300" height="150">${svgContent}</svg></div>`;
        };

        // Dataset Generator
        function generateDataset(type) {
            let questions = [];
            let source = [...questionBank]; // Clone

            // Helper to get Q by ID or fallback
            const getQ = (id) => source.find(q => q.id === id) || source[source.length - 1];

            if (type === 'short') {
                questions = [
                    getQ("1"), getQ("2"), getQ("3"), getQ("4"), getQ("5"), getQ("6")
                ];
            } else if (type === 'diagram') {
                // Diagram heavy
                questions = [getQ("8"), getQ("7"), getQ("26"), getQ("49")];
                // Fill remaining to 20
                for (let i = 0; i < 16; i++) {
                    let q = JSON.parse(JSON.stringify(getQ("Generic")));
                    q.id = (5 + i).toString();
                    if (i % 3 === 0) { q.diagram = 'geometry'; q.text += " \n Diagram: [Geometry]"; }
                    questions.push(q);
                }
            } else {
                // Standard / Sectioned / Expanded
                // Generate 35 questions
                // Use exemplars for first few, then fillers, then long ones
                questions.push(getQ("1"), getQ("2"), getQ("3"), getQ("4"), getQ("5"), getQ("6"), getQ("7"), getQ("8"), getQ("10b"), getQ("26"), getQ("49"), getQ("50"));

                // Fill gaps to 25
                for (let i = 13; i <= 25; i++) {
                    let q = JSON.parse(JSON.stringify(getQ("Generic")));
                    q.id = i.toString();
                    questions.push(q);
                }
                // Long algebra Q26-35 (mapped to IDs 26-35)
                for (let i = 26; i <= 35; i++) {
                    let q = JSON.parse(JSON.stringify(getQ("26"))); // Use Q26 as base for long
                    q.id = i.toString();
                    questions.push(q);
                }
            }

            // Apply Stress Test: Distribution of Derived Sections (3A)
            const N = questions.length;
            const base = Math.floor(N / 4);
            let remainder = N - (base * 4);

            // Groups: 0:Neither, 1:Keep, 2:Formulas, 3:Both
            // Remainder order: Both, Keep, Formulas, Neither

            const assignments = [];
            for (let i = 0; i < base; i++) assignments.push('neither', 'keep', 'formulas', 'both');
            if (remainder > 0) { assignments.push('both'); remainder--; }
            if (remainder > 0) { assignments.push('keep'); remainder--; }
            if (remainder > 0) { assignments.push('formulas'); remainder--; }

            // Shuffle assignments slightly or just map sequentially to mix it up
            // Simple map
            questions.forEach((q, idx) => {
                q.derived = assignments[idx % assignments.length];
            });

            // 3B Deep Nesting: Ensure at least 2 have depth. Q1 and Q7 already have it.
            // 3A.1 Alt Working: Q10b has it.

            return questions;
        }

        // HTML Renderer
        function renderPaper(datasetType) {
            const questions = generateDataset(datasetType);
            const navContainer = document.getElementById('nav-list-container');
            const contentContainer = document.getElementById('paper-content');
            const expandedByDefault = datasetType === 'standard-expanded';

            navContainer.innerHTML = '';
            contentContainer.innerHTML = '';

            questions.forEach((q, index) => {
                // Render Question Block
                const qBlock = document.createElement('div');
                qBlock.className = 'question-block';
                qBlock.id = `q-${q.id}`;
                qBlock.setAttribute('data-id', q.id);

                // Structure: Question -> Answer -> Solution Details
                // Recursively handle subquestions if top-level structure allows.
                // But strict brief says Top Level Q -> Sub Qs.
                // We'll render content recursively.

                const renderRecursive = (item, level = 0, parentId = '') => {
                    const wrapper = document.createElement('div');
                    wrapper.className = level === 0 ? '' : (level === 1 ? 'question-block sub-question' : 'question-block sub-sub-question');

                    // Header
                    const header = document.createElement('div');
                    header.className = 'question-header';
                    header.innerHTML = `
                    <span class="q-id">${item.id}</span>
                    <div class="q-text">
                        ${item.text}
                        ${getDiagram(item.diagram)}
                    </div>
                `;
                    wrapper.appendChild(header);

                    // Answer
                    if (item.answer) {
                        const ansDiv = document.createElement('div');
                        ansDiv.className = 'answer-section';
                        ansDiv.innerHTML = `
                        <span class="answer-label">Answer</span>
                        <span class="answer-value">$${item.answer}$</span>
                    `;
                        wrapper.appendChild(ansDiv);
                    }

                    // Solution Details (if working exists or children exist with working)
                    if (item.working || item.derived || item.alternativeWorking) {
                        const detailsDiv = document.createElement('div');
                        detailsDiv.className = 'solution-details';

                        const isExpanded = expandedByDefault;

                        // Toggle
                        const btn = document.createElement('button');
                        btn.className = 'disclosure-control';
                        btn.setAttribute('aria-expanded', isExpanded);
                        btn.setAttribute('aria-controls', `details-${item.id}`);
                        btn.innerHTML = `
                        <span class="label-text">${isExpanded ? 'Hide working' : 'Show working'}</span>
                        <svg class="chevron" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
                    `;

                        const contentDiv = document.createElement('div');
                        contentDiv.id = `details-${item.id}`;
                        contentDiv.className = 'details-content';
                        contentDiv.setAttribute('data-visible', isExpanded);

                        // 1. Keep in mind
                        if ((item.derived === 'keep' || item.derived === 'both') && keepInMindOptions.length > 0) {
                            contentDiv.innerHTML += `
                            <div class="derived-section">
                                <div class="derived-label">
                                    <svg viewBox="0 0 24 24"><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>
                                    Keep in mind
                                </div>
                                <div class="derived-body">
                                    <ul><li>${keepInMindOptions[Math.floor(Math.random() * keepInMindOptions.length)]}</li></ul>
                                </div>
                            </div>
                        `;
                        }

                        // 2. Formulas
                        if ((item.derived === 'formulas' || item.derived === 'both') && formulasOptions.length > 0) {
                            contentDiv.innerHTML += `
                            <div class="derived-section">
                                <div class="derived-label">Formulas used</div>
                                <div class="derived-body">
                                    <ul class="formulas-list"><li>${formulasOptions[Math.floor(Math.random() * formulasOptions.length)]}</li></ul>
                                </div>
                            </div>
                        `;
                        }

                        // 3. Working
                        if (item.working) {
                            contentDiv.innerHTML += `
                            <div class="working-section">
                                <div class="working-label">Working</div>
                                <div class="working-body">${item.working.replace(/\n/g, '<br>')}</div>
                            </div>
                        `;
                        }

                        // 4. Alt Working
                        if (item.alternativeWorking) {
                            contentDiv.innerHTML += `
                            <div class="working-section">
                                <div class="working-label">Alternative working</div>
                                <div class="working-body">${item.alternativeWorking.replace(/\n/g, '<br>')}</div>
                            </div>
                        `;
                        }

                        // Wire toggle
                        btn.onclick = () => {
                            const expanded = btn.getAttribute('aria-expanded') === 'true';
                            btn.setAttribute('aria-expanded', !expanded);
                            btn.querySelector('.label-text').textContent = !expanded ? 'Hide working' : 'Show working';
                            contentDiv.setAttribute('data-visible', !expanded);
                        };

                        detailsDiv.appendChild(btn);
                        detailsDiv.appendChild(contentDiv);
                        wrapper.appendChild(detailsDiv);
                    }

                    // Nav Item
                    const navItem = document.createElement('li');
                    const navLink = document.createElement('a');
                    navLink.className = 'nav-item';
                    navLink.textContent = item.id;
                    navLink.onclick = (e) => {
                        e.preventDefault();
                        document.getElementById(`q-${item.id}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
                        // Highlight logic handled by IntersectionObserver
                        // Close mobile drawer if open
                        document.getElementById('nav-rail').classList.remove('mobile-open');
                        document.getElementById('mobile-overlay').classList.remove('active');
                    };
                    navItem.appendChild(navLink);
                    navContainer.appendChild(navItem);

                    // Children
                    if (item.children) {
                        item.children.forEach(child => {
                            // Render child inside parent wrapper
                            wrapper.appendChild(renderRecursive(child, level + 1, item.id));
                        });
                    }

                    return wrapper;
                };

                const renderedQ = renderRecursive(q);

                // For top level, append to content
                // We need to re-wrap nav items if they were sub-questions? 
                // The recursive function appends nav items linearly which is correct for "flat list" nav.

                contentContainer.appendChild(renderedQ);

                // Section Separator Logic for Sectioned Paper
                if (datasetType === 'sectioned') {
                    if (index === 0) { addNavSeparator("Section A"); }
                    if (index === 35) { addNavSeparator("Section B"); }
                    if (index === 43) { addNavSeparator("Section C"); }
                }
            });

            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ],
                throwOnError: false
            });
        }

        function addNavSeparator(text) {
            const li = document.createElement('li');
            li.className = 'nav-section-label';
            li.textContent = text;
            const navList = document.getElementById('nav-list-container');
            // Insert before the last added items? 
            // Logic: The loop adds items. We need to inject separators at specific indices.
            // Actually, easiest to just insert at bottom since we proceed linearly.
            // We need to insert it *before* the current batch of Qs if it's the start.
            // Simplified: The nav generation inside recursion makes this tricky. 
            // Fix: Move Nav generation outside recursion or handle state.
            // Quick fix: Just insert at top of list for Section A, etc.
            // Re-implementation: The renderRecursive function appends to Nav immediately.
        }

        // Initial Render
        renderPaper('short');

        // Event Listeners
        document.getElementById('paper-select').addEventListener('change', (e) => {
            renderPaper(e.target.value);
        });

        // Mobile Nav
        const navRail = document.getElementById('nav-rail');
        const overlay = document.getElementById('mobile-overlay');

        document.getElementById('mobile-nav-toggle').addEventListener('click', () => {
            navRail.classList.add('mobile-open');
            overlay.classList.add('active');
        });

        overlay.addEventListener('click', () => {
            navRail.classList.remove('mobile-open');
            overlay.classList.remove('active');
        });

        // ScrollSpy for Active Nav
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('data-id');
                    // Remove active from all
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    // Add to current (match text content or store ref)
                    const link = Array.from(document.querySelectorAll('.nav-item')).find(l => l.textContent === id);
                    if (link) link.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -60% 0px' }); // Trigger near top

        // Observe after render
        const observeQuestions = () => {
            document.querySelectorAll('.question-block').forEach(q => observer.observe(q));
        };

        // Hook observer into render
        const originalRender = renderPaper;
        renderPaper = function (type) {
            originalRender(type);
            setTimeout(observeQuestions, 100);
        };

    </script>
</body>

</html>