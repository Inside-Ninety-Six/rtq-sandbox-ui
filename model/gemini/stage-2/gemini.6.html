<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Viewer - Prototype v3.5 (Refined)</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <style>
        /* --- RESET & BASE --- */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #fdfdfd;
            /* Near white */
            color: #111;
            line-height: 1.5;
            /* Single document scroll */
            height: auto;
            overflow-y: visible;
            scroll-behavior: smooth;
        }

        /* --- LAYOUT GRID --- */
        .app-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- HEADER (Paper Selector) --- */
        .app-header {
            background: #fff;
            border-bottom: 1px solid #eaeaea;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 64px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
        }

        .brand {
            font-weight: 700;
            font-size: 1.1rem;
            color: #222;
            letter-spacing: -0.01em;
        }

        .brand span {
            font-weight: 400;
            color: #777;
            font-size: 0.9em;
            margin-left: 0.3em;
        }

        .selector-group {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .selector-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #666;
        }

        select {
            padding: 0.4rem 0.8rem;
            font-size: 0.9rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            color: #333;
            cursor: pointer;
        }

        /* --- MAIN CONTENT WRAPPER --- */
        .paper-wrapper {
            display: flex;
            flex: 1;
            max-width: 1024px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        /* --- NAVIGATION RAIL (Desktop Sticky) --- */
        .nav-rail {
            width: 200px;
            flex-shrink: 0;
            padding-top: 3rem;
            margin-right: 3rem;

            /* Sticky Logic */
            position: sticky;
            top: 64px;
            /* Header height */
            align-self: flex-start;
            height: calc(100vh - 64px);

            /* Scrollable without visible bars */
            overflow-y: auto;
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE/Edge */
        }

        .nav-rail::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            padding-bottom: 4rem;
        }

        .nav-section-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 1.5rem 0 0.5rem 0;
            padding-left: 0.8rem;
        }

        .nav-item {
            margin-bottom: 0;
        }

        .nav-link {
            display: block;
            padding: 0.3rem 0;
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
            transition: color 0.1s;
            border-left: 2px solid transparent;
            padding-left: 0.8rem;
        }

        .nav-link:hover {
            color: #000;
        }

        .nav-link.active {
            font-weight: 600;
            color: #000;
            border-left-color: #000;
        }

        /* Nesting Indentation in Nav */
        .nav-indent-1 {
            padding-left: 1.5rem;
        }

        .nav-indent-2 {
            padding-left: 2.2rem;
            font-size: 0.85rem;
        }

        /* --- PAPER CONTENT --- */
        .paper-content {
            flex: 1;
            background: #fdfdfd;
            padding: 4rem 0 8rem 0;
            min-height: 80vh;
            /* Ensure no horizontal scroll at page level */
            overflow-x: hidden;
        }

        /* --- QUESTION BLOCK --- */
        .q-block {
            margin-bottom: 4rem;
            position: relative;
            scroll-margin-top: 80px;
        }

        .depth-0 {
            margin-left: 0;
        }

        .depth-1 {
            margin-left: 2.5rem;
        }

        .depth-2 {
            margin-left: 5rem;
        }

        .q-header {
            display: flex;
            align-items: baseline;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .q-num {
            font-weight: 700;
            font-size: 1.1rem;
            color: #000;
            min-width: 2rem;
            flex-shrink: 0;
        }

        .q-text {
            font-size: 1.1rem;
            color: #111;
            line-height: 1.6;
            max-width: 100%;
        }

        /* Inline Math Stress Handling */
        .q-text .katex {
            font-size: 1.05em;
            line-height: 1.1;
        }

        /* Section Headers */
        .doc-section-header {
            margin-top: 6rem;
            margin-bottom: 3rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
        }

        .doc-section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #000;
        }

        .doc-section-sub {
            font-size: 0.95rem;
            color: #666;
            margin-top: 0.3rem;
        }

        /* Diagrams */
        .diagram-wrapper {
            margin: 1.5rem 0;
            display: block;
        }

        svg {
            display: block;
            max-width: 100%;
            height: auto;
            opacity: 0.85;
        }

        /* Answer Component */
        .answer-comp {
            margin-top: 1.2rem;
            padding-left: 1rem;
            border-left: 3px solid #222;
        }

        .ans-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #777;
            margin-bottom: 0.3rem;
        }

        .ans-value {
            font-size: 1.15rem;
            font-weight: 500;
            color: #000;
        }

        /* Working Component */
        .working-comp {
            margin-top: 1.5rem;
        }

        .working-toggle {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #555;
            transition: color 0.2s;
            margin-bottom: 0.5rem;
        }

        .working-toggle:hover {
            color: #000;
        }

        .working-toggle:focus {
            outline: 2px solid #000;
            outline-offset: 2px;
            border-radius: 2px;
        }

        .toggle-icon {
            font-size: 0.7rem;
            transition: transform 0.2s;
        }

        .working-toggle[aria-expanded="true"] .toggle-icon {
            transform: rotate(90deg);
        }

        .working-body {
            display: none;
            margin-top: 0.8rem;
            padding-left: 1rem;
            border-left: 1px solid #ddd;
            color: #222;
            /* Limit width to prevent accidental layout blowouts before scroll takes over */
            max-width: 100%;
        }

        .working-body[data-visible="true"] {
            display: block;
        }

        /* Math Lines & Overflow Handling */
        .math-line {
            margin-bottom: 0.4rem;
            min-height: 1.5em;
            width: 100%;
            /* Overflow Safety Net */
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .text-line {
            margin-bottom: 0.6rem;
            font-style: italic;
            color: #555;
            font-size: 0.95rem;
        }

        .tier-label {
            font-family: monospace;
            font-size: 0.7rem;
            color: #e02e2e;
            /* Distinct color for stress test labels only */
            background: #fff0f0;
            padding: 1px 4px;
            border-radius: 3px;
            margin-right: 8px;
            vertical-align: text-bottom;
            display: inline-block;
            margin-bottom: 2px;
        }

        /* KaTeX Overrides for Layout Stability */
        .katex-display {
            margin: 0 !important;
            padding: 0.2em 0;
            text-align: left !important;
        }

        /* Ensure display math wrapper respects container width */
        .katex-display>.katex {
            white-space: normal !important;
            text-align: left;
        }

        .katex-html {
            overflow-x: visible;
            /* Let parent handle overflow */
        }

        /* --- MOBILE RESPONSIVENESS --- */
        .mobile-menu-btn {
            display: none;
        }

        .mobile-overlay {
            display: none;
        }

        @media (max-width: 900px) {
            .app-header {
                padding: 0 1rem;
            }

            .selector-label {
                display: none;
            }

            .nav-rail {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 280px;
                background: #fff;
                z-index: 2000;
                padding: 1.5rem;
                margin: 0;
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 10px 0 25px rgba(0, 0, 0, 0.1);
                height: 100vh;
            }

            .nav-rail.is-open {
                transform: translateX(0);
            }

            .paper-content {
                padding: 2rem 1.5rem;
            }

            .mobile-menu-btn {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                background: none;
                border: 1px solid #ccc;
                padding: 0.4rem 0.8rem;
                border-radius: 4px;
                font-size: 0.9rem;
                color: #333;
                cursor: pointer;
            }

            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.4);
                z-index: 1500;
                display: none;
            }

            .mobile-overlay.is-open {
                display: block;
            }

            .depth-1 {
                margin-left: 1rem;
            }

            .depth-2 {
                margin-left: 2rem;
            }
        }
    </style>
</head>

<body>

    <div class="app-layout">
        <header class="app-header">
            <button class="mobile-menu-btn" id="menuToggle" aria-label="Open Navigation">
                <span>☰</span> Index
            </button>
            <div class="brand">RTQ <span>Viewer</span></div>
            <div class="selector-group">
                <label for="paperSelect" class="selector-label">Paper:</label>
                <select id="paperSelect">
                    <option value="short">Short (6 Qs)</option>
                    <option value="standard">Standard (35 Qs)</option>
                    <option value="diagram">Diagrams (20 Qs)</option>
                    <option value="sectioned">Sectioned (A/B/C)</option>
                    <option value="expanded">Standard (Expanded)</option>
                </select>
            </div>
        </header>

        <div class="mobile-overlay" id="mobileOverlay"></div>

        <div class="paper-wrapper">
            <nav class="nav-rail" id="navRail" aria-label="Question Index">
                <div id="navContent">
                </div>
            </nav>

            <main class="paper-content" id="mainContent">
                <div style="text-align:center; padding: 4rem; color:#999;">Loading Paper...</div>
            </main>
        </div>
    </div>

    <script>
        /**
         * --- MATH STRESS DATA ---
         */

        const MATH_TIERS = {
            M: {
                label: "Tier M",
                tex: "f(x) = x^5 + 5x^4 + 10x^3 + 10x^2 + 5x + 1 + \\frac{d}{dx}(3x^2 + 2x)"
            },
            T: {
                label: "Tier T",
                tex: "\\int_{0}^{\\infty} \\frac{x^3}{e^x - 1} dx = \\frac{\\pi^4}{15} \\approx 6.493939402266829149096022179"
            },
            T_aligned: {
                label: "Tier T (Aligned)",
                tex: "\\begin{aligned} (a+b)^n &= \\sum_{k=0}^n {n \\choose k} a^{n-k} b^k \\\\ &= a^n + na^{n-1}b + \\dots + b^n \\end{aligned}"
            },
            D: {
                label: "Tier D",
                tex: "\\text{Total} = \\sum_{n=1}^{\\infty} \\frac{1}{n^2} + \\prod_{i=1}^{k} (x_i + y_i) + \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} + \\int_{-\\infty}^{\\infty} e^{-x^2} dx + \\lim_{x \\to 0} \\frac{\\sin x}{x}"
            },
            D_matrix: {
                label: "Tier D (Matrix)",
                tex: "\\det(A) = \\sum_{\\sigma \\in S_n} \\text{sgn}(\\sigma) \\prod_{i=1}^n a_{i,\\sigma(i)} = \\begin{pmatrix} a_{11} & a_{12} & \\cdots & a_{1n} \\\\ a_{21} & a_{22} & \\cdots & a_{2n} \\\\ \\vdots & \\vdots & \\ddots & \\vdots \\\\ a_{n1} & a_{n2} & \\cdots & a_{nn} \\end{pmatrix}"
            }
        };

        /**
         * --- DATA GENERATION ---
         */

        // SVG Templates (Grayscale)
        const SVGS = {
            geo: `<svg viewBox="0 0 200 120" width="200" height="120">
            <path d="M20,100 L100,20 L180,100 Z" fill="none" stroke="#333" stroke-width="1.5"/>
            <line x1="100" y1="20" x2="100" y2="100" stroke="#888" stroke-dasharray="4 4" stroke-width="1"/>
            <text x="90" y="115" font-family="sans-serif" font-size="11" fill="#444">base = 12cm</text>
            <text x="105" y="60" font-family="sans-serif" font-size="11" fill="#444">h</text>
          </svg>`,
            bar: `<svg viewBox="0 0 250 120" width="250" height="120">
            <line x1="20" y1="100" x2="230" y2="100" stroke="#444" stroke-width="1"/>
            <rect x="40" y="40" width="30" height="60" fill="#ddd"/>
            <rect x="90" y="20" width="30" height="80" fill="#bbb"/>
            <rect x="140" y="60" width="30" height="40" fill="#999"/>
            <text x="45" y="115" font-family="sans-serif" font-size="10" fill="#444">A</text>
            <text x="95" y="115" font-family="sans-serif" font-size="10" fill="#444">B</text>
            <text x="145" y="115" font-family="sans-serif" font-size="10" fill="#444">C</text>
          </svg>`,
            grid: `<svg viewBox="0 0 150 150" width="150" height="150">
            <defs><pattern id="g" width="15" height="15" patternUnits="userSpaceOnUse"><path d="M 15 0 L 0 0 0 15" fill="none" stroke="#eee" stroke-width="1"/></pattern></defs>
            <rect width="150" height="150" fill="url(#g)" stroke="#ccc"/>
            <line x1="75" y1="0" x2="75" y2="150" stroke="#666"/>
            <line x1="0" y1="75" x2="150" y2="75" stroke="#666"/>
            <line x1="0" y1="150" x2="150" y2="0" stroke="#222" stroke-width="1.5"/>
          </svg>`,
            table: `<svg viewBox="0 0 200 60" width="200" height="60">
            <rect x="0" y="0" width="200" height="60" fill="none" stroke="#666" stroke-width="1"/>
            <line x1="0" y1="30" x2="200" y2="30" stroke="#666" stroke-width="1"/>
            <line x1="100" y1="0" x2="100" y2="60" stroke="#666" stroke-width="1"/>
            <text x="50" y="20" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">x</text>
            <text x="150" y="20" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">y</text>
            <text x="50" y="50" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">2</text>
            <text x="150" y="50" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">?</text>
          </svg>`
        };

        // Math Steps Generator
        function genMath(count, stressType = null) {
            let arr = [];

            // Default filler steps
            const steps = [
                "x^2 + 4x + 4 = 0",
                "(x + 2)(x + 2) = 0",
                "x = -2",
                "\\frac{a}{b} + \\frac{c}{d} = \\frac{ad + bc}{bd}",
                "2x + 3y = 12",
                "y = 4 - \\frac{2}{3}x"
            ];

            // If a stress type is requested, inject it at the top
            if (stressType && MATH_TIERS[stressType]) {
                arr.push(`\\textbf{${MATH_TIERS[stressType].label}:}`);
                arr.push(MATH_TIERS[stressType].tex);
            }

            for (let i = 0; i < count; i++) {
                arr.push(steps[i % steps.length]);
            }
            return arr;
        }

        // Question Factory
        function createQ(id, num, depth, type, expanded = false, stressTier = null) {
            const isSub = depth > 0;
            const q = {
                id: id,
                num: num,
                depth: depth,
                text: isSub ? `Solve part ${num}.` : `Calculate the final value.`,
                answer: `x = ${Math.floor(Math.random() * 100)}`,
                working: genMath(type === 'long' ? 60 : 4, stressTier),
                diagram: null,
                expanded: expanded,
                sectionHeader: null
            };

            if (type === 'diagram') {
                const keys = Object.keys(SVGS);
                q.diagram = keys[Math.floor(Math.random() * keys.length)];
                q.text += " Refer to the diagram.";
            }

            if (type === 'long') {
                q.text = "This problem requires detailed algebraic derivation shown below (Stress Test: 60 lines).";
            }

            // Inline Math Stress Injection
            if (Math.random() > 0.8) {
                q.text += " Consider the expression $f(x) = \\sum_{n=0}^{\\infty} \\frac{f^{(n)}(a)}{n!} (x-a)^n$ which may cause line wrapping issues on smaller screens if not handled correctly.";
            }

            return q;
        }

        // Dataset Generators
        const DATASETS = {
            short: () => {
                let qs = [];
                for (let i = 1; i <= 5; i++) qs.push(createQ(`q${i}`, `${i}`, 0, 'short'));
                qs.push(createQ('q6', '6', 0, 'short'));
                qs.push(createQ('q6a', 'a', 1, 'short'));
                qs.push(createQ('q6b', 'b', 1, 'short'));
                return qs;
            },
            standard: (forceExpand = false) => {
                let qs = [];
                for (let i = 1; i <= 35; i++) {
                    let type = i >= 26 ? 'long' : 'short';

                    // STRESS TEST INJECTION
                    let stress = null;
                    if (i === 26) stress = 'M';
                    if (i === 27) stress = 'M';
                    if (i === 28) stress = 'T';
                    if (i === 29) stress = 'T_aligned';
                    if (i === 30) stress = 'D';
                    if (i === 31) stress = 'D_matrix';

                    if (i === 18) { // Deep nesting
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'short', forceExpand));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'short', forceExpand));
                        qs.push(createQ(`q${i}ai`, `i`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}aii`, `ii`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}b`, `b`, 1, 'short', forceExpand));
                    } else if (i === 30) {
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'long', forceExpand, stress));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'long', forceExpand));
                    } else {
                        qs.push(createQ(`q${i}`, `${i}`, 0, type, forceExpand, stress));
                    }
                }
                return qs;
            },
            diagram: () => {
                let qs = [];
                for (let i = 1; i <= 20; i++) {
                    let type = (i <= 8) ? 'diagram' : 'short';
                    qs.push(createQ(`q${i}`, `${i}`, 0, type));
                }
                return qs;
            },
            sectioned: () => {
                let qs = [];
                let num = 1;
                // Section A
                let q1 = createQ(`q${num}`, `${num}`, 0, 'short');
                q1.sectionHeader = { title: "Section A", sub: "Arithmetic (35 Questions)" };
                qs.push(q1);
                for (let i = 2; i <= 35; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'short')); }

                // Section B
                num++;
                let qB = createQ(`q${num}`, `${num}`, 0, 'short');
                qB.sectionHeader = { title: "Section B", sub: "Applied Maths (8 Questions)" };
                qs.push(qB);
                for (let i = 2; i <= 8; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'diagram')); }

                // Section C
                num++;
                let qC = createQ(`q${num}`, `${num}`, 0, 'long');
                qC.sectionHeader = { title: "Section C", sub: "Extended Reasoning (6 Questions)" };
                qs.push(qC);
                for (let i = 2; i <= 6; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'long')); }

                return qs;
            }
        };

        /**
         * --- RENDER ENGINE ---
         */

        function render(paperKey) {
            const container = document.getElementById('mainContent');
            const navContainer = document.getElementById('navContent');
            const isExpandedVariant = paperKey === 'expanded';
            const key = isExpandedVariant ? 'standard' : paperKey;

            const data = DATASETS[key](isExpandedVariant);

            let mainHTML = '';
            let navHTML = '<ul class="nav-list">';

            data.forEach(q => {
                // Nav Section
                if (q.sectionHeader) {
                    navHTML += `<li class="nav-section-label">${q.sectionHeader.title}</li>`;
                }

                // Nav Item
                let indentClass = q.depth === 1 ? 'nav-indent-1' : (q.depth === 2 ? 'nav-indent-2' : '');
                navHTML += `<li class="nav-item">
            <a href="#${q.id}" class="nav-link ${indentClass}">${q.num}</a>
        </li>`;

                // Doc Section Header
                if (q.sectionHeader) {
                    mainHTML += `
            <div class="doc-section-header">
                <div class="doc-section-title">${q.sectionHeader.title}</div>
                <div class="doc-section-sub">${q.sectionHeader.sub}</div>
            </div>`;
                }

                // Question
                let diagramHTML = q.diagram ? `<div class="diagram-wrapper">${SVGS[q.diagram]}</div>` : '';

                // Math Lines Construction
                let workingLines = q.working.map(line => {
                    if (line.startsWith('\\text')) {
                        return `<div class="text-line">${line.replace('\\text{', '').replace('}', '')}</div>`;
                    } else if (line.startsWith('\\textbf')) {
                        // Render Label
                        return `<div style="margin-top:10px;"><span class="tier-label">${line.replace('\\textbf{', '').replace(':}', '')}</span></div>`;
                    } else {
                        return `<div class="math-line">$$ ${line} $$</div>`;
                    }
                }).join('');

                let toggleState = q.expanded ? 'true' : 'false';
                let displayState = q.expanded ? 'true' : 'false';
                let iconRotation = q.expanded ? 'style="transform: rotate(90deg)"' : '';

                mainHTML += `
        <article class="q-block depth-${q.depth}" id="${q.id}">
            <div class="q-header">
                <div class="q-num">${q.num}</div>
                <div class="q-text">
                    ${q.text}
                    ${diagramHTML}
                </div>
            </div>
            
            <div class="answer-comp">
                <span class="ans-label">Answer</span>
                <span class="ans-value">$$ ${q.answer} $$</span>
            </div>

            <div class="working-comp">
                <button class="working-toggle" aria-expanded="${toggleState}" onclick="toggleW(this)">
                    <span class="toggle-icon" ${iconRotation}>▶</span> Show Working
                </button>
                <div class="working-body" data-visible="${displayState}">
                    ${workingLines}
                </div>
            </div>
        </article>`;
            });

            navHTML += '</ul>';

            container.innerHTML = mainHTML;
            navContainer.innerHTML = navHTML;

            // Trigger KaTeX
            if (window.renderMathInElement) {
                renderMathInElement(container, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ],
                    throwOnError: false
                });
            }
        }

        // Interaction: Toggle Working
        window.toggleW = function (btn) {
            const body = btn.nextElementSibling;
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            const icon = btn.querySelector('.toggle-icon');

            btn.setAttribute('aria-expanded', !expanded);
            body.setAttribute('data-visible', !expanded);
            icon.style.transform = !expanded ? 'rotate(90deg)' : 'rotate(0deg)';
        };

        // --- EVENT BINDING ---

        // Paper Selector
        document.getElementById('paperSelect').addEventListener('change', (e) => {
            render(e.target.value);
            window.scrollTo(0, 0);
        });

        // Mobile Menu
        const navRail = document.getElementById('navRail');
        const overlay = document.getElementById('mobileOverlay');

        function toggleMenu() {
            navRail.classList.toggle('is-open');
            overlay.classList.toggle('is-open');
        }

        document.getElementById('menuToggle').addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);

        // Nav Link Handling
        document.getElementById('navContent').addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');

                if (window.innerWidth <= 900) {
                    toggleMenu();
                }
            }
        });

        // Init
        window.onload = () => {
            setTimeout(() => render('short'), 100);
        };

    </script>
</body>

</html>