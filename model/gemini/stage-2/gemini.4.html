<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Viewer - Prototype v3.4 (Refined)</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>

    <style>
        /* --- RESET & BASE --- */
        * {
            box-sizing: border-box;
            border: solid 1px #f0f0f0;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #fcfcfc;
            /* Very light gray, almost white */
            color: #111;
            line-height: 1.5;
            height: auto;
            overflow-y: scroll;
            /* Main scroll on body */
            scroll-behavior: smooth;

            /* border: solid 1px #f0f0f0; */
        }

        /* --- LAYOUT GRID --- */
        .app-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- HEADER (Paper Selector) --- */
        .app-header {
            background: #fff;
            border-bottom: 1px solid #eee;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 60px;
        }

        .brand {
            font-weight: 700;
            font-size: 1rem;
            color: #333;
            letter-spacing: -0.02em;
        }

        .brand span {
            font-weight: 400;
            color: #888;
        }

        .selector-container {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .selector-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #666;
        }

        select {
            padding: 0.3rem 0.6rem;
            font-size: 0.9rem;
            border: 1px solid #ccc;
            border-radius: 3px;
            background: #fff;
            color: #333;
            cursor: pointer;
        }

        /* --- MAIN WRAPPER --- */
        .paper-wrapper {
            display: flex;
            flex: 1;
            max-width: 960px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        /* --- NAVIGATION RAIL (Sticky, Scrollable, Hidden Scrollbars) --- */
        .nav-rail {
            width: 160px;
            flex-shrink: 0;
            padding-top: 3rem;
            margin-right: 3rem;

            /* Sticky Logic */
            position: sticky;
            top: 60px;
            /* Offset for header */
            align-self: flex-start;
            height: calc(100vh - 60px);

            /* Scrollable but hidden scrollbars */
            overflow-y: auto;
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE/Edge */
        }

        .nav-rail::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            padding-bottom: 4rem;
        }

        .nav-section-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 1.5rem 0 0.5rem 0;
        }

        .nav-item {
            margin-bottom: 0;
        }

        .nav-link {
            display: block;
            padding: 0.25rem 0;
            text-decoration: none;
            color: #777;
            font-size: 0.85rem;
            transition: color 0.1s;
            border-left: 2px solid transparent;
            padding-left: 0.8rem;
        }

        .nav-link:hover {
            color: #000;
        }

        .nav-link.active {
            font-weight: 600;
            color: #000;
            border-left-color: #000;
        }

        /* Nav Indentation */
        .nav-indent-1 {
            margin-left: 0.5rem;
        }

        .nav-indent-2 {
            margin-left: 1rem;
        }

        /* --- PAPER CONTENT AREA --- */
        .paper-content {
            flex: 1;
            background: #fff;
            /* Pure white paper */
            padding: 3rem 0 6rem 0;
            /* Vertical breathing room */
            min-height: 80vh;
        }

        /* --- QUESTION BLOCK (De-tiled) --- */
        .q-block {
            margin-bottom: 3rem;
            /* Spacing instead of borders */
            padding-bottom: 1rem;
            /* Very subtle separator, relying mostly on whitespace */
            border-bottom: 1px solid #f5f5f5;
            scroll-margin-top: 80px;
        }

        .q-block:last-child {
            border-bottom: none;
        }

        /* Nesting (Indentation) */
        .depth-0 {
            margin-left: 0;
        }

        .depth-1 {
            margin-left: 2rem;
        }

        .depth-2 {
            margin-left: 4rem;
        }

        /* Header */
        .q-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .q-num {
            font-weight: 700;
            font-size: 1rem;
            color: #000;
            min-width: 24px;
            flex-shrink: 0;
        }

        .q-text {
            font-size: 1.05rem;
            color: #222;
            line-height: 1.6;
        }

        /* Section Headers inside the doc */
        .doc-section-header {
            margin-top: 5rem;
            margin-bottom: 2rem;
            padding-top: 1rem;
        }

        .doc-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #000;
        }

        .doc-section-sub {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.2rem;
        }

        /* Diagrams (Cleaned up) */
        .diagram-wrapper {
            margin: 1.5rem 0;
            display: flex;
            justify-content: flex-start;
            /* Left aligned usually better for reading flow in indent */
            opacity: 0.9;
        }

        /* Inverted grayscale diagrams for contrast on white */
        svg {
            display: block;
            max-width: 100%;
            height: auto;
        }

        /* Answer Component (Clean, Type-driven) */
        .answer-comp {
            margin-top: 1rem;
            padding-left: 1rem;
            /* Indent to separate from Q text */
            border-left: 2px solid #333;
            /* Minimal strong anchor */
        }

        .ans-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 0.2rem;
        }

        .ans-value {
            font-size: 1.1rem;
            font-weight: 500;
            color: #000;
        }

        /* Working Component (De-tiled) */
        .working-comp {
            margin-top: 1.5rem;
        }

        .working-toggle {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: #555;
            transition: color 0.2s;
            margin-bottom: 0.5rem;
        }

        .working-toggle:hover {
            color: #000;
        }

        .toggle-icon {
            font-size: 0.7rem;
            transition: transform 0.2s;
        }

        .working-toggle[aria-expanded="true"] .toggle-icon {
            transform: rotate(90deg);
        }

        .working-body {
            display: none;
            /* Collapsed */
            margin-top: 0.5rem;
            padding-left: 1rem;
            border-left: 1px solid #e0e0e0;
            /* Subtle guide line for the block */
            color: #333;
        }

        .working-body[data-visible="true"] {
            display: block;
        }

        /* Math Lines (Clean, no tiles) */
        .math-line {
            margin-bottom: 0.5rem;
            min-height: 1.5em;
            /* Ensure rhythm */
        }

        .text-line {
            margin-bottom: 0.5rem;
            font-style: italic;
            color: #666;
            font-size: 0.95rem;
        }

        /* --- MOBILE RESPONSIVENESS --- */
        .mobile-menu-btn {
            display: none;
        }

        .mobile-overlay {
            display: none;
        }

        @media (max-width: 900px) {
            .app-header {
                padding: 0 1rem;
            }

            .selector-label {
                display: none;
            }

            .nav-rail {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 260px;
                background: #fff;
                z-index: 2000;
                padding: 1.5rem;
                margin: 0;
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 4px 0 12px rgba(0, 0, 0, 0.05);
                height: 100vh;
            }

            .nav-rail.is-open {
                transform: translateX(0);
            }

            .paper-content {
                padding: 1.5rem 1rem;
            }

            .mobile-menu-btn {
                display: block;
                background: none;
                border: 1px solid #ccc;
                padding: 0.3rem 0.6rem;
                border-radius: 3px;
                font-size: 0.9rem;
                color: #333;
            }

            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.3);
                z-index: 1500;
                display: none;
            }

            .mobile-overlay.is-open {
                display: block;
            }

            /* Reduce indentation depth on mobile */
            .depth-1 {
                margin-left: 1rem;
            }

            .depth-2 {
                margin-left: 2rem;
            }
        }
    </style>
</head>

<body>

    <div class="app-layout">
        <header class="app-header">
            <button class="mobile-menu-btn" id="menuToggle">☰ Index</button>
            <div class="brand">RTQ <span>Viewer</span></div>
            <div class="selector-container">
                <label for="paperSelect" class="selector-label">Paper:</label>
                <select id="paperSelect">
                    <option value="short">Short (6 Qs)</option>
                    <option value="standard">Standard (35 Qs)</option>
                    <option value="diagram">Diagrams (20 Qs)</option>
                    <option value="sectioned">Sectioned (A/B/C)</option>
                    <option value="expanded">Standard (Expanded)</option>
                </select>
            </div>
        </header>

        <div class="mobile-overlay" id="mobileOverlay"></div>

        <div class="paper-wrapper">
            <nav class="nav-rail" id="navRail" aria-label="Question Index">
                <div id="navContent">
                </div>
            </nav>

            <main class="paper-content" id="mainContent">
                <div style="text-align:center; padding: 4rem; color:#999;">Loading Paper...</div>
            </main>
        </div>
    </div>

    <script>
        /**
         * --- DATA GENERATION & CONFIG ---
         */

        // SVG Templates (Minimalist Grayscale)
        const SVGS = {
            geo: `<svg viewBox="0 0 200 120" width="200" height="120">
            <path d="M20,100 L100,20 L180,100 Z" fill="none" stroke="#222" stroke-width="1.5"/>
            <line x1="100" y1="20" x2="100" y2="100" stroke="#888" stroke-dasharray="4 4" stroke-width="1"/>
            <text x="90" y="115" font-family="sans-serif" font-size="11" fill="#444">base = 12cm</text>
            <text x="105" y="60" font-family="sans-serif" font-size="11" fill="#444">h</text>
          </svg>`,
            bar: `<svg viewBox="0 0 250 120" width="250" height="120">
            <line x1="20" y1="100" x2="230" y2="100" stroke="#444" stroke-width="1"/>
            <rect x="40" y="40" width="30" height="60" fill="#ddd"/>
            <rect x="90" y="20" width="30" height="80" fill="#bbb"/>
            <rect x="140" y="60" width="30" height="40" fill="#999"/>
            <text x="45" y="115" font-family="sans-serif" font-size="10" fill="#444">A</text>
            <text x="95" y="115" font-family="sans-serif" font-size="10" fill="#444">B</text>
            <text x="145" y="115" font-family="sans-serif" font-size="10" fill="#444">C</text>
          </svg>`,
            grid: `<svg viewBox="0 0 150 150" width="150" height="150">
            <defs><pattern id="g" width="15" height="15" patternUnits="userSpaceOnUse"><path d="M 15 0 L 0 0 0 15" fill="none" stroke="#eee" stroke-width="1"/></pattern></defs>
            <rect width="150" height="150" fill="url(#g)" stroke="#ccc"/>
            <line x1="75" y1="0" x2="75" y2="150" stroke="#666"/>
            <line x1="0" y1="75" x2="150" y2="75" stroke="#666"/>
            <line x1="0" y1="150" x2="150" y2="0" stroke="#222" stroke-width="1.5"/>
          </svg>`,
            table: `<svg viewBox="0 0 200 60" width="200" height="60">
            <rect x="0" y="0" width="200" height="60" fill="none" stroke="#666" stroke-width="1"/>
            <line x1="0" y1="30" x2="200" y2="30" stroke="#666" stroke-width="1"/>
            <line x1="100" y1="0" x2="100" y2="60" stroke="#666" stroke-width="1"/>
            <text x="50" y="20" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">x</text>
            <text x="150" y="20" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">y</text>
            <text x="50" y="50" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">2</text>
            <text x="150" y="50" text-anchor="middle" font-family="sans-serif" font-size="11" fill="#333">?</text>
          </svg>`
        };

        // Math Steps Generator
        function genMath(count) {
            const steps = [
                "x^2 + 4x + 4 = 0",
                "(x + 2)(x + 2) = 0",
                "x = -2",
                "\\text{Area} = \\frac{1}{2} \\times b \\times h",
                "\\int_{0}^{\\infty} e^{-x} dx = 1",
                "\\frac{a}{b} + \\frac{c}{d} = \\frac{ad + bc}{bd}",
                "2x + 3y = 12",
                "3y = 12 - 2x",
                "y = 4 - \\frac{2}{3}x"
            ];
            let arr = [];
            for (let i = 0; i < count; i++) {
                arr.push(steps[i % steps.length]);
            }
            return arr;
        }

        // Question Factory
        function createQ(id, num, depth, type, expanded = false) {
            const isSub = depth > 0;
            const q = {
                id: id,
                num: num,
                depth: depth,
                text: isSub ? `Solve part ${num}.` : `Calculate the final value.`,
                answer: `x = ${Math.floor(Math.random() * 100)}`,
                working: genMath(type === 'long' ? 60 : 4), // 60 lines for long stress test
                diagram: null,
                expanded: expanded,
                sectionHeader: null
            };

            if (type === 'diagram') {
                const keys = Object.keys(SVGS);
                q.diagram = keys[Math.floor(Math.random() * keys.length)];
                q.text += " Refer to the diagram.";
            }

            if (type === 'long') {
                q.text = "This problem requires detailed algebraic derivation shown below.";
            }

            return q;
        }

        // Dataset Generators
        const DATASETS = {
            short: () => {
                let qs = [];
                for (let i = 1; i <= 5; i++) qs.push(createQ(`q${i}`, `${i}`, 0, 'short'));
                qs.push(createQ('q6', '6', 0, 'short'));
                qs.push(createQ('q6a', 'a', 1, 'short'));
                qs.push(createQ('q6b', 'b', 1, 'short'));
                return qs;
            },
            standard: (forceExpand = false) => {
                let qs = [];
                for (let i = 1; i <= 35; i++) {
                    let type = i >= 26 ? 'long' : 'short';
                    if (i === 18) { // Deep nesting test
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'short', forceExpand));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'short', forceExpand));
                        qs.push(createQ(`q${i}ai`, `i`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}aii`, `ii`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}b`, `b`, 1, 'short', forceExpand));
                    } else if (i === 30) { // Long working in deep nesting
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'long', forceExpand));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'long', forceExpand));
                    } else {
                        qs.push(createQ(`q${i}`, `${i}`, 0, type, forceExpand));
                    }
                }
                return qs;
            },
            diagram: () => {
                let qs = [];
                for (let i = 1; i <= 20; i++) {
                    let type = (i <= 8) ? 'diagram' : 'short';
                    qs.push(createQ(`q${i}`, `${i}`, 0, type));
                }
                return qs;
            },
            sectioned: () => {
                let qs = [];
                let num = 1;
                // Section A
                let q1 = createQ(`q${num}`, `${num}`, 0, 'short');
                q1.sectionHeader = { title: "Section A", sub: "Arithmetic (35 Questions)" };
                qs.push(q1);
                for (let i = 2; i <= 35; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'short')); }

                // Section B
                num++;
                let qB = createQ(`q${num}`, `${num}`, 0, 'short');
                qB.sectionHeader = { title: "Section B", sub: "Applied Maths (8 Questions)" };
                qs.push(qB);
                for (let i = 2; i <= 8; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'diagram')); }

                // Section C
                num++;
                let qC = createQ(`q${num}`, `${num}`, 0, 'long');
                qC.sectionHeader = { title: "Section C", sub: "Extended Reasoning (6 Questions)" };
                qs.push(qC);
                for (let i = 2; i <= 6; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'long')); }

                return qs;
            }
        };

        /**
         * --- RENDER ENGINE ---
         */

        function render(paperKey) {
            const container = document.getElementById('mainContent');
            const navContainer = document.getElementById('navContent');
            const isExpandedVariant = paperKey === 'expanded';
            const key = isExpandedVariant ? 'standard' : paperKey;

            const data = DATASETS[key](isExpandedVariant);

            let mainHTML = '';
            let navHTML = '<ul class="nav-list">';

            data.forEach(q => {
                // Nav Section Label
                if (q.sectionHeader) {
                    navHTML += `<li class="nav-section-label">${q.sectionHeader.title}</li>`;
                }

                // Nav Item
                let indentClass = q.depth === 1 ? 'nav-indent-1' : (q.depth === 2 ? 'nav-indent-2' : '');
                navHTML += `<li class="nav-item">
            <a href="#${q.id}" class="nav-link ${indentClass}">${q.num}</a>
        </li>`;

                // Main Content - Section Header
                if (q.sectionHeader) {
                    mainHTML += `
            <div class="doc-section-header">
                <div class="doc-section-title">${q.sectionHeader.title}</div>
                <div class="doc-section-sub">${q.sectionHeader.sub}</div>
            </div>`;
                }

                // Question Content
                let diagramHTML = q.diagram ? `<div class="diagram-wrapper">${SVGS[q.diagram]}</div>` : '';

                // Math Lines (De-tiled)
                let workingLines = q.working.map(line =>
                    line.startsWith('\\text')
                        ? `<div class="text-line">${line.replace('\\text{', '').replace('}', '')}</div>`
                        : `<div class="math-line">$$ ${line} $$</div>`
                ).join('');

                let toggleState = q.expanded ? 'true' : 'false';
                let displayState = q.expanded ? 'true' : 'false';

                mainHTML += `
        <article class="q-block depth-${q.depth}" id="${q.id}">
            <div class="q-header">
                <div class="q-num">${q.num}</div>
                <div class="q-text">
                    ${q.text}
                    ${diagramHTML}
                </div>
            </div>
            
            <div class="answer-comp">
                <span class="ans-label">Answer</span>
                <span class="ans-value">$$ ${q.answer} $$</span>
            </div>

            <div class="working-comp">
                <button class="working-toggle" aria-expanded="${toggleState}" onclick="toggleW(this)">
                    <span class="toggle-icon">▶</span> Show Working
                </button>
                <div class="working-body" data-visible="${displayState}">
                    ${workingLines}
                </div>
            </div>
        </article>`;
            });

            navHTML += '</ul>';

            container.innerHTML = mainHTML;
            navContainer.innerHTML = navHTML;

            // Trigger KaTeX rendering
            if (window.renderMathInElement) {
                renderMathInElement(container, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ],
                    throwOnError: false
                });
            }
        }

        // Global Interaction Handler
        window.toggleW = function (btn) {
            const body = btn.nextElementSibling;
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', !expanded);
            body.setAttribute('data-visible', !expanded);
        };

        // --- EVENTS ---

        // Paper Selector
        document.getElementById('paperSelect').addEventListener('change', (e) => {
            render(e.target.value);
            window.scrollTo(0, 0);
        });

        // Mobile Menu
        const navRail = document.getElementById('navRail');
        const overlay = document.getElementById('mobileOverlay');

        document.getElementById('menuToggle').addEventListener('click', () => {
            navRail.classList.add('is-open');
            overlay.classList.add('is-open');
        });

        overlay.addEventListener('click', () => {
            navRail.classList.remove('is-open');
            overlay.classList.remove('is-open');
        });

        // Nav Link Logic (Smooth scroll + Close mobile menu)
        document.getElementById('navContent').addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                // Active state
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');

                // Mobile close
                if (window.innerWidth <= 900) {
                    navRail.classList.remove('is-open');
                    overlay.classList.remove('is-open');
                }
            }
        });

        // Init
        window.onload = () => {
            setTimeout(() => render('short'), 50);
        };

    </script>
</body>

</html>