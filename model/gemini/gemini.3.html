<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Viewer - Prototype v3.4</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>

    <style>
        /* --- RESET & BASE --- */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f7f7f7;
            color: #333;
            line-height: 1.5;
            /* Force single document scroll */
            height: auto;
            overflow-y: visible;
            scroll-behavior: smooth;
        }

        /* --- LAYOUT GRID --- */
        .app-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- HEADER (Paper Selector) --- */
        .app-header {
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 70px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .brand {
            font-weight: 800;
            font-size: 1.1rem;
            color: #111;
            letter-spacing: -0.5px;
        }

        .brand span {
            font-weight: 400;
            color: #666;
        }

        .selector-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .selector-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #555;
        }

        select {
            padding: 0.4rem 0.8rem;
            font-size: 0.95rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            color: #333;
        }

        /* --- MAIN CONTENT WRAPPER --- */
        .paper-wrapper {
            display: flex;
            flex: 1;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        /* --- NAVIGATION RAIL (Desktop) --- */
        .nav-rail {
            width: 180px;
            flex-shrink: 0;
            padding-top: 2rem;
            margin-right: 2rem;

            /* Sticky Logic */
            position: sticky;
            top: 70px;
            /* Below header */
            align-self: flex-start;
            max-height: calc(100vh - 70px);

            /* Minimal chrome */
            border-right: 1px solid transparent;
            overflow-y: auto;
            /* Necessary for long lists, styled to be subtle */
            scrollbar-width: thin;
            scrollbar-color: #ccc transparent;
        }

        .nav-rail::-webkit-scrollbar {
            width: 4px;
        }

        .nav-rail::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 2px;
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-section-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 1.5rem 0 0.5rem 0.8rem;
        }

        .nav-item {
            margin-bottom: 2px;
        }

        .nav-link {
            display: block;
            padding: 0.3rem 0.8rem;
            text-decoration: none;
            color: #555;
            font-size: 0.9rem;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }

        .nav-link:hover {
            color: #000;
            background: #eaeaea;
        }

        .nav-link.active {
            font-weight: 700;
            color: #000;
            background: #e0e0e0;
        }

        /* Indentation for sub-questions in Nav */
        .nav-indent-1 {
            padding-left: 1.5rem;
            font-size: 0.85rem;
        }

        .nav-indent-2 {
            padding-left: 2.2rem;
            font-size: 0.8rem;
        }

        /* --- PAPER CONTENT AREA --- */
        .paper-content {
            flex: 1;
            background: #fff;
            padding: 3rem 4rem;
            min-height: 80vh;
            border-left: 1px solid #eee;
            border-right: 1px solid #eee;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.03);
        }

        /* --- QUESTION BLOCK STRUCTURE --- */
        .q-block {
            margin-bottom: 3rem;
            padding-bottom: 2.5rem;
            border-bottom: 1px dashed #e0e0e0;
            scroll-margin-top: 90px;
            /* For anchor jumps */
        }

        .q-block:last-child {
            border-bottom: none;
        }

        /* Nesting Indentation (Visual only, no borders) */
        .depth-0 {
            margin-left: 0;
        }

        .depth-1 {
            margin-left: 2.5rem;
        }

        .depth-2 {
            margin-left: 5rem;
        }

        /* Question Header */
        .q-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .q-num {
            font-weight: 800;
            font-size: 1.1rem;
            color: #222;
            min-width: 30px;
        }

        .q-text {
            font-size: 1.1rem;
            color: #111;
            line-height: 1.6;
            width: 100%;
        }

        /* Section Headers in Document */
        .doc-section-header {
            margin-top: 4rem;
            margin-bottom: 2rem;
            border-top: 2px solid #333;
            padding-top: 1rem;
        }

        .doc-section-title {
            font-size: 1.4rem;
            font-weight: 800;
            color: #333;
        }

        .doc-section-sub {
            font-size: 0.95rem;
            color: #666;
            margin-top: 0.2rem;
        }

        /* Diagrams (SVG) */
        .diagram-wrapper {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #fafafa;
            border: 1px solid #eee;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        svg {
            max-width: 100%;
            height: auto;
        }

        /* Answer Component (Always First) */
        .answer-comp {
            margin-top: 1.5rem;
            background: #f0f0f0;
            border-left: 4px solid #666;
            padding: 1rem 1.2rem;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .ans-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: #666;
        }

        .ans-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #000;
        }

        /* Working Component */
        .working-comp {
            margin-top: 1rem;
        }

        .working-toggle {
            background: none;
            border: 1px solid #ccc;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: #444;
            transition: all 0.2s;
        }

        .working-toggle:hover {
            background: #eee;
            border-color: #bbb;
            color: #000;
        }

        .working-toggle[aria-expanded="true"] {
            background: #e8e8e8;
            border-color: #999;
        }

        .working-body {
            display: none;
            /* Collapsed default */
            margin-top: 1rem;
            padding: 1.5rem;
            border-left: 2px solid #ddd;
            background: #fff;
        }

        .working-body[data-visible="true"] {
            display: block;
            animation: fadeIn 0.3s;
        }

        .math-line {
            margin-bottom: 0.8rem;
        }

        .text-line {
            margin-bottom: 0.8rem;
            font-style: italic;
            color: #555;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- MOBILE RESPONSIVENESS --- */
        .mobile-menu-btn {
            display: none;
        }

        .mobile-overlay {
            display: none;
        }

        @media (max-width: 900px) {
            .app-header {
                padding: 0.5rem 1rem;
            }

            .selector-label {
                display: none;
            }

            .nav-rail {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 260px;
                background: #fff;
                z-index: 2000;
                padding: 1rem;
                margin: 0;
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
                max-height: 100vh;
            }

            .nav-rail.is-open {
                transform: translateX(0);
            }

            .paper-content {
                padding: 2rem 1.5rem;
                border: none;
            }

            .mobile-menu-btn {
                display: block;
                background: none;
                border: 1px solid #999;
                padding: 0.4rem 0.8rem;
                border-radius: 4px;
                font-size: 0.9rem;
            }

            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 1500;
                display: none;
            }

            .mobile-overlay.is-open {
                display: block;
            }

            .depth-1 {
                margin-left: 1rem;
                border-left: 1px solid #eee;
                padding-left: 0.5rem;
            }

            .depth-2 {
                margin-left: 0.5rem;
                border-left: 1px solid #eee;
                padding-left: 0.5rem;
            }
        }
    </style>
</head>

<body>

    <div class="app-layout">
        <header class="app-header">
            <button class="mobile-menu-btn" id="menuToggle">☰ Index</button>
            <div class="brand">RTQ <span>Viewer</span></div>
            <div class="selector-container">
                <label for="paperSelect" class="selector-label">Paper:</label>
                <select id="paperSelect">
                    <option value="short">Short (6 Qs)</option>
                    <option value="standard">Standard (35 Qs)</option>
                    <option value="diagram">Diagrams (20 Qs)</option>
                    <option value="sectioned">Sectioned (A/B/C)</option>
                    <option value="expanded">Standard (All Expanded)</option>
                </select>
            </div>
        </header>

        <div class="mobile-overlay" id="mobileOverlay"></div>

        <div class="paper-wrapper">
            <nav class="nav-rail" id="navRail" aria-label="Question Index">
                <div id="navContent">
                </div>
            </nav>

            <main class="paper-content" id="mainContent">
                <div style="text-align:center; padding: 2rem; color:#888;">Loading Paper...</div>
            </main>
        </div>
    </div>

    <script>
        /**
         * --- DATA GENERATION & CONFIG ---
         */

        // SVG Templates (Grayscale)
        const SVGS = {
            geo: `<svg viewBox="0 0 200 120" width="200" height="120">
            <path d="M20,100 L100,20 L180,100 Z" fill="none" stroke="#444" stroke-width="2"/>
            <line x1="100" y1="20" x2="100" y2="100" stroke="#888" stroke-dasharray="4 2"/>
            <text x="90" y="115" font-family="sans-serif" font-size="12" fill="#333">base = 12cm</text>
            <text x="105" y="60" font-family="sans-serif" font-size="12" fill="#333">h</text>
          </svg>`,
            bar: `<svg viewBox="0 0 250 120" width="250" height="120">
            <line x1="20" y1="100" x2="230" y2="100" stroke="#333" stroke-width="1"/>
            <rect x="40" y="40" width="30" height="60" fill="#bbb"/>
            <rect x="90" y="20" width="30" height="80" fill="#999"/>
            <rect x="140" y="60" width="30" height="40" fill="#ddd"/>
            <text x="45" y="115" font-size="10" fill="#333">A</text>
            <text x="95" y="115" font-size="10" fill="#333">B</text>
            <text x="145" y="115" font-size="10" fill="#333">C</text>
          </svg>`,
            grid: `<svg viewBox="0 0 150 150" width="150" height="150">
            <defs><pattern id="g" width="15" height="15" patternUnits="userSpaceOnUse"><path d="M 15 0 L 0 0 0 15" fill="none" stroke="#eee" stroke-width="1"/></pattern></defs>
            <rect width="150" height="150" fill="url(#g)" stroke="#ccc"/>
            <line x1="75" y1="0" x2="75" y2="150" stroke="#666"/>
            <line x1="0" y1="75" x2="150" y2="75" stroke="#666"/>
            <line x1="0" y1="150" x2="150" y2="0" stroke="#333" stroke-width="2"/>
          </svg>`,
            table: `<svg viewBox="0 0 200 80" width="200" height="80">
            <rect x="0" y="0" width="200" height="80" fill="none" stroke="#333"/>
            <line x1="0" y1="40" x2="200" y2="40" stroke="#333"/>
            <line x1="100" y1="0" x2="100" y2="80" stroke="#333"/>
            <text x="50" y="25" text-anchor="middle" font-size="12">x</text>
            <text x="150" y="25" text-anchor="middle" font-size="12">y</text>
            <text x="50" y="65" text-anchor="middle" font-size="12">2</text>
            <text x="150" y="65" text-anchor="middle" font-size="12">?</text>
          </svg>`
        };

        // Math Generation Helper
        function genMath(lines) {
            const steps = [
                "x^2 + 4x + 4 = 0",
                "(x + 2)(x + 2) = 0",
                "x = -2",
                "\\text{Area} = \\frac{1}{2} \\times b \\times h",
                "\\int_{0}^{\\infty} e^{-x} dx = 1",
                "\\frac{a}{b} + \\frac{c}{d} = \\frac{ad + bc}{bd}"
            ];
            let arr = [];
            for (let i = 0; i < lines; i++) {
                arr.push(steps[i % steps.length]);
            }
            return arr;
        }

        // Question Factory
        function createQ(id, num, depth, type, expanded = false) {
            const isSub = depth > 0;
            const q = {
                id: id,
                num: num, // "1", "1a", "1a(i)"
                depth: depth, // 0, 1, 2
                text: isSub ? `Solve for part ${num}.` : `Question prompt for number ${num}. Calculate the value.`,
                answer: `x = ${Math.floor(Math.random() * 100)}`,
                working: genMath(type === 'long' ? 50 : 4),
                diagram: null,
                expanded: expanded,
                sectionHeader: null
            };

            if (type === 'diagram') {
                const keys = Object.keys(SVGS);
                q.diagram = keys[Math.floor(Math.random() * keys.length)];
                q.text += " Refer to the diagram below.";
            }

            if (type === 'long') {
                q.text = "This is a complex problem requiring extensive algebraic derivation.";
            }

            return q;
        }

        // Dataset Generators
        const DATASETS = {
            short: () => {
                let qs = [];
                for (let i = 1; i <= 5; i++) qs.push(createQ(`q${i}`, `${i}`, 0, 'short'));
                // Q6 Multi-part
                qs.push(createQ('q6', '6', 0, 'short'));
                qs.push(createQ('q6a', 'a', 1, 'short'));
                qs.push(createQ('q6b', 'b', 1, 'short'));
                return qs;
            },
            standard: (forceExpand = false) => {
                let qs = [];
                for (let i = 1; i <= 35; i++) {
                    let type = i >= 26 ? 'long' : 'short';
                    // Deep nesting example at Q18 and Q30
                    if (i === 18) {
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'short', forceExpand));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'short', forceExpand));
                        qs.push(createQ(`q${i}ai`, `i`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}aii`, `ii`, 2, 'short', forceExpand));
                        qs.push(createQ(`q${i}b`, `b`, 1, 'short', forceExpand));
                    } else if (i === 30) {
                        qs.push(createQ(`q${i}`, `${i}`, 0, 'long', forceExpand));
                        qs.push(createQ(`q${i}a`, `a`, 1, 'long', forceExpand)); // Long working deep nest
                    } else {
                        qs.push(createQ(`q${i}`, `${i}`, 0, type, forceExpand));
                    }
                }
                return qs;
            },
            diagram: () => {
                let qs = [];
                for (let i = 1; i <= 20; i++) {
                    let type = (i <= 8) ? 'diagram' : 'short';
                    qs.push(createQ(`q${i}`, `${i}`, 0, type));
                }
                return qs;
            },
            sectioned: () => {
                let qs = [];
                let num = 1;
                // Section A
                let q1 = createQ(`q${num}`, `${num}`, 0, 'short');
                q1.sectionHeader = { title: "Section A", sub: "Arithmetic (35 Questions)" };
                qs.push(q1);
                for (let i = 2; i <= 35; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'short')); }

                // Section B
                num++;
                let qB = createQ(`q${num}`, `${num}`, 0, 'short');
                qB.sectionHeader = { title: "Section B", sub: "Applied Maths (8 Questions)" };
                qs.push(qB);
                for (let i = 2; i <= 8; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'diagram')); }

                // Section C
                num++;
                let qC = createQ(`q${num}`, `${num}`, 0, 'long');
                qC.sectionHeader = { title: "Section C", sub: "Deep Reasoning (6 Questions)" };
                qs.push(qC);
                for (let i = 2; i <= 6; i++) { num++; qs.push(createQ(`q${num}`, `${num}`, 0, 'long')); }

                return qs;
            }
        };

        /**
         * --- RENDER LOGIC ---
         */

        function render(paperKey) {
            const container = document.getElementById('mainContent');
            const navContainer = document.getElementById('navContent');
            const isExpandedVariant = paperKey === 'expanded';
            const key = isExpandedVariant ? 'standard' : paperKey;

            // Generate Data
            const data = DATASETS[key](isExpandedVariant);

            // Build HTML strings (perf optimized)
            let mainHTML = '';
            let navHTML = '<ul class="nav-list">';

            data.forEach(q => {
                // 1. Navigation Item
                // If section header exists, add nav separator
                if (q.sectionHeader) {
                    navHTML += `<li class="nav-section-label">${q.sectionHeader.title}</li>`;
                }

                let indentClass = q.depth === 1 ? 'nav-indent-1' : (q.depth === 2 ? 'nav-indent-2' : '');
                navHTML += `<li class="nav-item">
            <a href="#${q.id}" class="nav-link ${indentClass}">${q.num}</a>
        </li>`;

                // 2. Main Content
                // Section Header in Doc
                if (q.sectionHeader) {
                    mainHTML += `
            <div class="doc-section-header">
                <div class="doc-section-title">${q.sectionHeader.title}</div>
                <div class="doc-section-sub">${q.sectionHeader.sub}</div>
            </div>`;
                }

                // Question Body
                let diagramHTML = q.diagram ? `<div class="diagram-wrapper">${SVGS[q.diagram]}</div>` : '';
                let workingLines = q.working.map(line =>
                    line.startsWith('\\text') ? `<div class="text-line">${line.replace('\\text{', '').replace('}', '')}</div>`
                        : `<div class="math-line">$$ ${line} $$</div>`
                ).join('');

                let toggleState = q.expanded ? 'true' : 'false';
                let displayState = q.expanded ? 'true' : 'false';
                let arrow = q.expanded ? '▼' : '▶';

                mainHTML += `
        <article class="q-block depth-${q.depth}" id="${q.id}">
            <div class="q-header">
                <div class="q-num">${q.num}</div>
                <div class="q-text">
                    ${q.text}
                    ${diagramHTML}
                </div>
            </div>
            
            <div class="answer-comp">
                <span class="ans-label">Answer</span>
                <span class="ans-value">$$ ${q.answer} $$</span>
            </div>

            <div class="working-comp">
                <button class="working-toggle" aria-expanded="${toggleState}" onclick="toggleW(this)">
                    <span>${arrow}</span> Show Working
                </button>
                <div class="working-body" data-visible="${displayState}">
                    ${workingLines}
                </div>
            </div>
        </article>`;
            });

            navHTML += '</ul>';

            // Inject
            container.innerHTML = mainHTML;
            navContainer.innerHTML = navHTML;

            // Trigger KaTeX
            if (window.renderMathInElement) {
                renderMathInElement(container, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ],
                    throwOnError: false
                });
            } else if (window.katex) {
                // Fallback manual scan if auto-render extension missing
                // For this prototype, auto-render is not imported, so we do manual
                manualKaTeX(container);
            }
        }

        function manualKaTeX(root) {
            // Scan for $$...$$ in innerHTML is risky, better to target classes.
            // But since I generated $$...$$ in strings, I need to parse them.
            // Simple approach for prototype:
            // 1. Render all .math-line
            root.querySelectorAll('.math-line').forEach(el => {
                let tex = el.textContent.replace(/\$\$/g, '');
                try { katex.render(tex, el, { displayMode: true }); } catch (e) { el.textContent = tex; }
            });
            // 2. Render all .ans-value
            root.querySelectorAll('.ans-value').forEach(el => {
                let tex = el.textContent.replace(/\$\$/g, '');
                try { katex.render(tex, el, { displayMode: false }); } catch (e) { el.textContent = tex; }
            });
        }

        // Toggle Function (Global)
        window.toggleW = function (btn) {
            const body = btn.nextElementSibling;
            const expanded = btn.getAttribute('aria-expanded') === 'true';

            btn.setAttribute('aria-expanded', !expanded);
            body.setAttribute('data-visible', !expanded);
            btn.querySelector('span').textContent = !expanded ? '▼' : '▶';
        };

        /**
         * --- EVENT LISTENERS ---
         */

        // 1. Selector
        document.getElementById('paperSelect').addEventListener('change', (e) => {
            render(e.target.value);
            window.scrollTo(0, 0);
        });

        // 2. Mobile Menu
        const navRail = document.getElementById('navRail');
        const overlay = document.getElementById('mobileOverlay');

        document.getElementById('menuToggle').addEventListener('click', () => {
            navRail.classList.add('is-open');
            overlay.classList.add('is-open');
        });

        overlay.addEventListener('click', () => {
            navRail.classList.remove('is-open');
            overlay.classList.remove('is-open');
        });

        // 3. Nav Link Clicks (Close menu on mobile, Smooth scroll)
        document.getElementById('navContent').addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                if (window.innerWidth <= 900) {
                    navRail.classList.remove('is-open');
                    overlay.classList.remove('is-open');
                }
            }
        });

        // --- INIT ---
        // Wait for KaTeX to load slightly
        window.onload = () => {
            setTimeout(() => render('short'), 100);
        };

    </script>
</body>

</html>