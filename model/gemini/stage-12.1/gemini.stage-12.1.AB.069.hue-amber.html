<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"AB","indexWithinVariant":"69","totalWithinVariant":"200","hueFamily":"amber","intensityMode":"","timestamp":"2026-01-06T23:19:46.581Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;AB&quot;,&quot;indexWithinVariant&quot;:&quot;69&quot;,&quot;totalWithinVariant&quot;:&quot;200&quot;,&quot;hueFamily&quot;:&quot;amber&quot;,&quot;intensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-06T23:19:46.581Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Viewer</title>
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Colorlab B: Forced Hue "Amber"
                        // Base neutrals using Stone for soft-warmth (Stage 5.3.1)
                        neutral: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        // Accent hue: Amber
                        accent: {
                            50: '#fffbeb',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                            800: '#92400e',
                            900: '#78350f',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- KATEX CSS (No Integrity/SRI per Stage 6.0.7b) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- MARKDOWN-IT (No Integrity/SRI) -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    
    <!-- KATEX JS (No Integrity/SRI) -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        /* BASE STYLES & RESET OVERRIDES */
        body {
            background-color: #fafaf9; /* neutral-50 */
            color: #1c1917; /* neutral-900 */
        }

        /* HIDE SCROLLBARS BUT KEEP FUNCTIONALITY (Stage 3 Add-on) */
        .scrollbar-hide {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        /* KATEX CONTAINMENT INVARIANT (Stage 3 + 6.0.8) */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding-bottom: 4px; /* Space for scrollbar if needed */
            margin: 1em 0;
            text-align: center;
        }
        
        /* INLINE KATEX BACKGROUND RULE (Stage 5.8.4) */
        .katex {
            background-color: transparent !important;
        }

        /* TABLE MINIMALISM (Stage 5.8.5) */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid #e7e5e4; /* neutral-200 */
            padding: 8px 12px;
            text-align: left;
        }
        th {
            font-weight: 600;
            color: #1c1917;
        }

        /* FOCUS INDICATOR (Stage 5.5.2 - Custom but restrained) */
        :focus-visible {
            outline: 2px solid #f59e0b; /* accent-500 */
            outline-offset: 2px;
            border-radius: 2px;
        }

        /* UTILITIES */
        .content-width {
            max-width: 65ch; /* Comfortable reading length */
        }
        
        /* MARKDOWN CONTENT SPACING */
        .md-content p {
            margin-bottom: 0.75em;
            line-height: 1.6;
        }
        .md-content p:last-child {
            margin-bottom: 0;
        }
        .md-content ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-bottom: 0.75em;
        }
        .md-content ol {
            list-style-type: decimal;
            padding-left: 1.5em;
            margin-bottom: 0.75em;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans text-neutral-900">

    <!-- TOP CONTROLS REGION -->
    <header class="sticky top-0 z-50 w-full bg-neutral-50/95 backdrop-blur border-b border-neutral-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
            <!-- Paper Selector -->
            <div class="flex items-center gap-3">
                <label for="paper-select" class="text-sm font-medium text-neutral-600 hidden sm:block">Paper:</label>
                <select id="paper-select" class="bg-white border border-neutral-300 text-neutral-900 text-sm rounded px-3 py-1.5 focus:border-accent-500 focus:ring-accent-500 hover:border-neutral-400 transition-colors cursor-pointer">
                    <option value="" disabled selected>Loading...</option>
                </select>
            </div>

            <!-- Mobile Jump To Trigger -->
            <button id="mobile-jump-trigger" class="lg:hidden text-sm font-medium text-accent-700 hover:text-accent-800 px-3 py-2" aria-label="Open navigation">
                Jump to
            </button>
        </div>
    </header>

    <!-- DOCUMENT FRAME SHELL -->
    <div class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 flex items-start gap-8 py-8 relative">
        
        <!-- DESKTOP NAVIGATION RAIL (Left Column) -->
        <!-- Stage 5.4: Peripheral, persistent, subordinate -->
        <nav id="desktop-nav" class="hidden lg:block w-48 sticky top-24 max-h-[calc(100vh-8rem)] overflow-y-auto scrollbar-hide pr-4" aria-label="Paper navigation">
            <ul id="desktop-nav-list" class="space-y-1">
                <!-- Nav items generated here -->
            </ul>
        </nav>

        <!-- PAPER DOCUMENT COLUMN (Right/Main Column) -->
        <main id="paper-content" class="flex-1 min-w-0 pb-32">
            <div id="paper-render-root" class="space-y-12">
                <!-- Paper content generated here -->
                <div class="text-center py-20 text-neutral-500 animate-pulse">Initializing paper viewer...</div>
            </div>
        </main>

    </div>

    <!-- MOBILE NAVIGATION DRAWER -->
    <div id="mobile-drawer-backdrop" class="fixed inset-0 bg-neutral-900/20 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-200" aria-hidden="true"></div>
    <div id="mobile-drawer" class="fixed inset-y-0 right-0 z-50 w-64 bg-white shadow-xl transform translate-x-full transition-transform duration-300 flex flex-col" role="dialog" aria-modal="true" aria-label="Navigation">
        <div class="flex items-center justify-between p-4 border-b border-neutral-100">
            <h2 class="text-lg font-semibold text-neutral-900">Jump to</h2>
            <button id="mobile-drawer-close" class="text-neutral-500 hover:text-neutral-800 p-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <ul id="mobile-nav-list" class="space-y-1">
                <!-- Nav items generated here -->
            </ul>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        /**
         * STAGE 0: CONSTANTS
         * Single source of truth for paths.
         */
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        /**
         * STATE & CONFIG
         */
        const State = {
            papers: [],
            currentPaperId: null,
            expandedDetails: new Set(), // Set of Question IDs where Solution Details are expanded
            markdown: null // Markdown-it instance
        };

        /**
         * MARKDOWN RENDERER SETUP (Stage 6 Add-on)
         * - html: true (SVG passthrough)
         * - breaks: false (critical for KaTeX)
         * - escape rule disabled (preserve TeX backslashes)
         */
        if (window.markdownit) {
            State.markdown = window.markdownit({
                html: true,
                linkify: true,
                breaks: false
            });
            // Disable escape rule to protect TeX backslashes
            State.markdown.inline.ruler.disable(['escape']);
        }

        /**
         * INITIALIZATION
         */
        document.addEventListener('DOMContentLoaded', async () => {
            initInteractionHandlers();
            await loadPayload();
        });

        async function loadPayload() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error("Payload Fetch Failed");
                
                const data = await response.json();
                if (!data.papers || !Array.isArray(data.papers)) throw new Error("Invalid Payload Schema");

                State.papers = data.papers;
                
                // Populate selector
                renderPaperSelector();
                
                // Load first paper by default
                if (State.papers.length > 0) {
                    switchPaper(State.papers[0].key);
                }
            } catch (err) {
                console.error(err);
                renderError();
            }
        }

        function renderError() {
            const root = document.getElementById('paper-render-root');
            root.innerHTML = `<div class="p-8 border border-red-200 bg-red-50 text-red-800 rounded text-center font-medium">PAPERS PAYLOAD MISSING</div>`;
            document.getElementById('paper-select').innerHTML = '<option>Error loading papers</option>';
            document.getElementById('paper-select').disabled = true;
        }

        /**
         * PAPER SELECTOR
         */
        function renderPaperSelector() {
            const select = document.getElementById('paper-select');
            select.innerHTML = State.papers.map(p => 
                `<option value="${p.key}">${p.label || p.key}</option>`
            ).join('');
            
            select.addEventListener('change', (e) => {
                switchPaper(e.target.value);
            });
        }

        function switchPaper(paperKey) {
            const paper = State.papers.find(p => p.key === paperKey);
            if (!paper) return;

            State.currentPaperId = paperKey;
            
            // Reset expanded state based on paper defaults
            State.expandedDetails.clear();
            const defaultExpanded = paper.defaults && paper.defaults.expandedAll !== false;
            
            // If default is true, we don't explicitly add IDs to the set yet; 
            // logic is: check set has ID -> forced state. If not in set -> fallback to default.
            // However, interaction requires toggling. 
            // Better model: Populate Set if default is true, or keep Set for "overridden to show" vs "overridden to hide".
            // Simpler: Just rely on HTML state rendering logic.
            // Let's store "explicitly toggled" or handle "default" at render time.
            // For this prototype, let's assume if expandedAll is true, we want everything open initially.
            // We'll handle this purely in the recursive render pass or just treat the Set as "currently open".
            // If expandedAll=true, we need to walk the tree and add all IDs with solutionDetails to the set.
            if (defaultExpanded) {
                const collectIds = (nodes) => {
                    nodes.forEach(node => {
                        if (node.solutionBlock?.solutionDetails) {
                            State.expandedDetails.add(node.id);
                        }
                        if (node.children) collectIds(node.children);
                    });
                };
                if (paper.questions) collectIds(paper.questions);
                if (paper.sections) paper.sections.forEach(s => collectIds(s.questions));
            }

            renderNavigation(paper);
            renderPaperContent(paper);
            
            // Render Math
            renderMath();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'auto' });
        }

        /**
         * NAVIGATION RENDERING
         */
        function renderNavigation(paper) {
            const createNavItem = (id, label) => {
                // Label is just identifier
                return `
                    <li>
                        <a href="#q-${id}" 
                           class="block px-2 py-1 text-sm text-neutral-500 hover:text-neutral-900 hover:underline decoration-neutral-300 underline-offset-2 transition-colors nav-link"
                           data-target="q-${id}">
                            ${label}
                        </a>
                    </li>
                `;
            };

            const createSectionHeader = (label) => {
                if (!label || label.trim() === '') return '';
                return `
                    <li class="mt-4 mb-2 px-2 text-xs font-bold text-neutral-400 uppercase tracking-wider cursor-default">
                        ${label}
                    </li>
                `;
            };

            const buildList = (items) => {
                let html = '';
                items.forEach(item => {
                     // Flat list - hierarchy via type scale/weight handled in item rendering if needed,
                     // but brief says "flat list... same left edge".
                     // We just render identifiers.
                     // IMPORTANT: Recursive flattening for navigation? 
                     // Brief: "expose full set of question identifiers".
                     // Usually linear 1, 1a, 1b.
                     
                     const processNode = (node) => {
                         html += createNavItem(node.id, node.id);
                         if (node.children) {
                             node.children.forEach(processNode);
                         }
                     };
                     
                     processNode(item);
                });
                return html;
            };

            let navHtml = '';
            
            if (paper.sections) {
                paper.sections.forEach(section => {
                    navHtml += createSectionHeader(section.label);
                    navHtml += buildList(section.questions);
                });
            } else if (paper.questions) {
                navHtml += buildList(paper.questions);
            }

            document.getElementById('desktop-nav-list').innerHTML = navHtml;
            document.getElementById('mobile-nav-list').innerHTML = navHtml;

            updateActiveNav();
        }

        /**
         * PAPER CONTENT RENDERING
         */
        function renderPaperContent(paper) {
            const root = document.getElementById('paper-render-root');
            let html = '';

            // Sectioned vs Flat
            if (paper.sections) {
                paper.sections.forEach(section => {
                    // Section Header
                    if (section.label && section.label.trim() !== '') {
                        html += `
                            <div class="border-b border-neutral-200 pb-2 mb-8 mt-12 first:mt-0">
                                <h2 class="text-xl font-semibold text-neutral-800">${section.label}</h2>
                            </div>
                        `;
                    }
                    
                    // Question List
                    html += `<div class="space-y-16">`; // SPC__TOP_LEVEL_INTER_QUESTION_SPACING
                    section.questions.forEach(q => {
                        html += renderQuestionNode(q, 0);
                    });
                    html += `</div>`;
                });
            } else if (paper.questions) {
                html += `<div class="space-y-16">`;
                paper.questions.forEach(q => {
                    html += renderQuestionNode(q, 0);
                });
                html += `</div>`;
            }

            root.innerHTML = html;
        }

        /**
         * QUESTION NODE RENDERING (Recursive)
         */
        function renderQuestionNode(node, depth) {
            const isTopLevel = depth === 0;
            const hasSolutionBlock = !!node.solutionBlock;
            const hasAnswer = hasSolutionBlock && !!node.solutionBlock.answer;
            const hasDetails = hasSolutionBlock && !!node.solutionBlock.solutionDetails;
            const isExpanded = State.expandedDetails.has(node.id);

            // Indentation for children (Stage 3E)
            // Using padding-left for children container
            
            // Markdown Rendering
            const qBodyHtml = renderMarkdown(node.question);

            let html = `
                <div id="q-${node.id}" class="question-node group relative scroll-mt-24">
                    <!-- Surface Seam Cue (Stage 4.3.a) - optional safety net, kept minimal -->
                    
                    <!-- Question Body -->
                    <div class="flex gap-4">
                        <div class="flex-none pt-1">
                            <span class="text-neutral-500 font-medium text-sm select-none" aria-hidden="true">${node.id}</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <!-- Prompt -->
                            <div class="md-content text-lg text-neutral-900 leading-relaxed max-w-none">
                                ${qBodyHtml}
                            </div>
            `;

            // Solution Block
            if (hasSolutionBlock) {
                html += `
                            <div class="mt-6 border-l-2 border-neutral-100 pl-4"> <!-- Visual subordination via border/indent -->
                `;

                // Answer
                if (hasAnswer) {
                    const ansHtml = renderMarkdown(node.solutionBlock.answer);
                    html += `
                                <div class="mb-4">
                                    <span class="text-xs font-bold uppercase tracking-wider text-neutral-500 mb-1 block">Answer</span>
                                    <div class="md-content text-neutral-800 font-medium">
                                        ${ansHtml}
                                    </div>
                                </div>
                    `;
                }

                // Solution Details Control
                if (hasDetails) {
                    html += `
                                <div class="mt-4">
                                    <button onclick="toggleWorking('${node.id}')" 
                                            class="flex items-center gap-2 text-sm font-medium text-accent-700 hover:text-accent-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-accent-500 rounded px-1 -ml-1 transition-colors"
                                            aria-expanded="${isExpanded}"
                                            aria-controls="details-${node.id}">
                                        <span class="text-xs transition-transform duration-200 ${isExpanded ? 'rotate-90' : ''}">â–¶</span>
                                        <span>${isExpanded ? 'Hide working' : 'Show working'}</span>
                                    </button>

                                    <!-- Expanded Details Region -->
                                    <div id="details-${node.id}" class="${isExpanded ? 'block' : 'hidden'} mt-4 animate-in fade-in slide-in-from-top-2 duration-200">
                                        ${renderSolutionDetails(node.solutionBlock.solutionDetails)}
                                    </div>
                                </div>
                    `;
                }

                html += `   </div>`; // End Solution Block Wrapper
            }

            html += `   </div>`; // End Flex-1
            html += `</div>`; // End Flex Row

            // Children
            if (node.children && node.children.length > 0) {
                html += `
                    <div class="mt-6 pl-4 sm:pl-10 border-l border-transparent space-y-8">
                        ${node.children.map(child => renderQuestionNode(child, depth + 1)).join('')}
                    </div>
                `;
            }

            html += `</div>`; // End Question Node
            return html;
        }

        function renderSolutionDetails(details) {
            let html = `<div class="space-y-6 text-base text-neutral-700">`; // Subordinate text color

            // Keep in mind
            if (details.keepInMind) {
                html += `
                    <div class="bg-neutral-100/50 rounded p-4 border border-neutral-200/50">
                        <h4 class="text-xs font-bold text-neutral-500 uppercase tracking-wide mb-2">Keep in mind</h4>
                        <div class="md-content text-sm">
                            ${renderMarkdown(details.keepInMind)}
                        </div>
                    </div>
                `;
            }

            // Formulas Used
            if (details.formulasUsed) {
                html += `
                    <div>
                        <h4 class="text-xs font-bold text-neutral-500 uppercase tracking-wide mb-2">Formulas used</h4>
                        <div class="md-content text-sm font-mono text-neutral-600">
                            ${renderMarkdown(details.formulasUsed)}
                        </div>
                    </div>
                `;
            }

            // Working (Primary)
            if (details.working) {
                html += `
                    <div>
                        <h4 class="text-xs font-bold text-neutral-500 uppercase tracking-wide mb-2">Working</h4>
                        <div class="md-content space-y-4">
                            ${renderMarkdown(details.working)}
                        </div>
                    </div>
                `;
            }

            // Alternative Workings
            if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
                details.alternativeWorking.forEach((alt, idx) => {
                    html += `
                        <div class="pt-4 border-t border-neutral-200 border-dashed">
                            <h4 class="text-xs font-bold text-neutral-500 uppercase tracking-wide mb-2">Alternative working ${details.alternativeWorking.length > 1 ? idx + 1 : ''}</h4>
                            <div class="md-content space-y-4">
                                ${renderMarkdown(alt)}
                            </div>
                        </div>
                    `;
                });
            }

            html += `</div>`;
            return html;
        }

        /**
         * MARKDOWN & MATH UTILS
         */
        function renderMarkdown(text) {
            if (!text) return '';
            if (!State.markdown) return text; // Fallback
            return State.markdown.render(text);
        }

        function renderMath() {
            if (!window.renderMathInElement) return;
            
            const contentRoot = document.getElementById('paper-render-root');
            renderMathInElement(contentRoot, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false,
                output: 'html' // Use HTML output
            });
        }

        /**
         * INTERACTION HANDLERS
         */
        window.toggleWorking = (questionId) => {
            if (State.expandedDetails.has(questionId)) {
                State.expandedDetails.delete(questionId);
            } else {
                State.expandedDetails.add(questionId);
            }
            
            // Re-render specifically this question node? 
            // Full re-render is safer for prototype to ensure state consistency,
            // but might lose scroll or be janky.
            // Better: DOM manipulation for the specific toggle ID.
            
            const btn = document.querySelector(`button[onclick="toggleWorking('${questionId}')"]`);
            const container = document.getElementById(`details-${questionId}`);
            
            if (btn && container) {
                const isExpanded = State.expandedDetails.has(questionId);
                
                // Update Button
                btn.setAttribute('aria-expanded', isExpanded);
                const arrow = btn.querySelector('span:first-child');
                const text = btn.querySelector('span:last-child');
                
                if (isExpanded) {
                    arrow.classList.add('rotate-90');
                    text.textContent = 'Hide working';
                    container.classList.remove('hidden');
                } else {
                    arrow.classList.remove('rotate-90');
                    text.textContent = 'Show working';
                    container.classList.add('hidden');
                }
            }
        };

        function initInteractionHandlers() {
            // Mobile Drawer
            const trigger = document.getElementById('mobile-jump-trigger');
            const close = document.getElementById('mobile-drawer-close');
            const backdrop = document.getElementById('mobile-drawer-backdrop');
            const drawer = document.getElementById('mobile-drawer');

            const toggleDrawer = (show) => {
                if (show) {
                    backdrop.classList.remove('hidden');
                    // small delay to allow display:block to apply before opacity transition
                    requestAnimationFrame(() => {
                        backdrop.classList.remove('opacity-0');
                        drawer.classList.remove('translate-x-full');
                    });
                } else {
                    backdrop.classList.add('opacity-0');
                    drawer.classList.add('translate-x-full');
                    setTimeout(() => {
                        backdrop.classList.add('hidden');
                    }, 300);
                }
            };

            trigger.addEventListener('click', () => toggleDrawer(true));
            close.addEventListener('click', () => toggleDrawer(false));
            backdrop.addEventListener('click', () => toggleDrawer(false));

            // Nav Links (Scroll & Close Drawer)
            document.addEventListener('click', (e) => {
                if (e.target.closest('.nav-link')) {
                    e.preventDefault();
                    const link = e.target.closest('.nav-link');
                    const targetId = link.getAttribute('data-target');
                    const el = document.getElementById(targetId);
                    
                    if (el) {
                        // Offset for sticky header
                        const headerOffset = 100;
                        const elementPosition = el.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                  
                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });

                        // Update Active State manually
                        document.querySelectorAll('.nav-link').forEach(l => {
                            l.classList.remove('font-bold', 'text-accent-700', 'bg-accent-50');
                            l.classList.add('text-neutral-500');
                        });
                        link.classList.remove('text-neutral-500');
                        link.classList.add('font-bold', 'text-accent-700', 'bg-accent-50'); // Active state visual
                        
                        // Close drawer if open
                        toggleDrawer(false);
                    }
                }
            });

            // Scroll Spy for Nav
            window.addEventListener('scroll', () => {
                updateActiveNav();
            });
        }

        function updateActiveNav() {
            // Simple Intersection Observer or scroll position check could go here.
            // For prototype, simple scroll check:
            const scrollPos = window.scrollY + 150;
            const nodes = document.querySelectorAll('.question-node');
            let currentId = null;

            nodes.forEach(node => {
                if (node.offsetTop <= scrollPos) {
                    currentId = node.id;
                }
            });

            if (currentId) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('font-bold', 'text-accent-700', 'border-l-2', 'border-accent-500', 'pl-1');
                    link.classList.add('text-neutral-500'); // Reset to quiet
                    
                    if (link.getAttribute('data-target') === currentId) {
                        link.classList.remove('text-neutral-500');
                        // Active state: Weight + Color (Amber) + subtle marker
                        link.classList.add('font-bold', 'text-accent-700'); 
                    }
                });
            }
        }

    </script>
</body>
</html>
