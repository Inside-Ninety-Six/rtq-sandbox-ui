<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"AB","indexWithinVariant":"14","totalWithinVariant":"200","hueFamily":"cyan","intensityMode":"","timestamp":"2026-01-06T20:11:19.225Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;AB&quot;,&quot;indexWithinVariant&quot;:&quot;14&quot;,&quot;totalWithinVariant&quot;:&quot;200&quot;,&quot;hueFamily&quot;:&quot;cyan&quot;,&quot;intensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-06T20:11:19.225Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>
    
    <!-- TAILWIND CSS (Via CDN for prototyping) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KATE X CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    
    <!-- LUCIDE ICONS -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- MARKDOWN-IT -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <!-- KATEX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // COLORLAB B: Forced Hue Family = CYAN
                        // Using Slate for Neutrals (Warm/Neutral base)
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        // Custom palette mapping
                        neutral: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        brand: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee', // Cyan 400
                            500: '#06b6d4', // Cyan 500
                            600: '#0891b2', // Cyan 600
                            700: '#0e7490',
                            900: '#164e63',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE VARIABLES (Light Mode Only per ColorLab A) */
        :root {
            --background: 0 0% 100%;       /* White */
            --foreground: 215 25% 27%;     /* Slate 700 - Soft text */
            
            --primary: 189 94% 43%;        /* Cyan 500 */
            --primary-foreground: 0 0% 100%;

            --secondary: 210 40% 96.1%;    /* Slate 100 */
            --secondary-foreground: 222.2 47.4% 11.2%;

            --muted: 210 40% 96.1%;        /* Slate 100 */
            --muted-foreground: 215 16% 47%; /* Slate 500 */

            --accent: 189 94% 43%;         /* Cyan 500 - For interactive states */
            --accent-foreground: 222.2 47.4% 11.2%;

            --border: 214.3 31.8% 91.4%;   /* Slate 200 */
            --input: 214.3 31.8% 91.4%;
            --ring: 189 94% 43%;           /* Cyan 500 */
            
            --radius: 0.5rem;
        }

        body {
            background-color: #fcfcfc; /* Very subtle off-white for page bg */
            color: hsl(var(--foreground));
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            overflow-y: scroll; /* Always show vertical scrollbar to prevent layout shift */
        }

        /* MATH CONTAINMENT INVARIANT */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding-bottom: 4px; /* Space for scrollbar */
            -webkit-overflow-scrolling: touch;
        }
        
        /* SCROLLBAR HIDING for Nav */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* UTILITIES */
        .focus-visible-ring:focus-visible {
            outline: 2px solid hsl(var(--ring));
            outline-offset: 2px;
        }

        /* TRANSITIONS */
        .reveal-content {
            transition: all 0.2s ease-in-out;
        }

        /* MARKDOWN TABLES */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1rem;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid #e2e8f0; /* Slate 200 */
            padding: 0.5rem 0.75rem;
            text-align: left;
        }
        th {
            background-color: transparent;
            font-weight: 600;
            color: #334155; /* Slate 700 */
        }
        
        /* KaTeX Font Fix for consistent baseline */
        .katex { font-size: 1.1em; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- TOP CONTROLS REGION -->
    <header class="sticky top-0 z-50 bg-[#fcfcfc]/95 backdrop-blur border-b border-neutral-200">
        <div class="max-w-[1280px] mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <!-- PAPER SELECTOR -->
                <select id="paper-selector" class="h-9 px-3 rounded-md border border-neutral-200 bg-white text-sm text-neutral-700 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent">
                    <option value="" disabled selected>Loading papers...</option>
                </select>
            </div>
            
            <!-- MOBILE JUMP TO TRIGGER -->
            <button id="mobile-jump-trigger" class="lg:hidden text-sm font-medium text-brand-600 hover:text-brand-700 flex items-center gap-1.5 focus-visible-ring rounded px-2 py-1">
                <span>Jump to</span>
                <i data-lucide="menu" class="w-4 h-4"></i>
            </button>
        </div>
    </header>

    <!-- DOCUMENT FRAME SHELL -->
    <div class="flex-1 max-w-[1280px] mx-auto w-full flex items-stretch">
        
        <!-- DESKTOP NAV RAIL (Left Column) -->
        <nav class="hidden lg:block w-64 flex-none sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto no-scrollbar pt-8 pb-12 pl-4 pr-6 border-r border-transparent">
            <div id="desktop-nav-list" class="flex flex-col space-y-1">
                <!-- Populated via JS -->
            </div>
        </nav>

        <!-- PAPER DOCUMENT COLUMN (Right/Main) -->
        <main class="flex-1 min-w-0 pt-8 pb-32 px-4 sm:px-8 lg:px-12 bg-white lg:bg-transparent shadow-sm lg:shadow-none border-x border-neutral-100 lg:border-none my-0 lg:my-0 mx-0 sm:mx-4 lg:mx-0 rounded-none sm:rounded-lg lg:rounded-none">
            
            <div id="paper-content" class="max-w-[48rem] mx-auto space-y-12">
                <!-- Content injected here -->
                <div class="text-center text-neutral-400 py-12">Select a paper to begin.</div>
            </div>

        </main>
    </div>

    <!-- MOBILE NAVIGATION DRAWER -->
    <div id="mobile-drawer-backdrop" class="fixed inset-0 bg-neutral-900/20 z-[60] hidden transition-opacity opacity-0" aria-hidden="true"></div>
    <div id="mobile-drawer" class="fixed inset-y-0 right-0 z-[70] w-72 bg-white shadow-xl transform translate-x-full transition-transform duration-200 flex flex-col" aria-hidden="true">
        <div class="flex items-center justify-between px-4 h-14 border-b border-neutral-100">
            <span class="font-semibold text-neutral-900">Jump to</span>
            <button id="mobile-drawer-close" class="p-2 text-neutral-500 hover:text-neutral-700 rounded focus-visible-ring">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <div id="mobile-nav-list" class="flex flex-col space-y-1">
                <!-- Populated via JS -->
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        // --- STAGE 0: CONSTANTS ---
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // --- GLOBAL STATE ---
        const state = {
            papers: [],
            currentPaper: null,
            expandedNodes: new Set(), // Set of question IDs
            isDrawerOpen: false
        };

        // --- MARKDOWN SETUP ---
        const md = window.markdownit ? window.markdownit({
            html: true,
            linkify: true,
            breaks: false // REQUIRED
        }) : null;

        if (md) {
            md.inline.ruler.disable(['escape']);
        }

        // --- DOM ELEMENTS ---
        const els = {
            paperSelector: document.getElementById('paper-selector'),
            paperContent: document.getElementById('paper-content'),
            desktopNavList: document.getElementById('desktop-nav-list'),
            mobileNavList: document.getElementById('mobile-nav-list'),
            mobileJumpTrigger: document.getElementById('mobile-jump-trigger'),
            mobileDrawer: document.getElementById('mobile-drawer'),
            mobileDrawerBackdrop: document.getElementById('mobile-drawer-backdrop'),
            mobileDrawerClose: document.getElementById('mobile-drawer-close')
        };

        // --- INITIALIZATION ---
        async function init() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error('Payload missing');
                const data = await response.json();
                state.papers = data.papers || [];
                
                populateSelector();
                
                // Select first paper by default if available
                if (state.papers.length > 0) {
                    loadPaper(state.papers[0].key);
                    els.paperSelector.value = state.papers[0].key;
                }
            } catch (error) {
                console.error(error);
                els.paperContent.innerHTML = `<div class="p-8 text-center text-red-600 font-medium">PAPERS PAYLOAD MISSING</div>`;
            }
        }

        // --- PAPER LOADING ---
        function populateSelector() {
            els.paperSelector.innerHTML = state.papers.map(p => 
                `<option value="${p.key}">${p.label}</option>`
            ).join('');

            els.paperSelector.addEventListener('change', (e) => {
                loadPaper(e.target.value);
            });
        }

        function loadPaper(key) {
            const paper = state.papers.find(p => p.key === key);
            if (!paper) return;

            state.currentPaper = paper;
            state.expandedNodes.clear();

            // Set defaults
            const expandAll = paper.defaults?.expandedAll !== false;
            
            // Render
            renderContent(paper, expandAll);
            renderNavigation(paper);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'auto' });
        }

        // --- RENDERING CORE ---
        function renderContent(paper, expandAll) {
            const container = els.paperContent;
            
            // Handle Flat vs Sectioned
            let html = '';
            
            // Helper to determine starting expansions
            const collectIds = (nodes) => {
                nodes.forEach(node => {
                    if (node.solutionBlock?.solutionDetails && expandAll) {
                        state.expandedNodes.add(node.id);
                    }
                    if (node.children) collectIds(node.children);
                });
            };

            if (paper.questions) {
                collectIds(paper.questions);
                html = `<div class="space-y-16">` + 
                       renderQuestionList(paper.questions) + 
                       `</div>`;
            } else if (paper.sections) {
                paper.sections.forEach(sec => collectIds(sec.questions));
                html = paper.sections.map(section => {
                    const header = section.label && section.label.trim() !== '' 
                        ? `<div class="mb-8 text-neutral-400 font-medium text-lg tracking-tight select-none border-b border-neutral-100 pb-2">${section.label}</div>` 
                        : '';
                    return `<div class="mb-16">
                        ${header}
                        <div class="space-y-16">
                            ${renderQuestionList(section.questions)}
                        </div>
                    </div>`;
                }).join('');
            }

            container.innerHTML = html;
            
            // Post-render: Icons, Math, Event Listeners
            lucide.createIcons();
            renderMathInElement(container, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false
            });
            
            attachInteractiveHandlers();
        }

        function renderQuestionList(questions) {
            return questions.map(q => renderQuestionNode(q, 0)).join('');
        }

        function renderQuestionNode(node, depth) {
            const isTopLevel = depth === 0;
            const hasSolutionBlock = !!node.solutionBlock;
            const hasAnswer = hasSolutionBlock && !!node.solutionBlock.answer;
            const hasSolutionDetails = hasSolutionBlock && !!node.solutionBlock.solutionDetails;
            const isExpanded = state.expandedNodes.has(node.id);
            
            // Indentation for children (Spacing only)
            const indentClass = depth > 0 ? 'ml-4 sm:ml-6 border-l-2 border-transparent pl-2 sm:pl-0' : '';
            
            // Question Body
            const questionBodyHtml = md ? md.render(node.question) : node.question;
            
            let output = `
                <div id="q-${node.id}" class="question-node scroll-mt-24 ${indentClass} group" data-id="${node.id}">
                    <!-- Question Body -->
                    <div class="flex gap-3 sm:gap-4 items-baseline mb-4">
                        <span class="text-neutral-500 font-semibold text-sm sm:text-base shrink-0 select-none w-8 sm:w-10 text-right font-mono tracking-tight pt-0.5">${node.id}</span>
                        <div class="prose prose-neutral prose-p:my-1 prose-headings:font-medium max-w-none text-neutral-800 text-[1.0625rem] leading-7">
                            ${questionBodyHtml}
                        </div>
                    </div>
            `;

            if (hasSolutionBlock) {
                output += `<div class="ml-11 sm:ml-14 space-y-4">`;
                
                // Answer
                if (hasAnswer) {
                    const answerHtml = md ? md.render(node.solutionBlock.answer) : node.solutionBlock.answer;
                    output += `
                        <div class="flex flex-col sm:flex-row sm:items-baseline gap-1 sm:gap-4 text-brand-700">
                            <span class="text-xs font-bold uppercase tracking-wider text-brand-600/80 shrink-0 select-none pt-1">Answer</span>
                            <div class="prose prose-sm max-w-none text-neutral-900 font-medium">
                                ${answerHtml}
                            </div>
                        </div>
                    `;
                }

                // Solution Details Toggle
                if (hasSolutionDetails) {
                    output += `
                        <div>
                            <button class="toggle-work-btn text-brand-600 hover:text-brand-700 text-sm font-medium flex items-center gap-1.5 focus-visible-ring rounded py-1 px-0.5 transition-colors select-none" data-target="${node.id}">
                                <span>${isExpanded ? 'Hide working' : 'Show working'}</span>
                                <i data-lucide="${isExpanded ? 'chevron-up' : 'chevron-down'}" class="w-4 h-4 transition-transform duration-200"></i>
                            </button>
                            
                            <div id="details-${node.id}" class="${isExpanded ? '' : 'hidden'} mt-4 pl-4 sm:pl-6 border-l border-neutral-200/60">
                                <div class="space-y-6 pb-2">
                                    ${renderSolutionDetails(node.solutionBlock.solutionDetails)}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                output += `</div>`; // End Solution Block Wrapper
            }

            // Children
            if (node.children && node.children.length > 0) {
                output += `
                    <div class="mt-6 space-y-6">
                        ${node.children.map(child => renderQuestionNode(child, depth + 1)).join('')}
                    </div>
                `;
            }

            output += `</div>`; // End Question Node
            
            // Top level separator
            if (isTopLevel) {
                output += `<div class="h-px bg-transparent my-0"></div>`;
            }
            
            return output;
        }

        function renderSolutionDetails(details) {
            if (!details) return '';
            
            let html = '';
            
            // Keep in mind
            if (details.keepInMind) {
                const kimHtml = md ? md.render(details.keepInMind) : details.keepInMind;
                html += `
                    <div class="space-y-1">
                        <div class="text-xs font-bold text-neutral-500 uppercase tracking-wider flex items-center gap-2">
                            <i data-lucide="lightbulb" class="w-3.5 h-3.5"></i> Keep in mind
                        </div>
                        <div class="prose prose-sm max-w-none text-neutral-600">
                            ${kimHtml}
                        </div>
                    </div>
                `;
            }

            // Formulas used
            if (details.formulasUsed) {
                const formHtml = md ? md.render(details.formulasUsed) : details.formulasUsed;
                html += `
                    <div class="space-y-1">
                        <div class="text-xs font-bold text-neutral-500 uppercase tracking-wider">Formulas used</div>
                        <div class="prose prose-sm max-w-none text-neutral-600 font-mono text-xs">
                            ${formHtml}
                        </div>
                    </div>
                `;
            }

            // Working (Primary)
            if (details.working) {
                const workHtml = md ? md.render(details.working) : details.working;
                html += `
                    <div class="space-y-2">
                        <div class="text-xs font-bold text-neutral-500 uppercase tracking-wider">Working</div>
                        <div class="prose prose-neutral max-w-none text-neutral-700 leading-relaxed">
                            ${workHtml}
                        </div>
                    </div>
                `;
            }

            // Alternative Working
            if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
                details.alternativeWorking.forEach((alt, idx) => {
                    const altHtml = md ? md.render(alt) : alt;
                    html += `
                        <div class="pt-4 mt-4 border-t border-neutral-100 space-y-2">
                            <div class="text-xs font-bold text-neutral-400 uppercase tracking-wider">Alternative working ${idx + 1 > 1 ? idx+1 : ''}</div>
                            <div class="prose prose-neutral max-w-none text-neutral-600 leading-relaxed">
                                ${altHtml}
                            </div>
                        </div>
                    `;
                });
            }

            return html;
        }

        // --- NAVIGATION RENDERING ---
        function renderNavigation(paper) {
            // Build flat list of identifiers
            const navItems = [];
            
            const processNodes = (nodes, sectionLabel = null) => {
                nodes.forEach(node => {
                    navItems.push({
                        id: node.id,
                        section: sectionLabel,
                        depth: (node.id.match(/\(/g) || []).length // rough heuristic for visual weight
                    });
                    if (node.children) processNodes(node.children, sectionLabel);
                });
            };

            let sectionsHtml = '';
            
            if (paper.sections) {
                paper.sections.forEach(sec => {
                    const secLabel = (sec.label && sec.label.trim()) ? sec.label : null;
                    const nodes = [];
                    const collector = (n) => {
                        nodes.push({ id: n.id, depth: 0 }); // Flat list implies depth doesn't indent
                        if(n.children) n.children.forEach(collector);
                    }
                    sec.questions.forEach(collector);
                    
                    if (secLabel) {
                        sectionsHtml += `
                            <div class="pt-4 first:pt-0 pb-1 text-[10px] font-bold text-neutral-400 uppercase tracking-widest pl-2 select-none">
                                ${secLabel}
                            </div>
                        `;
                    }
                    sectionsHtml += renderNavLinks(nodes);
                });
            } else if (paper.questions) {
                const nodes = [];
                const collector = (n) => {
                    nodes.push({ id: n.id, depth: 0 });
                    if(n.children) n.children.forEach(collector);
                }
                paper.questions.forEach(collector);
                sectionsHtml = renderNavLinks(nodes);
            }

            els.desktopNavList.innerHTML = sectionsHtml;
            els.mobileNavList.innerHTML = sectionsHtml;
            
            setupNavInteractions();
            updateActiveNav();
        }

        function renderNavLinks(items) {
            return items.map(item => {
                // Heuristic: sub-questions usually longer ids or contain parens.
                // We use quietness for hierarchy.
                const isSub = item.id.includes('(') || item.id.length > 3; 
                const classes = isSub 
                    ? 'text-neutral-500 font-normal text-xs py-1' 
                    : 'text-neutral-600 font-medium text-sm py-1.5';
                
                return `
                    <a href="#q-${item.id}" 
                       class="nav-item block pl-2 border-l-2 border-transparent hover:border-neutral-300 hover:text-neutral-900 transition-colors focus-visible-ring rounded-r ${classes}"
                       data-id="${item.id}">
                        ${item.id}
                    </a>
                `;
            }).join('');
        }

        // --- INTERACTIONS ---
        function attachInteractiveHandlers() {
            // Show/Hide Working
            document.querySelectorAll('.toggle-work-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = btn.dataset.target;
                    const container = document.getElementById(`details-${id}`);
                    const icon = btn.querySelector('i');
                    const textSpan = btn.querySelector('span');
                    
                    if (state.expandedNodes.has(id)) {
                        state.expandedNodes.delete(id);
                        container.classList.add('hidden');
                        textSpan.textContent = 'Show working';
                        icon.setAttribute('data-lucide', 'chevron-down');
                    } else {
                        state.expandedNodes.add(id);
                        container.classList.remove('hidden');
                        textSpan.textContent = 'Hide working';
                        icon.setAttribute('data-lucide', 'chevron-up');
                    }
                    lucide.createIcons();
                });
            });
        }

        function setupNavInteractions() {
            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const id = link.dataset.id;
                    const target = document.getElementById(`q-${id}`);
                    if (target) {
                        // Smooth scroll
                        const headerOffset = 80;
                        const elementPosition = target.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        
                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });
                        
                        // Close drawer on mobile
                        if (state.isDrawerOpen) toggleDrawer(false);
                        
                        // Set active immediate
                        setActiveNav(id);
                    }
                });
            });
        }

        // --- SCROLL SPY & ACTIVE STATE ---
        function updateActiveNav() {
            // Simple intersection observer or scroll handler could work.
            // Using scroll handler for simplicity in single file.
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio > 0.1) {
                        setActiveNav(entry.target.dataset.id);
                    }
                });
            }, { rootMargin: '-10% 0px -80% 0px' });

            document.querySelectorAll('.question-node').forEach(node => observer.observe(node));
        }

        function setActiveNav(id) {
            document.querySelectorAll('.nav-item').forEach(el => {
                // Reset
                el.classList.remove('border-brand-500', 'text-brand-600', 'font-bold');
                el.classList.add('border-transparent');
                if (el.classList.contains('text-xs')) el.classList.add('text-neutral-500');
                else el.classList.add('text-neutral-600');
            });

            // Set Active (Cyan marker + weight)
            const activeLinks = document.querySelectorAll(`.nav-item[data-id="${id}"]`);
            activeLinks.forEach(active => {
                active.classList.remove('border-transparent', 'text-neutral-500', 'text-neutral-600', 'font-normal');
                active.classList.add('border-brand-500', 'text-brand-600', 'font-bold');
            });
        }

        // --- MOBILE DRAWER ---
        function toggleDrawer(open) {
            state.isDrawerOpen = open;
            const drawer = els.mobileDrawer;
            const backdrop = els.mobileDrawerBackdrop;
            
            if (open) {
                backdrop.classList.remove('hidden');
                // slight delay to allow display block to apply before opacity transition
                requestAnimationFrame(() => {
                    backdrop.classList.remove('opacity-0');
                    drawer.classList.remove('translate-x-full');
                });
                document.body.style.overflow = 'hidden';
            } else {
                backdrop.classList.add('opacity-0');
                drawer.classList.add('translate-x-full');
                setTimeout(() => {
                    backdrop.classList.add('hidden');
                }, 200);
                document.body.style.overflow = '';
            }
        }

        els.mobileJumpTrigger.addEventListener('click', () => toggleDrawer(true));
        els.mobileDrawerClose.addEventListener('click', () => toggleDrawer(false));
        els.mobileDrawerBackdrop.addEventListener('click', () => toggleDrawer(false));

        // --- BOOTSTRAP ---
        init();

    </script>
</body>
</html>
