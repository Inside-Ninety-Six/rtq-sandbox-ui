<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"264","totalWithinVariant":"320","hueFamily":"blue","intensityMode":"deep_theme","timestamp":"2026-01-07T21:52:54.193Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;264&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;blue&quot;,&quot;intensityMode&quot;:&quot;deep_theme&quot;,&quot;timestamp&quot;:&quot;2026-01-07T21:52:54.193Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>

    <!-- KaTeX CSS (SRI disabled per requirements) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Libraries (SRI disabled per requirements) -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <style>
        /* =========================================
           STAGE 6 ADD-ON: COLORLAB C (DEEP THEME)
           Hue Family: Blue (250)
           Mode: deep_theme (Light Only)
           ========================================= */
        :root {
            /* Palette Constants (OKLCH) */
            --hue: 250; 

            /* Surfaces - Deep Theme Requirements:
               Page/Frame/Paper must be chromatic and distinguishable by L steps.
               C values must be significant [0.06 .. 0.16] */
            --color-page-bg: oklch(0.94 0.08 var(--hue));
            --color-frame-bg: oklch(0.92 0.08 var(--hue));
            --color-paper-bg: oklch(0.98 0.06 var(--hue));

            /* Text - High legibility, mostly neutral */
            --color-text-primary: oklch(0.20 0.015 var(--hue));
            --color-text-secondary: oklch(0.35 0.02 var(--hue));
            --color-text-quiet: oklch(0.55 0.02 var(--hue));

            /* Accent - Restrained usage (Links, Focus, Toggle) */
            --color-accent: oklch(0.55 0.20 var(--hue));
            
            /* Structural */
            --color-hairline: oklch(0.85 0.02 var(--hue));
            
            /* Solution Details Wash (Deep Theme: C [0.05 .. 0.10]) */
            --color-solution-wash: oklch(0.96 0.05 var(--hue));

            /* Typography */
            --font-family: 'Inter', system-ui, -apple-system, sans-serif;
            --font-size-base: 16px;
            --font-size-sm: 14px;
            --font-size-xs: 12px;
            --line-height-relaxed: 1.6;
            --line-height-snug: 1.4;

            /* Spacing */
            --space-unit: 8px;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-xxl: 48px;
            --space-q-gap: 64px; /* Largest unit for top-level questions */

            /* Layout Dimensions */
            --nav-width: 240px;
            --max-paper-width: 800px;
        }

        /* Reset & Base */
        *, *::before, *::after { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-family);
            background-color: var(--color-page-bg);
            color: var(--color-text-primary);
            line-height: var(--line-height-relaxed);
            -webkit-font-smoothing: antialiased;
        }

        /* Utility: Focus */
        :focus-visible {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
            border-radius: 2px;
        }

        /* =========================================
           LAYOUT ARCHITECTURE
           ========================================= */
        #app-root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Top Controls (Aligned to Shell) */
        .top-controls-region {
            background-color: var(--color-frame-bg);
            border-bottom: 1px solid var(--color-hairline);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .top-controls-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-md) var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .paper-selector {
            font-family: inherit;
            font-size: var(--font-size-sm);
            padding: var(--space-sm);
            border: 1px solid var(--color-hairline);
            border-radius: 4px;
            background-color: var(--color-paper-bg);
            color: var(--color-text-primary);
        }

        .mobile-jump-trigger {
            display: none; /* Desktop default */
            background: none;
            border: 1px solid var(--color-hairline);
            border-radius: 4px;
            color: var(--color-accent);
            font-weight: 500;
            padding: var(--space-xs) var(--space-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
        }

        /* Document Shell */
        .document-frame-shell {
            flex: 1;
            display: flex;
            justify-content: center;
            background-color: var(--color-frame-bg);
        }

        .shell-inner {
            display: flex;
            width: 100%;
            max-width: 1200px;
            padding: 0 var(--space-lg); /* Inner Gutters */
        }

        /* Navigation Rail (Desktop) */
        .nav-column {
            width: var(--nav-width);
            flex-shrink: 0;
            padding-top: var(--space-xl);
            padding-bottom: var(--space-xl);
            position: sticky;
            top: 60px; /* Offset for top controls */
            height: calc(100vh - 60px);
            overflow-y: auto;
            /* Hide scrollbar visually */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .nav-column::-webkit-scrollbar { display: none; }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-section-label {
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
            color: var(--color-text-quiet);
            margin-top: var(--space-md);
            margin-bottom: var(--space-sm);
            padding-left: var(--space-xs);
        }

        .nav-item {
            display: block;
            padding: var(--space-xs) var(--space-xs);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            text-decoration: none;
            cursor: pointer;
            border-radius: 4px;
            transition: color 0.1s ease;
        }
        
        .nav-item:hover {
            color: var(--color-text-primary);
            background-color: rgba(0,0,0,0.03); /* Subtle hover */
        }

        /* Active State - Weight only, Accent marker allowed per Stage 6 override */
        .nav-item.active {
            font-weight: 600;
            color: var(--color-accent);
        }

        /* Hierarchy via Type Scale (Stage 5.4.5) */
        .nav-item.depth-0 { font-size: var(--font-size-sm); }
        .nav-item.depth-1 { font-size: 13px; }
        .nav-item.depth-2 { font-size: 12px; }

        /* Paper Column */
        .paper-column {
            flex: 1;
            padding-top: var(--space-xl);
            padding-bottom: var(--space-xxl);
            padding-left: var(--space-xl);
            max-width: var(--max-paper-width);
        }

        .paper-surface {
            background-color: var(--color-paper-bg);
            min-height: 80vh;
            /* No container framing/shadows per deep theme paper-like rules */
            padding-bottom: 100px;
        }

        /* =========================================
           CONTENT STYLING
           ========================================= */
        
        /* Sections */
        .section-header-block {
            margin-bottom: var(--space-xl);
            border-bottom: 1px solid var(--color-hairline);
            padding-bottom: var(--space-sm);
        }
        .section-header-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        /* Question Nodes */
        .question-node {
            position: relative;
        }
        
        /* Top Level Separation */
        .question-node.top-level {
            margin-bottom: var(--space-q-gap);
        }
        
        /* Nested Separation */
        .children-container {
            margin-top: var(--space-md);
            /* Indentation via spacing only */
            margin-left: var(--space-lg); 
        }

        .question-body {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .q-id {
            flex-shrink: 0;
            font-weight: 600;
            color: var(--color-text-secondary);
            width: 3rem; 
        }

        .q-prompt {
            flex: 1;
            color: var(--color-text-primary);
            font-weight: 500;
        }

        /* Solution Block */
        .solution-block {
            margin-left: calc(3rem + var(--space-md)); /* Align with prompt */
            margin-top: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        /* Answer */
        .answer-region {
            margin-bottom: var(--space-sm);
        }
        .answer-label {
            font-size: var(--font-size-sm);
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-right: var(--space-sm);
        }
        .answer-content {
            display: inline-block;
            font-weight: 500;
        }

        /* Solution Details Control */
        .sd-control {
            background: none;
            border: none;
            padding: 0;
            font-family: inherit;
            font-size: var(--font-size-sm);
            color: var(--color-accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            margin-bottom: var(--space-sm);
        }
        .sd-control:hover {
            text-decoration: underline;
        }
        .chevron {
            transition: transform 0.2s ease;
        }
        .sd-control[aria-expanded="true"] .chevron {
            transform: rotate(180deg);
        }

        /* Solution Details Region */
        .solution-details-region {
            display: none;
            background-color: var(--color-solution-wash);
            padding: var(--space-md);
            border-radius: 4px; /* Slight radius permitted internally for wash, no card borders */
            font-size: var(--font-size-sm);
            margin-top: var(--space-xs);
        }
        .solution-details-region.expanded {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Subsections */
        .sd-subsection {
            margin-bottom: var(--space-md);
        }
        .sd-subsection:last-child {
            margin-bottom: 0;
        }

        .sd-label {
            font-weight: 600;
            font-size: var(--font-size-xs);
            text-transform: uppercase;
            letter-spacing: 0.02em;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-xs);
            display: block;
        }

        .sd-body {
            color: var(--color-text-secondary); /* Subordinate but readable */
        }
        
        /* Alternative Working Separation */
        .alt-working-block {
            margin-top: var(--space-lg);
            padding-top: var(--space-md);
            border-top: 1px solid var(--color-hairline); /* Quiet internal divider */
        }

        /* Keep in Mind specific */
        .keep-in-mind-body ul {
            margin: 0;
            padding-left: var(--space-lg);
        }

        /* Formulas Used specific */
        .formulas-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        /* Markdown Content Styling */
        .md-content p { margin-top: 0; margin-bottom: var(--space-sm); }
        .md-content p:last-child { margin-bottom: 0; }
        .md-content table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: var(--space-sm);
            font-size: var(--font-size-sm);
        }
        .md-content th, .md-content td {
            border: 1px solid var(--color-hairline);
            padding: var(--space-xs) var(--space-sm);
            text-align: left;
        }
        .md-content th {
            font-weight: 600;
            color: var(--color-text-primary);
        }

        /* KaTeX Containment Invariant */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: var(--space-xs) 0;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
            /* Scrollbar hiding optional but cleaner */
            scrollbar-width: thin;
            scrollbar-color: var(--color-hairline) transparent;
        }
        /* Inline math no background */
        .katex { font-size: 1.1em; } 

        /* Mobile Drawer */
        .drawer-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.2);
            z-index: 200;
            display: none;
        }
        .drawer-overlay.open { display: block; }

        .drawer {
            position: fixed;
            top: 0; bottom: 0; right: 0; /* Right side drawer typical for mobile menu, or bottom? Brief implies left or bottom. Let's do Right for "Jump To" list context or bottom sheet. Brief says "Drawer accessed via Jump to". Let's use a Right Drawer for list. */
            width: 80%;
            max-width: 300px;
            background: var(--color-frame-bg);
            z-index: 201;
            transform: translateX(100%);
            transition: transform 0.25s ease;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }
        .drawer.open { transform: translateX(0); }

        .drawer-header {
            padding: var(--space-md);
            border-bottom: 1px solid var(--color-hairline);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .drawer-title { font-weight: 600; }
        .drawer-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-text-secondary);
        }
        .drawer-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-md);
        }

        /* Media Queries */
        @media (max-width: 900px) {
            .nav-column { display: none; }
            .mobile-jump-trigger { display: block; }
            .shell-inner { padding: 0 var(--space-md); }
            .paper-column { padding-left: 0; }
            .solution-block { margin-left: 0; margin-top: var(--space-md); } /* Stack vertically on mobile */
            .question-body { flex-direction: column; gap: var(--space-xs); }
        }

        .error-message {
            color: var(--color-text-primary);
            padding: var(--space-xl);
            text-align: center;
            font-weight: 500;
        }

    </style>
</head>
<body>

<div id="app-root">
    <!-- Top Controls -->
    <div class="top-controls-region">
        <div class="top-controls-inner">
            <select id="paper-selector" class="paper-selector" aria-label="Select Paper"></select>
            <button id="jump-trigger" class="mobile-jump-trigger">Jump to...</button>
        </div>
    </div>

    <!-- Document Shell -->
    <div class="document-frame-shell">
        <div class="shell-inner">
            <!-- Navigation Rail -->
            <nav class="nav-column" aria-label="Question Navigation">
                <div id="nav-content"></div>
            </nav>

            <!-- Paper Content -->
            <main class="paper-column">
                <div id="paper-surface" class="paper-surface">
                    <!-- Content injected here -->
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Mobile Drawer -->
<div id="drawer-overlay" class="drawer-overlay"></div>
<div id="drawer" class="drawer" aria-modal="true" role="dialog" aria-label="Navigation">
    <div class="drawer-header">
        <span class="drawer-title">Jump to</span>
        <button id="drawer-close" class="drawer-close">&times;</button>
    </div>
    <div id="drawer-nav-content" class="drawer-content"></div>
</div>

<script>
    /* =========================================
       STAGE 0: CONSTANTS (Canonical)
       ========================================= */
    const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
    const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

    /* =========================================
       STATE & UTIL
       ========================================= */
    let papersData = [];
    let currentPaper = null;
    let mdRenderer = null;

    /* =========================================
       MARKDOWN CONFIGURATION (STAGE 6)
       ========================================= */
    if (window.markdownit) {
        mdRenderer = window.markdownit({
            html: true,     // Enable inline SVG passthrough
            linkify: true,
            breaks: false   // MUST be false to prevent <br> in math blocks
        });
        // Disable escape rule to preserve TeX backslashes
        mdRenderer.inline.ruler.disable(['escape']);
    }

    /* =========================================
       INITIALIZATION
       ========================================= */
    async function init() {
        try {
            const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
            if (!response.ok) throw new Error("Payload load failed");
            const data = await response.json();
            
            if (!data.papers || !Array.isArray(data.papers)) {
                throw new Error("Invalid payload format");
            }

            papersData = data.papers;
            populateSelector();
            
            // Load first paper by default
            if (papersData.length > 0) {
                loadPaper(papersData[0].key);
            }
        } catch (e) {
            console.error(e);
            renderError();
        }
    }

    function renderError() {
        const surface = document.getElementById('paper-surface');
        surface.innerHTML = '<div class="error-message">PAPERS PAYLOAD MISSING</div>';
    }

    /* =========================================
       PAPER LOADING & RENDERING
       ========================================= */
    function populateSelector() {
        const selector = document.getElementById('paper-selector');
        selector.innerHTML = '';
        papersData.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.key;
            opt.textContent = p.label;
            selector.appendChild(opt);
        });
        selector.addEventListener('change', (e) => loadPaper(e.target.value));
    }

    function loadPaper(key) {
        currentPaper = papersData.find(p => p.key === key);
        if (!currentPaper) return;

        // Reset scroll
        window.scrollTo(0, 0);

        // Render Content
        const surface = document.getElementById('paper-surface');
        surface.innerHTML = '';
        
        // Build Navigation Map
        const navItems = [];

        // Helper to flatten questions
        const processNodes = (nodes, depth) => {
            return nodes.map(node => {
                const flatNode = { id: node.id, depth, nodeRef: node };
                if (node.children && node.children.length > 0) {
                    flatNode.children = processNodes(node.children, depth + 1);
                }
                return flatNode;
            });
        };

        if (currentPaper.sections) {
            currentPaper.sections.forEach(sec => {
                // Section Header in Paper
                if (sec.label && sec.label.trim() !== '') {
                    const secEl = document.createElement('div');
                    secEl.className = 'section-header-block';
                    secEl.innerHTML = `<div class="section-header-text">${sec.label}</div>`;
                    surface.appendChild(secEl);
                }
                
                // Render Questions
                renderQuestionList(sec.questions, surface, 0);

                // Add to Nav
                navItems.push({
                    type: 'section',
                    label: sec.label,
                    items: processNodes(sec.questions, 0)
                });
            });
        } else if (currentPaper.questions) {
            renderQuestionList(currentPaper.questions, surface, 0);
            navItems.push({
                type: 'flat',
                items: processNodes(currentPaper.questions, 0)
            });
        }

        renderNavigation(navItems);
        
        // Trigger KaTeX Auto-render
        renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
            ],
            throwOnError: false
        });
    }

    /* =========================================
       CONTENT RENDERERS
       ========================================= */
    function renderQuestionList(questions, container, depth) {
        questions.forEach(q => {
            const nodeEl = document.createElement('div');
            nodeEl.className = `question-node ${depth === 0 ? 'top-level' : ''}`;
            nodeEl.id = `q-${q.id}`;

            // 1. Question Body
            const bodyEl = document.createElement('div');
            bodyEl.className = 'question-body';
            bodyEl.innerHTML = `
                <div class="q-id">${q.id}</div>
                <div class="q-prompt md-content">${renderMarkdown(q.question)}</div>
            `;
            nodeEl.appendChild(bodyEl);

            // 2. Solution Block (Optional)
            if (q.solutionBlock) {
                const sb = q.solutionBlock;
                const sbEl = document.createElement('div');
                sbEl.className = 'solution-block';

                // Answer (Optional)
                if (sb.answer) {
                    const ansEl = document.createElement('div');
                    ansEl.className = 'answer-region';
                    ansEl.innerHTML = `
                        <span class="answer-label">Answer</span>
                        <div class="answer-content md-content">${renderMarkdown(sb.answer)}</div>
                    `;
                    sbEl.appendChild(ansEl);
                }

                // Solution Details (Optional)
                if (sb.solutionDetails) {
                    const details = sb.solutionDetails;
                    const defaultsExpanded = currentPaper.defaults && currentPaper.defaults.expandedAll !== false;
                    
                    // Toggle
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = 'sd-control';
                    toggleBtn.setAttribute('aria-expanded', defaultsExpanded);
                    toggleBtn.innerHTML = `
                        <span>${defaultsExpanded ? 'Hide working' : 'Show working'}</span>
                        <svg class="chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    `;

                    // Region
                    const regionEl = document.createElement('div');
                    regionEl.className = `solution-details-region ${defaultsExpanded ? 'expanded' : ''}`;

                    // Subsections
                    // 1. Keep in mind
                    if (details.keepInMind) {
                        regionEl.appendChild(renderSubsection('Keep in mind', details.keepInMind, 'keep-in-mind-body'));
                    }
                    // 2. Formulas used
                    if (details.formulasUsed) {
                        regionEl.appendChild(renderSubsection('Formulas used', details.formulasUsed, 'formulas-list'));
                    }
                    // 3. Working
                    if (details.working) {
                        regionEl.appendChild(renderSubsection('Working', details.working, 'working-body'));
                    }
                    // 4. Alternative Working
                    if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
                        details.alternativeWorking.forEach(alt => {
                            const altEl = renderSubsection('Alternative working', alt, 'alt-working-block');
                            regionEl.appendChild(altEl);
                        });
                    }

                    // Interaction
                    toggleBtn.onclick = () => {
                        const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
                        toggleBtn.setAttribute('aria-expanded', !isExpanded);
                        toggleBtn.querySelector('span').textContent = !isExpanded ? 'Hide working' : 'Show working';
                        regionEl.classList.toggle('expanded');
                    };

                    sbEl.appendChild(toggleBtn);
                    sbEl.appendChild(regionEl);
                }
                nodeEl.appendChild(sbEl);
            }

            // 3. Children
            if (q.children && q.children.length > 0) {
                const childContainer = document.createElement('div');
                childContainer.className = 'children-container';
                renderQuestionList(q.children, childContainer, depth + 1);
                nodeEl.appendChild(childContainer);
            }

            container.appendChild(nodeEl);
        });
    }

    function renderSubsection(label, contentMarkdown, extraClass = '') {
        const div = document.createElement('div');
        div.className = `sd-subsection ${extraClass}`;
        div.innerHTML = `
            <span class="sd-label">${label}</span>
            <div class="sd-body md-content">${renderMarkdown(contentMarkdown)}</div>
        `;
        return div;
    }

    function renderMarkdown(text) {
        if (!text) return '';
        return mdRenderer ? mdRenderer.render(text) : text;
    }

    /* =========================================
       NAVIGATION RENDERER
       ========================================= */
    function renderNavigation(navData) {
        const buildList = (items, targetEl) => {
            const flatten = (list) => {
                let res = [];
                list.forEach(i => {
                    res.push(i);
                    if (i.children) res = res.concat(flatten(i.children));
                });
                return res;
            };

            const flatList = flatten(items);
            flatList.forEach(item => {
                const a = document.createElement('a');
                a.href = `#q-${item.id}`;
                a.className = `nav-item depth-${Math.min(item.depth, 2)}`;
                a.textContent = item.id;
                a.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById(`q-${item.id}`).scrollIntoView({behavior: 'smooth', block: 'start'});
                    // Update active state manually
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    a.classList.add('active');
                    // Close drawer if open
                    document.getElementById('drawer').classList.remove('open');
                    document.getElementById('drawer-overlay').classList.remove('open');
                };
                targetEl.appendChild(a);
            });
        };

        const renderContainer = (containerId) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            navData.forEach(block => {
                if (block.type === 'section') {
                    if (block.label && block.label.trim()) {
                        const lbl = document.createElement('div');
                        lbl.className = 'nav-section-label';
                        lbl.textContent = block.label;
                        container.appendChild(lbl);
                    }
                    buildList(block.items, container);
                } else {
                    buildList(block.items, container);
                }
            });
        };

        renderContainer('nav-content');
        renderContainer('drawer-nav-content');
    }

    /* =========================================
       MOBILE DRAWER LOGIC
       ========================================= */
    const drawer = document.getElementById('drawer');
    const overlay = document.getElementById('drawer-overlay');
    const jumpBtn = document.getElementById('jump-trigger');
    const closeBtn = document.getElementById('drawer-close');

    function toggleDrawer(open) {
        if (open) {
            drawer.classList.add('open');
            overlay.classList.add('open');
        } else {
            drawer.classList.remove('open');
            overlay.classList.remove('open');
        }
    }

    jumpBtn.onclick = () => toggleDrawer(true);
    closeBtn.onclick = () => toggleDrawer(false);
    overlay.onclick = () => toggleDrawer(false);

    /* =========================================
       START
       ========================================= */
    init();

</script>
</body>
</html>
