<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"94","totalWithinVariant":"320","hueFamily":"pink","intensityMode":"tinted_neutrals","timestamp":"2026-01-07T13:45:09.181Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;94&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;pink&quot;,&quot;intensityMode&quot;:&quot;tinted_neutrals&quot;,&quot;timestamp&quot;:&quot;2026-01-07T13:45:09.181Z&quot;}'>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RTQ Maths Paper Solution Viewer (Stage 6 Baseline)</title>

<!-- KaTeX CSS (No SRI, per Stage 6 baseline) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

<!-- Markdown-it Script -->
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
<!-- KaTeX JS -->
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

<style>
  /* 
   * =================================================================
   * STAGE 6 ADD-ON: COLORLAB IMPLEMENTATION
   * PARAMETERS:
   *   Hue Family: "pink" (H ≈ 340)
   *   Intensity Mode: "tinted_neutrals" (Light Mode Only)
   * =================================================================
   */
  :root {
    /* OKLCH values for "tinted_neutrals" mode with "pink" hue */
    
    /* Core Surfaces (C in 0.015 .. 0.035) */
    --c-page-bg: oklch(0.98 0.02 340);
    --c-frame-bg: oklch(0.96 0.025 340);
    --c-paper-bg: oklch(0.99 0.015 340);
    
    /* Wash Surfaces (C in 0.025 .. 0.045) */
    --c-wash-bg: oklch(0.97 0.03 340);
    
    /* Text (Primary C <= 0.010, Secondary C <= 0.012) */
    --c-text-primary: oklch(0.20 0.01 340);
    --c-text-secondary: oklch(0.45 0.012 340);
    
    /* Accent (C in 0.10 .. 0.16) */
    --c-accent: oklch(0.60 0.14 340);
    --c-accent-hover: oklch(0.55 0.16 340);
    
    /* Hairline (Low chroma) */
    --c-hairline: oklch(0.90 0.02 340);

    /* Typography */
    --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --font-size-base: 16px;
    --line-height-base: 1.5;
    
    /* Spacing Units */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2.5rem; /* Top-level question separation */
    
    /* Focus */
    --focus-ring: 0 0 0 2px var(--c-page-bg), 0 0 0 4px var(--c-accent);
  }

  /* Reset & Base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    padding: 0;
    font-family: var(--font-family);
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    color: var(--c-text-primary);
    background-color: var(--c-page-bg);
    -webkit-font-smoothing: antialiased;
  }

  button {
    font-family: inherit;
    font-size: inherit;
    cursor: pointer;
    border: none;
    background: none;
    padding: 0;
    color: inherit;
  }
  
  button:focus-visible, a:focus-visible {
    outline: none;
    box-shadow: var(--focus-ring);
    border-radius: 2px;
  }

  /* 
   * =================================================================
   * LAYOUT SHELL (Desktop: 2 Columns, Mobile: Drawer)
   * =================================================================
   */
  .app-layout {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .top-controls {
    position: sticky;
    top: 0;
    z-index: 50;
    background-color: var(--c-frame-bg); /* Aligned to frame surface */
    border-bottom: 1px solid var(--c-hairline);
    padding: var(--space-sm) var(--space-md);
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
  }

  .document-frame-shell {
    flex: 1;
    display: flex;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    background-color: var(--c-frame-bg); /* Desktop unified surface */
  }

  /* Navigation Rail (Desktop) */
  .nav-rail {
    width: 240px;
    flex-shrink: 0;
    position: sticky;
    top: 60px; /* Below top controls */
    height: calc(100vh - 60px);
    overflow-y: auto;
    padding: var(--space-md);
    display: none; /* Mobile default */
    border-right: 1px solid var(--c-hairline);
    scrollbar-width: none; /* Hide scrollbar Firefox */
  }
  .nav-rail::-webkit-scrollbar { display: none; } /* Hide scrollbar Webkit */

  /* Paper Content Column */
  .paper-column {
    flex: 1;
    padding: var(--space-lg);
    background-color: var(--c-paper-bg);
    min-width: 0; /* Prevent flex overflow */
  }

  @media (min-width: 768px) {
    .nav-rail { display: block; }
    .mobile-jump-trigger { display: none; }
  }

  @media (max-width: 767px) {
    .document-frame-shell { flex-direction: column; }
    .paper-column { padding: var(--space-md); }
  }

  /* 
   * =================================================================
   * NAVIGATION STYLES
   * =================================================================
   */
  .nav-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .nav-section-label {
    font-weight: 600;
    font-size: 0.85rem;
    color: var(--c-text-secondary);
    margin-top: var(--space-md);
    margin-bottom: var(--space-xs);
    padding-left: var(--space-xs);
    pointer-events: none;
  }

  .nav-item {
    display: block;
    padding: var(--space-xs) var(--space-sm);
    text-decoration: none;
    color: var(--c-text-secondary);
    font-size: 0.9rem;
    border-radius: 4px;
    transition: color 0.2s, background-color 0.2s;
    /* Hierarchy via type scale only - flat left edge */
    text-align: left;
  }

  .nav-item:hover {
    background-color: rgba(0,0,0,0.03);
    color: var(--c-text-primary);
  }

  .nav-item.active {
    font-weight: 700;
    color: var(--c-accent); /* Permitted per Stage 6 override for non-content UI */
    background-color: rgba(0,0,0,0.03);
  }

  /* Hierarchical visual damping (Type scale/opacity only, no indent) */
  .nav-item[data-depth="1"] { font-size: 0.85rem; opacity: 0.9; }
  .nav-item[data-depth="2"] { font-size: 0.85rem; opacity: 0.8; }

  /* Mobile Drawer */
  .drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 100;
    display: none;
  }
  .drawer-overlay.open { display: block; }

  .drawer-content {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    width: 280px;
    background: var(--c-page-bg);
    z-index: 101;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
    box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  }
  .drawer-content.open { transform: translateX(0); }

  .drawer-header {
    padding: var(--space-md);
    border-bottom: 1px solid var(--c-hairline);
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
  }

  .drawer-scroll {
    overflow-y: auto;
    padding: var(--space-md);
    flex: 1;
  }

  /* 
   * =================================================================
   * PAPER CONTENT STYLES
   * =================================================================
   */
  
  /* Section Headers within Paper */
  .paper-section-header {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--c-text-secondary);
    margin-top: var(--space-xl);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--c-hairline);
  }

  /* Question Nodes */
  .question-node {
    display: flex;
    flex-direction: column;
    /* Boundary spacing */
  }

  .question-node.top-level {
    margin-bottom: var(--space-xl);
  }
  
  .question-node.child {
    margin-top: var(--space-md);
  }

  /* Sub-question indent: adaptive */
  .children-container {
    margin-top: var(--space-md);
    padding-left: var(--space-md); /* Indent for visual hierarchy */
    border-left: 1px solid transparent; /* Placeholder for alignment */
  }
  @media (max-width: 480px) {
    .children-container { padding-left: var(--space-sm); }
  }

  /* Question Body */
  .question-body {
    margin-bottom: var(--space-sm);
  }
  .question-identifier {
    font-weight: 700;
    margin-right: var(--space-sm);
    color: var(--c-text-primary);
  }
  .question-prompt {
    display: inline;
    color: var(--c-text-primary);
  }
  .question-prompt p { margin: 0; display: inline; }

  /* Solution Block */
  .solution-block {
    margin-top: var(--space-sm);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  /* Answer */
  .answer-region {
    font-weight: 500;
    color: var(--c-text-primary);
  }
  .answer-label {
    font-weight: 700;
    font-size: 0.9rem;
    color: var(--c-text-secondary);
    margin-right: var(--space-xs);
  }

  /* Disclosure Control */
  .disclosure-control {
    align-self: flex-start;
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: 0.95rem;
    color: var(--c-accent);
    font-weight: 500;
    padding: var(--space-xs) 0;
  }
  .disclosure-control:hover {
    color: var(--c-accent-hover);
    text-decoration: underline;
  }
  .disclosure-icon {
    font-size: 0.75rem;
    transition: transform 0.2s ease;
  }
  .disclosure-control[aria-expanded="true"] .disclosure-icon {
    transform: rotate(90deg);
  }

  /* Solution Details Region */
  .solution-details {
    display: none;
    margin-top: var(--space-sm);
    padding: var(--space-md);
    background-color: var(--c-wash-bg); /* Surface differentiation */
    border-radius: 4px;
    font-size: 0.95rem;
  }
  .solution-details.expanded {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  /* Solution Subsections */
  .sd-subsection-label {
    font-weight: 700;
    font-size: 0.85rem;
    color: var(--c-text-secondary);
    margin-bottom: var(--space-xs);
    display: block;
  }

  /* Keep in mind */
  .sd-keep-in-mind {
    /* Slightly higher contrast body than working */
    color: var(--c-text-primary); 
  }

  /* Formulas used */
  .sd-formulas-used {
    color: var(--c-text-secondary);
  }

  /* Working / Alternative Working */
  .sd-working, .sd-alt-working {
    color: var(--c-text-secondary); /* Subordinate text */
  }

  .sd-alt-working {
    padding-top: var(--space-md);
    border-top: 1px solid var(--c-hairline); /* Divider for alt working */
  }

  /* Tables */
  table {
    width: 100%;
    border-collapse: collapse;
    margin: var(--space-sm) 0;
    font-size: 0.9rem;
  }
  th, td {
    padding: var(--space-xs) var(--space-sm);
    border: 1px solid var(--c-hairline);
    text-align: left;
  }
  th { font-weight: 600; }

  /* 
   * =================================================================
   * KATEX & MARKDOWN OVERRIDES
   * =================================================================
   */
  
  /* Markdown Content */
  .md-content p { margin-top: 0; margin-bottom: 0.5em; }
  .md-content p:last-child { margin-bottom: 0; }
  .md-content ul, .md-content ol { margin-top: 0; margin-bottom: 0.5em; padding-left: 1.5em; }
  
  /* KaTeX Containment Invariant */
  .katex-display {
    overflow-x: auto;
    overflow-y: hidden;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
    padding: 0.5em 0;
    margin: 0.5em 0;
    /* Underlay rules: block math allowed background, inline not. 
       However, strict ColorLab rules say accents only on surfaces. 
       We keep it transparent or minimal. */
  }
  
  /* Scrollbar hiding for math block */
  .katex-display::-webkit-scrollbar { height: 4px; }
  .katex-display::-webkit-scrollbar-track { background: transparent; }
  .katex-display::-webkit-scrollbar-thumb { background: var(--c-hairline); border-radius: 2px; }

  /* Inline SVG passthrough styles */
  svg { max-width: 100%; height: auto; }

  /* Error state */
  .error-state {
    padding: var(--space-xl);
    text-align: center;
    font-weight: 700;
    color: var(--c-text-secondary);
  }

  /* Top Control Select */
  .paper-selector {
    padding: var(--space-xs) var(--space-sm);
    font-size: 0.9rem;
    border: 1px solid var(--c-hairline);
    border-radius: 4px;
    background-color: var(--c-page-bg);
    color: var(--c-text-primary);
  }
</style>
</head>
<body>

<div id="app" class="app-layout">
  <!-- Top Controls -->
  <header class="top-controls">
    <div style="font-weight:700; color:var(--c-text-secondary);">RTQ Viewer</div>
    <div>
      <select id="paper-selector" class="paper-selector" aria-label="Select Paper"></select>
    </div>
    <button class="mobile-jump-trigger" id="jump-to-btn" aria-label="Jump to Question">
      <span style="font-weight:600; font-size:0.9rem; color:var(--c-accent);">Jump to</span>
    </button>
  </header>

  <!-- Document Shell -->
  <div class="document-frame-shell">
    
    <!-- Desktop Nav Rail -->
    <nav class="nav-rail" id="desktop-nav" aria-label="Document Navigation">
      <!-- Injected JS -->
    </nav>

    <!-- Paper Column -->
    <main class="paper-column" id="paper-content" tabindex="-1">
      <!-- Injected JS -->
    </main>

  </div>

  <!-- Mobile Drawer -->
  <div class="drawer-overlay" id="drawer-overlay"></div>
  <aside class="drawer-content" id="drawer-content" role="dialog" aria-modal="true" aria-label="Navigation">
    <div class="drawer-header">
      <span>Jump to</span>
      <button id="drawer-close" aria-label="Close navigation">✕</button>
    </div>
    <div class="drawer-scroll" id="mobile-nav-container">
      <!-- Injected JS copy -->
    </div>
  </aside>
</div>

<script>
  // ==========================================================
  // STAGE 0: CANONICAL CONSTANTS
  // ==========================================================
  const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
  
  // STAGE 6 ADD-ON: ColorLab Parameters
  const RTQ_COLORLAB_FORCE_HUE_FAMILY = "pink";
  const RTQ_COLORLAB_INTENSITY_MODE = "tinted_neutrals";

  // ==========================================================
  // STATE & INITIALIZATION
  // ==========================================================
  let appState = {
    papers: [],
    currentPaper: null,
    payloadLoaded: false
  };

  // --- Markdown renderer (authoritative config) ---
  const md = window.markdownit
    ? window.markdownit({
        html: true, // allow inline SVG and other inline HTML in payload Markdown
        linkify: true,
        breaks: false, // MUST stay false: prevents <br> inside $...$ / $$...$$
      })
    : null;

  if (md) {
    // Preserve TeX backslashes: do not let markdown-it escape them before KaTeX runs
    md.inline.ruler.disable(["escape"]);
  }

  // ==========================================================
  // MAIN EXECUTION
  // ==========================================================
  document.addEventListener('DOMContentLoaded', init);

  async function init() {
    try {
      const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
      if (!response.ok) throw new Error("Payload not found");
      const data = await response.json();
      
      appState.papers = data.papers || [];
      appState.payloadLoaded = true;

      if (appState.papers.length === 0) {
        renderError();
        return;
      }

      setupSelector();
      loadPaper(appState.papers[0].key); // Load first paper by default

    } catch (e) {
      console.error(e);
      renderError();
    }
    
    setupMobileDrawer();
  }

  function renderError() {
    document.getElementById('paper-content').innerHTML = `
      <div class="error-state">PAPERS PAYLOAD MISSING</div>
    `;
    document.getElementById('paper-selector').disabled = true;
  }

  // ==========================================================
  // COMPONENTS: SELECTOR
  // ==========================================================
  function setupSelector() {
    const selector = document.getElementById('paper-selector');
    selector.innerHTML = '';
    appState.papers.forEach(p => {
      const opt = document.createElement('option');
      opt.value = p.key;
      opt.textContent = p.label || p.key;
      selector.appendChild(opt);
    });

    selector.addEventListener('change', (e) => {
      loadPaper(e.target.value);
    });
  }

  // ==========================================================
  // CORE: RENDER PAPER
  // ==========================================================
  function loadPaper(paperKey) {
    const paper = appState.papers.find(p => p.key === paperKey);
    if (!paper) return;
    appState.currentPaper = paper;

    const contentEl = document.getElementById('paper-content');
    const navElDesktop = document.getElementById('desktop-nav');
    const navElMobile = document.getElementById('mobile-nav-container');

    // 1. Render Content
    let html = '';
    
    // Flatten logic for simple linear rendering inside container
    if (paper.sections) {
      paper.sections.forEach(sec => {
        // Section Header (only if label exists)
        if (sec.label && sec.label.trim().length > 0) {
          html += `<div class="paper-section-header">${sec.label}</div>`;
        }
        // Questions
        if (sec.questions) {
          sec.questions.forEach(q => {
            html += renderQuestionNode(q, 0, true, paper.defaults);
          });
        }
      });
    } else if (paper.questions) {
      paper.questions.forEach(q => {
        html += renderQuestionNode(q, 0, true, paper.defaults);
      });
    }

    contentEl.innerHTML = html;

    // 2. Render Navigation
    const navHTML = generateNavHTML(paper);
    navElDesktop.innerHTML = `<div class="nav-list">${navHTML}</div>`;
    navElMobile.innerHTML = `<div class="nav-list">${navHTML}</div>`;

    // 3. Post-Render: KaTeX
    renderMathInElement(contentEl, {
      delimiters: [
        {left: '$$', right: '$$', display: true},
        {left: '$', right: '$', display: false}
      ],
      throwOnError: false
    });

    // 4. Post-Render: Interactive Bindings
    bindToggles(contentEl);
    bindNavLinks();
    
    // Reset scroll
    window.scrollTo(0,0);
  }

  // ==========================================================
  // HELPER: RENDER QUESTION NODE
  // ==========================================================
  function renderQuestionNode(node, depth, isTopLevel, defaults) {
    const { id, question, solutionBlock, children } = node;
    
    // Determine default expanded state
    const expandedAll = defaults && defaults.expandedAll !== undefined ? defaults.expandedAll : true;
    
    // Has Solution Block?
    const hasSolutionBlock = !!solutionBlock;
    const answer = hasSolutionBlock ? solutionBlock.answer : null;
    const details = hasSolutionBlock ? solutionBlock.solutionDetails : null;
    const hasDetails = !!details;

    // --- RENDER HTML ---
    let html = `<div class="question-node ${isTopLevel ? 'top-level' : 'child'}" id="q-${id}" data-id="${id}">`;

    // 1. Question Body
    const qBody = md ? md.render(question || '') : (question || '');
    html += `
      <div class="question-body">
        <span class="question-identifier">${id}</span>
        <div class="question-prompt md-content">${qBody}</div>
      </div>
    `;

    // 2. Solution Block
    if (hasSolutionBlock) {
      html += `<div class="solution-block">`;
      
      // Answer
      if (answer) {
        const aBody = md ? md.render(answer) : answer;
        html += `
          <div class="answer-region">
            <span class="answer-label">Answer</span>
            <span class="md-content" style="display:inline;">${aBody}</span>
          </div>
        `;
      }

      // Details (Toggle + Content)
      if (hasDetails) {
        const isExpanded = expandedAll; 
        const expandedState = isExpanded ? 'true' : 'false';
        const displayStyle = isExpanded ? 'flex' : 'none';
        
        // Toggle Control
        html += `
          <button class="disclosure-control" aria-expanded="${expandedState}" aria-controls="sd-${id}">
            <span class="disclosure-text">${isExpanded ? 'Hide working' : 'Show working'}</span>
            <span class="disclosure-icon">▶</span>
          </button>
        `;

        // Details Region
        html += `<div id="sd-${id}" class="solution-details ${isExpanded ? 'expanded' : ''}" style="display:${displayStyle}">`;
        
        // Subsections order: Keep in mind -> Formulas -> Working -> Alt Working
        
        // Keep in mind
        if (details.keepInMind) {
          html += `
            <div class="sd-keep-in-mind md-content">
              <span class="sd-subsection-label">Keep in mind</span>
              ${md ? md.render(details.keepInMind) : details.keepInMind}
            </div>
          `;
        }

        // Formulas used
        if (details.formulasUsed) {
          html += `
            <div class="sd-formulas-used md-content">
              <span class="sd-subsection-label">Formulas used</span>
              ${md ? md.render(details.formulasUsed) : details.formulasUsed}
            </div>
          `;
        }

        // Working
        if (details.working) {
          html += `
            <div class="sd-working md-content">
              <span class="sd-subsection-label">Working</span>
              ${md ? md.render(details.working) : details.working}
            </div>
          `;
        }

        // Alternative Working (Array)
        if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
          details.alternativeWorking.forEach((alt, idx) => {
             html += `
              <div class="sd-alt-working md-content">
                <span class="sd-subsection-label">Alternative working</span>
                ${md ? md.render(alt) : alt}
              </div>
            `;
          });
        }

        html += `</div>`; // End Details
      }

      html += `</div>`; // End Solution Block
    }

    // 3. Children (Recursive)
    if (children && children.length > 0) {
      html += `<div class="children-container">`;
      children.forEach(child => {
        html += renderQuestionNode(child, depth + 1, false, defaults);
      });
      html += `</div>`;
    }

    html += `</div>`; // End Node
    return html;
  }

  // ==========================================================
  // HELPER: NAV GENERATION
  // ==========================================================
  function generateNavHTML(paper) {
    let html = '';

    const processNodes = (nodes, depth) => {
      let chunk = '';
      nodes.forEach(node => {
        chunk += `<a href="#q-${node.id}" class="nav-item" data-id="${node.id}" data-depth="${depth}">${node.id}</a>`;
        if (node.children) {
          chunk += processNodes(node.children, depth + 1);
        }
      });
      return chunk;
    };

    if (paper.sections) {
      paper.sections.forEach(sec => {
        if (sec.label && sec.label.trim().length > 0) {
          html += `<div class="nav-section-label">${sec.label}</div>`;
        }
        if (sec.questions) {
          html += processNodes(sec.questions, 0);
        }
      });
    } else if (paper.questions) {
      html += processNodes(paper.questions, 0);
    }
    
    return html;
  }

  // ==========================================================
  // INTERACTIONS
  // ==========================================================
  function bindToggles(root) {
    root.querySelectorAll('.disclosure-control').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // Find closest button (in case click target was span)
        const toggle = e.currentTarget;
        const regionId = toggle.getAttribute('aria-controls');
        const region = document.getElementById(regionId);
        
        const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
        const newState = !isExpanded;
        
        toggle.setAttribute('aria-expanded', newState);
        toggle.querySelector('.disclosure-text').textContent = newState ? 'Hide working' : 'Show working';
        
        if (newState) {
          region.classList.add('expanded');
          region.style.display = 'flex';
        } else {
          region.classList.remove('expanded');
          region.style.display = 'none';
        }
      });
    });
  }

  function bindNavLinks() {
    const handleNavClick = (e) => {
      e.preventDefault();
      const targetId = e.currentTarget.getAttribute('href').substring(1); // remove #
      const targetEl = document.getElementById(targetId);
      
      if (targetEl) {
        // Scroll adjustment for sticky header (60px) + space (20px)
        const top = targetEl.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({ top, behavior: 'smooth' });
        
        // Update Active State
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.querySelectorAll(`.nav-item[data-id="${e.currentTarget.dataset.id}"]`).forEach(n => n.classList.add('active'));

        // Close drawer if open
        closeDrawer();
      }
    };

    document.querySelectorAll('.nav-item').forEach(link => {
      link.addEventListener('click', handleNavClick);
    });
  }

  // Mobile Drawer Logic
  function setupMobileDrawer() {
    const trigger = document.getElementById('jump-to-btn');
    const closeBtn = document.getElementById('drawer-close');
    const overlay = document.getElementById('drawer-overlay');
    const drawer = document.getElementById('drawer-content');

    const open = () => {
      overlay.classList.add('open');
      drawer.classList.add('open');
      document.body.style.overflow = 'hidden';
    };

    const close = () => {
      overlay.classList.remove('open');
      drawer.classList.remove('open');
      document.body.style.overflow = '';
    };

    trigger.addEventListener('click', open);
    closeBtn.addEventListener('click', close);
    overlay.addEventListener('click', close);
    
    // Expose close globally for nav click
    window.closeDrawer = close;
  }

</script>
</body>
</html>
