<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ - Maths Paper Solution Viewer (Prototype)</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>

    <style>
        /* * RTQ PROTOTYPE STYLES 
         * Strict adherence to Design Brief v4.2
         * Grayscale, Document-centric, Calm.
         */

        :root {
            --c-bg: #ffffff;
            --c-text-primary: #111111;
            --c-text-secondary: #555555;
            --c-text-tertiary: #767676;
            --c-border: #e0e0e0;
            --c-surface: #f9f9f9;
            --c-accent: #333333;
            /* For interactions */

            --spacing-unit: 8px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 32px;
            --spacing-xl: 64px;
            /* Between major questions */

            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: "SF Mono", "Monaco", "Inconsolata", "Fira Mono", "Droid Sans Mono", "Source Code Pro", monospace;

            --layout-width: 960px;
            --nav-width: 180px;
        }

        /* RESET & BASE */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            color: var(--c-text-primary);
            background-color: var(--c-bg);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* LAYOUT SHELL */
        .app-shell {
            max-width: var(--layout-width);
            margin: 0 auto;
            padding: 0 var(--spacing-md);
            position: relative;
        }

        /* HEADER / CONTROLS */
        .top-controls {
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--c-border);
            margin-bottom: var(--spacing-lg);
            background: var(--c-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            /* Ensure controls stay on top */
        }

        .paper-selector {
            font-family: var(--font-main);
            font-size: 1rem;
            padding: var(--spacing-sm);
            border: 1px solid var(--c-text-tertiary);
            border-radius: 4px;
            background: #fff;
            min-width: 250px;
        }

        /* MAIN CONTENT AREA - GRID */
        .content-frame {
            display: grid;
            grid-template-columns: var(--nav-width) 1fr;
            gap: var(--spacing-lg);
            align-items: start;
            min-height: 100vh;
        }

        /* NAVIGATION RAIL */
        .nav-rail {
            position: sticky;
            top: 80px;
            /* Offset for header */
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            padding-right: var(--spacing-md);

            /* Hide Scrollbars */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE/Edge */
        }

        .nav-rail::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-section-label {
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--c-text-primary);
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            padding-left: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: block;
            padding: 4px 8px;
            font-size: 0.9rem;
            color: var(--c-text-secondary);
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.1s ease;
            font-feature-settings: "tnum";
            font-variant-numeric: tabular-nums;
        }

        .nav-item:hover {
            background-color: var(--c-surface);
            color: var(--c-text-primary);
        }

        .nav-item:focus-visible {
            outline: 2px solid var(--c-text-primary);
            background-color: var(--c-surface);
        }

        /* PAPER CONTENT */
        .paper-content {
            padding-bottom: 100px;
            min-width: 0;
            /* Prevent grid blowout from wide math */
        }

        /* QUESTION UNIT */
        .question-block {
            margin-bottom: var(--spacing-xl);
            scroll-margin-top: 100px;
            /* For anchor jumping */
            position: relative;
        }

        .question-header {
            display: flex;
            align-items: baseline;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
        }

        .q-num {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 2em;
        }

        .q-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--c-text-primary);
        }

        /* DIAGRAMS */
        .diagram-container {
            margin: var(--spacing-md) 0;
            background: var(--c-surface);
            border: 1px solid var(--c-border);
            padding: var(--spacing-md);
            display: flex;
            justify-content: center;
            max-width: 400px;
        }

        svg {
            max-width: 100%;
            height: auto;
        }

        .svg-stroke {
            stroke: #333;
            stroke-width: 2;
            fill: none;
        }

        .svg-fill {
            fill: #ddd;
            stroke: none;
        }

        .svg-text {
            font-family: sans-serif;
            font-size: 12px;
            fill: #333;
        }

        /* ANSWER SECTION */
        .answer-section {
            margin-top: var(--spacing-md);
            margin-left: 2em;
            /* Align with text, not number */
            display: flex;
            align-items: baseline;
            gap: var(--spacing-sm);
        }

        .answer-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--c-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .answer-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--c-text-primary);
        }

        /* WORKING SECTION */
        .working-section {
            margin-top: var(--spacing-sm);
            margin-left: 2em;
        }

        .working-toggle {
            background: none;
            border: none;
            padding: var(--spacing-xs) 0;
            font-size: 0.9rem;
            color: var(--c-text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: inherit;
        }

        .working-toggle:hover {
            color: var(--c-text-primary);
            text-decoration: underline;
        }

        .working-toggle svg {
            width: 12px;
            height: 12px;
            transition: transform 0.2s;
        }

        .working-toggle[aria-expanded="true"] svg {
            transform: rotate(90deg);
        }

        .working-content {
            display: none;
            margin-top: var(--spacing-sm);
            padding-left: var(--spacing-md);
            border-left: 2px solid var(--c-border);
            color: var(--c-text-secondary);
            font-size: 1rem;
        }

        .working-content[data-visible="true"] {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* KaTeX Overrides & Styling */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5em 0;
            margin: 0.5em 0;
            -webkit-overflow-scrolling: touch;
            /* smooth scroll on iOS */
            text-align: left !important;
            /* Force left align for flow */
        }

        /* Fallback if KaTeX fails */
        .math-fallback {
            font-family: var(--font-mono);
            background: #eee;
            padding: 2px 4px;
            font-size: 0.9em;
        }

        /* NESTED QUESTIONS */
        .sub-questions {
            margin-top: var(--spacing-md);
            margin-left: 1em;
            /* Indentation */
        }

        .sub-questions .question-block {
            margin-bottom: var(--spacing-lg);
            /* Tighter than top level */
        }

        .sub-questions .q-num {
            font-size: 1rem;
            min-width: 1.5em;
        }

        /* MOBILE / TABLET OVERRIDES */
        .mobile-nav-trigger {
            display: none;
        }

        .mobile-nav-overlay {
            display: none;
        }

        @media (max-width: 768px) {
            .content-frame {
                display: block;
                /* Stack layout */
            }

            .nav-rail {
                display: none;
                /* Hide standard rail */
            }

            .mobile-nav-trigger {
                display: inline-block;
                background: var(--c-text-primary);
                color: white;
                border: none;
                padding: 8px 12px;
                border-radius: 4px;
                font-size: 0.9rem;
                cursor: pointer;
            }

            /* Mobile Overlay Nav */
            .mobile-nav-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 200;
            }

            .mobile-nav-overlay.open {
                display: block;
            }

            .mobile-drawer {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 0;
                width: 80%;
                max-width: 300px;
                background: white;
                overflow-y: auto;
                padding: var(--spacing-md);
                box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .close-nav {
                display: block;
                margin-bottom: var(--spacing-md);
                background: none;
                border: none;
                font-size: 1.5rem;
                padding: 0;
                cursor: pointer;
            }

            /* Adjust visual density for mobile */
            .question-header {
                flex-direction: column;
                gap: 0;
            }

            .q-text {
                display: block;
                margin-left: 0;
            }

            .answer-section,
            .working-section,
            .sub-questions {
                margin-left: 0;
                /* Reduce indent on mobile */
                padding-left: var(--spacing-sm);
                border-left: 2px solid transparent;
                /* Visual anchor placeholder */
            }

            .sub-questions {
                border-left: 2px solid var(--c-border);
                /* Visual thread */
            }
        }
    </style>
</head>

<body>

    <div class="app-shell">
        <header class="top-controls">
            <select id="paperSelect" class="paper-selector" aria-label="Select Paper">
                <option value="short">Short Paper (6 Qs)</option>
                <option value="standard">Standard Paper (35 Qs)</option>
                <option value="diagram">Diagram-Heavy (20 Qs)</option>
                <option value="sectioned">Sectioned Paper (A/B/C)</option>
                <option value="stress_expanded">Stress Test: Standard (All Expanded)</option>
            </select>

            <button class="mobile-nav-trigger" id="mobileNavBtn">Jump to Question</button>
        </header>

        <main class="content-frame">

            <nav class="nav-rail" id="desktopNav" aria-label="Question Navigation">
            </nav>

            <article class="paper-content" id="paperContainer">
            </article>

        </main>
    </div>

    <div class="mobile-nav-overlay" id="mobileNavOverlay">
        <div class="mobile-drawer">
            <button class="close-nav" id="closeNavBtn" aria-label="Close navigation">&times;</button>
            <div class="nav-list" id="mobileNavList">
            </div>
        </div>
    </div>

    <script>
        // --- UTILS & DATA GENERATION ---

        const diagrams = {
            geometry: `<svg viewBox="0 0 200 150"><path d="M20,130 L100,20 L180,130 Z" class="svg-stroke"/><circle cx="100" cy="90" r="30" class="svg-stroke"/><text x="90" y="95" class="svg-text">r=3</text><text x="10" y="145" class="svg-text">A</text><text x="185" y="145" class="svg-text">B</text><text x="95" y="15" class="svg-text">C</text></svg>`,
            bar: `<svg viewBox="0 0 200 100"><rect x="20" y="20" width="40" height="60" class="svg-fill"/><rect x="80" y="40" width="40" height="40" class="svg-fill"/><rect x="140" y="10" width="40" height="70" class="svg-fill"/><line x1="10" y1="90" x2="190" y2="90" class="svg-stroke"/><text x="30" y="98" class="svg-text">X</text><text x="90" y="98" class="svg-text">Y</text><text x="150" y="98" class="svg-text">Z</text></svg>`,
            coord: `<svg viewBox="0 0 200 200"><line x1="10" y1="100" x2="190" y2="100" class="svg-stroke"/><line x1="100" y1="10" x2="100" y2="190" class="svg-stroke"/><circle cx="140" cy="60" r="4" fill="#333"/><text x="145" y="55" class="svg-text">P(4,4)</text><line x1="20" y1="180" x2="180" y2="20" class="svg-stroke" stroke-dasharray="4"/></svg>`,
            table: `<svg viewBox="0 0 200 80"><rect x="10" y="10" width="180" height="60" class="svg-stroke"/><line x1="10" y1="40" x2="190" y2="40" class="svg-stroke"/><line x1="100" y1="10" x2="100" y2="70" class="svg-stroke"/><text x="20" y="30" class="svg-text">Item</text><text x="110" y="30" class="svg-text">Cost</text><text x="20" y="60" class="svg-text">Apple</text><text x="110" y="60" class="svg-text">Â£0.50</text></svg>`
        };

        const mathTemplates = {
            arithmetic: "125 + 34 = 159",
            fraction: "\\frac{3}{4} + \\frac{1}{2} = \\frac{3}{4} + \\frac{2}{4} = \\frac{5}{4}",
            algebra_short: "3x + 5 = 20 \\implies 3x = 15 \\implies x = 5",
            algebra_long: (lines) => {
                let s = "\\begin{aligned} ";
                s += "f(x) &= 2x^2 + 4x + 10 \\\\ ";
                for (let i = 0; i < lines; i++) {
                    s += `&= 2(x^2 + 2x) + 10 + ${i} \\\\ `;
                }
                s += "&= \\text{Final Answer} \\end{aligned}";
                return s;
            }
        };

        // Paper Generators
        function generatePaper(type) {
            let questions = [];
            let sections = [];
            let isExpandedStress = (type === 'stress_expanded');

            if (type === 'short') {
                questions = [
                    createQ(1, "Calculate the sum of 125 and 34.", "159", "arithmetic"),
                    createQ(2, "Simplify the fraction.", "5/4", "fraction"),
                    createQ(3, "Solve for x.", "x=5", "algebra_short"),
                    createQ(4, "Find the area.", "15cm^2", "arithmetic", "geometry"),
                    {
                        id: "q5", number: "5", text: "A multi-part question about ratios.",
                        parts: [
                            createQ("a", "Find the ratio of X to Y.", "2:3", "arithmetic", "bar"),
                            createQ("b", "If Z is 20, what is X?", "15", "arithmetic")
                        ]
                    },
                    createQ(6, "Final arithmetic check.", "100", "arithmetic")
                ];
            } else if (type === 'standard' || type === 'stress_expanded') {
                for (let i = 1; i <= 35; i++) {
                    let isLong = i >= 26;
                    let qText = isLong ? "A complex algebraic problem requiring derivation." : "Solve the following problem.";
                    let wType = isLong ? mathTemplates.algebra_long(15) : "arithmetic";

                    // Stress test extremely long working for a few
                    if (type === 'stress_expanded' && i === 30) wType = mathTemplates.algebra_long(50);

                    // Add nesting for specific questions
                    if (i === 18) {
                        questions.push({
                            id: `q${i}`, number: `${i}`, text: "Nested question structure.",
                            parts: [
                                {
                                    id: `q${i}a`, number: "a", text: "First part.",
                                    parts: [
                                        createQ("i", "Sub-part one.", "42", "arithmetic"),
                                        createQ("ii", "Sub-part two.", "43", "arithmetic")
                                    ]
                                },
                                createQ("b", "Second part.", "10", "algebra_short")
                            ]
                        });
                    } else {
                        questions.push(createQ(i, qText, "Answer", wType));
                    }
                }
            } else if (type === 'diagram') {
                let diagKeys = Object.keys(diagrams);
                for (let i = 1; i <= 20; i++) {
                    let hasDiag = [2, 5, 8, 10, 12, 15, 18, 20].includes(i);
                    let dType = hasDiag ? diagKeys[i % diagKeys.length] : null;
                    questions.push(createQ(i, "Question involving visual data.", "Answer", "algebra_short", dType));
                }
            } else if (type === 'sectioned') {
                // Section A
                sections.push({ label: "Section A", start: 0 });
                for (let i = 1; i <= 35; i++) questions.push(createQ(i, "Section A Question", "Ans", "arithmetic"));

                // Section B
                sections.push({ label: "Section B", start: 35 });
                for (let i = 1; i <= 8; i++) questions.push(createQ(`B${i}`, "Section B Question", "Ans", "algebra_short"));

                // Section C (Long)
                sections.push({ label: "Section C", start: 43 });
                for (let i = 1; i <= 6; i++) questions.push(createQ(`C${i}`, "Long Derivation Required", "Ans", mathTemplates.algebra_long(25)));
            }

            return { questions, sections, isExpandedStress };
        }

        function createQ(num, text, ans, workType, diagType = null) {
            let workContent = typeof workType === 'function' ? workType : (mathTemplates[workType] || workType);
            // If exact string passed (like 'arithmetic'), lookup, else use raw
            if (Object.keys(mathTemplates).includes(workType)) workContent = mathTemplates[workType];

            return {
                id: `q${num}`.replace(/[^a-z0-9]/gi, ''),
                number: `${num}`,
                text: text,
                answer: ans,
                working: workContent,
                diagram: diagType
            };
        }

        // --- RENDERERS ---

        const paperContainer = document.getElementById('paperContainer');
        const desktopNav = document.getElementById('desktopNav');
        const mobileNavList = document.getElementById('mobileNavList');

        function renderMath(element, tex) {
            try {
                katex.render(tex, element, {
                    throwOnError: false,
                    displayMode: true,
                    fleqn: true // Flush left equations
                });
            } catch (e) {
                element.textContent = tex;
                element.className = 'math-fallback';
            }
        }

        function renderQuestion(q, level = 0, autoExpand = false) {
            const block = document.createElement('div');
            block.className = 'question-block';
            if (level > 0) block.style.marginTop = 'var(--spacing-md)';
            block.id = q.id;

            // 1. Header (Number + Text)
            const header = document.createElement('div');
            header.className = 'question-header';

            const num = document.createElement('span');
            num.className = 'q-num';
            num.textContent = level === 0 ? `${q.number}.` : `(${q.number})`; // Formatting for sub-qs

            const text = document.createElement('span');
            text.className = 'q-text';
            text.innerHTML = q.text; // Allow basic HTML if needed, mostly text

            header.appendChild(num);
            header.appendChild(text);
            block.appendChild(header);

            // Diagram
            if (q.diagram && diagrams[q.diagram]) {
                const d = document.createElement('div');
                d.className = 'diagram-container';
                d.innerHTML = diagrams[q.diagram];
                // Insert after text, inside block
                block.appendChild(d);
            }

            // Sub-questions (Recursive)
            if (q.parts) {
                const subs = document.createElement('div');
                subs.className = 'sub-questions';
                q.parts.forEach(p => subs.appendChild(renderQuestion(p, level + 1, autoExpand)));
                block.appendChild(subs);
            } else {
                // Leaf node: Render Answer & Working

                // Answer
                const ansSection = document.createElement('div');
                ansSection.className = 'answer-section';
                ansSection.innerHTML = `<span class="answer-label">Answer:</span> <span class="answer-value">${q.answer}</span>`;
                block.appendChild(ansSection);

                // Working
                const workSection = document.createElement('div');
                workSection.className = 'working-section';

                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'working-toggle';
                toggleBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
                <span>${autoExpand ? 'Hide working' : 'Show working'}</span>
            `;
                toggleBtn.setAttribute('aria-expanded', autoExpand);

                const workContent = document.createElement('div');
                workContent.className = 'working-content';
                if (autoExpand) workContent.setAttribute('data-visible', 'true');

                // Render math inside
                const mathContainer = document.createElement('div');
                renderMath(mathContainer, q.working);
                workContent.appendChild(mathContainer);

                // Interaction
                toggleBtn.onclick = () => {
                    const isExpanded = toggleBtn.getAttribute('aria-expanded') === 'true';
                    toggleBtn.setAttribute('aria-expanded', !isExpanded);
                    toggleBtn.querySelector('span').textContent = !isExpanded ? 'Hide working' : 'Show working';
                    workContent.setAttribute('data-visible', !isExpanded);
                };

                workSection.appendChild(toggleBtn);
                workSection.appendChild(workContent);
                block.appendChild(workSection);
            }

            return block;
        }

        function renderNav(questions, sections) {
            let html = '<ul class="nav-list">';

            // Helper to flatten q-list for nav but respecting sections
            let qIndex = 0;

            // Simple linear render for now, injecting headers
            // If sections exist, we track index to inject header
            let currentSectionIdx = 0;

            questions.forEach((q, idx) => {
                // Check if a section starts here
                if (sections && sections.length > 0 && currentSectionIdx < sections.length) {
                    if (idx === sections[currentSectionIdx].start) {
                        html += `<li class="nav-section-label">${sections[currentSectionIdx].label}</li>`;
                        currentSectionIdx++;
                    }
                }

                html += `<li><a href="#${q.id}" class="nav-item" onclick="handleNavClick(event, '${q.id}')">${q.number}</a></li>`;

                // Basic support for 1 level deep nav in diagram/short papers
                if (q.parts) {
                    q.parts.forEach(p => {
                        html += `<li><a href="#${p.id}" class="nav-item" style="padding-left:16px; font-size:0.85em;">${q.number}${p.number}</a></li>`;
                    });
                }
            });
            html += '</ul>';
            return html;
        }

        function loadPaper(type) {
            // Clear
            paperContainer.innerHTML = '';
            desktopNav.innerHTML = '';
            mobileNavList.innerHTML = '';

            const data = generatePaper(type);

            // Render Nav
            const navHTML = renderNav(data.questions, data.sections);
            desktopNav.innerHTML = navHTML;
            mobileNavList.innerHTML = navHTML;

            // Render Questions
            data.questions.forEach(q => {
                paperContainer.appendChild(renderQuestion(q, 0, data.isExpandedStress));
            });
        }

        // --- INTERACTIONS ---

        function handleNavClick(e, id) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Close mobile nav if open
                document.getElementById('mobileNavOverlay').classList.remove('open');

                // Accessibility focus
                target.setAttribute('tabindex', '-1');
                target.focus();
            }
        }

        document.getElementById('paperSelect').addEventListener('change', (e) => {
            loadPaper(e.target.value);
            window.scrollTo(0, 0);
        });

        // Mobile Nav Toggles
        const overlay = document.getElementById('mobileNavOverlay');
        document.getElementById('mobileNavBtn').onclick = () => overlay.classList.add('open');
        document.getElementById('closeNavBtn').onclick = () => overlay.classList.remove('open');
        overlay.onclick = (e) => { if (e.target === overlay) overlay.classList.remove('open'); };

        // Initial Load
        loadPaper('short');

    </script>

</body>

</html>