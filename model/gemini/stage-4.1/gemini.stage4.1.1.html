<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ - Maths Paper Solution Viewer</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <style>
        /* =========================================
           RESET & BASE
           ========================================= */
        :root {
            --c-bg-app: #f4f4f4;
            --c-bg-surface: #ffffff;
            --c-text-primary: #111111;
            --c-text-secondary: #555555;
            --c-text-tertiary: #757575;
            --c-accent: #222222; /* Neutral interaction color */
            --c-line: #e0e0e0;
            --c-focus: #000000;
            --c-solution-bg: #fafafa;

            --font-stack: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            
            --spacing-unit: 8px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 32px;
            --spacing-xl: 64px;

            --w-max-content: 960px;
            --w-nav: 200px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-stack);
            background-color: var(--c-bg-app);
            color: var(--c-text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* =========================================
           LAYOUT SHELL
           ========================================= */
        .app-shell {
            max-width: var(--w-max-content);
            margin: 0 auto;
            background-color: var(--c-bg-surface);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.02);
        }

        /* Header / Controls */
        .top-controls {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--c-line);
            background: var(--c-bg-surface);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .paper-selector {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .paper-selector label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--c-text-secondary);
        }

        select {
            padding: var(--spacing-sm) var(--spacing-md);
            font-family: inherit;
            font-size: 1rem;
            border: 1px solid var(--c-line);
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
        }

        /* Main Content Area */
        .content-frame {
            display: flex;
            flex: 1;
            position: relative;
        }

        /* =========================================
           NAVIGATION RAIL
           ========================================= */
        .nav-rail {
            width: var(--w-nav);
            flex-shrink: 0;
            padding: var(--spacing-lg) var(--spacing-md) var(--spacing-lg) var(--spacing-lg);
            border-right: 1px solid transparent; /* Visual separation via whitespace mostly */
            
            /* Sticky Logic */
            position: sticky;
            top: 73px; /* Offset for header */
            height: calc(100vh - 73px);
            overflow-y: auto;
            
            /* Hide Scrollbars */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        
        .nav-rail::-webkit-scrollbar {
            display: none;
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .nav-section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--c-text-tertiary);
            font-weight: 700;
            margin-top: var(--spacing-md);
            margin-bottom: var(--spacing-xs);
            padding-left: var(--spacing-sm);
        }

        .nav-item {
            display: block;
            padding: var(--spacing-xs) var(--spacing-sm);
            text-decoration: none;
            color: var(--c-text-tertiary);
            font-size: 0.9rem;
            border-radius: 4px;
            transition: color 0.1s ease, background 0.1s ease;
        }

        .nav-item:hover {
            color: var(--c-text-primary);
            background-color: var(--c-bg-app);
        }

        .nav-item.active {
            color: var(--c-text-primary);
            font-weight: 700;
            background-color: transparent; /* Clean look */
        }

        /* =========================================
           PAPER CONTENT
           ========================================= */
        .paper-stream {
            flex: 1;
            padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-xl) var(--spacing-lg);
            /* Prevent horizontal overflow at root */
            min-width: 0; 
        }

        /* Question Block */
        .question-block {
            margin-bottom: var(--spacing-xl);
            scroll-margin-top: 100px; /* Offset for sticky header */
            position: relative;
        }

        /* Indentation for sub-questions */
        .question-block[data-indent="1"] { margin-left: var(--spacing-lg); }
        .question-block[data-indent="2"] { margin-left: calc(var(--spacing-lg) * 2); }

        /* Typography Hierarchy */
        .q-header {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }

        .q-id {
            font-weight: 700;
            color: var(--c-text-primary);
            min-width: 2ch;
            flex-shrink: 0;
        }

        .q-text {
            color: var(--c-text-primary);
            font-size: 1.125rem;
            font-weight: 400;
            line-height: 1.5;
        }

        .q-diagram {
            margin: var(--spacing-md) 0;
            display: block;
            max-width: 100%;
            height: auto;
            border: 1px solid transparent; /* No border, just placement */
        }

        .q-diagram svg {
            display: block;
            max-width: 100%;
            height: auto;
            color: var(--c-text-primary);
        }

        /* Answer Section */
        .answer-section {
            margin-left: calc(2ch + var(--spacing-md)); /* Align with text */
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: baseline;
            gap: var(--spacing-md);
        }

        .answer-label {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .answer-value {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--c-text-primary);
        }

        /* Solution Details (Workings) */
        .solution-toggle-btn {
            background: none;
            border: none;
            padding: 0;
            margin-left: calc(2ch + var(--spacing-md));
            font-family: inherit;
            font-size: 0.95rem;
            color: var(--c-text-secondary);
            cursor: pointer;
            text-decoration: underline;
            text-underline-offset: 4px;
            transition: color 0.2s;
        }

        .solution-toggle-btn:hover {
            color: var(--c-text-primary);
        }

        .solution-details {
            margin-top: var(--spacing-md);
            margin-left: calc(2ch + var(--spacing-md));
            padding-left: var(--spacing-md);
            border-left: 2px solid var(--c-line); /* Subtle guideline */
            display: none; /* Collapsed by default */
        }

        .solution-details.expanded {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Solution Components */
        .sol-component {
            margin-bottom: var(--spacing-md);
        }
        
        .sol-component:last-child {
            margin-bottom: 0;
        }

        .sol-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--c-text-tertiary);
            margin-bottom: var(--spacing-xs);
            text-transform: uppercase;
        }

        .sol-body {
            font-size: 1rem;
            color: var(--c-text-secondary);
            line-height: 1.6;
        }

        .keep-in-mind {
            background-color: #f7f7f7;
            padding: var(--spacing-md);
            border-radius: 4px;
        }

        /* KaTeX & Math Handling */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding: var(--spacing-xs) 0;
            margin: var(--spacing-sm) 0;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Force scrollbars on math to be unobtrusive but usable */
        .katex-display::-webkit-scrollbar {
            height: 6px;
        }
        .katex-display::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        /* =========================================
           RESPONSIVE
           ========================================= */
        @media (max-width: 768px) {
            .app-shell {
                width: 100%;
            }

            .content-frame {
                flex-direction: column;
            }

            .nav-rail {
                display: none; /* Use overlay for mobile - simplified for prototype as 'drawer' */
            }

            /* Mobile Nav Overlay (Simplified for prototype) */
            .mobile-nav-trigger {
                display: block;
            }
            
            .paper-stream {
                padding: var(--spacing-md);
            }

            .q-text {
                font-size: 1rem;
            }
        }

        /* Focus Styles for Accessibility */
        button:focus-visible, a:focus-visible, select:focus-visible {
            outline: 2px solid var(--c-focus);
            outline-offset: 2px;
        }

    </style>
</head>
<body>

<div class="app-shell">
    
    <header class="top-controls">
        <div class="paper-selector">
            <label for="paper-select">Select Paper:</label>
            <select id="paper-select" onchange="loadPaper(this.value)">
                <option value="short">Short Paper (6 Qs)</option>
                <option value="standard">Standard Paper (35 Qs)</option>
                <option value="standard-expanded">Standard (Workings Expanded)</option>
                <option value="diagrams">Diagram Heavy (20 Qs)</option>
                <option value="sectioned">Sectioned Paper (A, B, C)</option>
            </select>
        </div>
    </header>

    <main class="content-frame">
        
        <nav class="nav-rail" aria-label="Paper Navigation">
            <ul class="nav-list" id="nav-list-container">
                </ul>
        </nav>

        <article class="paper-stream" id="paper-content">
            </article>

    </main>

</div>

<script>
    // =========================================
    // DATA GENERATORS & HELPERS
    // =========================================

    // SVG Diagrams
    const SVGS = {
        geometry: `<svg viewBox="0 0 200 150" fill="none" stroke="#333" stroke-width="2" xmlns="http://www.w3.org/2000/svg" style="background:#f9f9f9; width:200px;"><path d="M20 130 L100 20 L180 130 Z" /><circle cx="100" cy="90" r="30" stroke-dasharray="4 4" /><text x="90" y="145" font-family="sans-serif" font-size="12" stroke="none" fill="#333">x cm</text></svg>`,
        bar: `<svg viewBox="0 0 300 100" fill="none" xmlns="http://www.w3.org/2000/svg" style="background:#f9f9f9; width:300px;"><rect x="10" y="20" width="100" height="60" fill="#ddd" /><rect x="115" y="20" width="60" height="60" fill="#bbb" /><rect x="180" y="20" width="100" height="60" fill="#999" /><text x="10" y="95" font-family="sans-serif" font-size="12" fill="#333">A</text><text x="115" y="95" font-family="sans-serif" font-size="12" fill="#333">B</text><text x="180" y="95" font-family="sans-serif" font-size="12" fill="#333">C</text></svg>`,
        grid: `<svg viewBox="0 0 200 200" fill="none" stroke="#ccc" stroke-width="1" xmlns="http://www.w3.org/2000/svg" style="background:#fff; width:200px;"><path d="M0 20 H200 M0 40 H200 M0 60 H200 M0 80 H200 M0 100 H200 M0 120 H200 M0 140 H200 M0 160 H200 M0 180 H200" /><path d="M20 0 V200 M40 0 V200 M60 0 V200 M80 0 V200 M100 0 V200 M120 0 V200 M140 0 V200 M160 0 V200 M180 0 V200" /><path d="M20 180 L180 20" stroke="#333" stroke-width="2" /></svg>`,
        table: `<svg viewBox="0 0 300 100" fill="none" stroke="#333" stroke-width="1" xmlns="http://www.w3.org/2000/svg" style="background:#fff; width:300px;"><rect x="1" y="1" width="298" height="98" /><line x1="100" y1="0" x2="100" y2="100" /><line x1="200" y1="0" x2="200" y2="100" /><line x1="0" y1="33" x2="300" y2="33" /><line x1="0" y1="66" x2="300" y2="66" /></svg>`
    };

    // Helper: Create a question object
    function q(id, type, options = {}) {
        const {
            indent = 0,
            hasDiagram = false,
            diagramType = 'geometry',
            linesOfWorking = 5,
            isLong = false,
            section = null,
            subParts = null,
            expanded = false,
            includeExtras = false // Keep in mind, Formulas, Alt working
        } = options;

        let workingLatex = "";
        
        // Generate working steps based on linesOfWorking
        if (linesOfWorking > 20) {
            // Extreme long working
            workingLatex = `\\text{Initial setup: } 3x^2 + 7x - 20 = 0 \\\\`;
            for(let i=0; i<linesOfWorking; i++) {
                workingLatex += `\\Rightarrow \\quad \\text{Step ${i+1}: derivation continues... } \\frac{${i}x}{y} = \\sqrt{${i*2}} \\\\`;
            }
            workingLatex += `\\text{Final Check: } x = \\frac{4}{3}`;
        } else {
            // Standard working
            workingLatex = `\\begin{aligned} 
                \\text{Total} &= 180^\\circ \\\\
                3x + 40 &= 180 \\\\
                3x &= 140 \\\\
                x &= \\frac{140}{3} \\approx 46.67
            \\end{aligned}`;
        }

        const questionText = options.text || (type === 'arithmetic' ? "Calculate the value of $342 \\times 16$." : "Solve for $x$ in the equation below.");
        const answerVal = options.answer || (type === 'arithmetic' ? "5472" : "46.67");

        return {
            id,
            section,
            indent,
            text: questionText,
            answer: answerVal,
            diagram: hasDiagram ? SVGS[diagramType] : null,
            working: workingLatex,
            expanded,
            includeExtras,
            isLong
        };
    }

    // Dataset Generators
    const DATASETS = {
        short: () => [
            q('1', 'arithmetic', { text: "Calculate $15\\%$ of $40$." , answer: "6" }),
            q('2', 'word', { text: "A train leaves London at 09:45 and arrives in Paris at 13:15. How long is the journey?", answer: "3 hours 30 mins" }),
            q('3', 'algebra', { text: "Simplify $3a + 4b - a + 2b$.", answer: "$2a + 6b$" }),
            q('4', 'geometry', { hasDiagram:true, diagramType:'geometry', text: "Calculate angle $x$.", answer: "$36^\\circ$" }),
            q('5', 'multi', { text: "Solve the following:" }),
            q('5a', 'arithmetic', { indent: 1, text: "$24 \\div 6 + 2$", answer: "6" }),
            q('5b', 'arithmetic', { indent: 1, text: "$(24 \\div 6) + 2$", answer: "6" })
        ],
        standard: (expandedDefault = false) => {
            let qs = [];
            // 1-25 Standard
            for(let i=1; i<=25; i++) {
                qs.push(q(`${i}`, 'mixed', { expanded: expandedDefault, linesOfWorking: 4, text: `Standard Question ${i}: Solve $2x + ${i} = 20$.`, answer: `${(20-i)/2}` }));
            }
            // 26-35 Long
            for(let i=26; i<=35; i++) {
                qs.push(q(`${i}`, 'long', { isLong: true, linesOfWorking: 30, expanded: expandedDefault, text: `Long Question ${i}: Derive the quadratic formula.`, answer: "Proof shown" }));
            }
            return qs;
        },
        diagrams: () => {
            let qs = [];
            for(let i=1; i<=20; i++) {
                const hasDiag = [2,5,8,10,12,15,18,20].includes(i);
                const types = ['geometry', 'bar', 'grid', 'table'];
                qs.push(q(`${i}`, 'mixed', { hasDiagram: hasDiag, diagramType: types[i%4], text: hasDiag ? `Refer to the diagram. Calculate area.` : `Solve question ${i}.`, answer: "42" }));
            }
            return qs;
        },
        sectioned: () => {
            let qs = [];
            // Section A
            for(let i=1; i<=35; i++) qs.push(q(`${i}`, 'mixed', { section: (i===1 ? 'Section A' : null), text: `Section A, Q${i}`, answer: "A" }));
            // Section B
            for(let i=1; i<=8; i++) qs.push(q(`${i}`, 'mixed', { section: (i===1 ? 'Section B' : null), text: `Section B, Q${i}`, answer: "B" }));
            // Section C (Long)
            for(let i=1; i<=6; i++) qs.push(q(`${i}`, 'long', { section: (i===1 ? 'Section C' : null), isLong: true, includeExtras: true, linesOfWorking: 50, text: `Section C, Q${i} (Complex)`, answer: "C" }));
            return qs;
        }
    };

    // =========================================
    // RENDER LOGIC
    // =========================================

    const container = document.getElementById('paper-content');
    const navContainer = document.getElementById('nav-list-container');
    let currentData = [];

    function loadPaper(type) {
        container.innerHTML = "";
        navContainer.innerHTML = "";
        
        let data = [];
        if(type === 'standard-expanded') {
            data = DATASETS.standard(true);
        } else {
            data = DATASETS[type]();
        }
        currentData = data;

        // Render Nav and Content
        let currentSection = null;

        data.forEach((item, index) => {
            // Navigation Section Header
            if(item.section && item.section !== currentSection) {
                currentSection = item.section;
                const secLi = document.createElement('li');
                secLi.className = 'nav-section-label';
                secLi.textContent = currentSection;
                navContainer.appendChild(secLi);
            }

            // Navigation Item
            const navLi = document.createElement('li');
            const navA = document.createElement('a');
            navA.className = 'nav-item';
            navA.href = `#q-${item.id}-${index}`; // Unique hash
            navA.textContent = item.id;
            navLi.appendChild(navA);
            navContainer.appendChild(navLi);

            // Paper Content
            const article = document.createElement('div');
            article.className = 'question-block';
            article.id = `q-${item.id}-${index}`;
            article.setAttribute('data-indent', item.indent);

            // Diagram HTML
            const diagramHtml = item.diagram ? `<div class="q-diagram">${item.diagram}</div>` : '';

            // Extras (Add-on coverage)
            let extrasHtml = '';
            if(item.includeExtras) {
                extrasHtml = `
                    <div class="sol-component keep-in-mind">
                        <span class="sol-label">Keep in mind</span>
                        <div class="sol-body">Remember to convert units before starting the calculation.</div>
                    </div>
                    <div class="sol-component">
                        <span class="sol-label">Formulas used</span>
                        <div class="sol-body">$$ Area = \\pi r^2 $$</div>
                    </div>
                `;
            }
            let altWorkingHtml = item.includeExtras ? `
                <div class="sol-component">
                    <span class="sol-label">Alternative working</span>
                    <div class="sol-body">Using ratio method: $$ 3:4 \\rightarrow 12 $$</div>
                </div>
            ` : '';

            const workingStateClass = item.expanded ? 'expanded' : '';
            const btnText = item.expanded ? 'Hide working' : 'Show working';

            article.innerHTML = `
                <div class="q-header">
                    <span class="q-id">${item.id}</span>
                    <div class="q-content-wrapper" style="flex:1;">
                        <div class="q-text">
                            ${item.text}
                            ${diagramHtml}
                        </div>
                    </div>
                </div>

                <div class="answer-section">
                    <span class="answer-label">Answer</span>
                    <span class="answer-value">${item.answer}</span>
                </div>

                <button class="solution-toggle-btn" onclick="toggleWorking(this)">${btnText}</button>

                <div class="solution-details ${workingStateClass}">
                    ${extrasHtml}
                    <div class="sol-component">
                        <span class="sol-label">Working</span>
                        <div class="sol-body">
                            $$ ${item.working} $$
                        </div>
                    </div>
                    ${altWorkingHtml}
                </div>
            `;

            container.appendChild(article);
        });

        // Trigger KaTeX Render
        renderMathInElement(container, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ],
            throwOnError: false
        });

        setupNavObserver();
    }

    // =========================================
    // INTERACTION LOGIC
    // =========================================

    window.toggleWorking = function(btn) {
        const details = btn.nextElementSibling;
        const isExpanded = details.classList.contains('expanded');
        
        if(isExpanded) {
            details.classList.remove('expanded');
            btn.textContent = "Show working";
        } else {
            details.classList.add('expanded');
            btn.textContent = "Hide working";
        }
    };

    // Scroll Observer for Navigation Highlighting
    function setupNavObserver() {
        const options = {
            root: null,
            rootMargin: '-10% 0px -80% 0px', // Active when element is near top
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if(entry.isIntersecting) {
                    // Remove active from all
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    // Add active to current
                    const id = entry.target.id;
                    const navLink = document.querySelector(`.nav-item[href="#${id}"]`);
                    if(navLink) {
                        navLink.classList.add('active');
                        // Scroll nav into view if needed
                        navLink.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                    }
                }
            });
        }, options);

        document.querySelectorAll('.question-block').forEach(section => {
            observer.observe(section);
        });
    }

    // Initialize Default
    window.addEventListener('DOMContentLoaded', () => {
        loadPaper('short');
    });

</script>
</body>
</html>