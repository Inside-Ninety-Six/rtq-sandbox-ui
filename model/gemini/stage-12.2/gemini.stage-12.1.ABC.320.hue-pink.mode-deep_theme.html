<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"320","totalWithinVariant":"320","hueFamily":"pink","intensityMode":"deep_theme","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-10T01:23:14.674Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;320&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;pink&quot;,&quot;intensityMode&quot;:&quot;deep_theme&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-10T01:23:14.674Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer (Stage 6 Baseline)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- KaTeX (No SRI per Stage 6.0.7b) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <style>
        /* COLORLAB CONFIGURATION: Deep Theme + Pink Hue */
        :root {
            /* 
               ColorLab Mode: deep_theme 
               Forced Hue: pink (H ~ 350)
            */
            
            /* Surfaces */
            --page-bg: 96% 0.08 350;      /* oklch(0.96 0.08 350) */
            --frame-bg: 93% 0.10 350;     /* oklch(0.93 0.10 350) */
            --paper-bg: 98% 0.06 350;     /* oklch(0.98 0.06 350) */
            
            /* Washes */
            --wash-solution: 95% 0.05 350; /* oklch(0.95 0.05 350) */
            --wash-sub: 94% 0.06 350;      /* oklch(0.94 0.06 350) */

            /* Typography (High Legibility, Low Chroma) */
            --text-primary: 20% 0.015 350;   /* oklch(0.20 0.015 350) */
            --text-secondary: 40% 0.02 350;  /* oklch(0.40 0.02 350) */
            --text-tertiary: 55% 0.02 350;   /* oklch(0.55 0.02 350) */

            /* Accent (Restrained, for affordance only) */
            --accent: 55% 0.22 350;          /* oklch(0.55 0.22 350) */
            --accent-foreground: 98% 0.01 350;

            /* Borders/Lines (Neutral-leaning) */
            --border: 85% 0.02 350;          /* oklch(0.85 0.02 350) */
            
            /* Focus Ring */
            --focus-ring: 55% 0.22 350;
        }

        body {
            background-color: oklch(var(--page-bg));
            color: oklch(var(--text-primary));
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbar hiding for nav */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* KaTeX Containment Invariant */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding-bottom: 0.5rem; /* Space for scrollbar if needed */
            -webkit-overflow-scrolling: touch;
        }
        
        /* Table styles per Stage 5.8.5 */
        .md-table-wrapper {
            overflow-x: auto;
            margin-bottom: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid oklch(var(--border));
            padding: 0.5rem;
            text-align: left;
        }
        th {
            font-weight: 600;
        }

        /* Remove default list styles from markdown unless specifically styled, but keep hierarchy */
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1em; }
        .prose ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1em; }
        .prose p { margin-bottom: 0.75em; line-height: 1.6; }
        .prose p:last-child { margin-bottom: 0; }
        
        /* Focus styles */
        *:focus-visible {
            outline: 2px solid oklch(var(--focus-ring));
            outline-offset: 2px;
            border-radius: 2px;
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        page: 'oklch(var(--page-bg))',
                        frame: 'oklch(var(--frame-bg))',
                        paper: 'oklch(var(--paper-bg))',
                        primary: 'oklch(var(--text-primary))',
                        secondary: 'oklch(var(--text-secondary))',
                        tertiary: 'oklch(var(--text-tertiary))',
                        accent: 'oklch(var(--accent))',
                        'accent-fg': 'oklch(var(--accent-foreground))',
                        border: 'oklch(var(--border))',
                        wash: 'oklch(var(--wash-solution))',
                        'wash-sub': 'oklch(var(--wash-sub))'
                    },
                    spacing: {
                        'rhythm-lg': '3rem',    /* Top-level question separation */
                        'rhythm-md': '1.5rem',  /* Parent-child separation */
                        'rhythm-sm': '1rem',    /* Internal question blocks */
                        'rhythm-xs': '0.5rem',  /* Tight grouping */
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center">

    <div id="root" class="w-full h-full flex flex-col items-center"></div>

    <script type="text/babel">
        /**
         * STAGE 0: CONSTANTS
         */
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        /**
         * MARKDOWN RENDERER CONFIGURATION (Stage 6 Add-on)
         */
        const md = window.markdownit
            ? window.markdownit({
                html: true, // allow inline SVG
                linkify: true,
                breaks: false, // Must be false for KaTeX
            })
            : null;

        if (md) {
            md.inline.ruler.disable(['escape']); // Preserve TeX backslashes
        }

        /**
         * UTILITIES
         */
        const renderMarkdown = (content, elementId) => {
            if (!content || !md) return { __html: content || '' };
            return { __html: md.render(content) };
        };

        const useKaTeX = (containerRef, content) => {
            React.useEffect(() => {
                if (containerRef.current && window.renderMathInElement) {
                    window.renderMathInElement(containerRef.current, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError: false
                    });
                }
            }, [content]);
        };

        /**
         * ICONS
         */
        const ChevronDownIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>
        );
        const ChevronRightIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>
        );
        const MenuIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
        );
        const XIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );

        /**
         * COMPONENTS
         */

        // Navigation Rail (Desktop)
        const NavigationRail = ({ items, activeId, onJump }) => {
            return (
                <div className="hidden lg:block w-48 sticky top-8 max-h-[calc(100vh-4rem)] overflow-y-auto scrollbar-hide pr-4">
                    <nav className="flex flex-col space-y-1" aria-label="Paper Navigation">
                        {items.map((item, idx) => {
                            if (item.type === 'section') {
                                return (
                                    <div key={`sec-${idx}`} className="mt-4 mb-2 first:mt-0">
                                        <span className="text-xs font-semibold text-tertiary uppercase tracking-wider block mb-1">
                                            {item.label}
                                        </span>
                                    </div>
                                );
                            }
                            // Question item
                            const isActive = activeId === item.id;
                            const isSub = item.depth > 0;
                            return (
                                <button
                                    key={item.id}
                                    onClick={() => onJump(item.id)}
                                    className={`
                                        text-left py-1 transition-colors duration-200 block w-full truncate
                                        ${isActive ? 'font-bold text-accent' : 'font-normal text-secondary hover:text-primary'}
                                        ${isSub ? 'text-sm' : 'text-base'}
                                    `}
                                    aria-current={isActive ? 'true' : undefined}
                                >
                                    {item.id}
                                </button>
                            );
                        })}
                    </nav>
                </div>
            );
        };

        // Mobile Navigation Drawer
        const MobileNavDrawer = ({ isOpen, onClose, items, activeId, onJump }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 lg:hidden flex justify-end">
                    <div className="absolute inset-0 bg-black/20" onClick={onClose} aria-hidden="true" />
                    <div className="relative w-64 h-full bg-paper shadow-xl flex flex-col border-l border-border">
                        <div className="flex items-center justify-between p-4 border-b border-border">
                            <span className="font-semibold text-primary">Jump to</span>
                            <button onClick={onClose} className="text-secondary p-1 rounded hover:bg-wash">
                                <XIcon className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 scrollbar-hide">
                             <nav className="flex flex-col space-y-2">
                                {items.map((item, idx) => {
                                    if (item.type === 'section') {
                                        return (
                                            <div key={`m-sec-${idx}`} className="mt-4 mb-2 first:mt-0 border-b border-border pb-1">
                                                <span className="text-xs font-bold text-tertiary uppercase">
                                                    {item.label}
                                                </span>
                                            </div>
                                        );
                                    }
                                    const isActive = activeId === item.id;
                                    const isSub = item.depth > 0;
                                    return (
                                        <button
                                            key={item.id}
                                            onClick={() => onJump(item.id)}
                                            className={`
                                                text-left py-2 px-2 rounded block w-full
                                                ${isActive ? 'bg-wash text-accent font-bold' : 'text-primary hover:bg-wash'}
                                                ${isSub ? 'text-sm pl-4' : 'text-base'}
                                            `}
                                        >
                                            {item.id}
                                        </button>
                                    );
                                })}
                            </nav>
                        </div>
                    </div>
                </div>
            );
        };

        // Markdown Wrapper Component
        const MarkdownContent = ({ content, className = "prose" }) => {
            const containerRef = React.useRef(null);
            useKaTeX(containerRef, content);
            return (
                <div 
                    ref={containerRef}
                    className={`${className} max-w-none text-primary`}
                    dangerouslySetInnerHTML={renderMarkdown(content)}
                />
            );
        };

        // Solution Block Components
        const SolutionSubsection = ({ title, content, type }) => {
            if (!content) return null;
            // Type determines visual treatment if needed. Default is minimal.
            // Stage 5.9: Keep in mind > Formulas used > Working > Alt Working
            
            const isKeepInMind = type === 'keepInMind';
            const isFormulas = type === 'formulasUsed';
            
            return (
                <div className="mb-4 last:mb-0">
                    {title && (
                        <h5 className="text-xs font-bold text-tertiary uppercase tracking-wide mb-2">
                            {title}
                        </h5>
                    )}
                    {/* 
                        Structure rules:
                        Keep in mind: list, bulleted preferred
                        Formulas used: compact list
                        Working/Alt: mixed prose/maths
                    */}
                    <div className={`
                        ${isKeepInMind ? 'text-secondary font-medium' : 'text-secondary'}
                        ${isFormulas ? 'text-sm' : 'text-base'}
                    `}>
                        {Array.isArray(content) ? (
                            // For alternative workings array
                            content.map((item, i) => (
                                <div key={i} className="mb-6 last:mb-0 border-t border-border pt-4 first:border-0 first:pt-0">
                                    <MarkdownContent content={item} />
                                </div>
                            ))
                        ) : (
                            <MarkdownContent content={content} />
                        )}
                    </div>
                </div>
            );
        };

        const SolutionBlock = ({ solution, isExpanded, onToggle, hasToggle }) => {
            // solution: { answer, solutionDetails: { keepInMind, formulasUsed, working, alternativeWorking } }
            if (!solution) return null;

            const { answer, solutionDetails } = solution;
            const hasDetails = !!solutionDetails;

            return (
                <div className="mt-4">
                    {/* Separator from Question to Solution Block */}
                    
                    {/* Answer (Visible by default) */}
                    {answer && (
                        <div className="mb-4">
                            <span className="block text-xs font-bold text-tertiary uppercase mb-1">Answer</span>
                            <div className="text-primary font-medium">
                                <MarkdownContent content={answer} />
                            </div>
                        </div>
                    )}

                    {/* Solution Details (Expandable) */}
                    {hasDetails && (
                        <div className="mt-2">
                            {/* Control */}
                            <button 
                                onClick={onToggle}
                                className="flex items-center text-accent hover:text-primary transition-colors text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-1 focus-visible:ring-accent rounded px-1 -ml-1 py-1"
                                aria-expanded={isExpanded}
                            >
                                <span className="mr-1">{isExpanded ? 'Hide working' : 'Show working'}</span>
                                {isExpanded ? <ChevronDownIcon className="w-4 h-4" /> : <ChevronRightIcon className="w-4 h-4" />}
                            </button>

                            {/* Expanded Region */}
                            {isExpanded && (
                                <div className="mt-3 pl-4 border-l-2 border-border/50 py-2 bg-wash rounded-r-sm">
                                    <div className="space-y-6">
                                        <SolutionSubsection title="Keep in mind" content={solutionDetails.keepInMind} type="keepInMind" />
                                        
                                        {(solutionDetails.keepInMind && solutionDetails.formulasUsed) && <div className="h-px bg-border/30 w-full" />}
                                        
                                        <SolutionSubsection title="Formulas used" content={solutionDetails.formulasUsed} type="formulasUsed" />
                                        
                                        {(solutionDetails.formulasUsed && solutionDetails.working) && <div className="h-px bg-border/30 w-full" />}
                                        
                                        <SolutionSubsection title="Working" content={solutionDetails.working} type="working" />
                                        
                                        {(solutionDetails.working && solutionDetails.alternativeWorking) && <div className="h-px bg-border/30 w-full" />}
                                        
                                        <SolutionSubsection title="Alternative working" content={solutionDetails.alternativeWorking} type="alternativeWorking" />
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const QuestionNode = ({ node, depth = 0, paperDefaults, expandedState, toggleNode }) => {
            // Node: { id, question, solutionBlock, children }
            const indentClass = depth > 0 ? "ml-0 lg:ml-0" : ""; // Flat indentation visually per spec, but semantic nesting
            // Actually spec Stage 3.E says indentation allowed for children.
            // Stage 5.1 says sub-questions weaker separation.
            
            // Indentation logic: We use margin left for children, adapting to viewport.
            // But spec Stage 5.4.5 Navigation is flat. Paper content IS indented structurally.
            const wrapperClass = depth === 0 
                ? "mb-12 pt-4 first:pt-0" // Top level separation
                : "mt-6 mb-4 pl-4 lg:pl-8 border-l border-border/40"; // Child separation

            const hasSolutionDetails = node.solutionBlock?.solutionDetails;
            
            // Determine expanded state
            // Default is expanded unless paper defaults say otherwise, OR explicit user toggle
            // Logic: if expandedState has key, use it. Else use paperDefaults.expandedAll (default true).
            const isUserSet = expandedState.hasOwnProperty(node.id);
            const isExpanded = isUserSet 
                ? expandedState[node.id] 
                : (paperDefaults?.expandedAll !== false);

            const handleToggle = () => toggleNode(node.id);

            return (
                <div id={`q-${node.id}`} className={`${wrapperClass} scroll-mt-24`}>
                    {/* Surface for Question Node (optional per spec, using transparent/none) */}
                    
                    {/* Question Body */}
                    <div className="flex flex-col items-start">
                        <div className="flex items-baseline w-full">
                            <span className="text-secondary font-bold mr-3 shrink-0 select-none text-lg">
                                {node.id}
                            </span>
                            <div className="flex-1 min-w-0">
                                <MarkdownContent content={node.question} className="prose text-lg text-primary leading-relaxed" />
                            </div>
                        </div>
                    </div>

                    {/* Solution Block */}
                    <SolutionBlock 
                        solution={node.solutionBlock}
                        isExpanded={isExpanded}
                        onToggle={handleToggle}
                        hasToggle={!!hasSolutionDetails}
                    />

                    {/* Children */}
                    {node.children && node.children.length > 0 && (
                        <div className="mt-4">
                            {node.children.map((child, i) => (
                                <QuestionNode 
                                    key={i} 
                                    node={child} 
                                    depth={depth + 1}
                                    paperDefaults={paperDefaults}
                                    expandedState={expandedState}
                                    toggleNode={toggleNode}
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [payload, setPayload] = React.useState(null);
            const [error, setError] = React.useState(false);
            const [selectedPaperKey, setSelectedPaperKey] = React.useState(null);
            const [expandedState, setExpandedState] = React.useState({});
            const [mobileNavOpen, setMobileNavOpen] = React.useState(false);
            const [activeId, setActiveId] = React.useState(null);

            // Fetch payload
            React.useEffect(() => {
                fetch(RTQ_PAPERS_PAYLOAD_PATH)
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to load");
                        return res.json();
                    })
                    .then(data => {
                        setPayload(data);
                        if (data.papers && data.papers.length > 0) {
                            setSelectedPaperKey(data.papers[0].key);
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        setError(true);
                    });
            }, []);

            // Scroll spy for active ID
            React.useEffect(() => {
                const handleScroll = () => {
                    const ids = Array.from(document.querySelectorAll('[id^="q-"]'))
                        .map(el => ({ id: el.id.replace('q-', ''), top: el.getBoundingClientRect().top }));
                    
                    // Find first element close to top
                    const active = ids.find(item => item.top > 0 && item.top < window.innerHeight / 2) || ids[0];
                    if (active) setActiveId(active.id);
                };
                window.addEventListener('scroll', handleScroll, { passive: true });
                return () => window.removeEventListener('scroll', handleScroll);
            }, [selectedPaperKey]);

            // Handlers
            const handlePaperChange = (e) => {
                setSelectedPaperKey(e.target.value);
                setExpandedState({});
                window.scrollTo(0, 0);
            };

            const toggleNode = (id) => {
                const paper = payload.papers.find(p => p.key === selectedPaperKey);
                const defaultExpanded = paper.defaults?.expandedAll !== false;
                const currentState = expandedState.hasOwnProperty(id) ? expandedState[id] : defaultExpanded;
                
                setExpandedState(prev => ({
                    ...prev,
                    [id]: !currentState
                }));
            };

            const handleJump = (id) => {
                const el = document.getElementById(`q-${id}`);
                if (el) {
                    const y = el.getBoundingClientRect().top + window.pageYOffset - 100; // Offset for header
                    window.scrollTo({ top: y, behavior: 'smooth' });
                    setMobileNavOpen(false);
                    setActiveId(id);
                }
            };

            // Helpers to flatten nav items
            const getNavItems = (paper) => {
                if (!paper) return [];
                const items = [];
                
                const traverse = (nodes, depth) => {
                    nodes.forEach(node => {
                        items.push({ id: node.id, type: 'question', depth });
                        if (node.children) traverse(node.children, depth + 1);
                    });
                };

                if (paper.sections) {
                    paper.sections.forEach(section => {
                        if (section.label && section.label.trim() !== "") {
                            items.push({ label: section.label, type: 'section' });
                        }
                        traverse(section.questions, 0);
                    });
                } else if (paper.questions) {
                    traverse(paper.questions, 0);
                }
                return items;
            };

            // Render
            if (error) {
                return (
                    <div className="w-full max-w-4xl p-8 text-center text-primary font-bold text-xl mt-20">
                        PAPERS PAYLOAD MISSING
                    </div>
                );
            }

            if (!payload || !selectedPaperKey) return <div className="p-8">Loading...</div>;

            const activePaper = payload.papers.find(p => p.key === selectedPaperKey);
            const navItems = getNavItems(activePaper);

            return (
                <div className="w-full bg-frame min-h-screen">
                    {/* Top Controls Area - Aligned to DocumentFrameShell */}
                    <div className="w-full bg-frame border-b border-border sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 lg:px-8 h-16 flex items-center justify-between">
                            {/* Paper Selector */}
                            <div className="flex items-center">
                                <label htmlFor="paper-select" className="sr-only">Select Paper</label>
                                <select 
                                    id="paper-select"
                                    value={selectedPaperKey}
                                    onChange={handlePaperChange}
                                    className="bg-paper border border-border text-primary text-sm font-medium rounded p-2 focus:ring-2 focus:ring-accent outline-none"
                                >
                                    {payload.papers.map(p => (
                                        <option key={p.key} value={p.key}>{p.label}</option>
                                    ))}
                                </select>
                            </div>

                            {/* Mobile Nav Trigger */}
                            <button 
                                className="lg:hidden p-2 text-primary hover:bg-wash rounded"
                                onClick={() => setMobileNavOpen(true)}
                                aria-label="Open navigation"
                            >
                                <span className="mr-2 text-sm font-bold text-accent">Jump to</span>
                                <MenuIcon className="inline w-5 h-5 text-accent" />
                            </button>
                        </div>
                    </div>

                    {/* DocumentFrameShell */}
                    <div className="max-w-7xl mx-auto flex items-start px-4 lg:px-8 pt-8 pb-32">
                        
                        {/* Desktop Navigation Column */}
                        <NavigationRail items={navItems} activeId={activeId} onJump={handleJump} />

                        {/* Paper Content Column */}
                        <div className="flex-1 min-w-0 lg:pl-16">
                            <div className="bg-paper min-h-[80vh] p-6 lg:p-12 shadow-sm rounded-sm border border-border/50">
                                {/* Paper Header */}
                                <h1 className="text-2xl font-bold text-primary mb-8 pb-4 border-b border-border">
                                    {activePaper.label}
                                </h1>

                                {/* Questions List */}
                                <div className="space-y-12">
                                    {activePaper.sections ? (
                                        activePaper.sections.map((section, idx) => (
                                            <div key={idx} className="mb-16">
                                                {section.label && section.label.trim() !== "" && (
                                                    <div className="mb-8 pb-2 border-b border-border">
                                                        <h2 className="text-lg font-bold text-secondary uppercase tracking-wide">
                                                            Section {section.label}
                                                        </h2>
                                                    </div>
                                                )}
                                                <div>
                                                    {section.questions.map((q, qIdx) => (
                                                        <QuestionNode 
                                                            key={q.id} 
                                                            node={q} 
                                                            paperDefaults={activePaper.defaults}
                                                            expandedState={expandedState}
                                                            toggleNode={toggleNode}
                                                        />
                                                    ))}
                                                </div>
                                            </div>
                                        ))
                                    ) : (
                                        activePaper.questions.map((q, qIdx) => (
                                            <QuestionNode 
                                                key={q.id} 
                                                node={q} 
                                                paperDefaults={activePaper.defaults}
                                                expandedState={expandedState}
                                                toggleNode={toggleNode}
                                            />
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Mobile Drawer */}
                    <MobileNavDrawer 
                        isOpen={mobileNavOpen} 
                        onClose={() => setMobileNavOpen(false)} 
                        items={navItems} 
                        activeId={activeId}
                        onJump={handleJump}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
