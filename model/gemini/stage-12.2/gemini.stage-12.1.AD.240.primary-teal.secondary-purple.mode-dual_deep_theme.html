<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"AD","indexWithinVariant":"240","totalWithinVariant":"440","hueFamily":"","intensityMode":"","primaryHueFamily":"teal","secondaryHueFamily":"purple","dualIntensityMode":"dual_deep_theme","timestamp":"2026-01-10T13:11:16.258Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;AD&quot;,&quot;indexWithinVariant&quot;:&quot;240&quot;,&quot;totalWithinVariant&quot;:&quot;440&quot;,&quot;hueFamily&quot;:&quot;&quot;,&quot;intensityMode&quot;:&quot;&quot;,&quot;primaryHueFamily&quot;:&quot;teal&quot;,&quot;secondaryHueFamily&quot;:&quot;purple&quot;,&quot;dualIntensityMode&quot;:&quot;dual_deep_theme&quot;,&quot;timestamp&quot;:&quot;2026-01-10T13:11:16.258Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>

    <!-- 1. Libraries (No SRI/Integrity per Stage 6) -->
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- 2. Configuration & Styles -->
    <script>
        // ColorLab D: Dual Deep Theme (Light Only)
        // Primary Hue: Blue (250), Secondary Hue: Amber (70)
        // Values calculated based on OKLCH bands provided in Add-on D
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Deep chromatic surfaces
                        page: 'oklch(0.94 0.12 250)',   // L 0.92-0.98, C 0.08-0.16
                        frame: 'oklch(0.92 0.12 250)',  // L 0.90-0.96, C 0.08-0.16
                        paper: 'oklch(0.97 0.08 250)',  // L 0.94-0.99, C 0.06-0.14
                        
                        // Text (Neutral/Deep)
                        tprimary: 'oklch(0.20 0.01 250)',
                        tsecondary: 'oklch(0.40 0.02 250)',
                        
                        // Accents (Restrained)
                        // Primary Accent (Blue)
                        accent: 'oklch(0.55 0.20 250)', 
                        // Secondary Accent (Amber) - Supplementary role only
                        accent2: 'oklch(0.60 0.18 70)',
                        
                        // Utilities
                        hairline: 'oklch(0.85 0.02 250)',
                        wash: 'oklch(0.96 0.05 250)', // Solution Details Wash
                    },
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    spacing: {
                        'nav-w': '16rem', // 256px
                    }
                }
            }
        }
    </script>

    <style>
        /* Baseline Reset & Typography */
        body {
            background-color: theme('colors.page');
            color: theme('colors.tprimary');
            font-family: theme('fontFamily.sans');
            -webkit-font-smoothing: antialiased;
        }

        /* Scrollbar Hiding for Navigation (Cross-browser) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* KaTeX Containment Invariant */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
            padding: 0.5em 0;
            margin: 0.5em 0;
        }
        
        /* Inline KaTeX Transparency Rule */
        .katex {
            background-color: transparent !important;
        }

        /* Table Styling (Minimal Structural) */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid theme('colors.hairline');
            padding: 0.5em;
            text-align: left;
        }
        th {
            font-weight: 600;
            background-color: transparent; 
        }

        /* Focus Ring Customization (ColorLab D Accent) */
        :focus-visible {
            outline: 2px solid theme('colors.accent');
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // =====================================================================
        // STAGE 0: CONSTANTS (Canonical)
        // =====================================================================
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // =====================================================================
        // UTILITIES
        // =====================================================================

        // Markdown Configuration (Stage 6 Invariant)
        const md = window.markdownit ? window.markdownit({
            html: true,      // Allow inline SVG passthrough
            linkify: true,
            breaks: false    // MUST stay false per spec
        }) : null;

        if (md) {
            // Disable escape rule to preserve TeX backslashes
            md.inline.ruler.disable(['escape']);
        }

        // Icon Component (Lucide wrapper)
        const Icon = ({ name, className, size = 16 }) => {
            if (!window.lucide || !window.lucide.icons[name]) return null;
            
            // Render basic SVG manually to avoid DOM issues with react-lucide not present
            // Using a simple data-attribute approach for lucide.createIcons to pick up isn't React-idiomatic
            // So we use a ref and lucide.createElement logic roughly, or just dangerouslySetInnerHTML
            // For this prototype, we'll try to use the raw SVG string from lucide if available, 
            // or just render a placeholder. 
            // Actually, lucide.icons[name] is an object.
            
            // Simplest React integration for Lucide CDN:
            React.useEffect(() => {
                lucide.createIcons();
            });

            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
        };
        
        // Chevron for toggles
        const ChevronDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronRight = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const MenuIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>
            </svg>
        );

        const CloseIcon = ({ className }) => (
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
            </svg>
        );

        // =====================================================================
        // COMPONENTS
        // =====================================================================

        // --- Markdown Renderer ---
        const MarkdownContent = ({ content, className = "" }) => {
            const containerRef = React.useRef(null);

            // 1. Render Markdown to HTML
            const htmlContent = React.useMemo(() => {
                if (!md || !content) return "";
                return md.render(content);
            }, [content]);

            // 2. Auto-render KaTeX after DOM update
            React.useLayoutEffect(() => {
                if (containerRef.current && window.renderMathInElement) {
                    window.renderMathInElement(containerRef.current, {
                        delimiters: [
                            { left: '$$', right: '$$', display: true },
                            { left: '$', right: '$', display: false }
                        ],
                        throwOnError: false
                    });
                }
            }, [htmlContent]);

            return (
                <div 
                    ref={containerRef}
                    className={`markdown-body ${className}`}
                    dangerouslySetInnerHTML={{ __html: htmlContent }}
                />
            );
        };

        // --- Navigation Items ---
        const NavItem = ({ id, activeId, onClick, depth = 0 }) => {
            const isActive = activeId === id;
            
            // Hierarchy via type scale/contrast only (no indentation)
            // Depth 0: Base
            // Depth 1: Slightly smaller
            // Depth 2+: Quieter
            const fontSize = depth === 0 ? 'text-sm' : 'text-xs';
            const opacity = depth === 0 ? 'opacity-100' : 'opacity-80';
            const weight = isActive ? 'font-bold text-accent' : 'font-normal text-tprimary';

            return (
                <button
                    onClick={() => onClick(id)}
                    className={`
                        w-full text-left py-1 px-0 border-none bg-transparent cursor-pointer
                        hover:underline decoration-accent underline-offset-2
                        transition-colors duration-200
                        ${fontSize} ${opacity} ${weight}
                    `}
                >
                    {id}
                    {isActive && <span className="sr-only">(Current)</span>}
                </button>
            );
        };

        const NavSection = ({ label }) => (
            <div className="pt-4 pb-2 text-xs font-bold text-tsecondary uppercase tracking-wider select-none">
                {label}
            </div>
        );

        // Flatten questions for navigation
        const flattenQuestions = (questions, depth = 0) => {
            let flat = [];
            questions.forEach(q => {
                flat.push({ id: q.id, depth });
                if (q.children && q.children.length > 0) {
                    flat = flat.concat(flattenQuestions(q.children, depth + 1));
                }
            });
            return flat;
        };

        // --- Navigation Rail (Desktop) ---
        const DesktopNav = ({ paper, activeId, onJump }) => {
            const renderList = () => {
                if (paper.sections) {
                    return paper.sections.map((section, idx) => (
                        <div key={idx} className="mb-2">
                            {section.label && section.label.trim() !== "" && <NavSection label={section.label} />}
                            {flattenQuestions(section.questions).map(item => (
                                <NavItem 
                                    key={item.id} 
                                    id={item.id} 
                                    activeId={activeId} 
                                    depth={item.depth} 
                                    onClick={onJump} 
                                />
                            ))}
                        </div>
                    ));
                } else {
                    return flattenQuestions(paper.questions || []).map(item => (
                        <NavItem 
                            key={item.id} 
                            id={item.id} 
                            activeId={activeId} 
                            depth={item.depth} 
                            onClick={onJump} 
                        />
                    ));
                }
            };

            return (
                <nav className="w-nav-w hidden md:flex flex-col flex-shrink-0 h-[calc(100vh-4rem)] sticky top-16 pr-6 border-r border-hairline/0">
                    <div className="flex-1 overflow-y-auto no-scrollbar py-2">
                        {renderList()}
                    </div>
                </nav>
            );
        };

        // --- Mobile Drawer ---
        const MobileDrawer = ({ isOpen, onClose, paper, activeId, onJump }) => {
            if (!isOpen) return null;

            const renderList = () => {
                // Duplicate logic from DesktopNav for structure
                if (paper.sections) {
                    return paper.sections.map((section, idx) => (
                        <div key={idx} className="mb-4">
                            {section.label && section.label.trim() !== "" && <NavSection label={section.label} />}
                            {flattenQuestions(section.questions).map(item => (
                                <NavItem key={item.id} id={item.id} activeId={activeId} depth={item.depth} onClick={(id) => { onJump(id); onClose(); }} />
                            ))}
                        </div>
                    ));
                } else {
                    return flattenQuestions(paper.questions || []).map(item => (
                        <NavItem key={item.id} id={item.id} activeId={activeId} depth={item.depth} onClick={(id) => { onJump(id); onClose(); }} />
                    ));
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex justify-start">
                    {/* Scrim */}
                    <div className="absolute inset-0 bg-black/20" onClick={onClose}></div>
                    
                    {/* Drawer Content */}
                    <div className="relative bg-page w-64 h-full shadow-lg flex flex-col p-4 overflow-y-auto border-r border-hairline">
                        <div className="flex justify-between items-center mb-6 border-b border-hairline pb-2">
                            <span className="font-bold text-tprimary">Jump to</span>
                            <button onClick={onClose} className="p-1 text-tsecondary hover:text-accent">
                                <CloseIcon className="w-6 h-6" />
                            </button>
                        </div>
                        <div className="space-y-1">
                            {renderList()}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Solution Details Subsections ---
        const KeepInMind = ({ content }) => (
            <div className="mb-4">
                <div className="flex items-center gap-2 mb-1 text-sm font-bold text-tsecondary">
                    <span className="text-accent2">‚óè</span> Keep in mind
                </div>
                <MarkdownContent content={content} className="text-sm text-tsecondary leading-relaxed pl-4" />
            </div>
        );

        const FormulasUsed = ({ content }) => (
            <div className="mb-4">
                <div className="mb-1 text-sm font-bold text-tsecondary">Formulas used</div>
                <MarkdownContent content={content} className="text-sm text-tsecondary leading-snug pl-0 font-mono" />
            </div>
        );

        const Working = ({ content }) => (
            <div className="mb-6">
                <div className="mb-2 text-sm font-bold text-tsecondary">Working</div>
                {/* Working internal grammar: prose vs math handled by Markdown + CSS */}
                <MarkdownContent content={content} className="text-base text-tprimary leading-relaxed" />
            </div>
        );

        const AlternativeWorking = ({ content }) => (
            <div className="mt-6 pt-4 border-t border-hairline">
                <div className="mb-2 text-sm font-bold text-tsecondary">Alternative working</div>
                <MarkdownContent content={content} className="text-base text-tprimary leading-relaxed" />
            </div>
        );

        // --- Question Components ---
        
        const SolutionDetailsRegion = ({ details }) => {
            return (
                <div className="mt-3 pl-0 animate-in fade-in zoom-in-95 duration-200 bg-wash rounded-sm p-3 -mx-3 sm:mx-0 sm:rounded-none sm:p-0 sm:bg-transparent sm:pl-4 sm:border-l-2 sm:border-hairline">
                    {/* On Desktop/Tablet: Use standard border indentation. On Mobile: Use a wash to differentiate regions in dense view */}
                    {/* Actually, per spec "Surface differentiation... subtle value shifts... Solution Details wash surface (when present)" */}
                    {/* ColorLab D defines 'bg-wash'. We'll apply it broadly if expanded. */}
                    
                    <div className="bg-wash p-4 rounded border border-hairline/50">
                        {details.keepInMind && <KeepInMind content={details.keepInMind} />}
                        {details.formulasUsed && <div className="my-4 h-px bg-hairline/50" />}
                        {details.formulasUsed && <FormulasUsed content={details.formulasUsed} />}
                        
                        {(details.keepInMind || details.formulasUsed) && <div className="my-4 h-px bg-hairline/50" />}
                        
                        {details.working && <Working content={details.working} />}
                        
                        {details.alternativeWorking && details.alternativeWorking.map((alt, idx) => (
                            <AlternativeWorking key={idx} content={alt} />
                        ))}
                    </div>
                </div>
            );
        };

        const SolutionBlock = ({ answer, solutionDetails, isExpanded, onToggle, hasToggle }) => {
            return (
                <div className="mt-4">
                    {/* Answer (visible by default if present) */}
                    {answer && (
                        <div className="mb-3">
                            <span className="text-sm font-bold text-tsecondary uppercase tracking-wide mr-2">Answer</span>
                            <div className="inline-block">
                                <MarkdownContent content={answer} className="inline text-tprimary font-medium" />
                            </div>
                        </div>
                    )}

                    {/* Show/Hide Control */}
                    {hasToggle && (
                        <div className="mb-2">
                            <button 
                                onClick={onToggle}
                                className="flex items-center gap-1 text-sm font-medium text-accent hover:underline decoration-accent focus:outline-none"
                                aria-expanded={isExpanded}
                            >
                                {isExpanded ? 'Hide working' : 'Show working'}
                                {isExpanded ? <ChevronDown className="w-4 h-4" /> : <ChevronRight className="w-4 h-4" />}
                            </button>
                        </div>
                    )}

                    {/* Expanded Details */}
                    {isExpanded && solutionDetails && (
                        <SolutionDetailsRegion details={solutionDetails} />
                    )}
                </div>
            );
        };

        const QuestionNode = ({ node, level = 0, expandedState, toggleNode }) => {
            const hasSolutionBlock = !!node.solutionBlock;
            const hasAnswer = hasSolutionBlock && !!node.solutionBlock.answer;
            const hasDetails = hasSolutionBlock && !!node.solutionBlock.solutionDetails;
            
            // Interaction State
            const isExpanded = expandedState[node.id] || false;

            return (
                <div id={node.id} className={`group mb-8 scroll-mt-24 ${level > 0 ? 'ml-0 sm:ml-6 border-l border-hairline pl-4' : ''}`}>
                    {/* Question Body */}
                    <div className="mb-3">
                        <div className="flex items-baseline gap-3">
                            <span className="text-tsecondary font-bold text-sm select-none shrink-0 w-8">{node.id}</span>
                            <div className="flex-1">
                                <MarkdownContent content={node.question} className="text-lg text-tprimary leading-relaxed" />
                            </div>
                        </div>
                    </div>

                    {/* Solution Block (Optional) */}
                    {hasSolutionBlock && (
                        <div className="ml-11">
                            <SolutionBlock 
                                answer={node.solutionBlock.answer}
                                solutionDetails={node.solutionBlock.solutionDetails}
                                isExpanded={isExpanded}
                                onToggle={() => toggleNode(node.id)}
                                hasToggle={hasDetails}
                            />
                        </div>
                    )}

                    {/* Recursion for Children */}
                    {node.children && node.children.length > 0 && (
                        <div className="mt-6">
                            {node.children.map((child, idx) => (
                                <QuestionNode 
                                    key={idx} 
                                    node={child} 
                                    level={level + 1} 
                                    expandedState={expandedState}
                                    toggleNode={toggleNode}
                                />
                            ))}
                        </div>
                    )}
                    
                    {/* Spacer for top level */}
                    {level === 0 && <div className="h-12 border-b border-hairline/50 mt-8 mb-8" />}
                </div>
            );
        };

        const SectionBlock = ({ section, expandedState, toggleNode }) => (
            <div className="mb-12">
                {section.label && section.label.trim() !== "" && (
                    <div className="mb-8 pb-2 border-b border-hairline">
                        <h2 className="text-xl font-bold text-tsecondary">{section.label}</h2>
                    </div>
                )}
                {section.questions.map((q, idx) => (
                    <QuestionNode 
                        key={idx} 
                        node={q} 
                        level={0} 
                        expandedState={expandedState}
                        toggleNode={toggleNode}
                    />
                ))}
            </div>
        );

        // --- Main App ---
        const App = () => {
            const [payload, setPayload] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(false);
            const [currentPaperKey, setCurrentPaperKey] = React.useState(null);
            const [expandedState, setExpandedState] = React.useState({});
            const [isDrawerOpen, setIsDrawerOpen] = React.useState(false);
            const [activeNavId, setActiveNavId] = React.useState(null);

            // Fetch Payload
            React.useEffect(() => {
                fetch(RTQ_PAPERS_PAYLOAD_PATH)
                    .then(res => {
                        if (!res.ok) throw new Error("Missing");
                        return res.json();
                    })
                    .then(data => {
                        setPayload(data);
                        if (data.papers && data.papers.length > 0) {
                            setCurrentPaperKey(data.papers[0].key);
                            initExpandedState(data.papers[0]);
                        }
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error(err);
                        setError(true);
                        setLoading(false);
                    });
            }, []);

            const currentPaper = payload?.papers?.find(p => p.key === currentPaperKey);

            // Init Expansion Logic based on defaults
            const initExpandedState = (paper) => {
                if (!paper) return;
                const expandAll = paper.defaults?.expandedAll !== false; // Default true unless explicitly false
                
                const traverse = (nodes, acc) => {
                    nodes.forEach(node => {
                        if (node.solutionBlock?.solutionDetails) {
                            acc[node.id] = expandAll;
                        }
                        if (node.children) traverse(node.children, acc);
                    });
                };

                const initialState = {};
                if (paper.sections) {
                    paper.sections.forEach(s => traverse(s.questions, initialState));
                } else if (paper.questions) {
                    traverse(paper.questions, initialState);
                }
                setExpandedState(initialState);
            };

            const handlePaperChange = (e) => {
                const newKey = e.target.value;
                setCurrentPaperKey(newKey);
                const paper = payload.papers.find(p => p.key === newKey);
                initExpandedState(paper);
                window.scrollTo(0,0);
            };

            const toggleNode = (id) => {
                setExpandedState(prev => ({
                    ...prev,
                    [id]: !prev[id]
                }));
            };

            const scrollToId = (id) => {
                const el = document.getElementById(id);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    setActiveNavId(id); // Optimistic update
                }
            };

            // Intersection Observer for Active Nav
            React.useEffect(() => {
                if (!currentPaper || loading) return;
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            setActiveNavId(entry.target.id);
                        }
                    });
                }, { rootMargin: '-20% 0px -60% 0px' });

                const ids = [];
                const extractIds = (nodes) => {
                    nodes.forEach(n => {
                        ids.push(n.id);
                        if (n.children) extractIds(n.children);
                    });
                };
                
                if (currentPaper.sections) {
                    currentPaper.sections.forEach(s => extractIds(s.questions));
                } else {
                    extractIds(currentPaper.questions);
                }

                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) observer.observe(el);
                });

                return () => observer.disconnect();
            }, [currentPaper, loading]);


            if (loading) return <div className="p-8 text-tsecondary">Loading...</div>;
            if (error || !payload) return <div className="p-8 font-bold text-red-600">PAPERS PAYLOAD MISSING</div>;

            return (
                <div className="min-h-screen bg-frame text-tprimary selection:bg-accent selection:text-white flex flex-col items-center">
                    
                    {/* Top Controls (Aligned to Frame) */}
                    <div className="w-full max-w-6xl px-4 md:px-8 py-4 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <label className="text-sm font-bold text-tsecondary hidden sm:inline">Select Paper:</label>
                            <select 
                                value={currentPaperKey} 
                                onChange={handlePaperChange}
                                className="bg-paper border border-hairline rounded px-3 py-2 text-sm font-medium text-tprimary focus:outline-none focus-visible:ring-2 focus-visible:ring-accent"
                            >
                                {payload.papers.map(p => (
                                    <option key={p.key} value={p.key}>{p.label}</option>
                                ))}
                            </select>
                        </div>

                        {/* Mobile Jump Trigger */}
                        <button 
                            className="md:hidden flex items-center gap-2 text-sm font-bold text-accent"
                            onClick={() => setIsDrawerOpen(true)}
                        >
                            <MenuIcon className="w-5 h-5" />
                            Jump to
                        </button>
                    </div>

                    {/* DocumentFrameShell */}
                    <div className="w-full max-w-6xl flex-1 flex flex-col md:flex-row bg-frame">
                        
                        {/* Left Nav Column (Desktop) */}
                        <DesktopNav 
                            paper={currentPaper} 
                            activeId={activeNavId} 
                            onJump={scrollToId} 
                        />

                        {/* Mobile Drawer */}
                        <MobileDrawer 
                            isOpen={isDrawerOpen} 
                            onClose={() => setIsDrawerOpen(false)}
                            paper={currentPaper}
                            activeId={activeNavId}
                            onJump={scrollToId}
                        />

                        {/* Paper Content Column */}
                        <main className="flex-1 min-w-0 md:pl-8 pb-32">
                            <div className="bg-paper shadow-sm min-h-screen p-6 md:p-12 lg:p-16 border border-hairline/20 rounded-t-sm">
                                {currentPaper.sections ? (
                                    currentPaper.sections.map((sec, idx) => (
                                        <SectionBlock 
                                            key={idx} 
                                            section={sec} 
                                            expandedState={expandedState}
                                            toggleNode={toggleNode}
                                        />
                                    ))
                                ) : (
                                    currentPaper.questions.map((q, idx) => (
                                        <QuestionNode 
                                            key={idx} 
                                            node={q} 
                                            level={0} 
                                            expandedState={expandedState}
                                            toggleNode={toggleNode}
                                        />
                                    ))
                                )}
                            </div>
                        </main>

                    </div>
                </div>
            );
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
