<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"AB","indexWithinVariant":"98","totalWithinVariant":"200","hueFamily":"blue","intensityMode":"","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-08T17:49:30.819Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;AB&quot;,&quot;indexWithinVariant&quot;:&quot;98&quot;,&quot;totalWithinVariant&quot;:&quot;200&quot;,&quot;hueFamily&quot;:&quot;blue&quot;,&quot;intensityMode&quot;:&quot;&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-08T17:49:30.819Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Markdown-it -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ColorLab B: Forced Hue = Blue
                        // Using Slate for neutrals to keep it cool and paper-like
                        // Using Blue for accents/focus
                        base: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb', // Active/Focus
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        paper: '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .no-scrollbar::-webkit-scrollbar {
                display: none;
            }
            .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        }

        /* Global base styles */
        body {
            @apply bg-base-50 text-base-900 font-sans antialiased overflow-y-scroll;
        }

        /* KaTeX Overflow Protection (Invariant) */
        .katex-display {
            @apply overflow-x-auto overflow-y-hidden max-w-full py-2 px-1;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Block math background (Permitted by Stage 6/ColorLab for readability) */
        .katex-display > .katex {
            @apply inline-block min-w-min;
        }

        /* Markdown Content Styles */
        .prose p {
            @apply mb-3 leading-relaxed;
        }
        .prose ul {
            @apply list-disc list-outside ml-5 mb-3 space-y-1;
        }
        .prose ol {
            @apply list-decimal list-outside ml-5 mb-3 space-y-1;
        }
        /* Tables: Minimal, structural */
        .prose table {
            @apply w-full border-collapse mb-4 text-sm text-left;
        }
        .prose th {
            @apply border-b border-base-200 font-semibold py-2 pr-4 text-base-700;
        }
        .prose td {
            @apply border-b border-base-100 py-2 pr-4 text-base-600;
        }
        /* Inline code */
        .prose code {
            @apply bg-base-100 px-1 py-0.5 rounded text-sm font-mono text-base-700;
        }
        /* Diagrams (SVG) */
        .prose svg {
            @apply max-w-full h-auto my-4;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // =====================================================================
        // STAGE 0: CONSTANTS
        // =====================================================================
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // =====================================================================
        // MARKDOWN CONFIGURATION (STAGE 6 HARDENING)
        // =====================================================================
        const md = window.markdownit
            ? window.markdownit({
                html: true, // Allow inline SVG
                linkify: true,
                breaks: false, // CRITICAL: false to prevent <br> in math
            })
            : null;

        if (md) {
            md.inline.ruler.disable(['escape']); // Preserve TeX backslashes
        }

        // =====================================================================
        // ICONS
        // =====================================================================
        const IconChevronDown = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m6 9 6 6 6-6"/></svg>
        );
        const IconChevronRight = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m9 18 6-6-6-6"/></svg>
        );
        const IconMenu = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
        );
        const IconX = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        );
        const IconInfo = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
        );

        // =====================================================================
        // UTILS
        // =====================================================================
        // KaTeX Auto-render wrapper
        const useKaTeX = (containerRef, content) => {
            React.useEffect(() => {
                if (containerRef.current && window.renderMathInElement) {
                    window.renderMathInElement(containerRef.current, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false}
                        ],
                        throwOnError: false,
                        trust: true // Allow HTML in math
                    });
                }
            }, [content]);
        };

        const MarkdownContent = ({ content, className = "" }) => {
            const containerRef = React.useRef(null);
            
            // 1. Render Markdown to HTML
            const htmlContent = React.useMemo(() => {
                if (!content || !md) return "";
                return md.render(content);
            }, [content]);

            // 2. Render KaTeX on the HTML
            useKaTeX(containerRef, htmlContent);

            if (!content) return null;

            return (
                <div 
                    ref={containerRef}
                    className={`prose max-w-none text-base-800 ${className}`}
                    dangerouslySetInnerHTML={{ __html: htmlContent }}
                />
            );
        };

        // Scroll helper
        const scrollToId = (id) => {
            const el = document.getElementById(`q-${id}`);
            if (el) {
                const headerOffset = 80;
                const elementPosition = el.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
            }
        };

        // =====================================================================
        // COMPONENTS
        // =====================================================================

        // --- Navigation Items ---
        const NavigationItem = ({ id, isActive, onClick, depth = 0 }) => {
            // Hierarchy via type scale/weight only (Stage 3/5 layout tree)
            const isSub = depth > 0;
            return (
                <button
                    onClick={onClick}
                    className={`
                        w-full text-left py-1.5 px-3 block transition-colors duration-200 outline-none focus-visible:ring-2 focus-visible:ring-primary-400 focus-visible:ring-offset-1 rounded-md
                        ${isActive ? 'font-bold text-primary-700' : 'font-medium text-base-500 hover:text-base-900 hover:bg-base-100'}
                        ${isSub ? 'text-xs' : 'text-sm'}
                    `}
                    aria-current={isActive ? 'page' : undefined}
                >
                    {id}
                </button>
            );
        };

        const NavigationSection = ({ label, children }) => {
            return (
                <div className="mb-4">
                    {label && label.trim() !== "" && (
                        <div className="px-3 py-1 text-xs font-bold text-base-400 uppercase tracking-wider mb-1 select-none">
                            {label}
                        </div>
                    )}
                    <div className="space-y-0.5">
                        {children}
                    </div>
                </div>
            );
        };

        // --- Navigation Rail (Desktop) ---
        const NavigationRail = ({ questions, currentId, sections }) => {
            
            // Helper to render linear list of nav items from recursive structure
            const renderItems = (items, depth = 0) => {
                return items.map(q => (
                    <React.Fragment key={q.id}>
                        <NavigationItem 
                            id={q.id} 
                            isActive={currentId === q.id} 
                            onClick={() => scrollToId(q.id)}
                            depth={depth}
                        />
                        {q.children && q.children.length > 0 && renderItems(q.children, depth + 1)}
                    </React.Fragment>
                ));
            };

            return (
                <nav className="hidden lg:block w-48 shrink-0 sticky top-6 max-h-[calc(100vh-3rem)] overflow-y-auto no-scrollbar pr-4 pb-10" aria-label="Question navigation">
                    {sections ? (
                        sections.map((section, idx) => (
                            <NavigationSection key={idx} label={section.label}>
                                {renderItems(section.questions)}
                            </NavigationSection>
                        ))
                    ) : (
                        <div className="space-y-0.5">
                            {renderItems(questions)}
                        </div>
                    )}
                </nav>
            );
        };

        // --- Navigation Drawer (Mobile) ---
        const NavigationDrawer = ({ isOpen, onClose, questions, currentId, sections }) => {
            if (!isOpen) return null;

            const renderItems = (items, depth = 0) => {
                return items.map(q => (
                    <React.Fragment key={q.id}>
                        <NavigationItem 
                            id={q.id} 
                            isActive={currentId === q.id} 
                            onClick={() => { scrollToId(q.id); onClose(); }}
                            depth={depth}
                        />
                        {q.children && q.children.length > 0 && renderItems(q.children, depth + 1)}
                    </React.Fragment>
                ));
            };

            return (
                <div className="fixed inset-0 z-50 flex justify-start lg:hidden" role="dialog" aria-modal="true">
                    {/* Scrim */}
                    <div className="absolute inset-0 bg-base-900/20 backdrop-blur-sm transition-opacity" onClick={onClose}></div>
                    
                    {/* Drawer Content */}
                    <div className="relative w-64 h-full bg-paper shadow-xl border-r border-base-200 flex flex-col">
                        <div className="flex items-center justify-between p-4 border-b border-base-100">
                            <h2 className="text-sm font-bold text-base-900 uppercase tracking-wide">Jump to</h2>
                            <button onClick={onClose} className="p-2 text-base-500 hover:text-base-900 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-400">
                                <IconX className="w-5 h-5" />
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2">
                             {sections ? (
                                sections.map((section, idx) => (
                                    <NavigationSection key={idx} label={section.label}>
                                        {renderItems(section.questions)}
                                    </NavigationSection>
                                ))
                            ) : (
                                <div className="space-y-0.5">
                                    {renderItems(questions)}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Solution Details Internal Blocks ---
        
        const SolutionSubsection = ({ title, children, className = "", icon = null }) => {
            if (!children) return null;
            return (
                <div className={`mb-6 last:mb-0 ${className}`}>
                    <div className="flex items-center gap-2 mb-2">
                        {icon}
                        <h4 className="text-xs font-bold text-base-500 uppercase tracking-wider">{title}</h4>
                    </div>
                    {children}
                </div>
            );
        };

        const KeepInMind = ({ content }) => {
            if (!content) return null;
            return (
                <SolutionSubsection 
                    title="Keep in mind" 
                    icon={<IconInfo className="w-4 h-4 text-primary-500" />}
                >
                    <MarkdownContent content={content} className="text-sm text-base-700" />
                </SolutionSubsection>
            );
        };

        const FormulasUsed = ({ content }) => {
            if (!content) return null;
            return (
                <SolutionSubsection title="Formulas used">
                    <MarkdownContent content={content} className="text-sm text-base-600" />
                </SolutionSubsection>
            );
        };

        const Working = ({ content }) => {
            if (!content) return null;
            return (
                <SolutionSubsection title="Working">
                    <MarkdownContent content={content} className="text-base text-base-800" />
                </SolutionSubsection>
            );
        };

        const AlternativeWorking = ({ content, index }) => {
            if (!content) return null;
            return (
                <SolutionSubsection 
                    title={`Alternative working ${index > 0 ? index + 1 : ''}`} 
                    className="pt-6 border-t border-base-200 mt-6"
                >
                    <MarkdownContent content={content} className="text-base text-base-800" />
                </SolutionSubsection>
            );
        };

        // --- Solution Block ---
        const SolutionBlock = ({ data, expanded, onToggle }) => {
            if (!data) return null; // No solution block at all

            const { answer, solutionDetails } = data;
            const hasDetails = !!solutionDetails;
            const hasAnswer = !!answer;

            // If neither exist, render nothing (should have been caught upstream, but safe guard)
            if (!hasAnswer && !hasDetails) return null;

            return (
                <div className="mt-6">
                    {/* Spacing boundary from question body is handled by margin-top here */}
                    
                    {/* Answer (Visible by default if present) */}
                    {hasAnswer && (
                        <div className="mb-4">
                            <h4 className="text-xs font-bold text-base-500 uppercase tracking-wider mb-1">Answer</h4>
                            <div className="text-lg font-medium text-base-900 bg-base-50 inline-block px-3 py-1.5 rounded-md border border-base-200 shadow-sm">
                                <MarkdownContent content={answer} />
                            </div>
                        </div>
                    )}

                    {/* Disclosure Control (Only if details exist) */}
                    {hasDetails && (
                        <div>
                            <button 
                                onClick={onToggle}
                                className="group flex items-center gap-2 text-sm font-medium text-primary-600 hover:text-primary-700 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 rounded px-1 -ml-1 py-1"
                                aria-expanded={expanded}
                            >
                                <span className="uppercase tracking-wide text-xs font-bold">
                                    {expanded ? "Hide working" : "Show working"}
                                </span>
                                {expanded ? <IconChevronDown className="w-4 h-4" /> : <IconChevronRight className="w-4 h-4" />}
                            </button>

                            {/* Expanded Details Region */}
                            {expanded && (
                                <div className="mt-4 pl-4 border-l-2 border-base-200 animate-in fade-in slide-in-from-top-1 duration-200">
                                    {/* Optional Region Wash: Using transparent/none per minimal default, relying on border/indent */}
                                    
                                    <KeepInMind content={solutionDetails.keepInMind} />
                                    <FormulasUsed content={solutionDetails.formulasUsed} />
                                    <Working content={solutionDetails.working} />
                                    
                                    {solutionDetails.alternativeWorking && 
                                     solutionDetails.alternativeWorking.map((alt, idx) => (
                                        <AlternativeWorking key={idx} content={alt} index={idx} />
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        // --- Question Node ---
        const QuestionNode = ({ node, depth = 0, expandedState, toggleNode }) => {
            const hasSolutionDetails = node.solutionBlock && node.solutionBlock.solutionDetails;
            const isExpanded = expandedState[node.id] || false;

            // Indentation logic based on depth (Stage 3)
            // Use left padding for visual hierarchy without cards
            const indentClass = depth > 0 ? "ml-4 md:ml-8 border-l border-base-100 pl-4 md:pl-6" : "";

            return (
                <div id={`q-${node.id}`} className={`py-6 first:pt-0 ${indentClass}`}>
                    
                    {/* Question Body */}
                    <div className="group">
                        <div className="flex items-baseline gap-3 md:gap-4">
                            <span className="shrink-0 text-base font-bold text-base-400 select-none w-8 text-right font-mono">
                                {node.id}
                            </span>
                            <div className="flex-1 min-w-0">
                                <MarkdownContent content={node.question} className="text-lg md:text-xl text-base-900" />
                            </div>
                        </div>
                    </div>

                    {/* Solution Block */}
                    {node.solutionBlock && (
                        <div className="pl-11 md:pl-12">
                            <SolutionBlock 
                                data={node.solutionBlock} 
                                expanded={isExpanded} 
                                onToggle={() => toggleNode(node.id)} 
                            />
                        </div>
                    )}

                    {/* Children Recursion */}
                    {node.children && node.children.length > 0 && (
                        <div className="mt-4">
                            {node.children.map((child, idx) => (
                                <QuestionNode 
                                    key={child.id || idx} 
                                    node={child} 
                                    depth={depth + 1} 
                                    expandedState={expandedState} 
                                    toggleNode={toggleNode} 
                                />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- Section Block ---
        const SectionBlock = ({ section, expandedState, toggleNode }) => {
            return (
                <section className="mb-12 border-t-2 border-base-200 pt-8 first:border-t-0 first:pt-0">
                    {section.label && section.label.trim() !== "" && (
                        <div className="mb-8 flex items-center gap-4">
                             <h2 className="text-xl font-bold text-base-400 border border-base-300 rounded px-3 py-1 bg-base-50 inline-block shadow-sm">
                                Section {section.label}
                             </h2>
                        </div>
                    )}
                    <div className="divide-y divide-base-200/50">
                        {section.questions.map(q => (
                            <QuestionNode 
                                key={q.id} 
                                node={q} 
                                expandedState={expandedState} 
                                toggleNode={toggleNode} 
                            />
                        ))}
                    </div>
                </section>
            );
        };

        // --- Main App Shell ---
        const App = () => {
            const [payload, setPayload] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(false);
            
            const [activePaperKey, setActivePaperKey] = React.useState(null);
            const [expandedState, setExpandedState] = React.useState({});
            const [mobileNavOpen, setMobileNavOpen] = React.useState(false);

            // Load Payload
            React.useEffect(() => {
                fetch(RTQ_PAPERS_PAYLOAD_PATH)
                    .then(res => {
                        if (!res.ok) throw new Error("Failed to load");
                        return res.json();
                    })
                    .then(data => {
                        setPayload(data);
                        if (data.papers && data.papers.length > 0) {
                            setActivePaperKey(data.papers[0].key);
                        }
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error(err);
                        setError(true);
                        setLoading(false);
                    });
            }, []);

            // Initialize expansion state when paper changes
            React.useEffect(() => {
                if (!payload || !activePaperKey) return;
                
                const paper = payload.papers.find(p => p.key === activePaperKey);
                if (!paper) return;

                const defaultExpanded = paper.defaults?.expandedAll !== false;
                const newState = {};

                const traverse = (nodes) => {
                    nodes.forEach(node => {
                        if (node.solutionBlock?.solutionDetails) {
                            newState[node.id] = defaultExpanded;
                        }
                        if (node.children) traverse(node.children);
                    });
                };

                if (paper.sections) {
                    paper.sections.forEach(s => traverse(s.questions));
                } else if (paper.questions) {
                    traverse(paper.questions);
                }

                setExpandedState(newState);
                window.scrollTo(0, 0);
            }, [activePaperKey, payload]);

            const toggleNode = (id) => {
                setExpandedState(prev => ({
                    ...prev,
                    [id]: !prev[id]
                }));
            };

            if (loading) {
                return <div className="min-h-screen flex items-center justify-center text-base-500 animate-pulse">Loading paper data...</div>;
            }

            if (error || !payload) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-8 text-center bg-base-50">
                        <div className="text-xl font-bold text-red-600 mb-2">PAPERS PAYLOAD MISSING</div>
                        <p className="text-base-600">Could not load content from canonical path.</p>
                    </div>
                );
            }

            const activePaper = payload.papers.find(p => p.key === activePaperKey);
            
            // Flatten questions for navigation if in sections
            const flatQuestions = activePaper.sections 
                ? activePaper.sections.flatMap(s => s.questions)
                : activePaper.questions;

            // Find current active item for nav highlighting (simple scroll spy could go here, strictly strictly strictly observational? 
            // For this prototype we'll just let click highlight. Scroll spy is complex to implement robustly in single file without intersection observer overhead.
            // We'll rely on clicked state or simple first item.)
            // Note: Stage 5.4.3 says "Active indication may use one strong cue". We'll just highlight the last clicked or default none.
            // Actually, sticky nav usually implies scroll tracking. I will implement a basic scroll tracker.
            const [currentViewId, setCurrentViewId] = React.useState(null);

            React.useEffect(() => {
                const handleScroll = () => {
                    // Simple logic: find first heading in viewport
                    const ids = [];
                    const traverse = (nodes) => {
                        nodes.forEach(n => {
                            ids.push(n.id);
                            if (n.children) traverse(n.children);
                        });
                    };
                    
                    if (activePaper.sections) activePaper.sections.forEach(s => traverse(s.questions));
                    else traverse(activePaper.questions);

                    for (const id of ids) {
                        const el = document.getElementById(`q-${id}`);
                        if (el) {
                            const rect = el.getBoundingClientRect();
                            if (rect.top >= 0 && rect.top < window.innerHeight / 2) {
                                setCurrentViewId(id);
                                break;
                            }
                        }
                    }
                };
                window.addEventListener('scroll', handleScroll, { passive: true });
                return () => window.removeEventListener('scroll', handleScroll);
            }, [activePaper]);


            return (
                <div className="min-h-screen flex flex-col bg-base-50 text-base-900 font-sans">
                    
                    {/* Top Controls Region */}
                    <header className="sticky top-0 z-40 w-full bg-base-50/95 backdrop-blur supports-[backdrop-filter]:bg-base-50/60 border-b border-base-200">
                        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                            
                            {/* Paper Selector */}
                            <div className="flex items-center gap-4">
                                <label htmlFor="paper-select" className="sr-only">Select Paper</label>
                                <div className="relative">
                                    <select 
                                        id="paper-select"
                                        value={activePaperKey}
                                        onChange={(e) => setActivePaperKey(e.target.value)}
                                        className="appearance-none bg-paper border border-base-300 text-base-900 text-sm rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 pr-8 font-medium shadow-sm hover:border-base-400 transition-colors"
                                    >
                                        {payload.papers.map(p => (
                                            <option key={p.key} value={p.key}>{p.label}</option>
                                        ))}
                                    </select>
                                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-base-500">
                                        <IconChevronDown className="w-4 h-4" />
                                    </div>
                                </div>
                            </div>

                            {/* Mobile Jump To Trigger */}
                            <button 
                                onClick={() => setMobileNavOpen(true)}
                                className="lg:hidden flex items-center gap-2 text-sm font-medium text-base-600 hover:text-primary-600 px-3 py-2 rounded-md hover:bg-base-100 transition-colors"
                            >
                                <span className="uppercase tracking-wide text-xs font-bold">Jump to</span>
                                <IconMenu className="w-5 h-5" />
                            </button>
                        </div>
                    </header>

                    {/* Document Frame Shell */}
                    <div className="flex-1 max-w-6xl mx-auto w-full px-4 md:px-6 py-8 flex items-start gap-8 lg:gap-12 relative">
                        
                        {/* Desktop Navigation Rail */}
                        <NavigationRail 
                            questions={activePaper.questions} 
                            sections={activePaper.sections}
                            currentId={currentViewId}
                        />

                        {/* Paper Content Column */}
                        <main className="flex-1 min-w-0 pb-32">
                            <div className="bg-paper shadow-sm border border-base-200 rounded-lg px-6 py-10 md:px-12 md:py-12 min-h-[60vh]">
                                
                                {/* Paper Title/Header */}
                                <div className="mb-12 text-center border-b border-base-100 pb-8">
                                    <h1 className="text-2xl md:text-3xl font-bold text-base-900 tracking-tight">{activePaper.label}</h1>
                                </div>

                                {/* Content Rendering */}
                                {activePaper.sections ? (
                                    activePaper.sections.map((section, idx) => (
                                        <SectionBlock 
                                            key={idx} 
                                            section={section} 
                                            expandedState={expandedState} 
                                            toggleNode={toggleNode} 
                                        />
                                    ))
                                ) : (
                                    <div className="divide-y divide-base-200/50">
                                        {activePaper.questions.map(q => (
                                            <QuestionNode 
                                                key={q.id} 
                                                node={q} 
                                                expandedState={expandedState} 
                                                toggleNode={toggleNode} 
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>
                        </main>

                    </div>

                    {/* Mobile Navigation Drawer */}
                    <NavigationDrawer 
                        isOpen={mobileNavOpen} 
                        onClose={() => setMobileNavOpen(false)} 
                        questions={activePaper.questions}
                        sections={activePaper.sections}
                        currentId={currentViewId}
                    />

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
