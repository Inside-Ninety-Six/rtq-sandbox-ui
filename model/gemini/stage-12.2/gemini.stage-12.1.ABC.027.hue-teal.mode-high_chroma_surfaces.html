<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"27","totalWithinVariant":"320","hueFamily":"teal","intensityMode":"high_chroma_surfaces","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-09T11:11:35.566Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;27&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;teal&quot;,&quot;intensityMode&quot;:&quot;high_chroma_surfaces&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-09T11:11:35.566Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>
    
    <!-- Dependencies (CDN) -->
    <!-- Tailwind for layout utilities -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX (No SRI integrity attributes per Stage 6.0.7b) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 
         * STAGE 6 ADD-ON: COLORLAB C - HIGH CHROMA SURFACES (TEAL) 
         * Forced Hue: Teal (approx 175)
         * Mode: high_chroma_surfaces (Light Mode Only)
         * Rules:
         * 1. Two major surfaces C in [0.06 .. 0.12]
         * 2. Remaining major surface C in [0.03 .. 0.07]
         * 3. Wash surfaces C in [0.05 .. 0.10]
         * 4. Text Primary C <= 0.015
         * 5. Accent C in [0.12 .. 0.20]
         */
        :root {
            /* Palette Configuration */
            --hue-family: 175; /* Teal */
            
            /* Major Surfaces */
            /* Surface 1: Page Background (High Chroma) */
            --c-page-bg: oklch(0.92 0.09 var(--hue-family));
            /* Surface 2: Frame Base (High Chroma - typically navigation sits here) */
            --c-frame-bg: oklch(0.95 0.07 var(--hue-family));
            /* Surface 3: Paper (Tinted, remaining major surface) */
            --c-paper-bg: oklch(0.99 0.03 var(--hue-family));

            /* Region Washes */
            --c-wash: oklch(0.96 0.08 var(--hue-family));
            
            /* Text & Content */
            --c-text-primary: oklch(0.20 0.015 var(--hue-family));
            --c-text-secondary: oklch(0.45 0.02 var(--hue-family));
            
            /* Accents & UI */
            --c-accent: oklch(0.50 0.16 var(--hue-family));
            --c-divider: oklch(0.85 0.04 var(--hue-family));
            --c-focus: oklch(0.50 0.16 var(--hue-family));

            /* Spacing Scale (based on remit) */
            --sp-xs: 0.25rem;
            --sp-sm: 0.5rem;
            --sp-md: 1rem;
            --sp-lg: 1.5rem;
            --sp-xl: 2.5rem; /* Top level question separation */
        }

        /* Base Typography */
        body {
            background-color: var(--c-page-bg);
            color: var(--c-text-primary);
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* Focus Management */
        *:focus-visible {
            outline: 2px solid var(--c-focus);
            outline-offset: 2px;
        }

        /* Layout Shells */
        .doc-shell {
            background-color: var(--c-frame-bg);
            /* Shared surface context for Nav and Paper on desktop */
        }

        /* Navigation */
        .nav-item {
            color: var(--c-text-secondary);
            font-size: 0.875rem;
            transition: color 0.15s ease, font-weight 0.15s ease;
        }
        .nav-item:hover {
            color: var(--c-text-primary);
            text-decoration: underline;
            text-decoration-thickness: 1px;
            text-decoration-color: var(--c-divider);
        }
        .nav-item.active {
            font-weight: 700;
            color: var(--c-text-primary);
            /* Stage 6: Weight only, allowed accent marker if used carefully, sticking to weight per baseline */
        }
        .nav-scroll::-webkit-scrollbar {
            display: none;
        }
        .nav-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Content Hierarchy */
        .question-body {
            font-size: 1.125rem;
            font-weight: 500;
            color: var(--c-text-primary);
        }
        
        .answer-label {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        .disclosure-control {
            color: var(--c-accent);
            font-size: 0.95rem;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .disclosure-control:hover {
            text-decoration: underline;
        }

        /* Solution Details & Subsections */
        .solution-details-region {
            /* Optional wash per Stage 3 */
            background-color: var(--c-wash);
            /* Border radius strictly forbidden by Stage 5 surface posture, but subtle seam allowed */
            padding: var(--sp-md);
            margin-top: var(--sp-sm);
        }

        .sd-subsection-label {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--c-text-secondary);
            margin-bottom: var(--sp-xs);
            display: block;
        }

        /* KaTeX Containment Invariant */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 2px; /* Scrollbar clearance */
        }
        /* Hide scrollbar in katex blocks if possible but keep functional */
        .katex-display::-webkit-scrollbar {
            height: 4px;
        }
        .katex-display::-webkit-scrollbar-thumb {
            background-color: var(--c-divider);
            border-radius: 2px;
        }

        /* Table Resets */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            margin-bottom: var(--sp-md);
        }
        th, td {
            border: 1px solid var(--c-divider);
            padding: 0.5rem;
            text-align: left;
        }
        th {
            font-weight: 600;
            background-color: rgba(255,255,255,0.1); /* Subtle tint interaction */
        }

        /* Utilities */
        .hairline {
            height: 1px;
            background-color: var(--c-divider);
            border: none;
        }
        
        /* Mobile Drawer */
        .drawer-backdrop {
            background-color: rgba(0,0,0,0.4);
        }
        .drawer-panel {
            background-color: var(--c-frame-bg);
        }
    </style>
</head>
<body>

    <!-- STAGE 0 CONSTANTS -->
    <script>
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";
    </script>

    <!-- App Root -->
    <div id="app" class="min-h-screen flex flex-col">
        
        <!-- Top Controls Region -->
        <!-- Visually aligned with DocumentFrameShell, but typically sticky or top-of-flow -->
        <div class="w-full bg-[var(--c-frame-bg)] border-b border-[var(--c-divider)] z-20 relative">
            <div class="max-w-7xl mx-auto px-4 lg:px-8 h-16 flex items-center justify-between">
                
                <!-- Paper Selector -->
                <div class="flex items-center gap-4">
                    <label for="paper-select" class="text-sm font-medium text-[var(--c-text-secondary)]">Paper:</label>
                    <select id="paper-select" class="bg-[var(--c-paper-bg)] border border-[var(--c-divider)] text-[var(--c-text-primary)] text-sm rounded px-3 py-1.5 focus:border-[var(--c-accent)] focus:ring-1 focus:ring-[var(--c-accent)] outline-none">
                        <option value="" disabled selected>Loading...</option>
                    </select>
                </div>

                <!-- Mobile Jump To Trigger -->
                <button id="mobile-jump-trigger" class="lg:hidden flex items-center gap-2 text-[var(--c-accent)] font-medium text-sm">
                    <span class="mr-1">Jump to</span>
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- DocumentFrameShell -->
        <!-- Desktop: Nav + Paper share this shell context (Surface 2: Frame Base) -->
        <main class="flex-1 w-full max-w-7xl mx-auto doc-shell flex relative">
            
            <!-- Desktop Navigation Rail (Left Column) -->
            <aside class="hidden lg:block w-64 flex-shrink-0 sticky top-0 h-[calc(100vh-4rem)] overflow-y-auto nav-scroll pt-8 pb-12 pl-8 pr-4 border-r border-transparent">
                <nav id="desktop-nav-list" class="space-y-1" aria-label="Question navigation">
                    <!-- Nav items generated here -->
                </nav>
            </aside>

            <!-- Paper Document Column (Right Column) -->
            <div class="flex-1 min-w-0 bg-[var(--c-paper-bg)] min-h-[calc(100vh-4rem)]">
                <!-- Content Region -->
                <div id="paper-content" class="px-4 sm:px-8 lg:px-16 py-12 max-w-4xl mx-auto">
                    <!-- Questions generated here -->
                    <div id="loading-state" class="text-[var(--c-text-secondary)] text-center py-20">Loading paper content...</div>
                </div>
            </div>

        </main>
    </div>

    <!-- Mobile Navigation Drawer -->
    <div id="mobile-drawer" class="fixed inset-0 z-50 hidden" aria-hidden="true">
        <!-- Backdrop -->
        <div id="drawer-backdrop" class="absolute inset-0 drawer-backdrop transition-opacity opacity-0"></div>
        
        <!-- Drawer Panel -->
        <div id="drawer-panel" class="absolute right-0 top-0 bottom-0 w-80 max-w-[85vw] drawer-panel shadow-xl transform translate-x-full transition-transform duration-300 flex flex-col">
            <div class="p-4 border-b border-[var(--c-divider)] flex items-center justify-between">
                <h2 class="font-bold text-[var(--c-text-primary)]">Jump to</h2>
                <button id="drawer-close" class="text-[var(--c-text-secondary)] hover:text-[var(--c-text-primary)] p-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <nav id="mobile-nav-list" class="flex-1 overflow-y-auto p-4 space-y-1 nav-scroll">
                <!-- Mobile nav items generated here -->
            </nav>
        </div>
    </div>

    <!-- Logic -->
    <script>
        // --- Markdown renderer (authoritative config) ---
        const md = window.markdownit
          ? window.markdownit({
              html: true, // allow inline SVG and other inline HTML in payload Markdown
              linkify: true,
              breaks: false, // MUST stay false: prevents <br> inside $...$ / $$...$$
            })
          : null;

        if (md) {
          // Preserve TeX backslashes: do not let markdown-it escape them before KaTeX runs
          md.inline.ruler.disable(["escape"]);
        }

        // --- Application State ---
        const state = {
            papers: [],
            activePaper: null,
            expanded: {}, // Map of questionNodeId -> boolean
            navItems: [] // { id, label, isSection, indentLevel }
        };

        // --- DOM Elements ---
        const els = {
            paperSelect: document.getElementById('paper-select'),
            paperContent: document.getElementById('paper-content'),
            desktopNav: document.getElementById('desktop-nav-list'),
            mobileNav: document.getElementById('mobile-nav-list'),
            loadingState: document.getElementById('loading-state'),
            mobileDrawer: document.getElementById('mobile-drawer'),
            drawerBackdrop: document.getElementById('drawer-backdrop'),
            drawerPanel: document.getElementById('drawer-panel'),
            jumpTrigger: document.getElementById('mobile-jump-trigger'),
            drawerClose: document.getElementById('drawer-close')
        };

        // --- Initialization ---
        async function init() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error('Fetch failed');
                
                const payload = await response.json();
                state.papers = payload.papers || [];

                if (state.papers.length === 0) throw new Error('No papers');

                renderPaperSelector();
                
                // Load first paper by default
                loadPaper(state.papers[0].key);

            } catch (err) {
                console.error(err);
                renderError();
            }
        }

        function renderError() {
            els.paperContent.innerHTML = `<div class="text-center py-20 font-bold text-[var(--c-text-primary)]">PAPERS PAYLOAD MISSING</div>`;
            els.paperSelect.innerHTML = `<option disabled>Error</option>`;
        }

        function renderPaperSelector() {
            els.paperSelect.innerHTML = state.papers.map(p => 
                `<option value="${p.key}">${p.label}</option>`
            ).join('');

            els.paperSelect.addEventListener('change', (e) => {
                loadPaper(e.target.value);
            });
        }

        function loadPaper(key) {
            const paper = state.papers.find(p => p.key === key);
            if (!paper) return;

            state.activePaper = paper;
            state.expanded = {}; // Reset expansion state
            state.navItems = []; // Reset nav

            // Determine default expansion
            const defaultExpanded = paper.defaults?.expandedAll !== false;

            // Generate Content HTML & Build Nav Model
            const contentHtml = generatePaperHtml(paper, defaultExpanded);
            
            // Render Content
            els.paperContent.innerHTML = contentHtml;
            
            // Render Nav
            renderNavigation();

            // Post-Render: Icons
            lucide.createIcons();

            // Post-Render: KaTeX
            renderMathInElement(els.paperContent, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ],
                throwOnError: false
            });

            // Bind Events (Toggles)
            bindInteractions();

            // Setup Scroll Spy
            setupScrollSpy();

            // Scroll to top
            window.scrollTo(0,0);
        }

        // --- Generation Logic ---

        function generatePaperHtml(paper, defaultExpanded) {
            let html = '';

            // Handle Sections vs Flat
            if (paper.sections) {
                paper.sections.forEach(section => {
                    // Stage 5.4.6: Section Labels are non-clickable signposts
                    // Only render if label is non-empty
                    if (section.label && section.label.trim().length > 0) {
                        html += generateSectionHeader(section.label);
                        state.navItems.push({ type: 'section', label: section.label });
                    }
                    
                    html += `<div class="space-y-[var(--sp-xl)]">`; // List wrapper
                    section.questions.forEach(q => {
                        html += generateQuestionNode(q, defaultExpanded, 0);
                    });
                    html += `</div>`;

                    // Separator between sections handled by margin/padding logic in css
                    html += `<div class="h-[var(--sp-xl)]"></div>`;
                });
            } else if (paper.questions) {
                html += `<div class="space-y-[var(--sp-xl)]">`;
                paper.questions.forEach(q => {
                    html += generateQuestionNode(q, defaultExpanded, 0);
                });
                html += `</div>`;
            }

            return html;
        }

        function generateSectionHeader(label) {
            return `
                <div class="mb-[var(--sp-lg)] pt-[var(--sp-md)]">
                    <h2 class="text-xl font-bold text-[var(--c-text-primary)] border-b border-[var(--c-divider)] pb-2 mb-4">${label}</h2>
                </div>
            `;
        }

        function generateQuestionNode(node, defaultExpanded, depth) {
            // Register for navigation
            state.navItems.push({ 
                type: 'item', 
                id: node.id, 
                targetId: `q-${node.id}`, // Anchor ID
                depth: depth 
            });

            // Setup Expansion State
            const hasSolutionDetails = !!(node.solutionBlock?.solutionDetails);
            // If toggle exists, set default state if not already set
            if (hasSolutionDetails && state.expanded[node.id] === undefined) {
                state.expanded[node.id] = defaultExpanded;
            }
            const isExpanded = state.expanded[node.id];

            // Render Markdown
            const qHtml = md ? md.render(node.question || '') : node.question;
            
            let html = `
                <div id="q-${node.id}" class="question-node group scroll-mt-24">
                    <!-- Surface (implicit in paper bg, no extra container) -->
                    
                    <!-- Question Body -->
                    <div class="mb-[var(--sp-sm)]">
                        <div class="flex items-baseline gap-3">
                            <span class="font-bold text-[var(--c-text-secondary)] select-none shrink-0">${node.id}</span>
                            <div class="question-body flex-1">${qHtml}</div>
                        </div>
                    </div>
            `;

            // Optional Solution Block
            if (node.solutionBlock) {
                html += `<div class="pl-0 sm:pl-8 lg:pl-10 mt-[var(--sp-sm)] space-y-[var(--sp-sm)]">`; // Indent for hierarchy
                
                // Answer (Visible by default if present)
                if (node.solutionBlock.answer) {
                    const aHtml = md ? md.render(node.solutionBlock.answer) : node.solutionBlock.answer;
                    html += `
                        <div class="answer-block">
                            <div class="answer-label mb-1">Answer</div>
                            <div class="text-[var(--c-text-primary)]">${aHtml}</div>
                        </div>
                    `;
                }

                // Solution Details (Expandable)
                if (hasSolutionDetails) {
                    const sd = node.solutionBlock.solutionDetails;
                    const expandLabel = isExpanded ? "Hide working" : "Show working";
                    const chevronRot = isExpanded ? "rotate-180" : "";
                    const displayStyle = isExpanded ? "block" : "none";

                    html += `
                        <div class="solution-details-wrapper">
                            <!-- Toggle -->
                            <button class="disclosure-control js-toggle" data-id="${node.id}">
                                <span>${expandLabel}</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-200 ${chevronRot}"></i>
                            </button>

                            <!-- Expanded Region -->
                            <div id="sd-${node.id}" class="solution-details-region" style="display: ${displayStyle}">
                                ${generateSolutionDetailsContent(sd)}
                            </div>
                        </div>
                    `;
                }

                html += `</div>`; // End Solution Block
            }

            // Children (Recursion)
            if (node.children && node.children.length > 0) {
                html += `<div class="pl-4 sm:pl-8 mt-[var(--sp-md)] space-y-[var(--sp-md)] border-l border-[var(--c-divider)] ml-2 sm:ml-4">`;
                node.children.forEach(child => {
                    html += generateQuestionNode(child, defaultExpanded, depth + 1);
                });
                html += `</div>`;
            }

            html += `</div>`; // End Question Node
            return html;
        }

        function generateSolutionDetailsContent(sd) {
            let html = '';

            // Order: Keep in mind -> Formulas -> Working -> Alternative
            
            if (sd.keepInMind) {
                html += `<div class="mb-[var(--sp-lg)]">
                    <span class="sd-subsection-label">Keep in mind</span>
                    <div class="text-[var(--c-text-primary)] text-sm leading-relaxed">${md.render(sd.keepInMind)}</div>
                </div>`;
            }

            if (sd.formulasUsed) {
                html += `<div class="mb-[var(--sp-lg)]">
                    <span class="sd-subsection-label">Formulas used</span>
                    <div class="text-[var(--c-text-primary)] text-sm leading-relaxed">${md.render(sd.formulasUsed)}</div>
                </div>`;
            }

            if (sd.working) {
                html += `<div class="mb-[var(--sp-lg)]">
                    <span class="sd-subsection-label">Working</span>
                    <div class="text-[var(--c-text-primary)] leading-relaxed space-y-2">${md.render(sd.working)}</div>
                </div>`;
            }

            if (sd.alternativeWorking && Array.isArray(sd.alternativeWorking)) {
                sd.alternativeWorking.forEach(alt => {
                    html += `<div class="pt-[var(--sp-md)] border-t border-[var(--c-divider)] mt-[var(--sp-md)]">
                        <span class="sd-subsection-label">Alternative working</span>
                        <div class="text-[var(--c-text-primary)] leading-relaxed space-y-2">${md.render(alt)}</div>
                    </div>`;
                });
            }

            return html;
        }

        function renderNavigation() {
            const buildNav = () => state.navItems.map(item => {
                if (item.type === 'section') {
                    return `<div class="pt-4 pb-1 text-xs font-bold text-[var(--c-text-secondary)] uppercase tracking-wider select-none">${item.label}</div>`;
                }
                // Hierarchy via type scale/quietness (Stage 5.4.5)
                // We use opacity or font-size adjustments for deeper items, but flat alignment
                const hierarchyClass = item.depth > 0 ? "text-[0.8rem] opacity-90" : "";
                
                return `<a href="#${item.targetId}" class="nav-item block py-0.5 pl-0 border-l-2 border-transparent hover:border-[var(--c-divider)] ${hierarchyClass}" data-target="${item.targetId}">${item.id}</a>`;
            }).join('');

            const html = buildNav();
            els.desktopNav.innerHTML = html;
            els.mobileNav.innerHTML = html;
            
            // Re-bind click for smooth scroll / drawer close
            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    const targetEl = document.getElementById(targetId);
                    if (targetEl) {
                        // Close drawer if open
                        closeDrawer();
                        // Scroll
                        const headerOffset = 80; // approximate
                        const elementPosition = targetEl.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({
                            top: offsetPosition,
                            behavior: "smooth"
                        });
                    }
                });
            });
        }

        function bindInteractions() {
            document.querySelectorAll('.js-toggle').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = btn.getAttribute('data-id');
                    state.expanded[id] = !state.expanded[id];
                    
                    // Re-render just this button and its content logic (simplified: direct DOM manipulation)
                    const region = document.getElementById(`sd-${id}`);
                    const icon = btn.querySelector('i');
                    const text = btn.querySelector('span');
                    
                    if (state.expanded[id]) {
                        region.style.display = 'block';
                        text.innerText = "Hide working";
                        icon.classList.add('rotate-180');
                    } else {
                        region.style.display = 'none';
                        text.innerText = "Show working";
                        icon.classList.remove('rotate-180');
                    }
                });
            });
        }

        // --- Drawer Logic ---
        function openDrawer() {
            els.mobileDrawer.classList.remove('hidden');
            // Force reflow
            void els.mobileDrawer.offsetWidth;
            els.drawerBackdrop.classList.remove('opacity-0');
            els.drawerPanel.classList.remove('translate-x-full');
            document.body.style.overflow = 'hidden';
        }

        function closeDrawer() {
            els.drawerBackdrop.classList.add('opacity-0');
            els.drawerPanel.classList.add('translate-x-full');
            setTimeout(() => {
                els.mobileDrawer.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        els.jumpTrigger.addEventListener('click', openDrawer);
        els.drawerClose.addEventListener('click', closeDrawer);
        els.drawerBackdrop.addEventListener('click', closeDrawer);

        // --- Scroll Spy ---
        function setupScrollSpy() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Update active state
                        const id = entry.target.id;
                        document.querySelectorAll('.nav-item').forEach(nav => {
                            if (nav.getAttribute('data-target') === id) {
                                nav.classList.add('active');
                                nav.classList.add('border-[var(--c-accent)]'); // Nav active marker via border
                                nav.classList.remove('border-transparent');
                            } else {
                                nav.classList.remove('active');
                                nav.classList.remove('border-[var(--c-accent)]');
                                nav.classList.add('border-transparent');
                            }
                        });
                    }
                });
            }, {
                rootMargin: '-10% 0px -80% 0px' // Focus on top area
            });

            document.querySelectorAll('.question-node').forEach(node => {
                observer.observe(node);
            });
        }

        // --- Run ---
        init();

    </script>
</body>
</html>
