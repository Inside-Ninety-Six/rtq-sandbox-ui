<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"236","totalWithinVariant":"320","hueFamily":"purple","intensityMode":"deep_theme","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-09T21:24:00.334Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;236&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;purple&quot;,&quot;intensityMode&quot;:&quot;deep_theme&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-09T21:24:00.334Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ â€“ Maths Paper Solution Viewer (Stage 6 Baseline)</title>

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- LIBRARIES (No Integrity Attributes) -->
    <!-- Tailwind CSS (Script for rapid prototyping) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <!-- KaTeX JS + Auto-render -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- STYLES -->
    <style>
        /* 
           COLORLAB CONFIGURATION
           Mode: Tinted Neutrals (Add-on C)
           Hue: Purple (Add-on B)
           Values derived to meet Add-on C numeric constraints.
        */
        :root {
            /* Base Hue: 290 (Purple) */
            
            /* Surfaces (L ~0.97-0.99, C ~0.015-0.035) */
            --color-bg-page: oklch(0.98 0.02 290);
            --color-bg-frame: oklch(0.97 0.025 290);
            --color-bg-paper: oklch(0.99 0.015 290);
            
            /* Wash Surfaces (C ~0.025-0.045) */
            --color-wash-solution: oklch(0.96 0.03 290);
            
            /* Typography (C <= 0.012) */
            --color-text-primary: oklch(0.20 0.01 290);
            --color-text-secondary: oklch(0.45 0.012 290);
            
            /* Accent (C ~0.10-0.16) - Used for links, focus, toggles */
            --color-accent: oklch(0.55 0.14 290);
            
            /* Structural */
            --color-border: oklch(0.90 0.02 290);
            --color-focus: var(--color-accent);
        }

        body {
            background-color: var(--color-bg-page);
            color: var(--color-text-primary);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        /* KA-TEX CONTAINMENT INVARIANT */
        /* Only display math scrolls. No page horizontal scroll. */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding-bottom: 4px; /* Scrollbar breathing room */
            -webkit-overflow-scrolling: touch;
        }
        
        /* SCROLLBAR UTILS */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* FOCUS VISIBILITY */
        :focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }
        
        /* TABLE STYLING */
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid var(--color-border);
            padding: 0.5em 0.75em;
            text-align: left;
        }
        th {
            font-weight: 600;
        }
        /* Mobile table scroll wrapper handled in JS render */

        /* LAYOUT UTILS */
        .nav-sticky {
            position: sticky;
            top: 0;
            height: 100vh;
        }
        
        /* ANIMATIONS (Reduced Motion Safe) */
        @media (prefers-reduced-motion: no-preference) {
            .reveal-content {
                transition: opacity 0.2s ease, max-height 0.3s ease;
            }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- TOP CONTROLS REGION -->
    <header class="w-full border-b border-[var(--color-border)] bg-[var(--color-bg-frame)] z-20 relative">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
            <!-- Paper Selector -->
            <div class="flex items-center gap-3">
                <label for="paper-select" class="text-xs font-semibold uppercase tracking-wider text-[var(--color-text-secondary)]">Paper</label>
                <select id="paper-select" class="bg-[var(--color-bg-paper)] border border-[var(--color-border)] text-sm rounded px-2 py-1 focus:ring-1 focus:ring-[var(--color-accent)] outline-none min-w-[200px]">
                    <option disabled selected>Loading papers...</option>
                </select>
            </div>

            <!-- Mobile Jump To Trigger -->
            <button id="mobile-jump-trigger" class="md:hidden text-sm font-medium text-[var(--color-accent)] flex items-center gap-1">
                <span>Jump to</span>
                <svg width="16" height="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H11L7.5 10.5L4 6Z" fill="currentColor"></path></svg>
            </button>
        </div>
    </header>

    <!-- DOCUMENT FRAME SHELL -->
    <div class="flex-1 w-full max-w-[1400px] mx-auto flex items-start relative bg-[var(--color-bg-frame)]">
        
        <!-- NAVIGATION RAIL (Desktop) -->
        <nav class="hidden md:block w-64 flex-shrink-0 nav-sticky py-6 pl-4 pr-4 overflow-y-auto no-scrollbar border-r border-transparent">
            <div id="desktop-nav-list" class="flex flex-col gap-1">
                <!-- Nav items injected here -->
            </div>
        </nav>

        <!-- SEPARATOR (Visual Only) -->
        <div class="hidden md:block w-px bg-transparent h-full mx-2"></div>

        <!-- PAPER DOCUMENT COLUMN -->
        <main class="flex-1 w-full min-w-0 py-6 px-4 sm:px-8 md:px-12 bg-[var(--color-bg-paper)] min-h-[calc(100vh-3.5rem)] shadow-sm">
            <div id="paper-content" class="max-w-[800px] mx-auto pb-32">
                <!-- Paper content injected here -->
                <div class="text-[var(--color-text-secondary)] text-center mt-20 animate-pulse">Loading payload...</div>
            </div>
        </main>

    </div>

    <!-- MOBILE DRAWER -->
    <div id="mobile-drawer" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
        <!-- Scrim -->
        <div id="mobile-drawer-scrim" class="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity opacity-0"></div>
        <!-- Drawer Panel -->
        <div id="mobile-drawer-panel" class="absolute right-0 top-0 bottom-0 w-[80%] max-w-xs bg-[var(--color-bg-frame)] shadow-xl transform translate-x-full transition-transform duration-300 flex flex-col">
            <div class="flex items-center justify-between p-4 border-b border-[var(--color-border)]">
                <span class="font-semibold text-[var(--color-text-primary)]">Jump to</span>
                <button id="mobile-drawer-close" class="p-2 text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]">
                    <svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.50005L3.21846 10.9685C2.99391 11.1931 2.99391 11.5571 3.21846 11.7816C3.44301 12.0062 3.80708 12.0062 4.03164 11.7816L7.50005 8.31322L10.9685 11.7816C11.193 12.0062 11.5571 12.0062 11.7816 11.7816C12.0062 11.5571 12.0062 11.1931 11.7816 10.9685L8.31322 7.50005L11.7816 4.03157Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                </button>
            </div>
            <div id="mobile-nav-list" class="flex-1 overflow-y-auto p-4 space-y-1">
                <!-- Mobile nav items injected here -->
            </div>
        </div>
    </div>

    <!-- APP LOGIC -->
    <script>
        // --- STAGE 0: CONSTANTS ---
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // --- GLOBAL STATE ---
        const AppState = {
            papers: [],
            currentPaper: null,
            expandedNodes: new Set(),
            navActiveId: null
        };

        // --- MARKDOWN CONFIGURATION (STAGE 6) ---
        // Must allow html (SVG), linkify, breaks: false, no escape.
        let md = null;
        if (window.markdownit) {
            md = window.markdownit({
                html: true,
                linkify: true,
                breaks: false 
            });
            // Disable escape rule to preserve TeX backslashes
            md.inline.ruler.disable(['escape']);
        }

        // --- DOM ELEMENTS ---
        const els = {
            paperSelect: document.getElementById('paper-select'),
            paperContent: document.getElementById('paper-content'),
            desktopNav: document.getElementById('desktop-nav-list'),
            mobileNav: document.getElementById('mobile-nav-list'),
            mobileTrigger: document.getElementById('mobile-jump-trigger'),
            mobileDrawer: document.getElementById('mobile-drawer'),
            mobilePanel: document.getElementById('mobile-drawer-panel'),
            mobileScrim: document.getElementById('mobile-drawer-scrim'),
            mobileClose: document.getElementById('mobile-drawer-close')
        };

        // --- INITIALIZATION ---
        async function init() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error("Payload not found");
                const payload = await response.json();
                
                if (!payload || !payload.papers) throw new Error("Invalid payload structure");

                AppState.papers = payload.papers;
                renderPaperSelector();
                
                // Load first paper by default
                if (AppState.papers.length > 0) {
                    loadPaper(AppState.papers[0].key);
                }
            } catch (err) {
                renderError();
                console.error(err);
            }
        }

        function renderError() {
            els.paperContent.innerHTML = `<div class="p-8 text-center text-red-600 font-semibold border border-red-200 bg-red-50 rounded">PAPERS PAYLOAD MISSING</div>`;
            els.paperSelect.innerHTML = `<option>Error loading payload</option>`;
            els.paperSelect.disabled = true;
        }

        function renderPaperSelector() {
            els.paperSelect.innerHTML = AppState.papers.map(p => 
                `<option value="${p.key}">${p.label}</option>`
            ).join('');
            
            els.paperSelect.addEventListener('change', (e) => {
                loadPaper(e.target.value);
            });
        }

        function loadPaper(paperKey) {
            const paper = AppState.papers.find(p => p.key === paperKey);
            if (!paper) return;

            AppState.currentPaper = paper;
            AppState.expandedNodes.clear();

            // Default expansion logic based on paper.defaults
            const defaultExpanded = paper.defaults?.expandedAll !== false; // Default true unless explicitly false

            // Flatten questions for navigation and expansion init
            const allNodes = [];
            const traverse = (nodes) => {
                nodes.forEach(node => {
                    allNodes.push(node);
                    if (node.solutionBlock?.solutionDetails && defaultExpanded) {
                        AppState.expandedNodes.add(node.id);
                    }
                    if (node.children) traverse(node.children);
                });
            };

            if (paper.sections) {
                paper.sections.forEach(s => traverse(s.questions));
            } else {
                traverse(paper.questions);
            }

            renderNav();
            renderPaperContent();
            
            // Trigger KaTeX
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ],
                    throwOnError: false
                });
            }

            // Reset scroll
            window.scrollTo({ top: 0, behavior: 'instant' });
        }

        // --- RENDERING CORE ---

        function renderNav() {
            const paper = AppState.currentPaper;
            
            // Helper to generate list items
            const generateItems = (questions) => {
                let html = '';
                const recurse = (nodes, depth = 0) => {
                    nodes.forEach(node => {
                        // Hierarchy via type scale/quietness, no indent
                        const fontSize = depth === 0 ? 'text-sm' : 'text-xs';
                        const color = depth === 0 ? 'text-[var(--color-text-primary)]' : 'text-[var(--color-text-secondary)]';
                        const weight = depth === 0 ? 'font-medium' : 'font-normal';
                        
                        html += `
                            <button onclick="scrollToQuestion('${node.id}')" 
                                class="w-full text-left py-1 px-2 rounded hover:bg-[var(--color-wash-solution)] focus-visible:ring-2 focus-visible:ring-[var(--color-focus)] transition-colors nav-item"
                                data-qid="${node.id}">
                                <span class="${fontSize} ${color} ${weight}">${node.id}</span>
                            </button>
                        `;
                        if (node.children) recurse(node.children, depth + 1);
                    });
                };
                recurse(questions);
                return html;
            };

            let navHtml = '';

            if (paper.sections) {
                paper.sections.forEach(section => {
                    // Only render label if non-empty
                    if (section.label && section.label.trim().length > 0) {
                        navHtml += `<div class="mt-4 mb-2 text-xs font-bold text-[var(--color-text-secondary)] uppercase tracking-wider px-2 select-none">${section.label}</div>`;
                    }
                    navHtml += generateItems(section.questions);
                    // Separator between sections (spacing)
                    navHtml += `<div class="h-2"></div>`; 
                });
            } else {
                navHtml += generateItems(paper.questions);
            }

            els.desktopNav.innerHTML = navHtml;
            els.mobileNav.innerHTML = navHtml;
        }

        function renderPaperContent() {
            const paper = AppState.currentPaper;
            let html = '';

            if (paper.sections) {
                paper.sections.forEach((section, idx) => {
                    // Section Header
                    if (section.label && section.label.trim().length > 0) {
                        html += `
                            <div class="mb-8 border-b border-[var(--color-border)] pb-2">
                                <h2 class="text-xl font-bold text-[var(--color-text-primary)]">${section.label}</h2>
                            </div>
                        `;
                    }
                    html += `<div class="flex flex-col gap-12 mb-12">`; // Question list container
                    section.questions.forEach(q => {
                        html += renderQuestionNode(q, 0);
                    });
                    html += `</div>`;
                });
            } else {
                html += `<div class="flex flex-col gap-12 mt-8">`;
                paper.questions.forEach(q => {
                    html += renderQuestionNode(q, 0);
                });
                html += `</div>`;
            }

            els.paperContent.innerHTML = html;
        }

        function renderQuestionNode(node, depth) {
            // Render specific parts
            const qBody = renderMarkdown(node.question);
            
            let solutionBlockHtml = '';
            
            if (node.solutionBlock) {
                // Answer
                let answerHtml = '';
                if (node.solutionBlock.answer) {
                    answerHtml = `
                        <div class="mb-4">
                            <span class="block text-xs font-bold text-[var(--color-text-secondary)] mb-1 uppercase tracking-wider">Answer</span>
                            <div class="text-[var(--color-text-primary)] font-medium">
                                ${renderMarkdown(node.solutionBlock.answer)}
                            </div>
                        </div>
                    `;
                }

                // Solution Details
                let detailsHtml = '';
                if (node.solutionBlock.solutionDetails) {
                    const isExpanded = AppState.expandedNodes.has(node.id);
                    const details = node.solutionBlock.solutionDetails;
                    
                    const btnText = isExpanded ? 'Hide working' : 'Show working';
                    const chevronRot = isExpanded ? 'rotate-180' : 'rotate-0';
                    const displayStyle = isExpanded ? 'block' : 'none';

                    // Subsections
                    let subsectionsHtml = '';
                    
                    // Keep in mind
                    if (details.keepInMind) {
                        subsectionsHtml += `
                            <div class="mb-6">
                                <div class="flex items-center gap-2 mb-2 text-[var(--color-accent)]">
                                    <svg width="16" height="16" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0.875C3.84112 0.875 0.875 3.84112 0.875 7.5C0.875 11.1589 3.84112 14.125 7.5 14.125C11.1589 14.125 14.125 11.1589 14.125 7.5C14.125 3.84112 11.1589 0.875 7.5 0.875ZM8.25 10.75H6.75V12.25H8.25V10.75ZM8.25 2.75H6.75V9.25H8.25V2.75Z" fill="currentColor"/></svg>
                                    <span class="text-sm font-bold">Keep in mind</span>
                                </div>
                                <div class="text-sm text-[var(--color-text-primary)] pl-6">
                                    ${renderMarkdown(details.keepInMind)}
                                </div>
                            </div>
                        `;
                    }

                    // Formulas Used
                    if (details.formulasUsed) {
                        subsectionsHtml += `
                            <div class="mb-6">
                                <span class="block text-xs font-bold text-[var(--color-text-secondary)] mb-2 uppercase tracking-wider">Formulas used</span>
                                <div class="text-sm text-[var(--color-text-primary)] border-l-2 border-[var(--color-border)] pl-3">
                                    ${renderMarkdown(details.formulasUsed)}
                                </div>
                            </div>
                        `;
                    }

                    // Working
                    if (details.working) {
                        subsectionsHtml += `
                            <div class="mb-6">
                                <span class="block text-xs font-bold text-[var(--color-text-secondary)] mb-2 uppercase tracking-wider">Working</span>
                                <div class="prose-working text-[var(--color-text-primary)] space-y-4">
                                    ${renderMarkdown(details.working)}
                                </div>
                            </div>
                        `;
                    }

                    // Alternative Working
                    if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
                        details.alternativeWorking.forEach((alt, idx) => {
                            subsectionsHtml += `
                                <div class="mt-8 pt-6 border-t border-[var(--color-border)]">
                                    <span class="block text-xs font-bold text-[var(--color-text-secondary)] mb-2 uppercase tracking-wider">Alternative working</span>
                                    <div class="prose-working text-[var(--color-text-primary)] space-y-4">
                                        ${renderMarkdown(alt)}
                                    </div>
                                </div>
                            `;
                        });
                    } else if (typeof details.alternativeWorking === 'string') {
                         subsectionsHtml += `
                                <div class="mt-8 pt-6 border-t border-[var(--color-border)]">
                                    <span class="block text-xs font-bold text-[var(--color-text-secondary)] mb-2 uppercase tracking-wider">Alternative working</span>
                                    <div class="prose-working text-[var(--color-text-primary)] space-y-4">
                                        ${renderMarkdown(details.alternativeWorking)}
                                    </div>
                                </div>
                            `;
                    }

                    detailsHtml = `
                        <div class="mt-2">
                            <button onclick="toggleNode('${node.id}')" class="flex items-center gap-1 text-sm font-medium text-[var(--color-accent)] hover:underline focus:outline-none focus-visible:ring-2 focus-visible:ring-[var(--color-accent)] rounded px-1 -ml-1 py-1">
                                <span>${btnText}</span>
                                <svg class="transform transition-transform duration-200 ${chevronRot}" width="12" height="12" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                            </button>
                            
                            <div id="details-${node.id}" class="mt-3 pl-4 border-l border-[var(--color-border)] bg-[var(--color-wash-solution)] -ml-4 p-4 rounded-r-sm rounded-bl-sm" style="display: ${displayStyle}">
                                ${subsectionsHtml}
                            </div>
                        </div>
                    `;
                }

                if (answerHtml || detailsHtml) {
                    solutionBlockHtml = `
                        <div class="mt-6 pt-2">
                            ${answerHtml}
                            ${detailsHtml}
                        </div>
                    `;
                }
            }

            // Children
            let childrenHtml = '';
            if (node.children && node.children.length > 0) {
                childrenHtml = `<div class="mt-6 flex flex-col gap-6 ml-4 sm:ml-6 border-l border-transparent pl-2 sm:pl-0">`;
                node.children.forEach(child => {
                    childrenHtml += renderQuestionNode(child, depth + 1);
                });
                childrenHtml += `</div>`;
            }

            // Main ID styling
            const idClass = depth === 0 ? 'text-lg font-bold text-[var(--color-text-secondary)] w-12 shrink-0 pt-0.5' : 'text-sm font-semibold text-[var(--color-text-secondary)] w-10 shrink-0 pt-0.5';

            return `
                <div id="q-${node.id}" class="group scroll-mt-24">
                    <div class="flex items-start">
                        <div class="${idClass}">${node.id}</div>
                        <div class="flex-1 min-w-0">
                            <!-- Question Body -->
                            <div class="text-[var(--color-text-primary)] text-base sm:text-lg leading-relaxed">
                                ${qBody}
                            </div>
                            <!-- Solution Block -->
                            ${solutionBlockHtml}
                        </div>
                    </div>
                    ${childrenHtml}
                </div>
            `;
        }

        function renderMarkdown(text) {
            if (!text) return '';
            if (!md) return text; // Fallback
            return md.render(text);
        }

        // --- INTERACTION ---

        window.toggleNode = (id) => {
            if (AppState.expandedNodes.has(id)) {
                AppState.expandedNodes.delete(id);
            } else {
                AppState.expandedNodes.add(id);
            }
            // Re-render specific node or whole tree? 
            // For simplicity and correctness with KaTeX, easiest to re-render whole content and maintain scroll.
            // A clearer optimization would be DOM manipulation, but this is a stress-test prototype.
            // Let's re-render content.
            const scrollPos = window.scrollY;
            renderPaperContent();
            // Re-trigger math
            if (window.renderMathInElement) {
                renderMathInElement(els.paperContent, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false}
                    ]
                });
            }
            window.scrollTo({top: scrollPos, behavior: 'auto'});
        };

        window.scrollToQuestion = (id) => {
            const el = document.getElementById(`q-${id}`);
            if (el) {
                el.scrollIntoView({behavior: 'smooth', block: 'start'});
                closeDrawer();
                
                // Update active state visual (Nav only)
                document.querySelectorAll('.nav-item').forEach(btn => {
                    const isActive = btn.dataset.qid === id;
                    btn.classList.toggle('font-bold', isActive);
                    btn.classList.toggle('text-[var(--color-accent)]', isActive);
                    if (isActive) {
                        // Ensure nav marker logic if needed
                    } else {
                        // Reset
                        // Re-apply depth logic would be complex here without state. 
                        // Simplest: just use CSS class 'font-bold' for active.
                    }
                });
            }
        };

        // --- MOBILE DRAWER ---
        function openDrawer() {
            els.mobileDrawer.classList.remove('hidden');
            // Trigger reflow
            void els.mobileDrawer.offsetWidth;
            els.mobileScrim.classList.remove('opacity-0');
            els.mobilePanel.classList.remove('translate-x-full');
            document.body.style.overflow = 'hidden';
        }

        function closeDrawer() {
            els.mobileScrim.classList.add('opacity-0');
            els.mobilePanel.classList.add('translate-x-full');
            setTimeout(() => {
                els.mobileDrawer.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        els.mobileTrigger.addEventListener('click', openDrawer);
        els.mobileClose.addEventListener('click', closeDrawer);
        els.mobileScrim.addEventListener('click', closeDrawer);

        // --- EXECUTE ---
        init();

    </script>
</body>
</html>
