<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"22","totalWithinVariant":"320","hueFamily":"cyan","intensityMode":"tinted_neutrals","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-09T10:58:14.068Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;22&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;cyan&quot;,&quot;intensityMode&quot;:&quot;tinted_neutrals&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-09T10:58:14.068Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer (Stage 6 Baseline)</title>

    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- KaTeX CSS (no integrity per Stage 6 rules) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- KaTeX JS (no integrity per Stage 6 rules) -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Markdown-it (no integrity per Stage 6 rules) -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <script>
        // --- STAGE 0: CONSTANTS (AUTHORITATIVE) ---
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // --- COLORLAB C (TINTED_NEUTRALS) + B (CYAN) CONFIGURATION ---
        // Hue Family: Cyan (approx H=195 in OKLCH)
        // Intensity Mode: tinted_neutrals (per strict bands)
        
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Surfaces (C in 0.015..0.035)
                        page: 'oklch(0.97 0.02 195)', 
                        frame: 'oklch(0.95 0.025 195)',
                        paper: 'oklch(0.99 0.015 195)',
                        
                        // Washes (C in 0.025..0.045)
                        wash: 'oklch(0.96 0.03 195)', 
                        
                        // Text (Primary C<=0.010, Secondary C<=0.012)
                        primary: 'oklch(0.20 0.01 195)',
                        secondary: 'oklch(0.45 0.012 195)',
                        
                        // Accent (C in 0.10..0.16)
                        accent: 'oklch(0.55 0.14 195)',
                        
                        // Borders (Low chroma)
                        hairline: 'oklch(0.90 0.02 195)',
                    },
                    fontFamily: {
                        sans: ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                    spacing: {
                        'nav-w': '240px',
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Reset & Typography Defaults */
        body {
            background-color: theme('colors.page');
            color: theme('colors.primary');
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Scrollbar Hiding for Navigation (Stage 3 Add-on) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* KaTeX Containment Invariant (Stage 3/6) */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 4px; /* Space for scrollbar if needed */
        }
        
        /* Inline KaTeX Transparency Rule (Stage 5.8.4) */
        .katex {
            background-color: transparent !important;
        }

        /* Markdown Content Styling */
        .md-content p {
            margin-bottom: 0.75em;
            line-height: 1.6;
        }
        .md-content p:last-child {
            margin-bottom: 0;
        }
        .md-content ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-bottom: 0.75em;
        }
        .md-content ol {
            list-style-type: decimal;
            padding-left: 1.5em;
            margin-bottom: 0.75em;
        }
        /* Minimal Table Styling (Stage 5.8.5) */
        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0.75em;
            font-size: 0.95em;
        }
        .md-content th, .md-content td {
            border: 1px solid theme('colors.hairline');
            padding: 8px 12px;
            text-align: left;
        }
        .md-content th {
            font-weight: 600;
        }
        
        /* Focus Visibility (Stage 5.5.2) */
        :focus-visible {
            outline: 2px solid theme('colors.accent');
            outline-offset: 2px;
        }

        /* Transitions */
        .transition-height {
            transition-property: max-height, opacity;
            transition-duration: 300ms;
            transition-timing-function: ease-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Top Controls Region -->
    <div class="sticky top-0 z-20 w-full bg-page border-b border-hairline">
        <div class="max-w-6xl mx-auto px-4 md:px-8 h-14 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <!-- Mobile Jump Trigger -->
                <button id="mobile-jump-trigger" class="md:hidden text-accent font-medium text-sm flex items-center gap-1" aria-label="Open navigation">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    Jump to
                </button>
                
                <!-- Paper Selector -->
                <div class="flex items-center gap-2">
                    <label for="paper-select" class="text-sm text-secondary hidden sm:block">Paper:</label>
                    <select id="paper-select" class="bg-frame border border-hairline rounded px-2 py-1 text-sm text-primary focus:border-accent focus:outline-none">
                        <option value="" disabled selected>Loading...</option>
                    </select>
                </div>
            </div>
            <div class="text-xs text-secondary font-mono">RTQ v11.3.7</div>
        </div>
    </div>

    <!-- DocumentFrameShell -->
    <main class="flex-1 w-full max-w-6xl mx-auto md:px-8 flex relative bg-frame">
        
        <!-- Navigation Rail (Desktop) -->
        <aside class="hidden md:block w-nav-w flex-shrink-0 sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto no-scrollbar py-8 pr-6 border-r border-transparent">
            <nav id="desktop-nav" class="flex flex-col gap-1" aria-label="Paper navigation">
                <!-- Nav items injected here -->
            </nav>
        </aside>

        <!-- Paper Content Column -->
        <div class="flex-1 min-w-0 py-8 md:pl-8">
            <div id="paper-region" class="bg-paper min-h-[50vh] pb-32">
                <!-- Paper content injected here -->
                <div id="loading-indicator" class="p-8 text-center text-secondary">Loading paper content...</div>
            </div>
        </div>

    </main>

    <!-- Mobile Navigation Drawer -->
    <div id="mobile-drawer-backdrop" class="fixed inset-0 bg-black/20 z-40 hidden" aria-hidden="true"></div>
    <div id="mobile-drawer" class="fixed inset-y-0 left-0 w-64 bg-frame z-50 transform -translate-x-full transition-transform duration-300 shadow-xl flex flex-col" aria-hidden="true">
        <div class="h-14 border-b border-hairline flex items-center justify-between px-4 bg-page">
            <span class="font-bold text-sm text-primary">Jump to</span>
            <button id="drawer-close" class="text-secondary p-2 hover:text-primary" aria-label="Close navigation">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <nav id="mobile-nav-list" class="flex-1 overflow-y-auto p-4 flex flex-col gap-1">
            <!-- Mobile nav items injected here -->
        </nav>
    </div>

    <!-- Application Logic -->
    <script>
        // --- STATE & UTILS ---
        const state = {
            papers: [],
            activePaperKey: null,
            expandedNodes: new Set(), // Set of Question IDs
            isDrawerOpen: false
        };

        // --- MARKDOWN INIT (Stage 6 Add-on) ---
        // html: true for inline SVG, breaks: false to protect KaTeX delimiters
        const md = window.markdownit ? window.markdownit({
            html: true,
            linkify: true,
            breaks: false 
        }) : null;

        if (md) {
            // Disable escape rule to preserve TeX backslashes
            md.inline.ruler.disable(['escape']);
        }

        // --- DOM ELEMENTS ---
        const els = {
            paperSelect: document.getElementById('paper-select'),
            paperRegion: document.getElementById('paper-region'),
            desktopNav: document.getElementById('desktop-nav'),
            mobileNavList: document.getElementById('mobile-nav-list'),
            mobileJumpTrigger: document.getElementById('mobile-jump-trigger'),
            mobileDrawer: document.getElementById('mobile-drawer'),
            mobileDrawerBackdrop: document.getElementById('mobile-drawer-backdrop'),
            drawerClose: document.getElementById('drawer-close'),
            loadingIndicator: document.getElementById('loading-indicator')
        };

        // --- RENDER HELPERS ---

        function renderMarkdown(text) {
            if (!text) return '';
            if (!md) return text; // Fallback
            return md.render(text);
        }

        function toggleDrawer(open) {
            state.isDrawerOpen = open;
            if (open) {
                els.mobileDrawer.classList.remove('-translate-x-full');
                els.mobileDrawerBackdrop.classList.remove('hidden');
                els.mobileDrawer.setAttribute('aria-hidden', 'false');
            } else {
                els.mobileDrawer.classList.add('-translate-x-full');
                els.mobileDrawerBackdrop.classList.add('hidden');
                els.mobileDrawer.setAttribute('aria-hidden', 'true');
            }
        }

        function scrollToQuestion(id) {
            const el = document.getElementById(`q-${id}`);
            if (el) {
                // Smooth scroll with offset for sticky header
                const headerOffset = 60; 
                const elementPosition = el.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                
                window.scrollTo({
                    top: offsetPosition,
                    behavior: "smooth"
                });
                
                // Close drawer if open
                if (state.isDrawerOpen) toggleDrawer(false);
            }
        }

        function toggleWorking(questionId) {
            if (state.expandedNodes.has(questionId)) {
                state.expandedNodes.delete(questionId);
            } else {
                state.expandedNodes.add(questionId);
            }
            // Re-render only the specific question node's solution region to avoid full page repaint
            // In a real reactive framework this is automatic. Here we re-render the paper for simplicity in this proto structure
            // Or better, just target the DOM elements for this ID.
            const container = document.getElementById(`solution-details-${questionId}`);
            const btnText = document.getElementById(`btn-text-${questionId}`);
            const btnIcon = document.getElementById(`btn-icon-${questionId}`);
            
            if (container) {
                if (state.expandedNodes.has(questionId)) {
                    container.classList.remove('hidden');
                    if (btnText) btnText.textContent = "Hide working";
                    if (btnIcon) btnIcon.style.transform = "rotate(180deg)";
                } else {
                    container.classList.add('hidden');
                    if (btnText) btnText.textContent = "Show working";
                    if (btnIcon) btnIcon.style.transform = "rotate(0deg)";
                }
            }
        }

        // --- RENDERERS ---

        function renderNav(paper) {
            const createNavItem = (q) => {
                const isActive = false; // Logic for active state via IntersectionObserver could go here
                // Hierarchy via type scale only (Stage 5.4.5)
                const isChild = q.id.includes('(') || q.id.length > 2; // Heuristic for nesting visual cue if needed, or derived from tree
                // Actually Stage 6 requires flat list logic. We generate linearly.
                
                const item = document.createElement('button');
                item.className = `w-full text-left py-1 px-2 text-sm rounded transition-colors 
                    ${isActive ? 'font-bold text-accent' : 'text-secondary hover:text-primary hover:bg-black/5'} 
                    ${isChild ? 'text-xs' : ''}`;
                item.textContent = q.id;
                item.onclick = () => scrollToQuestion(q.id);
                return item;
            };

            const createSectionLabel = (label) => {
                const div = document.createElement('div');
                div.className = "mt-4 mb-1 px-2 text-xs font-bold text-secondary uppercase tracking-wider select-none";
                div.textContent = label;
                return div;
            };

            const buildList = (container) => {
                container.innerHTML = '';
                
                // Recursive flat flattener helper
                const flattenQuestions = (qs) => {
                    let list = [];
                    qs.forEach(q => {
                        list.push(q);
                        if (q.children && q.children.length) {
                            list = list.concat(flattenQuestions(q.children));
                        }
                    });
                    return list;
                };

                if (paper.sections) {
                    paper.sections.forEach(section => {
                        if (section.label && section.label.trim().length > 0) {
                            container.appendChild(createSectionLabel(section.label));
                        }
                        const flatQs = flattenQuestions(section.questions);
                        flatQs.forEach(q => container.appendChild(createNavItem(q)));
                        
                        // Spacer between sections
                        const spacer = document.createElement('div');
                        spacer.className = "h-2";
                        container.appendChild(spacer);
                    });
                } else if (paper.questions) {
                    const flatQs = flattenQuestions(paper.questions);
                    flatQs.forEach(q => container.appendChild(createNavItem(q)));
                }
            };

            buildList(els.desktopNav);
            buildList(els.mobileNavList);
        }

        function renderQuestionNode(node, depth = 0) {
            // Check for Solution Block existence
            const hasSolutionBlock = !!node.solutionBlock;
            const hasAnswer = hasSolutionBlock && !!node.solutionBlock.answer;
            const hasDetails = hasSolutionBlock && !!node.solutionBlock.solutionDetails;
            
            const isExpanded = state.expandedNodes.has(node.id);

            // Container for the node
            const nodeDiv = document.createElement('div');
            nodeDiv.className = `question-node ${depth > 0 ? 'mt-4' : 'mb-12'}`; // Spacing: Top-level larger (Stage 5.1)
            nodeDiv.id = `q-${node.id}`;

            // 1. Question Body
            const bodyDiv = document.createElement('div');
            bodyDiv.className = "flex gap-4"; // Horizontal layout for ID + Prompt

            // Identifier
            const idSpan = document.createElement('div');
            idSpan.className = "flex-shrink-0 font-bold text-primary w-8 md:w-12 pt-1"; // Fixed width column feel
            idSpan.textContent = node.id;
            bodyDiv.appendChild(idSpan);

            // Prompt
            const promptDiv = document.createElement('div');
            promptDiv.className = "flex-1 text-lg md:text-xl text-primary md-content";
            promptDiv.innerHTML = renderMarkdown(node.question);
            bodyDiv.appendChild(promptDiv);

            nodeDiv.appendChild(bodyDiv);

            // 2. Solution Block (Optional)
            if (hasSolutionBlock) {
                const solutionBlockDiv = document.createElement('div');
                // Indent to align with prompt text (skip ID column)
                solutionBlockDiv.className = "ml-8 md:ml-12 mt-4 max-w-3xl";

                // A. Answer (Optional)
                if (hasAnswer) {
                    const answerDiv = document.createElement('div');
                    answerDiv.className = "mb-4";
                    
                    const answerLabel = document.createElement('div');
                    answerLabel.className = "text-xs font-bold text-secondary uppercase tracking-wide mb-1";
                    answerLabel.textContent = "Answer";
                    answerDiv.appendChild(answerLabel);

                    const answerContent = document.createElement('div');
                    answerContent.className = "text-base text-primary md-content";
                    answerContent.innerHTML = renderMarkdown(node.solutionBlock.answer);
                    answerDiv.appendChild(answerContent);

                    solutionBlockDiv.appendChild(answerDiv);
                }

                // B. Solution Details (Optional)
                if (hasDetails) {
                    // Disclosure Control
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = "flex items-center gap-2 text-sm font-medium text-accent hover:text-primary transition-colors focus-visible:rounded mb-2";
                    toggleBtn.onclick = () => toggleWorking(node.id);
                    
                    const btnText = document.createElement('span');
                    btnText.id = `btn-text-${node.id}`;
                    btnText.textContent = isExpanded ? "Hide working" : "Show working";
                    
                    const btnIcon = document.createElement('span');
                    btnIcon.id = `btn-icon-${node.id}`;
                    btnIcon.className = "transition-transform duration-200";
                    btnIcon.style.transform = isExpanded ? "rotate(180deg)" : "rotate(0deg)";
                    btnIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`;

                    toggleBtn.appendChild(btnText);
                    toggleBtn.appendChild(btnIcon);
                    solutionBlockDiv.appendChild(toggleBtn);

                    // Details Region
                    const detailsRegion = document.createElement('div');
                    detailsRegion.id = `solution-details-${node.id}`;
                    detailsRegion.className = `${isExpanded ? '' : 'hidden'} bg-wash rounded-sm p-4 md:p-6 mt-2 border-l-2 border-hairline`; // Quiet surface wash + hairline cue
                    
                    const sd = node.solutionBlock.solutionDetails;

                    // Keep in mind
                    if (sd.keepInMind) {
                        const kimDiv = document.createElement('div');
                        kimDiv.className = "mb-6";
                        const kimLabel = document.createElement('div');
                        kimLabel.className = "text-xs font-bold text-secondary uppercase mb-2 flex items-center gap-2";
                        kimLabel.innerHTML = `<span>Keep in mind</span>`; // Icon optional
                        kimDiv.appendChild(kimLabel);
                        const kimBody = document.createElement('div');
                        kimBody.className = "text-sm text-secondary md-content";
                        kimBody.innerHTML = renderMarkdown(sd.keepInMind);
                        kimDiv.appendChild(kimBody);
                        detailsRegion.appendChild(kimDiv);
                    }

                    // Formulas Used
                    if (sd.formulasUsed) {
                        const formulasDiv = document.createElement('div');
                        formulasDiv.className = "mb-6";
                        const fLabel = document.createElement('div');
                        fLabel.className = "text-xs font-bold text-secondary uppercase mb-2";
                        fLabel.textContent = "Formulas used";
                        formulasDiv.appendChild(fLabel);
                        const fBody = document.createElement('div');
                        fBody.className = "text-sm text-secondary md-content";
                        fBody.innerHTML = renderMarkdown(sd.formulasUsed);
                        formulasDiv.appendChild(fBody);
                        detailsRegion.appendChild(formulasDiv);
                    }

                    // Working
                    if (sd.working) {
                        const wDiv = document.createElement('div');
                        wDiv.className = "mb-6";
                        const wLabel = document.createElement('div');
                        wLabel.className = "text-xs font-bold text-secondary uppercase mb-2";
                        wLabel.textContent = "Working";
                        wDiv.appendChild(wLabel);
                        const wBody = document.createElement('div');
                        wBody.className = "text-base text-primary md-content";
                        wBody.innerHTML = renderMarkdown(sd.working);
                        wDiv.appendChild(wBody);
                        detailsRegion.appendChild(wDiv);
                    }

                    // Alternative Working
                    if (sd.alternativeWorking && Array.isArray(sd.alternativeWorking)) {
                        sd.alternativeWorking.forEach((alt, idx) => {
                            const altDiv = document.createElement('div');
                            altDiv.className = "mt-8 pt-4 border-t border-hairline"; // Separation
                            const altLabel = document.createElement('div');
                            altLabel.className = "text-xs font-bold text-secondary uppercase mb-2";
                            altLabel.textContent = "Alternative working";
                            altDiv.appendChild(altLabel);
                            const altBody = document.createElement('div');
                            altBody.className = "text-base text-primary md-content";
                            altBody.innerHTML = renderMarkdown(alt);
                            altDiv.appendChild(altBody);
                            detailsRegion.appendChild(altDiv);
                        });
                    }

                    solutionBlockDiv.appendChild(detailsRegion);
                }

                nodeDiv.appendChild(solutionBlockDiv);
            }

            // 3. Children (Recursive)
            if (node.children && node.children.length > 0) {
                const childrenContainer = document.createElement('div');
                childrenContainer.className = "ml-8 md:ml-12 mt-6"; // Indentation for sub-questions
                node.children.forEach(child => {
                    childrenContainer.appendChild(renderQuestionNode(child, depth + 1));
                });
                nodeDiv.appendChild(childrenContainer);
            }

            return nodeDiv;
        }

        function renderPaper(paper) {
            els.paperRegion.innerHTML = ''; // Clear loading
            
            // Section Headers Handling
            if (paper.sections) {
                paper.sections.forEach(section => {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = "mb-16";
                    
                    if (section.label && section.label.trim().length > 0) {
                        const header = document.createElement('div');
                        header.className = "text-2xl font-bold text-primary mb-8 border-b border-hairline pb-2";
                        header.textContent = `Section ${section.label}`;
                        sectionDiv.appendChild(header);
                    }

                    section.questions.forEach(q => {
                        sectionDiv.appendChild(renderQuestionNode(q));
                    });
                    els.paperRegion.appendChild(sectionDiv);
                });
            } else if (paper.questions) {
                const listDiv = document.createElement('div');
                listDiv.className = "pt-8";
                paper.questions.forEach(q => {
                    listDiv.appendChild(renderQuestionNode(q));
                });
                els.paperRegion.appendChild(listDiv);
            }

            // Post-render: KaTeX
            renderMathInElement(els.paperRegion, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }

        function switchPaper(key) {
            const paper = state.papers.find(p => p.key === key);
            if (!paper) return;

            state.activePaperKey = key;
            state.expandedNodes.clear();

            // Set Defaults
            const expandAll = paper.defaults?.expandedAll !== false; // Default to true
            if (expandAll) {
                // Traverse to find all nodes with solution details
                const collectIds = (nodes) => {
                    nodes.forEach(n => {
                        if (n.solutionBlock?.solutionDetails) state.expandedNodes.add(n.id);
                        if (n.children) collectIds(n.children);
                    });
                };
                if (paper.sections) paper.sections.forEach(s => collectIds(s.questions));
                else if (paper.questions) collectIds(paper.questions);
            }

            renderNav(paper);
            renderPaper(paper);
            
            // Update URL/History (Optional, good for reloading)
            // history.pushState({paper: key}, '', `?paper=${key}`);
        }

        // --- INIT ---

        async function init() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error("Failed to load payload");
                const payload = await response.json();
                
                state.papers = payload.papers;

                // Populate Selector
                els.paperSelect.innerHTML = '';
                state.papers.forEach(p => {
                    const opt = document.createElement('option');
                    opt.value = p.key;
                    opt.textContent = p.label;
                    els.paperSelect.appendChild(opt);
                });

                els.paperSelect.addEventListener('change', (e) => {
                    switchPaper(e.target.value);
                });

                // Events
                els.mobileJumpTrigger.addEventListener('click', () => toggleDrawer(true));
                els.drawerClose.addEventListener('click', () => toggleDrawer(false));
                els.mobileDrawerBackdrop.addEventListener('click', () => toggleDrawer(false));

                // Load Initial Paper (first one)
                if (state.papers.length > 0) {
                    switchPaper(state.papers[0].key);
                } else {
                    els.paperRegion.innerHTML = '<div class="p-8 text-center text-secondary">No papers found in payload.</div>';
                }

            } catch (err) {
                console.error(err);
                els.paperRegion.innerHTML = '<div class="p-8 text-center text-red-600 font-bold">PAPERS PAYLOAD MISSING</div>';
                els.paperSelect.innerHTML = '<option disabled>Error</option>';
            }
        }

        // Start
        init();

    </script>
</body>
</html>
