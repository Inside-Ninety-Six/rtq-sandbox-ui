<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"295","totalWithinVariant":"320","hueFamily":"blue","intensityMode":"high_chroma_surfaces","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-09T23:54:07.617Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;295&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;blue&quot;,&quot;intensityMode&quot;:&quot;high_chroma_surfaces&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-09T23:54:07.617Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer (Stage 6)</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- ColorLab Configuration: Blue Hue (250), High Chroma Surfaces -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // High Chroma Surfaces Configuration (Blue Hue Family ~250)
                        // L 0.94, C 0.07, H 250
                        page: 'oklch(0.94 0.07 250)', 
                        // L 0.92, C 0.08, H 250
                        frame: 'oklch(0.92 0.08 250)',
                        // L 0.97, C 0.035, H 250 (Tinted neutral)
                        paper: 'oklch(0.97 0.035 250)',
                        
                        // Text (Low Chroma)
                        primary: 'oklch(0.25 0.01 250)',
                        secondary: 'oklch(0.45 0.015 250)',
                        
                        // Accents (Restrained use)
                        // L 0.55, C 0.16, H 250
                        accent: 'oklch(0.55 0.16 250)',
                        accentHover: 'oklch(0.45 0.16 250)',

                        // Washes
                        // L 0.95, C 0.06, H 250
                        solutionWash: 'oklch(0.95 0.06 250)',
                        
                        // Borders
                        divider: 'oklch(0.85 0.02 250)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Reset & Typography */
        body {
            background-color: theme('colors.page');
            color: theme('colors.primary');
            font-family: theme('fontFamily.sans');
            -webkit-font-smoothing: antialiased;
            overflow-y: scroll; /* Force scrollbar to prevent layout shift */
        }

        /* KaTeX Containment Invariant - Critical */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            max-width: 100%;
            padding: 0.5em 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .katex-display::-webkit-scrollbar {
            display: none; /* Hide scrollbar WebKit */
        }
        
        /* Math block underlay permitted only on block elements, never inline */
        .katex-display > .katex {
            text-align: left; /* Alignment preference for workings */
            white-space: normal;
        }

        /* Inline SVG passthrough fixes */
        svg {
            max-width: 100%;
            height: auto;
        }

        /* Scrollbar Hiding for Navigation */
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Focus States (Accessibility) */
        *:focus-visible {
            outline: 2px solid theme('colors.accent');
            outline-offset: 2px;
        }

        /* Markdown Content Styling */
        .markdown-content p {
            margin-bottom: 0.75em;
            line-height: 1.6;
        }
        .markdown-content p:last-child {
            margin-bottom: 0;
        }
        .markdown-content ul {
            list-style-type: disc;
            padding-left: 1.25em;
            margin-bottom: 0.75em;
        }
        .markdown-content ol {
            list-style-type: decimal;
            padding-left: 1.25em;
            margin-bottom: 0.75em;
        }
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1em;
            font-size: 0.95em;
        }
        .markdown-content th, .markdown-content td {
            border: 1px solid theme('colors.divider');
            padding: 0.5em;
            text-align: left;
        }
        .markdown-content th {
            font-weight: 600;
            color: theme('colors.primary');
        }

        /* Drawer Transition */
        .drawer-enter { transform: translateX(-100%); }
        .drawer-enter-active { transform: translateX(0); transition: transform 300ms ease-out; }
        .drawer-exit { transform: translateX(0); }
        .drawer-exit-active { transform: translateX(-100%); transition: transform 200ms ease-in; }

        /* Disclosure Transition */
        .disclosure-enter { max-height: 0; opacity: 0; overflow: hidden; }
        .disclosure-enter-active { max-height: 2000px; opacity: 1; transition: all 400ms ease-in-out; }
        .disclosure-exit { max-height: 2000px; opacity: 1; overflow: hidden; }
        .disclosure-exit-active { max-height: 0; opacity: 0; transition: all 300ms ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">

        // --- STAGE 0: CONSTANTS ---
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // --- MARKDOWN SETUP ---
        const md = window.markdownit ? window.markdownit({
            html: true, // Allow inline SVG
            linkify: true,
            breaks: false, // CRITICAL: Must be false for KaTeX
            typographer: true
        }) : null;

        if (md) {
            md.inline.ruler.disable(['escape']); // Preserve TeX backslashes
        }

        // --- COMPONENTS ---

        // 1. Markdown Renderer Component
        const MarkdownRenderer = ({ content, className = "" }) => {
            const containerRef = React.useRef(null);

            React.useEffect(() => {
                if (containerRef.current && content) {
                    // 1. Render Markdown to HTML
                    const rawHtml = md ? md.render(content) : content;
                    containerRef.current.innerHTML = rawHtml;

                    // 2. Render KaTeX
                    renderMathInElement(containerRef.current, {
                        delimiters: [
                            {left: '$$', right: '$$', display: true},
                            {left: '$', right: '$', display: false},
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError: false,
                        trust: true // Allow basic HTML in math if needed
                    });
                }
            }, [content]);

            return <div ref={containerRef} className={`markdown-content ${className}`} />;
        };

        // 2. Icons
        const IconChevronDown = ({ className }) => (
            <svg className={className} width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z" fill="currentColor" fillRule="evenodd" clipRule="evenodd"></path></svg>
        );
        
        const IconMenu = ({ className }) => (
            <svg className={className} width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.5 3C1.22386 3 1 3.22386 1 3.5C1 3.77614 1.22386 4 1.5 4H13.5C13.7761 4 14 3.77614 14 3.5C14 3.22386 13.7761 3 13.5 3H1.5ZM1 7.5C1 7.22386 1.22386 7 1.5 7H13.5C13.7761 7 14 7.22386 14 7.5C14 7.77614 13.7761 8 13.5 8H1.5C1.22386 8 1 7.77614 1 7.5ZM1 11.5C1 11.2239 1.22386 11 1.5 11H13.5C13.7761 11 14 11.2239 14 11.5C14 11.7761 13.7761 12 13.5 12H1.5C1.22386 12 1 11.7761 1 11.5Z" fill="currentColor" fillRule="evenodd" clipRule="evenodd"></path></svg>
        );

        const IconClose = ({ className }) => (
             <svg className={className} width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.50001L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.50001L11.7816 4.03157Z" fill="currentColor" fillRule="evenodd" clipRule="evenodd"></path></svg>
        );

        // 3. Navigation Component (Desktop Rail & Drawer List)
        const NavigationList = ({ items, sections, onNavigate, activeId }) => {
            // Helper to render the list
            const renderItems = () => {
                // Scenario A: Sections exist
                if (sections && sections.length > 0) {
                    return sections.map((sec, idx) => (
                        <div key={`sec-${idx}`} className="mb-6">
                            {sec.label && sec.label.trim() !== "" && (
                                <div className="text-xs font-semibold text-secondary uppercase tracking-wider mb-2 px-3 border-b border-divider pb-1">
                                    {sec.label}
                                </div>
                            )}
                            <div className="flex flex-col gap-0.5">
                                {sec.questions.map(q => renderNavItem(q))}
                            </div>
                        </div>
                    ));
                }
                
                // Scenario B: Flat list
                return <div className="flex flex-col gap-0.5">{items.map(q => renderNavItem(q))}</div>;
            };

            const renderNavItem = (q) => {
                const isActive = activeId === q.id;
                // Type scale hierarchy based on ID length/structure logic (simulated)
                // Actually Stage 5.4.5 says no indentation, scale only. 
                // We keep it simple: flat list, identifier only.
                return (
                    <button
                        key={q.id}
                        onClick={() => onNavigate(q.id)}
                        className={`
                            text-left px-3 py-1.5 rounded-md text-sm transition-colors duration-200
                            ${isActive 
                                ? 'font-bold text-accent bg-accent/5' 
                                : 'text-secondary hover:text-primary hover:bg-black/5'}
                        `}
                    >
                        {q.id}
                    </button>
                );
            };

            return (
                <nav className="py-2" role="navigation">
                    {renderItems()}
                </nav>
            );
        };

        // 4. Solution Details Inner Blocks
        const SolutionDetailsContent = ({ details }) => {
            if (!details) return null;

            return (
                <div className="flex flex-col gap-6 pt-4">
                    {/* Keep in Mind */}
                    {details.keepInMind && (
                        <div className="bg-white/40 p-3 rounded-sm border-l-2 border-accent/30">
                            <div className="text-xs font-bold text-accent uppercase tracking-wide mb-2 flex items-center gap-2">
                                Keep in mind
                            </div>
                            <MarkdownRenderer content={details.keepInMind} className="text-sm text-primary/90" />
                        </div>
                    )}

                    {/* Formulas Used */}
                    {details.formulasUsed && (
                        <div className="mb-2">
                            <div className="text-xs font-bold text-secondary uppercase tracking-wide mb-1">
                                Formulas used
                            </div>
                            <div className="text-sm text-secondary">
                                <MarkdownRenderer content={details.formulasUsed} />
                            </div>
                        </div>
                    )}

                    {/* Working (Primary) */}
                    {details.working && (
                        <div>
                            <div className="text-xs font-bold text-secondary uppercase tracking-wide mb-2">
                                Working
                            </div>
                            <MarkdownRenderer content={details.working} className="text-base text-primary" />
                        </div>
                    )}

                    {/* Alternative Working */}
                    {details.alternativeWorking && Array.isArray(details.alternativeWorking) && details.alternativeWorking.map((alt, idx) => (
                         <div key={idx} className="mt-4 pt-4 border-t border-divider border-dashed">
                            <div className="text-xs font-bold text-secondary uppercase tracking-wide mb-2">
                                Alternative working
                            </div>
                            <MarkdownRenderer content={alt} className="text-base text-primary" />
                        </div>
                    ))}
                </div>
            );
        };

        // 5. Question Node Component
        const QuestionNode = ({ node, defaultExpanded }) => {
            const hasSolutionDetails = node.solutionBlock && node.solutionBlock.solutionDetails;
            const hasAnswer = node.solutionBlock && node.solutionBlock.answer;
            const hasSolutionBlock = hasAnswer || hasSolutionDetails;
            
            // Local toggle state
            const [isExpanded, setIsExpanded] = React.useState(defaultExpanded);

            return (
                <div id={`q-${node.id}`} className="mb-10 group scroll-mt-24">
                    {/* Question Node Surface (Optional visual cue, using subtle structure) */}
                    
                    {/* Question Body */}
                    <div className="mb-4">
                        <div className="flex items-baseline gap-3 mb-2">
                            <span className="text-lg font-bold text-secondary shrink-0 select-none opacity-60 w-8 text-right">
                                {node.id}
                            </span>
                            <div className="flex-1">
                                <MarkdownRenderer content={node.question} className="text-lg text-primary leading-relaxed" />
                            </div>
                        </div>
                    </div>

                    {/* Solution Block (If present) */}
                    {hasSolutionBlock && (
                        <div className="ml-11 pl-4 border-l border-divider/50">
                            
                            {/* Answer */}
                            {hasAnswer && (
                                <div className="mb-4">
                                    <span className="text-xs font-bold text-secondary uppercase tracking-wider block mb-1">Answer</span>
                                    <MarkdownRenderer content={node.solutionBlock.answer} className="text-base text-primary font-medium" />
                                </div>
                            )}

                            {/* Solution Details Toggle & Region */}
                            {hasSolutionDetails && (
                                <div className="mt-2">
                                    <button 
                                        onClick={() => setIsExpanded(!isExpanded)}
                                        className="text-sm font-medium text-accent hover:text-accentHover flex items-center gap-1.5 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-accent rounded-sm px-1 -ml-1 py-1"
                                        aria-expanded={isExpanded}
                                    >
                                        <span>{isExpanded ? "Hide working" : "Show working"}</span>
                                        <IconChevronDown className={`transition-transform duration-300 ${isExpanded ? "rotate-180" : ""}`} />
                                    </button>

                                    {isExpanded && (
                                        <div className="mt-3 bg-solutionWash p-5 rounded-md border border-divider/20 animate-[fadeIn_0.3s_ease-out]">
                                            <SolutionDetailsContent details={node.solutionBlock.solutionDetails} />
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    )}

                    {/* Children (Recursive) */}
                    {node.children && node.children.length > 0 && (
                        <div className="mt-6 ml-4 sm:ml-8 pl-4 border-l border-divider/30">
                            {node.children.map((child, idx) => (
                                <QuestionNode key={idx} node={child} defaultExpanded={defaultExpanded} />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // 6. Section Wrapper
        const SectionBlock = ({ section, defaultExpanded }) => {
            // If label is empty, just render questions. If not, render header.
            const showHeader = section.label && section.label.trim().length > 0;

            return (
                <div className="mb-12">
                    {showHeader && (
                        <div className="flex items-center gap-4 mb-8">
                            <h2 className="text-2xl font-bold text-secondary opacity-40">{section.label}</h2>
                            <div className="h-px bg-divider flex-1"></div>
                        </div>
                    )}
                    <div>
                        {section.questions.map((q, idx) => (
                            <QuestionNode key={q.id || idx} node={q} defaultExpanded={defaultExpanded} />
                        ))}
                    </div>
                </div>
            );
        };

        // 7. Navigation Drawer (Mobile)
        const NavigationDrawer = ({ isOpen, onClose, items, sections, activeId, onNavigate }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex justify-end md:hidden" role="dialog" aria-modal="true">
                    {/* Scrim */}
                    <div 
                        className="absolute inset-0 bg-black/20 backdrop-blur-sm transition-opacity" 
                        onClick={onClose}
                    ></div>
                    
                    {/* Drawer Surface */}
                    <div className="relative w-64 h-full bg-frame shadow-2xl flex flex-col border-l border-divider">
                        <div className="p-4 flex items-center justify-between border-b border-divider bg-page">
                            <h2 className="text-sm font-bold text-primary">Jump to</h2>
                            <button onClick={onClose} className="p-2 text-secondary hover:text-primary rounded-md">
                                <IconClose />
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 no-scrollbar bg-frame">
                            <NavigationList 
                                items={items} 
                                sections={sections}
                                activeId={activeId} 
                                onNavigate={(id) => { onNavigate(id); onClose(); }} 
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // 8. Document Frame Shell
        const DocumentFrameShell = ({ children, navContent, onMobileMenuClick }) => {
            return (
                <div className="max-w-7xl mx-auto flex flex-col md:flex-row min-h-screen bg-frame border-x border-divider shadow-sm">
                    {/* Mobile Header */}
                    <div className="md:hidden sticky top-0 z-40 bg-page/95 backdrop-blur border-b border-divider px-4 py-3 flex items-center justify-between">
                        <span className="text-sm font-semibold text-secondary">Paper Content</span>
                        <button 
                            onClick={onMobileMenuClick}
                            className="text-sm font-medium text-accent flex items-center gap-2 px-3 py-1.5 bg-accent/10 rounded-full"
                        >
                            <span>Jump to</span>
                            <IconMenu />
                        </button>
                    </div>

                    {/* Desktop Navigation Rail */}
                    <aside className="hidden md:block w-64 shrink-0 border-r border-divider bg-frame relative">
                        <div className="sticky top-0 h-screen overflow-y-auto py-8 px-4 no-scrollbar">
                            {navContent}
                        </div>
                    </aside>

                    {/* Paper Content Column */}
                    <main className="flex-1 min-w-0 bg-paper">
                        <div className="max-w-3xl mx-auto py-8 px-4 md:px-12">
                            {children}
                        </div>
                    </main>
                </div>
            );
        };

        // 9. Main Application
        const App = () => {
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(false);
            const [payload, setPayload] = React.useState(null);
            const [selectedPaperKey, setSelectedPaperKey] = React.useState(null);
            const [isDrawerOpen, setIsDrawerOpen] = React.useState(false);
            const [activeId, setActiveId] = React.useState(null); // Track active for highlighting

            // Fetch Payload
            React.useEffect(() => {
                const fetchPayload = async () => {
                    try {
                        const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                        if (!response.ok) throw new Error("Failed to load");
                        const data = await response.json();
                        setPayload(data);
                        if (data.papers && data.papers.length > 0) {
                            setSelectedPaperKey(data.papers[0].key);
                        }
                    } catch (err) {
                        console.error(err);
                        setError(true);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchPayload();
            }, []);

            // Helper to scroll to question
            const handleNavigate = (id) => {
                const el = document.getElementById(`q-${id}`);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    setActiveId(id);
                }
            };

            // Intersection Observer to update active ID on scroll
            React.useEffect(() => {
                if (!payload || !selectedPaperKey) return;
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            // q-ID -> ID
                            const id = entry.target.id.substring(2);
                            setActiveId(id);
                        }
                    });
                }, { rootMargin: '-10% 0px -80% 0px' });

                const ids = document.querySelectorAll('[id^="q-"]');
                ids.forEach(el => observer.observe(el));

                return () => observer.disconnect();
            }, [selectedPaperKey, payload]);

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-page text-secondary animate-pulse">
                        Loading Paper...
                    </div>
                );
            }

            if (error || !payload) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-page">
                        <div className="text-center p-8 bg-frame border border-divider rounded-lg max-w-md">
                            <h1 className="text-xl font-bold text-primary mb-2">PAPERS PAYLOAD MISSING</h1>
                            <p className="text-secondary text-sm">Unable to load content from canonical path.</p>
                        </div>
                    </div>
                );
            }

            const activePaper = payload.papers.find(p => p.key === selectedPaperKey) || payload.papers[0];
            const defaultExpanded = activePaper.defaults?.expandedAll ?? true;
            
            // Flatten logic for nav list generation
            const getAllQuestions = (nodes) => {
                let list = [];
                nodes.forEach(node => {
                    list.push({ id: node.id });
                    if (node.children) {
                        list = list.concat(getAllQuestions(node.children));
                    }
                });
                return list;
            };

            let flatNavList = [];
            let sectionNavStructure = [];

            if (activePaper.sections) {
                // Handle Sections
                activePaper.sections.forEach(sec => {
                    const qs = getAllQuestions(sec.questions);
                    sectionNavStructure.push({ label: sec.label, questions: qs });
                    flatNavList = flatNavList.concat(qs);
                });
            } else if (activePaper.questions) {
                // Handle Flat
                flatNavList = getAllQuestions(activePaper.questions);
            }

            return (
                <div className="min-h-screen bg-page text-primary font-sans antialiased">
                    
                    {/* Top Controls Surface (Unified with Shell) */}
                    <div className="bg-frame border-b border-divider">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between md:justify-start gap-4">
                            <div className="flex items-center gap-2">
                                <span className="text-sm font-semibold text-secondary">Paper:</span>
                                <select 
                                    className="bg-white border border-divider text-primary text-sm rounded-md px-3 py-1.5 focus:ring-2 focus:ring-accent focus:border-transparent outline-none"
                                    value={selectedPaperKey}
                                    onChange={(e) => setSelectedPaperKey(e.target.value)}
                                >
                                    {payload.papers.map(p => (
                                        <option key={p.key} value={p.key}>{p.label}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    <DocumentFrameShell 
                        navContent={
                            <NavigationList 
                                items={flatNavList} 
                                sections={sectionNavStructure}
                                activeId={activeId} 
                                onNavigate={handleNavigate} 
                            />
                        }
                        onMobileMenuClick={() => setIsDrawerOpen(true)}
                    >
                        {/* Paper Rendering */}
                        <div className="animate-[fadeIn_0.5s_ease-out]">
                            {/* Paper Title (Visual Anchor) */}
                            <div className="mb-12 pb-6 border-b border-divider">
                                <h1 className="text-3xl font-bold text-primary tracking-tight">{activePaper.label}</h1>
                                <p className="text-secondary mt-2">Exam Paper View â€¢ {flatNavList.length} Questions</p>
                            </div>

                            {/* Questions */}
                            {activePaper.sections ? (
                                activePaper.sections.map((sec, idx) => (
                                    <SectionBlock key={idx} section={sec} defaultExpanded={defaultExpanded} />
                                ))
                            ) : (
                                activePaper.questions.map((q, idx) => (
                                    <QuestionNode key={q.id || idx} node={q} defaultExpanded={defaultExpanded} />
                                ))
                            )}

                            {/* Footer Spacing */}
                            <div className="h-32 flex items-center justify-center text-sm text-secondary/50">
                                End of Document
                            </div>
                        </div>
                    </DocumentFrameShell>

                    {/* Mobile Navigation Drawer */}
                    <NavigationDrawer 
                        isOpen={isDrawerOpen} 
                        onClose={() => setIsDrawerOpen(false)} 
                        items={flatNavList}
                        sections={sectionNavStructure}
                        activeId={activeId}
                        onNavigate={handleNavigate}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
