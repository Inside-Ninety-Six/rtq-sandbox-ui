<!DOCTYPE html>
<html lang="en">
<head>
  <!-- RTQ_RUN {"generator":"rtq-prototype-batch","model":"gemini-3-pro-preview","prefix":"gemini.stage-12.1","variant":"ABC","indexWithinVariant":"160","totalWithinVariant":"320","hueFamily":"pink","intensityMode":"deep_theme","primaryHueFamily":"","secondaryHueFamily":"","dualIntensityMode":"","timestamp":"2026-01-09T17:30:35.897Z"} -->
  <meta name="rtq-run" content='{&quot;generator&quot;:&quot;rtq-prototype-batch&quot;,&quot;model&quot;:&quot;gemini-3-pro-preview&quot;,&quot;prefix&quot;:&quot;gemini.stage-12.1&quot;,&quot;variant&quot;:&quot;ABC&quot;,&quot;indexWithinVariant&quot;:&quot;160&quot;,&quot;totalWithinVariant&quot;:&quot;320&quot;,&quot;hueFamily&quot;:&quot;pink&quot;,&quot;intensityMode&quot;:&quot;deep_theme&quot;,&quot;primaryHueFamily&quot;:&quot;&quot;,&quot;secondaryHueFamily&quot;:&quot;&quot;,&quot;dualIntensityMode&quot;:&quot;&quot;,&quot;timestamp&quot;:&quot;2026-01-09T17:30:35.897Z&quot;}'>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ Maths Paper Solution Viewer</title>

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- LIBRARIES (SRI DISABLED per instructions) -->
    <!-- Tailwind CSS (via CDN for prototyping) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Markdown-it -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- CONFIGURATION & STYLES -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        page: 'var(--color-page-bg)',
                        frame: 'var(--color-frame-bg)',
                        paper: 'var(--color-paper-bg)',
                        txt: {
                            primary: 'var(--color-text-primary)',
                            secondary: 'var(--color-text-secondary)',
                            tertiary: 'var(--color-text-tertiary)',
                        },
                        accent: 'var(--color-accent)',
                        divider: 'var(--color-divider)',
                        wash: 'var(--color-wash)',
                    },
                    spacing: {
                        '18': '4.5rem',
                    }
                }
            }
        }
    </script>

    <style>
        /* COLORLAB B (PINK) + C (DEEP THEME) CONFIGURATION */
        /* Hue Family: Pink (approx 350) */
        /* Intensity Mode: deep_theme (Light Mode Only) */
        :root {
            /* Page Background: L~0.94, C~0.09 */
            --color-page-bg: oklch(0.94 0.09 350);
            
            /* Frame Base Surface: L~0.92, C~0.09 (Distinct from page) */
            --color-frame-bg: oklch(0.92 0.09 350);
            
            /* Paper Surface: L~0.97, C~0.07 */
            --color-paper-bg: oklch(0.97 0.07 350);
            
            /* Text - High Legibility, slight tint */
            --color-text-primary: oklch(0.25 0.015 350);
            --color-text-secondary: oklch(0.40 0.02 350);
            --color-text-tertiary: oklch(0.55 0.025 350); /* Nav idle */
            
            /* Accent - Restrained (Links, Focus, Controls) */
            --color-accent: oklch(0.55 0.20 350);
            
            /* Structural - Dividers */
            --color-divider: oklch(0.88 0.02 350);
            
            /* Surfaces - Solution Details Wash */
            --color-wash: oklch(0.955 0.05 350);
        }

        body {
            background-color: var(--color-page-bg);
            color: var(--color-text-primary);
            -webkit-font-smoothing: antialiased;
        }

        /* UTILITIES */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* KATEX CONTAINMENT INVARIANTS */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding-top: 0.2em;
            padding-bottom: 0.2em;
            max-width: 100%;
            -webkit-overflow-scrolling: touch;
        }
        /* No background on inline math */
        .katex {
            background-color: transparent !important;
        }
        /* Display math background allowed (quiet) if needed, using wash color here for consistency if blocked */
        .katex-display {
             /* Optional: could add very subtle underlay, but sticking to clean per brief */
        }

        /* MARKDOWN STYLING */
        .md-content p {
            margin-bottom: 0.75em;
            line-height: 1.6;
        }
        .md-content p:last-child {
            margin-bottom: 0;
        }
        .md-content ul {
            list-style-type: disc;
            padding-left: 1.25em;
            margin-bottom: 0.75em;
        }
        .md-content ol {
            list-style-type: decimal;
            padding-left: 1.25em;
            margin-bottom: 0.75em;
        }
        .md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
            font-size: 0.95em;
        }
        .md-content th, .md-content td {
            border: 1px solid var(--color-divider);
            padding: 0.5em 0.75em;
            text-align: left;
        }
        .md-content th {
            font-weight: 500;
            color: var(--color-text-primary);
        }

        /* FOCUS STATES */
        :focus-visible {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
            border-radius: 2px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pb-20">

    <!-- TOP CONTROLS AREA -->
    <div class="w-full max-w-7xl px-4 md:px-6 lg:px-8 mt-4 md:mt-8 mb-4 md:mb-6 flex items-center justify-between z-20 relative">
        <!-- Paper Selector -->
        <div class="relative">
            <select id="paper-selector" class="appearance-none bg-paper border border-divider text-txt-primary py-2 pl-3 pr-8 rounded text-sm font-medium focus:border-accent hover:border-txt-secondary transition-colors cursor-pointer shadow-sm">
                <option value="" disabled selected>Loading papers...</option>
            </select>
            <i data-lucide="chevron-down" class="absolute right-2.5 top-2.5 w-4 h-4 text-txt-secondary pointer-events-none"></i>
        </div>

        <!-- Mobile Jump To Trigger -->
        <button id="mobile-menu-trigger" class="lg:hidden flex items-center gap-2 text-txt-primary font-medium px-3 py-2 rounded hover:bg-black/5 transition-colors">
            <span class="text-sm">Jump to</span>
            <i data-lucide="menu" class="w-4 h-4"></i>
        </button>
    </div>

    <!-- DOCUMENT FRAME SHELL -->
    <div class="w-full max-w-7xl px-4 md:px-6 lg:px-8 flex-1 flex gap-8 items-start relative">
        
        <!-- DESKTOP NAVIGATION RAIL (Sticky) -->
        <nav class="hidden lg:block w-48 sticky top-8 max-h-[calc(100vh-4rem)] overflow-y-auto hide-scrollbar shrink-0 pt-2">
            <div id="desktop-nav-list" class="flex flex-col gap-1 pb-10">
                <!-- Nav items injected here -->
            </div>
        </nav>

        <!-- PAPER CONTENT COLUMN -->
        <main class="flex-1 min-w-0 w-full bg-paper shadow-sm border border-divider/50 rounded-sm min-h-[80vh] relative">
            
            <!-- Paper Content Container -->
            <div id="paper-content" class="p-6 md:p-10 lg:p-12">
                <!-- Content injected here -->
                <div class="flex items-center justify-center h-40 text-txt-secondary animate-pulse">
                    Loading payload...
                </div>
            </div>

        </main>
    </div>

    <!-- MOBILE NAVIGATION DRAWER -->
    <div id="mobile-drawer-backdrop" class="fixed inset-0 bg-black/20 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-200"></div>
    <div id="mobile-drawer" class="fixed inset-y-0 right-0 w-72 bg-frame shadow-xl z-50 transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-4 border-b border-divider flex items-center justify-between bg-paper">
            <h2 class="font-medium text-txt-primary">Jump to</h2>
            <button id="mobile-drawer-close" class="p-2 text-txt-secondary hover:text-txt-primary rounded hover:bg-black/5">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
        <div id="mobile-nav-list" class="flex-1 overflow-y-auto p-4 flex flex-col gap-1 bg-paper">
            <!-- Mobile nav items injected here -->
        </div>
    </div>

    <!-- SCRIPT LOGIC -->
    <script>
        // --- STAGE 0: CONSTANTS ---
        const RTQ_PAPERS_PAYLOAD_PATH = "../../../payload/rtq.papers.payload.v2.json";
        const RTQ_SHADCN_TOKEN_PROFILES_PATH = "../../../payload/rtq.shadcn.token.profiles.v1.json";

        // --- GLOBAL STATE ---
        let appState = {
            papers: [],
            currentPaperKey: null,
            expandedNodes: new Set() // Tracks IDs of question nodes with Expanded Solution Details
        };

        // --- MARKDOWN CONFIGURATION (STAGE 6 HARD RULES) ---
        const md = window.markdownit ? window.markdownit({
            html: true,
            linkify: true,
            breaks: false, // Must be false for KaTeX
            typographer: true
        }) : null;

        if (md) {
            md.inline.ruler.disable(['escape']); // Preserve TeX backslashes
        }

        // --- DOM ELEMENTS ---
        const els = {
            selector: document.getElementById('paper-selector'),
            content: document.getElementById('paper-content'),
            desktopNav: document.getElementById('desktop-nav-list'),
            mobileNav: document.getElementById('mobile-nav-list'),
            mobileTrigger: document.getElementById('mobile-menu-trigger'),
            mobileDrawer: document.getElementById('mobile-drawer'),
            mobileBackdrop: document.getElementById('mobile-drawer-backdrop'),
            mobileClose: document.getElementById('mobile-drawer-close'),
        };

        // --- INITIALIZATION ---
        async function init() {
            try {
                const response = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!response.ok) throw new Error("Payload missing");
                const payload = await response.json();
                
                appState.papers = payload.papers || [];
                if (appState.papers.length === 0) throw new Error("No papers in payload");

                renderSelector();
                
                // Select first paper by default
                switchPaper(appState.papers[0].key);

            } catch (e) {
                console.error(e);
                els.content.innerHTML = `<div class="text-center py-20 text-txt-secondary font-medium">PAPERS PAYLOAD MISSING</div>`;
                els.selector.innerHTML = `<option>Error loading</option>`;
                els.selector.disabled = true;
            }
        }

        // --- RENDER SELECTOR ---
        function renderSelector() {
            els.selector.innerHTML = appState.papers.map(p => 
                `<option value="${p.key}">${p.label || p.key}</option>`
            ).join('');
            
            els.selector.addEventListener('change', (e) => {
                switchPaper(e.target.value);
            });
        }

        // --- SWITCH PAPER ---
        function switchPaper(paperKey) {
            const paper = appState.papers.find(p => p.key === paperKey);
            if (!paper) return;

            appState.currentPaperKey = paperKey;
            
            // Handle defaults
            const expandAll = paper.defaults?.expandedAll !== false; // Default true unless false
            
            // Reset expanded state map based on paper structure
            appState.expandedNodes.clear();
            // Note: In a real app we might traverse and set based on expandAll. 
            // Here we'll treat "expandAll=true" as the default check when rendering.
            // If expandAll is false, we start empty. If true, we assume expanded unless explicitly toggled off.
            // For simplicity in this prototype: strict set tracking.
            
            // Pre-calculate expanded set if default is true is complex without traversal, 
            // so let's traverse the items to set initial state.
            const allNodes = [];
            const collectNodes = (list) => {
                list.forEach(item => {
                    if (item.id) allNodes.push(item);
                    if (item.children) collectNodes(item.children);
                    if (item.questions) collectNodes(item.questions); // Section handling
                });
            };
            
            if (paper.questions) collectNodes(paper.questions);
            if (paper.sections) paper.sections.forEach(s => collectNodes(s.questions));

            if (expandAll) {
                allNodes.forEach(node => {
                    if (node.solutionBlock?.solutionDetails) {
                        appState.expandedNodes.add(node.id);
                    }
                });
            }

            renderPaper(paper);
            renderNavigation(paper);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'instant' });
            
            // Re-run icons and KaTeX
            lucide.createIcons();
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }

        // --- RENDER NAVIGATION ---
        function renderNavigation(paper) {
            const createNavHTML = (isMobile) => {
                let html = '';

                // Handle flat paper vs sectioned paper
                if (paper.sections) {
                    paper.sections.forEach(section => {
                        // Section Header (only if label exists)
                        if (section.label && section.label.trim().length > 0) {
                            html += `<div class="text-xs font-semibold text-txt-secondary uppercase tracking-wider mt-4 mb-2 pl-2 opacity-80 select-none">${section.label}</div>`;
                        } else if (html.length > 0) {
                            // Spacing if unnamed section follows content
                            html += `<div class="mt-4"></div>`;
                        }
                        
                        // Questions
                        section.questions.forEach(q => {
                            html += renderNavNode(q, isMobile);
                        });
                    });
                } else if (paper.questions) {
                    paper.questions.forEach(q => {
                        html += renderNavNode(q, isMobile);
                    });
                }
                return html;
            };

            const desktopHTML = createNavHTML(false);
            const mobileHTML = createNavHTML(true);

            els.desktopNav.innerHTML = desktopHTML;
            els.mobileNav.innerHTML = mobileHTML;

            // Add click listeners for smooth scroll
            const attachListeners = (container) => {
                container.querySelectorAll('[data-nav-target]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const targetId = btn.getAttribute('data-nav-target');
                        const el = document.getElementById(`q-${targetId}`);
                        if (el) {
                            // Offset for sticky header/spacing
                            const y = el.getBoundingClientRect().top + window.scrollY - 80;
                            window.scrollTo({top: y, behavior: 'smooth'});
                            
                            // Close mobile drawer if open
                            if (container === els.mobileNav) closeDrawer();
                        }
                    });
                });
            };

            attachListeners(els.desktopNav);
            attachListeners(els.mobileNav);
        }

        function renderNavNode(node, isMobile) {
            // Flat list, hierarchy via type scale/quietness
            // We need to know depth for styling. Since recursive structure is allowed:
            // The payload is strictly the source.
            // However, the nav rendering here is simple sequential.
            // To handle depth visual cues properly without complex recursion in string building,
            // we'll output the top level here. 
            // Wait, the Brief says navigation reflects the structure.
            // We need a recursive helper that knows depth.
            
            let html = '';
            
            const renderItem = (n, depth = 0) => {
                // Typography scale based on depth
                // Depth 0: Base
                // Depth 1: Quieter/Smaller
                const isTop = depth === 0;
                const classes = isTop 
                    ? "text-sm text-txt-secondary hover:text-accent font-medium" 
                    : "text-xs text-txt-secondary/70 hover:text-accent font-normal";
                
                const activeMarker = ""; // Logic for active scroll spy could go here later
                
                html += `
                    <button data-nav-target="${n.id}" class="w-full text-left py-1 pl-2 border-l-2 border-transparent hover:border-accent/30 transition-colors ${classes} truncate">
                        ${n.id}
                    </button>
                `;

                if (n.children && n.children.length > 0) {
                    n.children.forEach(c => renderItem(c, depth + 1));
                }
            };

            renderItem(node);
            return html;
        }

        // --- RENDER PAPER CONTENT ---
        function renderPaper(paper) {
            let html = '';

            if (paper.sections) {
                paper.sections.forEach((section, idx) => {
                    html += `<section class="mb-12">`;
                    if (section.label && section.label.trim().length > 0) {
                        html += `
                            <div class="flex items-center gap-4 mb-8">
                                <h2 class="text-lg font-semibold text-txt-secondary uppercase tracking-widest">${section.label}</h2>
                                <div class="h-px bg-divider flex-1"></div>
                            </div>
                        `;
                    }
                    html += `<div class="flex flex-col gap-12">`; // Spacing between top level questions
                    section.questions.forEach(q => {
                        html += renderQuestionNode(q, 0);
                    });
                    html += `</div>`;
                    html += `</section>`;
                });
            } else if (paper.questions) {
                html += `<div class="flex flex-col gap-12">`;
                paper.questions.forEach(q => {
                    html += renderQuestionNode(q, 0);
                });
                html += `</div>`;
            }

            els.content.innerHTML = html;

            // Attach event listeners for disclosure
            els.content.querySelectorAll('[data-toggle-id]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const nodeId = btn.getAttribute('data-toggle-id');
                    toggleSolution(nodeId);
                });
            });
        }

        function renderQuestionNode(node, depth) {
            const isTopLevel = depth === 0;
            const hasSolutionBlock = !!node.solutionBlock;
            const hasAnswer = hasSolutionBlock && !!node.solutionBlock.answer;
            const hasDetails = hasSolutionBlock && !!node.solutionBlock.solutionDetails;
            const isExpanded = appState.expandedNodes.has(node.id);

            // Container classes
            // Top level: strong separation (handled by parent gap).
            // Children: indentation via padding-left + vertical spacing.
            const indentClass = depth > 0 ? "ml-4 md:ml-8 mt-6 border-l border-divider/50 pl-4 md:pl-6" : "";
            
            let html = `
                <div id="q-${node.id}" class="group relative ${indentClass}">
                    <!-- Question Body -->
                    <div class="flex items-baseline gap-3 mb-4">
                        <span class="text-sm font-semibold text-txt-tertiary select-none shrink-0" aria-hidden="true">${node.id}</span>
                        <div class="md-content text-lg text-txt-primary font-medium leading-relaxed max-w-none">
                            ${renderMarkdown(node.question)}
                        </div>
                    </div>
            `;

            if (hasSolutionBlock) {
                html += `<div class="ml-0 md:ml-8 pl-0 border-l-0 md:border-l-2 md:border-transparent">`; // Alignment wrapper

                // Answer
                if (hasAnswer) {
                    html += `
                        <div class="mb-4">
                            <div class="text-xs font-bold text-txt-secondary uppercase tracking-wide mb-1">Answer</div>
                            <div class="md-content text-base text-txt-primary">
                                ${renderMarkdown(node.solutionBlock.answer)}
                            </div>
                        </div>
                    `;
                }

                // Solution Details Toggle + Region
                if (hasDetails) {
                    const btnLabel = isExpanded ? "Hide working" : "Show working";
                    const btnIconRot = isExpanded ? "rotate-180" : "";
                    
                    html += `
                        <div class="mt-4">
                            <button data-toggle-id="${node.id}" class="flex items-center gap-2 text-sm font-medium text-accent hover:text-accent/80 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-accent rounded px-1 -ml-1 py-1">
                                <span>${btnLabel}</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-200 ${btnIconRot}"></i>
                            </button>

                            ${isExpanded ? renderSolutionDetails(node.solutionBlock.solutionDetails) : ''}
                        </div>
                    `;
                }
                
                html += `</div>`; // End alignment wrapper
            }

            // Children
            if (node.children && node.children.length > 0) {
                html += `<div class="mt-4">`;
                node.children.forEach(child => {
                    html += renderQuestionNode(child, depth + 1);
                });
                html += `</div>`;
            }

            html += `</div>`; // End Node
            return html;
        }

        function renderSolutionDetails(details) {
            let html = `
                <div class="mt-4 pl-4 border-l-2 border-divider bg-wash/50 rounded-r-sm py-4 pr-4 animate-in fade-in slide-in-from-top-1 duration-200">
            `;

            // Order: Keep in mind -> Formulas -> Working -> Alt Working
            
            // Keep In Mind
            if (details.keepInMind) {
                html += `
                    <div class="mb-6">
                        <div class="flex items-center gap-2 mb-2 text-txt-secondary">
                            <i data-lucide="lightbulb" class="w-4 h-4"></i>
                            <span class="text-xs font-bold uppercase tracking-wide">Keep in mind</span>
                        </div>
                        <div class="md-content text-sm text-txt-primary">
                            ${renderMarkdown(details.keepInMind)}
                        </div>
                    </div>
                `;
            }

            // Formulas Used
            if (details.formulasUsed) {
                html += `
                    <div class="mb-6">
                        <div class="text-xs font-bold text-txt-secondary uppercase tracking-wide mb-2">Formulas used</div>
                        <div class="md-content text-sm text-txt-primary">
                            ${renderMarkdown(details.formulasUsed)}
                        </div>
                    </div>
                `;
            }

            // Working (Primary)
            if (details.working) {
                html += `
                    <div class="mb-6">
                        <div class="text-xs font-bold text-txt-secondary uppercase tracking-wide mb-2">Working</div>
                        <div class="md-content text-base text-txt-primary space-y-4">
                            ${renderMarkdown(details.working)}
                        </div>
                    </div>
                `;
            }

            // Alternative Working
            if (details.alternativeWorking && Array.isArray(details.alternativeWorking)) {
                details.alternativeWorking.forEach((alt, idx) => {
                    html += `
                        <div class="mt-8 pt-6 border-t border-divider border-dashed">
                            <div class="text-xs font-bold text-txt-secondary uppercase tracking-wide mb-2">Alternative working</div>
                            <div class="md-content text-base text-txt-primary">
                                ${renderMarkdown(alt)}
                            </div>
                        </div>
                    `;
                });
            } else if (typeof details.alternativeWorking === 'string') {
                 html += `
                        <div class="mt-8 pt-6 border-t border-divider border-dashed">
                            <div class="text-xs font-bold text-txt-secondary uppercase tracking-wide mb-2">Alternative working</div>
                            <div class="md-content text-base text-txt-primary">
                                ${renderMarkdown(details.alternativeWorking)}
                            </div>
                        </div>
                    `;
            }

            html += `</div>`;
            return html;
        }

        function renderMarkdown(text) {
            if (!text) return '';
            if (!md) return text; // Fallback
            return md.render(text);
        }

        function toggleSolution(nodeId) {
            if (appState.expandedNodes.has(nodeId)) {
                appState.expandedNodes.delete(nodeId);
            } else {
                appState.expandedNodes.add(nodeId);
            }
            
            // Re-render paper to reflect state
            // Optimization: Find the node and just re-render that bit? 
            // For prototype robustness, we'll re-render the whole paper to keep ID sync simple.
            // But preserving scroll is tricky if we re-render all.
            // Better: find the specific node in the DOM and replace it?
            // Actually, for this prototype, re-rendering the specific question block is safer but complex logic to find the data node.
            
            // Let's just find the paper object again.
            const paper = appState.papers.find(p => p.key === appState.currentPaperKey);
            
            // Save scroll position
            const scrollY = window.scrollY;
            
            renderPaper(paper);
            
            // Restore scroll - rough approximation, might jump slightly due to height change
            // Ideally we want to maintain the relative position of the toggled element if collapsing.
            // If expanding, maintain top.
            // Since we are top-anchored, standard restore should be okay-ish.
            window.scrollTo({top: scrollY, behavior: 'instant'});

            lucide.createIcons();
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        }

        // --- MOBILE DRAWER LOGIC ---
        function openDrawer() {
            els.mobileBackdrop.classList.remove('hidden');
            // small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                els.mobileBackdrop.classList.remove('opacity-0');
                els.mobileDrawer.classList.remove('translate-x-full');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function closeDrawer() {
            els.mobileBackdrop.classList.add('opacity-0');
            els.mobileDrawer.classList.add('translate-x-full');
            setTimeout(() => {
                els.mobileBackdrop.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        els.mobileTrigger.addEventListener('click', openDrawer);
        els.mobileClose.addEventListener('click', closeDrawer);
        els.mobileBackdrop.addEventListener('click', closeDrawer);

        // --- BOOTSTRAP ---
        // Initialize Lucide
        lucide.createIcons();
        // Start App
        init();

    </script>
</body>
</html>
