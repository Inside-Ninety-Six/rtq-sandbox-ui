<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ â€“ Maths Paper Solution Viewer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-page: #f8f7f5;
            --surface-paper: #ffffff;
            --surface-solution: #fafaf9;
            --text-primary: #2a2726;
            --text-secondary: #4a4745;
            --text-tertiary: #6b6866;
            --text-quiet: #8a8784;
            --line-subtle: #e8e6e3;
            --line-medium: #d4d2cf;
            --accent: #5b7c99;
            --accent-hover: #4a6680;
            --math-bg: #f5f4f2;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-page);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-shell {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .top-controls {
            background: var(--surface-paper);
            border-bottom: 1px solid var(--line-subtle);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top-controls-inner {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .paper-selector-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .paper-selector {
            padding: 6px 12px;
            border: 1px solid var(--line-medium);
            border-radius: 4px;
            background: var(--surface-paper);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            font-family: inherit;
        }

        .paper-selector:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .mobile-nav-trigger {
            display: none;
            padding: 8px 14px;
            background: transparent;
            border: 1px solid var(--line-medium);
            border-radius: 4px;
            color: var(--accent);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            margin-left: auto;
        }

        .mobile-nav-trigger:hover {
            text-decoration: underline;
        }

        .mobile-nav-trigger:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .content-frame {
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 32px;
            flex: 1;
            display: flex;
            gap: 48px;
            position: relative;
            background: var(--surface-paper);
        }

        .nav-rail {
            width: 180px;
            flex-shrink: 0;
            position: sticky;
            top: 72px;
            align-self: flex-start;
            max-height: calc(100vh - 88px);
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 32px 0;
        }

        .nav-rail::-webkit-scrollbar {
            display: none;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            padding: 6px 0;
            color: var(--text-quiet);
            font-size: 14px;
            cursor: pointer;
            transition: none;
        }

        .nav-item:hover {
            text-decoration: underline;
            color: var(--text-tertiary);
        }

        .nav-item:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
            border-radius: 2px;
        }

        .nav-item[aria-current="true"] {
            font-weight: 600;
        }

        .nav-section-label {
            padding: 12px 0 6px 0;
            color: var(--text-tertiary);
            font-size: 13px;
            font-weight: 500;
            pointer-events: none;
        }

        .nav-item-nested {
            padding-left: 16px;
        }

        .nav-item-nested-2 {
            padding-left: 32px;
        }

        .paper-content {
            flex: 1;
            min-width: 0;
            padding: 48px 0 96px 0;
        }

        .question-block {
            margin-bottom: 64px;
        }

        .question-block-nested {
            margin-bottom: 40px;
            margin-left: 24px;
        }

        .question-block-nested-2 {
            margin-bottom: 32px;
            margin-left: 24px;
        }

        .question-header {
            margin-bottom: 24px;
        }

        .question-id {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 15px;
            margin-right: 8px;
        }

        .question-text {
            font-size: 17px;
            line-height: 1.65;
            color: var(--text-primary);
            display: inline;
        }

        .question-text p {
            margin-bottom: 12px;
        }

        .question-text p:last-child {
            margin-bottom: 0;
        }

        .answer-block {
            margin-bottom: 20px;
        }

        .answer-label {
            font-weight: 600;
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .answer-value {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .solution-details-toggle {
            background: transparent;
            border: none;
            padding: 0;
            color: var(--accent);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: inherit;
            margin-bottom: 16px;
        }

        .solution-details-toggle:hover {
            text-decoration: underline;
            color: var(--accent-hover);
        }

        .solution-details-toggle:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
            border-radius: 2px;
        }

        .chevron {
            display: inline-block;
            width: 12px;
            height: 12px;
            transition: transform 0.15s ease;
        }

        .chevron-down {
            transform: rotate(0deg);
        }

        .chevron-up {
            transform: rotate(180deg);
        }

        .solution-details {
            display: none;
            background: var(--surface-solution);
            padding: 24px;
            margin-top: 16px;
            border-top: 1px solid var(--line-subtle);
        }

        .solution-details.expanded {
            display: block;
        }

        .solution-subsection {
            margin-bottom: 24px;
        }

        .solution-subsection:last-child {
            margin-bottom: 0;
        }

        .subsection-label {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .keep-in-mind .subsection-label {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .keep-in-mind-icon {
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
        }

        .subsection-content {
            font-size: 14px;
            line-height: 1.65;
            color: var(--text-secondary);
        }

        .keep-in-mind .subsection-content {
            color: var(--text-primary);
        }

        .subsection-content p {
            margin-bottom: 10px;
        }

        .subsection-content p:last-child {
            margin-bottom: 0;
        }

        .subsection-content ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }

        .subsection-content ul:last-child {
            margin-bottom: 0;
        }

        .subsection-content li {
            margin-bottom: 6px;
        }

        .formulas-used {
            padding-top: 4px;
        }

        .formulas-used .subsection-content {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .working-content {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        .working-content p {
            margin-bottom: 14px;
        }

        .working-content p:last-child {
            margin-bottom: 0;
        }

        .working-content .katex-display {
            background: var(--math-bg);
            padding: 12px 16px;
            margin: 16px 0;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--line-medium) transparent;
        }

        .working-content .katex-display::-webkit-scrollbar {
            height: 6px;
        }

        .working-content .katex-display::-webkit-scrollbar-track {
            background: transparent;
        }

        .working-content .katex-display::-webkit-scrollbar-thumb {
            background: var(--line-medium);
            border-radius: 3px;
        }

        .working-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
            overflow-x: auto;
            display: block;
        }

        .working-content table thead {
            font-weight: 500;
        }

        .working-content table th,
        .working-content table td {
            border: 1px solid var(--line-subtle);
            padding: 8px 12px;
            text-align: left;
        }

        .alternative-working {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--line-subtle);
        }

        .mobile-nav-drawer {
            display: none;
        }

        .mobile-nav-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 200;
            display: none;
        }

        .mobile-nav-backdrop.open {
            display: block;
        }

        .mobile-nav-panel {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 280px;
            background: var(--surface-paper);
            z-index: 201;
            padding: 24px;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.2s ease;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .mobile-nav-panel::-webkit-scrollbar {
            display: none;
        }

        .mobile-nav-panel.open {
            transform: translateX(0);
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .mobile-nav-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .mobile-nav-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            font-size: 24px;
            line-height: 1;
        }

        .mobile-nav-close:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
            border-radius: 2px;
        }

        .failure-message {
            text-align: center;
            padding: 96px 32px;
            color: var(--text-secondary);
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .top-controls-inner {
                padding: 0 16px;
            }

            .mobile-nav-trigger {
                display: block;
            }

            .content-frame {
                padding: 0 16px;
            }

            .nav-rail {
                display: none;
            }

            .mobile-nav-drawer {
                display: block;
            }

            .paper-content {
                padding: 32px 0 64px 0;
            }

            .question-block {
                margin-bottom: 48px;
            }

            .question-block-nested {
                margin-left: 16px;
                margin-bottom: 32px;
            }

            .question-block-nested-2 {
                margin-left: 16px;
                margin-bottom: 24px;
            }

            .solution-details {
                padding: 16px;
            }
        }

        @media (prefers-reduced-motion: reduce) {

            .chevron,
            .mobile-nav-panel {
                transition: none;
            }
        }
    </style>
</head>

<body>

    <div class="app-shell">
        <div class="top-controls">
            <div class="top-controls-inner">
                <label class="paper-selector-label" for="paperSelect">Paper:</label>
                <select id="paperSelect" class="paper-selector"></select>
                <button id="mobileNavTrigger" class="mobile-nav-trigger">Jump to</button>
            </div>
        </div>

        <div class="content-frame">
            <nav class="nav-rail" aria-label="Question navigation">
                <ul id="desktopNav" class="nav-list"></ul>
            </nav>

            <main class="paper-content" id="paperContent"></main>
        </div>
    </div>

    <div class="mobile-nav-drawer">
        <div id="mobileNavBackdrop" class="mobile-nav-backdrop"></div>
        <nav class="mobile-nav-panel" id="mobileNavPanel" aria-label="Question navigation">
            <div class="mobile-nav-header">
                <div class="mobile-nav-title">Jump to</div>
                <button id="mobileNavClose" class="mobile-nav-close" aria-label="Close navigation">&times;</button>
            </div>
            <ul id="mobileNav" class="nav-list"></ul>
        </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        const RTQ_PAPERS_PAYLOAD_PATH = "../../payload/rtq.papers.payload.json";

        const md = window.markdownit ? window.markdownit({
            html: true,
            linkify: true,
            breaks: false,
        }) : null;

        if (md) {
            md.inline.ruler.disable(['escape']);
        }

        let __rtqNavObserver = null;
        let __rtqVisibleMap = new Map();

        function setCurrentNav(id) {
            document.querySelectorAll('[data-nav-id][aria-current="true"]').forEach(el => el.removeAttribute('aria-current'));
            document.querySelectorAll(`[data-nav-id="${CSS.escape(id)}"]`).forEach(el => el.setAttribute('aria-current', 'true'));
        }

        function bindNav(container) {
            if (!container || container.__rtqBound) return;
            container.__rtqBound = true;

            container.addEventListener('click', e => {
                const item = e.target.closest('[data-nav-id]');
                if (!item) return;

                const targetId = item.getAttribute('data-nav-id');
                const targetEl = document.getElementById(targetId);
                if (targetEl) {
                    targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    closeMobileNav();
                }
            });
        }

        function enableScrollSpy(questionEls) {
            if (__rtqNavObserver) __rtqNavObserver.disconnect();
            __rtqVisibleMap.clear();

            __rtqNavObserver = new IntersectionObserver(entries => {
                entries.forEach(en => {
                    const id = en.target && en.target.id;
                    if (!id) return;
                    if (en.isIntersecting) {
                        __rtqVisibleMap.set(id, en.boundingClientRect.top);
                    } else {
                        __rtqVisibleMap.delete(id);
                    }
                });

                if (!__rtqVisibleMap.size) return;

                let bestId = null;
                let bestTop = Infinity;
                for (const [id, top] of __rtqVisibleMap.entries()) {
                    if (top < bestTop) {
                        bestTop = top;
                        bestId = id;
                    }
                }
                if (bestId) setCurrentNav(bestId);
            }, {
                root: null,
                threshold: [0.15, 0.25, 0.5],
                rootMargin: '0px 0px -70% 0px'
            });

            questionEls.forEach(el => __rtqNavObserver.observe(el));

            if (questionEls.length && questionEls[0].id) setCurrentNav(questionEls[0].id);
        }

        let currentPayload = null;
        let currentPaper = null;

        async function loadPayload() {
            try {
                const res = await fetch(RTQ_PAPERS_PAYLOAD_PATH);
                if (!res.ok) throw new Error('Failed to load payload');
                currentPayload = await res.json();
                populatePaperSelector();
                if (currentPayload.papers && currentPayload.papers.length > 0) {
                    loadPaper(currentPayload.papers[0].key);
                }
            } catch (err) {
                console.error('Payload load error:', err);
                document.getElementById('paperContent').innerHTML = '<div class="failure-message">PAPERS PAYLOAD MISSING</div>';
            }
        }

        function populatePaperSelector() {
            const select = document.getElementById('paperSelect');
            select.innerHTML = '';
            if (!currentPayload || !currentPayload.papers) return;

            currentPayload.papers.forEach(paper => {
                const opt = document.createElement('option');
                opt.value = paper.key;
                opt.textContent = paper.label;
                select.appendChild(opt);
            });

            select.addEventListener('change', () => {
                loadPaper(select.value);
            });
        }

        function loadPaper(key) {
            if (!currentPayload || !currentPayload.papers) return;
            currentPaper = currentPayload.papers.find(p => p.key === key);
            if (!currentPaper) return;

            document.getElementById('paperSelect').value = key;

            renderPaper();
            renderNavigation();

            const questionEls = Array.from(document.querySelectorAll('[data-question-id]'));

            const desktopNavEl = document.getElementById('desktopNav');
            const mobileNavEl = document.getElementById('mobileNav');

            desktopNavEl.__rtqBound = false;
            mobileNavEl.__rtqBound = false;

            bindNav(desktopNavEl);
            bindNav(mobileNavEl);
            enableScrollSpy(questionEls);
        }

        function renderPaper() {
            const content = document.getElementById('paperContent');
            content.innerHTML = '';

            if (!currentPaper) return;

            const expandedAll = currentPaper.defaults && currentPaper.defaults.expandedAll;

            if (currentPaper.sections) {
                currentPaper.sections.forEach(section => {
                    section.questions.forEach(q => {
                        content.appendChild(renderQuestion(q, 0, expandedAll));
                    });
                });
            } else if (currentPaper.questions) {
                currentPaper.questions.forEach(q => {
                    content.appendChild(renderQuestion(q, 0, expandedAll));
                });
            }

            if (window.renderMathInElement) {
                renderMathInElement(content, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ],
                    throwOnError: false
                });
            }
        }

        function renderQuestion(q, depth, expandedAll) {
            const block = document.createElement('div');
            block.className = depth === 0 ? 'question-block' : (depth === 1 ? 'question-block-nested' : 'question-block-nested-2');
            block.id = q.id;
            block.setAttribute('data-question-id', q.id);

            const header = document.createElement('div');
            header.className = 'question-header';

            const idSpan = document.createElement('span');
            idSpan.className = 'question-id';
            idSpan.textContent = q.id;

            const textSpan = document.createElement('span');
            textSpan.className = 'question-text';
            textSpan.innerHTML = md ? md.render(q.question) : q.question;

            header.appendChild(idSpan);
            header.appendChild(textSpan);
            block.appendChild(header);

            const answerBlock = document.createElement('div');
            answerBlock.className = 'answer-block';

            const answerLabel = document.createElement('div');
            answerLabel.className = 'answer-label';
            answerLabel.textContent = 'Answer';

            const answerValue = document.createElement('div');
            answerValue.className = 'answer-value';
            answerValue.innerHTML = md ? md.render(q.answer) : q.answer;

            answerBlock.appendChild(answerLabel);
            answerBlock.appendChild(answerValue);
            block.appendChild(answerBlock);

            if (q.solutionDetails) {
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'solution-details-toggle';
                toggleBtn.innerHTML = `
      <span class="toggle-text">Show working</span>
      <svg class="chevron chevron-down" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M2 4l4 4 4-4"/>
      </svg>
    `;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'solution-details';
                if (expandedAll) {
                    detailsDiv.classList.add('expanded');
                    toggleBtn.querySelector('.toggle-text').textContent = 'Hide working';
                    toggleBtn.querySelector('.chevron').classList.remove('chevron-down');
                    toggleBtn.querySelector('.chevron').classList.add('chevron-up');
                }

                toggleBtn.addEventListener('click', () => {
                    const isExpanded = detailsDiv.classList.contains('expanded');
                    detailsDiv.classList.toggle('expanded');
                    toggleBtn.querySelector('.toggle-text').textContent = isExpanded ? 'Show working' : 'Hide working';
                    toggleBtn.querySelector('.chevron').classList.toggle('chevron-down');
                    toggleBtn.querySelector('.chevron').classList.toggle('chevron-up');
                });

                if (q.solutionDetails.keepInMind) {
                    const keepInMind = document.createElement('div');
                    keepInMind.className = 'solution-subsection keep-in-mind';
                    keepInMind.innerHTML = `
        <div class="subsection-label">
          <svg class="keep-in-mind-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="8" cy="8" r="6"/>
            <path d="M8 5v3M8 11h0"/>
          </svg>
          Keep in mind
        </div>
        <div class="subsection-content">${md ? md.render(q.solutionDetails.keepInMind) : q.solutionDetails.keepInMind}</div>
      `;
                    detailsDiv.appendChild(keepInMind);
                }

                if (q.solutionDetails.formulasUsed) {
                    const formulas = document.createElement('div');
                    formulas.className = 'solution-subsection formulas-used';
                    formulas.innerHTML = `
        <div class="subsection-label">Formulas used</div>
        <div class="subsection-content">${md ? md.render(q.solutionDetails.formulasUsed) : q.solutionDetails.formulasUsed}</div>
      `;
                    detailsDiv.appendChild(formulas);
                }

                if (q.solutionDetails.working) {
                    const working = document.createElement('div');
                    working.className = 'solution-subsection';
                    working.innerHTML = `
        <div class="subsection-label">Working</div>
        <div class="working-content">${md ? md.render(q.solutionDetails.working) : q.solutionDetails.working}</div>
      `;
                    detailsDiv.appendChild(working);
                }

                if (q.solutionDetails.alternativeWorking) {
                    const altWorking = document.createElement('div');
                    altWorking.className = 'solution-subsection alternative-working';
                    altWorking.innerHTML = `
        <div class="subsection-label">Alternative working</div>
        <div class="working-content">${md ? md.render(q.solutionDetails.alternativeWorking) : q.solutionDetails.alternativeWorking}</div>
      `;
                    detailsDiv.appendChild(altWorking);
                }

                block.appendChild(toggleBtn);
                block.appendChild(detailsDiv);
            }

            if (q.children && q.children.length > 0) {
                q.children.forEach(child => {
                    block.appendChild(renderQuestion(child, depth + 1, expandedAll));
                });
            }

            return block;
        }

        function renderNavigation() {
            const desktopNav = document.getElementById('desktopNav');
            const mobileNav = document.getElementById('mobileNav');

            desktopNav.innerHTML = '';
            mobileNav.innerHTML = '';

            if (!currentPaper) return;

            if (currentPaper.sections) {
                currentPaper.sections.forEach(section => {
                    const sectionLabel = document.createElement('li');
                    sectionLabel.className = 'nav-section-label';
                    sectionLabel.textContent = section.label;
                    desktopNav.appendChild(sectionLabel);
                    mobileNav.appendChild(sectionLabel.cloneNode(true));

                    section.questions.forEach(q => {
                        renderNavItem(q, 0, desktopNav, mobileNav);
                    });
                });
            } else if (currentPaper.questions) {
                currentPaper.questions.forEach(q => {
                    renderNavItem(q, 0, desktopNav, mobileNav);
                });
            }
        }

        function renderNavItem(q, depth, desktopContainer, mobileContainer) {
            const desktopItem = document.createElement('li');
            desktopItem.className = 'nav-item' + (depth === 1 ? ' nav-item-nested' : depth === 2 ? ' nav-item-nested-2' : '');
            desktopItem.textContent = q.id;
            desktopItem.setAttribute('data-nav-id', q.id);
            desktopItem.setAttribute('tabindex', '0');
            desktopItem.setAttribute('role', 'button');

            desktopItem.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    desktopItem.click();
                }
            });

            const mobileItem = desktopItem.cloneNode(true);
            mobileItem.addEventListener('keydown', e => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    mobileItem.click();
                }
            });

            desktopContainer.appendChild(desktopItem);
            mobileContainer.appendChild(mobileItem);

            if (q.children && q.children.length > 0) {
                q.children.forEach(child => {
                    renderNavItem(child, depth + 1, desktopContainer, mobileContainer);
                });
            }
        }

        function openMobileNav() {
            document.getElementById('mobileNavBackdrop').classList.add('open');
            document.getElementById('mobileNavPanel').classList.add('open');
            document.getElementById('mobileNavClose').focus();
            document.body.style.overflow = 'hidden';
        }

        function closeMobileNav() {
            document.getElementById('mobileNavBackdrop').classList.remove('open');
            document.getElementById('mobileNavPanel').classList.remove('open');
            document.getElementById('mobileNavTrigger').focus();
            document.body.style.overflow = '';
        }

        document.getElementById('mobileNavTrigger').addEventListener('click', openMobileNav);
        document.getElementById('mobileNavClose').addEventListener('click', closeMobileNav);
        document.getElementById('mobileNavBackdrop').addEventListener('click', closeMobileNav);

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && document.getElementById('mobileNavPanel').classList.contains('open')) {
                closeMobileNav();
            }
        });

        document.getElementById('mobileNavPanel').addEventListener('keydown', e => {
            if (e.key === 'Tab') {
                const panel = document.getElementById('mobileNavPanel');
                const focusable = panel.querySelectorAll('button, [tabindex="0"]');
                const first = focusable[0];
                const last = focusable[focusable.length - 1];

                if (e.shiftKey && document.activeElement === first) {
                    e.preventDefault();
                    last.focus();
                } else if (!e.shiftKey && document.activeElement === last) {
                    e.preventDefault();
                    first.focus();
                }
            }
        });

        loadPayload();
    </script>

</body>

</html>