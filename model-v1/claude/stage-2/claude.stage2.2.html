<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ – Maths Paper Solution Viewer</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #222;
            background: #f5f5f5;
        }

        .app-header {
            background: #fff;
            border-bottom: 1px solid #ddd;
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-header h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #111;
        }

        .paper-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .paper-selector button {
            padding: 0.5rem 1rem;
            background: #e8e8e8;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .paper-selector button:hover {
            background: #d8d8d8;
        }

        .paper-selector button.active {
            background: #666;
            color: #fff;
            border-color: #555;
        }

        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
        }

        .nav-rail {
            width: 200px;
            padding: 1.5rem 1rem;
            background: #fff;
            border-right: 1px solid #ddd;
            position: sticky;
            top: 80px;
            height: calc(100vh - 80px);
            flex-shrink: 0;
            overflow-y: auto;
        }

        .nav-rail h2 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #888;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .nav-list {
            list-style: none;
        }

        .nav-list li {
            margin-bottom: 0.25rem;
        }

        .nav-list a {
            display: block;
            padding: 0.4rem 0.6rem;
            color: #555;
            text-decoration: none;
            font-size: 0.9rem;
            border-radius: 3px;
            transition: background 0.15s;
        }

        .nav-list a:hover {
            background: #f0f0f0;
        }

        .nav-separator {
            font-weight: 600;
            color: #333;
            padding: 0.6rem 0.6rem 0.3rem;
            font-size: 0.85rem;
            margin-top: 0.75rem;
        }

        .nav-separator:first-child {
            margin-top: 0;
        }

        .paper-content {
            flex: 1;
            padding: 2rem;
            background: #fff;
            min-width: 0;
        }

        .paper {
            max-width: 800px;
            margin: 0 auto;
        }

        .paper.hidden {
            display: none;
        }

        .section-header {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 2.5rem 0 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #333;
            color: #111;
        }

        .section-header:first-child {
            margin-top: 0;
        }

        .question-block {
            margin-bottom: 2.5rem;
            scroll-margin-top: 100px;
        }

        .question-block.sub-question {
            margin-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .question-block.sub-sub-question {
            margin-left: 3rem;
            margin-bottom: 1.5rem;
        }

        .question-prompt {
            padding: 1.25rem;
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .question-number {
            font-weight: 600;
            color: #111;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .question-text {
            color: #333;
            line-height: 1.7;
        }

        .diagram {
            margin: 1rem 0;
            width: 100%;
            max-width: 400px;
        }

        .answer-block {
            padding: 1rem 1.25rem;
            background: #f9f9f9;
            border-left: 3px solid #999;
            margin-bottom: 0.75rem;
        }

        .answer-label {
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .answer-content {
            color: #111;
            font-size: 1rem;
        }

        .working-block {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }

        .working-toggle {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #fff;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #555;
            transition: background 0.15s;
        }

        .working-toggle:hover {
            background: #fafafa;
        }

        .working-toggle-icon {
            color: #999;
            font-size: 0.8rem;
        }

        .working-content {
            padding: 1.25rem;
            background: #fdfdfd;
            border-top: 1px solid #eee;
            display: none;
            line-height: 1.8;
            color: #333;
        }

        .working-content.expanded {
            display: block;
        }

        .working-step {
            margin-bottom: 1rem;
        }

        .working-step:last-child {
            margin-bottom: 0;
        }

        .nav-toggle {
            display: none;
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #333;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 200;
        }

        .nav-drawer {
            display: none;
        }

        @media (max-width: 1024px) {
            .nav-rail {
                display: none;
            }

            .nav-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .nav-drawer {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px;
                height: 100vh;
                background: #fff;
                box-shadow: 2px 0 12px rgba(0, 0, 0, 0.1);
                transform: translateX(-100%);
                transition: transform 0.3s;
                z-index: 300;
                padding: 1.5rem 1rem;
                overflow-y: auto;
            }

            .nav-drawer.open {
                transform: translateX(0);
            }

            .nav-drawer-close {
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                color: #666;
                padding: 0.25rem;
            }

            .nav-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.4);
                z-index: 250;
            }

            .nav-overlay.open {
                display: block;
            }

            .paper-content {
                padding: 1.5rem 1rem;
            }
        }

        @media (max-width: 640px) {
            .app-header {
                padding: 1rem;
            }

            .app-header h1 {
                font-size: 1.1rem;
            }

            .paper-selector button {
                font-size: 0.85rem;
                padding: 0.4rem 0.75rem;
            }

            .question-block.sub-question {
                margin-left: 1rem;
            }

            .question-block.sub-sub-question {
                margin-left: 2rem;
            }

            .diagram {
                max-width: 100%;
            }
        }
    </style>
</head>

<body>

    <header class="app-header">
        <h1>RTQ – Maths Paper Solution Viewer</h1>
        <div class="paper-selector">
            <button class="active" data-paper="short">Short Paper</button>
            <button data-paper="standard">Standard Paper</button>
            <button data-paper="standard-expanded">Standard (Workings Expanded)</button>
            <button data-paper="diagram">Diagram-Heavy Paper</button>
            <button data-paper="sectioned">Sectioned Paper</button>
        </div>
    </header>

    <div class="main-container">
        <nav class="nav-rail" id="navRail"></nav>

        <main class="paper-content">
            <div id="paperShort" class="paper"></div>
            <div id="paperStandard" class="paper hidden"></div>
            <div id="paperStandardExpanded" class="paper hidden"></div>
            <div id="paperDiagram" class="paper hidden"></div>
            <div id="paperSectioned" class="paper hidden"></div>
        </main>
    </div>

    <button class="nav-toggle" id="navToggle">≡</button>
    <div class="nav-overlay" id="navOverlay"></div>
    <nav class="nav-drawer" id="navDrawer">
        <button class="nav-drawer-close" id="navDrawerClose">×</button>
        <div id="navDrawerContent"></div>
    </nav>

    <script>
        const diagrams = {
            triangle: `<svg viewBox="0 0 200 180" class="diagram">
    <polygon points="100,20 20,160 180,160" fill="none" stroke="#555" stroke-width="2"/>
    <text x="100" y="15" text-anchor="middle" font-size="12" fill="#333">A</text>
    <text x="15" y="175" text-anchor="middle" font-size="12" fill="#333">B</text>
    <text x="185" y="175" text-anchor="middle" font-size="12" fill="#333">C</text>
    <text x="100" y="100" text-anchor="middle" font-size="11" fill="#666">8 cm</text>
    <line x1="100" y1="20" x2="100" y2="160" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
    <text x="110" y="90" font-size="11" fill="#666">6 cm</text>
  </svg>`,

            circle: `<svg viewBox="0 0 200 200" class="diagram">
    <circle cx="100" cy="100" r="70" fill="none" stroke="#555" stroke-width="2"/>
    <line x1="100" y1="100" x2="170" y2="100" stroke="#999" stroke-width="1.5"/>
    <text x="135" y="95" font-size="11" fill="#666">5 cm</text>
    <circle cx="100" cy="100" r="3" fill="#333"/>
  </svg>`,

            bars: `<svg viewBox="0 0 240 160" class="diagram">
    <rect x="20" y="100" width="40" height="40" fill="#ccc" stroke="#666" stroke-width="1"/>
    <rect x="70" y="60" width="40" height="80" fill="#999" stroke="#666" stroke-width="1"/>
    <rect x="120" y="80" width="40" height="60" fill="#ccc" stroke="#666" stroke-width="1"/>
    <rect x="170" y="70" width="40" height="70" fill="#ccc" stroke="#666" stroke-width="1"/>
    <line x1="15" y1="145" x2="215" y2="145" stroke="#333" stroke-width="1.5"/>
    <line x1="15" y1="50" x2="15" y2="145" stroke="#333" stroke-width="1.5"/>
    <text x="40" y="155" text-anchor="middle" font-size="10" fill="#666">A</text>
    <text x="90" y="155" text-anchor="middle" font-size="10" fill="#666">B</text>
    <text x="140" y="155" text-anchor="middle" font-size="10" fill="#666">C</text>
    <text x="190" y="155" text-anchor="middle" font-size="10" fill="#666">D</text>
  </svg>`,

            grid: `<svg viewBox="0 0 220 220" class="diagram">
    <defs>
      <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#ddd" stroke-width="0.5"/>
      </pattern>
    </defs>
    <rect width="220" height="220" fill="url(#grid)"/>
    <line x1="10" y1="10" x2="10" y2="210" stroke="#666" stroke-width="1.5"/>
    <line x1="10" y1="210" x2="210" y2="210" stroke="#666" stroke-width="1.5"/>
    <line x1="10" y1="110" x2="190" y2="30" stroke="#555" stroke-width="2"/>
    <circle cx="90" cy="150" r="4" fill="#333"/>
    <text x="95" y="148" font-size="10" fill="#666">P(4,3)</text>
  </svg>`,

            table: `<svg viewBox="0 0 180 140" class="diagram">
    <rect x="20" y="20" width="140" height="100" fill="none" stroke="#666" stroke-width="2"/>
    <line x1="20" y1="45" x2="160" y2="45" stroke="#666" stroke-width="1"/>
    <line x1="20" y1="70" x2="160" y2="70" stroke="#666" stroke-width="1"/>
    <line x1="20" y1="95" x2="160" y2="95" stroke="#666" stroke-width="1"/>
    <line x1="90" y1="20" x2="90" y2="120" stroke="#666" stroke-width="1"/>
    <text x="55" y="37" text-anchor="middle" font-size="11" fill="#666">x</text>
    <text x="125" y="37" text-anchor="middle" font-size="11" fill="#666">y</text>
    <text x="55" y="62" text-anchor="middle" font-size="10" fill="#666">1</text>
    <text x="125" y="62" text-anchor="middle" font-size="10" fill="#666">2</text>
    <text x="55" y="87" text-anchor="middle" font-size="10" fill="#666">3</text>
    <text x="125" y="87" text-anchor="middle" font-size="10" fill="#666">6</text>
    <text x="55" y="112" text-anchor="middle" font-size="10" fill="#666">5</text>
    <text x="125" y="112" text-anchor="middle" font-size="10" fill="#666">10</text>
  </svg>`
        };

        function generateLongWorking(baseSteps, targetLines) {
            const steps = [...baseSteps];
            const additionalLines = targetLines - steps.length;

            for (let i = 0; i < additionalLines; i++) {
                steps.push(`\\text{Step } ${steps.length + 1}: \\quad ${i}x^2 + ${i + 1}x - ${i + 2} = 0`);
            }

            return steps;
        }

        const papers = {
            short: [
                { id: 'q1', type: 'single', question: 'Calculate \\(47 + 38\\)', answer: '85', working: ['47 + 38', '= 85'] },
                { id: 'q2', type: 'single', question: 'What is 15% of 200?', answer: '30', working: ['15\\% \\times 200', '= 0.15 \\times 200', '= 30'] },
                { id: 'q3', type: 'single', question: 'Solve for \\(x\\): \\(3x + 7 = 22\\)', answer: '\\(x = 5\\)', working: ['3x + 7 = 22', '3x = 22 - 7', '3x = 15', 'x = 5'] },
                {
                    id: 'q4', type: 'parent', question: 'A rectangle has a perimeter of 24 cm.', subs: [
                        { id: 'q4a', question: 'If the length is 8 cm, what is the width?', answer: '4 cm', working: ['\\text{Perimeter} = 2(l + w)', '24 = 2(8 + w)', '12 = 8 + w', 'w = 4'] },
                        { id: 'q4b', question: 'What is the area?', answer: '32 cm²', working: ['\\text{Area} = l \\times w', '= 8 \\times 4', '= 32'] }
                    ]
                },
                { id: 'q5', type: 'single', question: 'Write 0.625 as a fraction in its simplest form.', answer: '⁵⁄₈', working: ['0.625 = \\frac{625}{1000}', '= \\frac{125}{200}', '= \\frac{25}{40}', '= \\frac{5}{8}'] },
                { id: 'q6', type: 'single', question: 'Find the next number in the sequence: 2, 5, 11, 23, ...', answer: '47', working: ['\\text{Pattern: } \\times 2 + 1', '2 \\times 2 + 1 = 5', '5 \\times 2 + 1 = 11', '11 \\times 2 + 1 = 23', '23 \\times 2 + 1 = 47'] }
            ],

            standard: Array.from({ length: 35 }, (_, i) => {
                const qNum = i + 1;
                if (qNum >= 26) {
                    const baseWorking = [
                        'ax^2 + bx + c = 0',
                        `a = ${qNum}, b = -${qNum * 2}, c = ${qNum - 5}`,
                        'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                        '\\text{Discriminant} = b^2 - 4ac',
                        `= (-${qNum * 2})^2 - 4(${qNum})(${qNum - 5})`,
                        `= ${(qNum * 2) ** 2} - ${4 * qNum * (qNum - 5)}`,
                        `= ${(qNum * 2) ** 2 - 4 * qNum * (qNum - 5)}`,
                        'x = \\frac{\\text{numerator}}{\\text{denominator}}',
                        `x_1 = ${(qNum / 10).toFixed(2)}`,
                        `x_2 = ${(qNum / 5).toFixed(2)}`,
                        '\\text{Verification step 1}',
                        '\\text{Substitute } x_1 \\text{ back into original equation}',
                        '\\text{Verification step 2}',
                        '\\text{Substitute } x_2 \\text{ back into original equation}',
                        '\\text{Both solutions satisfy the equation}'
                    ];
                    return {
                        id: `q${qNum}`,
                        type: 'single',
                        question: `Solve the algebraic equation for \\(x\\): \\(${qNum}x^2 - ${qNum * 2}x + ${qNum - 5} = 0\\)`,
                        answer: `\\(x = ${(qNum / 10).toFixed(2)}\\) or \\(x = ${(qNum / 5).toFixed(2)}\\)`,
                        working: baseWorking,
                        defaultExpanded: false
                    };
                }
                return {
                    id: `q${qNum}`,
                    type: 'single',
                    question: `Calculate: \\(${qNum * 3} + ${qNum * 2} - ${qNum}\\)`,
                    answer: `\\(${qNum * 3 + qNum * 2 - qNum}\\)`,
                    working: [`${qNum * 3} + ${qNum * 2} - ${qNum}`, `= ${qNum * 3 + qNum * 2 - qNum}`],
                    defaultExpanded: false
                };
            }),

            diagram: [
                { id: 'q1', type: 'single', question: 'Find the area of the triangle shown below.', diagram: 'triangle', answer: '24 cm²', working: ['\\text{Area} = \\frac{1}{2} \\times \\text{base} \\times \\text{height}', '= \\frac{1}{2} \\times 8 \\times 6', '= 24'] },
                { id: 'q2', type: 'single', question: 'What percentage of the whole does the shaded portion represent?', diagram: 'bars', answer: '35%', working: ['\\text{Shaded} = 7 \\text{ units}', '\\text{Total} = 20 \\text{ units}', '\\frac{7}{20} \\times 100\\% = 35\\%'] },
                { id: 'q3', type: 'single', question: 'Calculate the circumference of the circle.', diagram: 'circle', answer: '31.4 cm (to 1 d.p.)', working: ['C = 2\\pi r', '= 2 \\times \\pi \\times 5', '= 10\\pi \\approx 31.4'] },
                { id: 'q4', type: 'single', question: 'What are the coordinates of point P on the graph?', diagram: 'grid', answer: '(4, 3)', working: ['x\\text{-coordinate} = 4', 'y\\text{-coordinate} = 3', '\\text{Point P} = (4, 3)'] },
                { id: 'q5', type: 'single', question: 'Based on the bar chart, what is the total frequency?', diagram: 'bars', answer: '85', working: ['\\text{Sum} = 15 + 28 + 22 + 20', '= 85'] },
                { id: 'q6', type: 'single', question: 'Find the area of the shaded region in the diagram.', diagram: 'triangle', answer: '18 cm²', working: ['\\text{Total area} - \\text{unshaded area}', '= 30 - 12', '= 18'] },
                { id: 'q7', type: 'single', question: 'Using the array shown, calculate the product.', diagram: 'table', answer: '144', working: ['12 \\times 12', '= 144'] },
                { id: 'q8', type: 'single', question: 'What is the gradient of the line shown on the coordinate grid?', diagram: 'grid', answer: '2', working: ['m = \\frac{y_2 - y_1}{x_2 - x_1}', '= \\frac{6 - 2}{3 - 1}', '= \\frac{4}{2} = 2'] },
                { id: 'q9', type: 'single', question: 'The circle has radius 10 cm. What is its area?', diagram: 'circle', answer: '314 cm² (to nearest whole number)', working: ['A = \\pi r^2', '= \\pi \\times 10^2', '= 100\\pi \\approx 314'] },
                { id: 'q10', type: 'single', question: 'Calculate \\(35 + 42\\)', answer: '77', working: ['35 + 42 = 77'] },
                { id: 'q11', type: 'single', question: 'Using the table, find the value when \\(x = 5\\).', diagram: 'table', answer: '25', working: ['\\text{Pattern: } y = x^2', '\\text{When } x = 5, y = 25'] },
                { id: 'q12', type: 'single', question: 'Find the unknown angle in the triangle.', diagram: 'triangle', answer: '65°', working: ['\\text{Sum of angles} = 180°', 'x + 55 + 60 = 180', 'x = 65'] },
                { id: 'q13', type: 'single', question: 'What is \\(7 \\times 8\\)?', answer: '56', working: ['7 \\times 8 = 56'] },
                { id: 'q14', type: 'single', question: 'Based on the bar chart, which category has the highest value?', diagram: 'bars', answer: 'Category B (28)', working: ['\\text{Compare all values}', '\\text{Highest} = 28'] },
                { id: 'q15', type: 'single', question: 'Calculate \\(120 \\div 8\\)', answer: '15', working: ['120 \\div 8 = 15'] },
                { id: 'q16', type: 'single', question: 'Using the coordinate grid, find the distance between points A and B.', diagram: 'grid', answer: '5 units', working: ['d = \\sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}', '= \\sqrt{4^2 + 3^2}', '= \\sqrt{25} = 5'] },
                { id: 'q17', type: 'single', question: 'What is the circumference of the circle shown?', diagram: 'circle', answer: '25.1 cm (to 1 d.p.)', working: ['C = 2\\pi r', '= 2 \\times \\pi \\times 4', '\\approx 25.1'] },
                {
                    id: 'q18', type: 'parent', question: 'Given the expression \\(5x + 3y - 2z\\)', subs: [
                        {
                            id: 'q18a', type: 'parent', question: 'Simplify when \\(z = 0\\):', subs: [
                                { id: 'q18ai', question: 'and \\(y = 2x\\)', answer: '\\(11x\\)', working: ['5x + 3(2x) - 2(0)', '= 5x + 6x', '= 11x'] },
                                { id: 'q18aii', question: 'and \\(x = y\\)', answer: '\\(8x\\)', working: ['5x + 3x - 2(0)', '= 8x'] }
                            ]
                        },
                        { id: 'q18b', question: 'If \\(x = 2, y = 3, z = 1\\), evaluate the expression.', answer: '17', working: ['5(2) + 3(3) - 2(1)', '= 10 + 9 - 2', '= 17'] }
                    ]
                },
                { id: 'q19', type: 'single', question: 'From the array, what is \\(8 \\times 7\\)?', diagram: 'table', answer: '56', working: ['8 \\times 7 = 56'] },
                { id: 'q20', type: 'single', question: 'Find the value of \\(y\\) when \\(x = 3\\) on the graph.', diagram: 'grid', answer: '\\(y = 7\\)', working: ['\\text{From graph, when } x = 3, y = 7'] }
            ],

            sectioned: {
                'Section A': Array.from({ length: 35 }, (_, i) => {
                    const qNum = i + 1;
                    return {
                        id: `a${qNum}`,
                        type: 'single',
                        question: `Calculate: \\(${qNum * 2} + ${qNum * 3}\\)`,
                        answer: `\\(${qNum * 5}\\)`,
                        working: [`${qNum * 2} + ${qNum * 3} = ${qNum * 5}`],
                        defaultExpanded: false
                    };
                }),
                'Section B': Array.from({ length: 8 }, (_, i) => {
                    const qNum = i + 1;
                    return {
                        id: `b${qNum}`,
                        type: 'single',
                        question: `Solve for \\(x\\): \\(${qNum}x + ${qNum * 2} = ${qNum * 5}\\)`,
                        answer: `\\(x = ${qNum * 3}\\)`,
                        working: [
                            `${qNum}x + ${qNum * 2} = ${qNum * 5}`,
                            `${qNum}x = ${qNum * 5} - ${qNum * 2}`,
                            `${qNum}x = ${qNum * 3}`,
                            `x = ${qNum * 3}`
                        ],
                        defaultExpanded: false
                    };
                }),
                'Section C': Array.from({ length: 6 }, (_, i) => {
                    const qNum = i + 1;
                    const baseWorking = [
                        '\\text{For } ax^2 + bx + c = 0',
                        '\\text{Sum of roots} = -\\frac{b}{a}',
                        `a = ${qNum}, b = -${qNum * 4}, c = ${qNum * 3}`,
                        `\\text{Sum} = -\\frac{-${qNum * 4}}{${qNum}}`,
                        `= \\frac{${qNum * 4}}{${qNum}}`,
                        `= ${(qNum * 4 / qNum).toFixed(1)}`,
                        '\\text{Alternative verification using quadratic formula:}',
                        'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                        `\\text{Discriminant} = (-${qNum * 4})^2 - 4(${qNum})(${qNum * 3})`,
                        `= ${(qNum * 4) ** 2} - ${4 * qNum * qNum * 3}`,
                        `= ${(qNum * 4) ** 2 - 4 * qNum * qNum * 3}`,
                        '\\text{Root 1 calculation...}',
                        '\\text{Root 2 calculation...}',
                        '\\text{Sum verification confirms result}',
                        '\\therefore \\text{ proven}'
                    ];
                    const longWorking = qNum === 3 || qNum === 5 ? generateLongWorking(baseWorking, 55) : baseWorking;
                    return {
                        id: `c${qNum}`,
                        type: 'single',
                        question: `Prove that for the quadratic equation \\(${qNum}x^2 - ${qNum * 4}x + ${qNum * 3} = 0\\), the sum of the roots equals \\(\\frac{${qNum * 4}}{${qNum}}\\)`,
                        answer: `Sum of roots = \\(${(qNum * 4 / qNum).toFixed(1)}\\)`,
                        working: longWorking,
                        defaultExpanded: false
                    };
                })


                    `x = ${qNum * 3}`
        ],
        defaultExpanded: false
      };
    }),
        'Section C': Array.from({ length: 6 }, (_, i) => {
            const qNum = i + 1;
            const baseWorking = [
                '\\text{For } ax^2 + bx + c = 0',
                '\\text{Sum of roots} = -\\frac{b}{a}',
                `a = ${qNum}, b = -${qNum * 4}, c = ${qNum * 3}`,
                `\\text{Sum} = -\\frac{-${qNum * 4}}{${qNum}}`,
                `= \\frac{${qNum * 4}}{${qNum}}`,
                `= ${(qNum * 4 / qNum).toFixed(1)}`,
                '\\text{Alternative verification using quadratic formula:}',
                'x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}',
                `\\text{Discriminant} = (-${qNum * 4})^2 - 4(${qNum})(${qNum * 3})`,
                `= ${(qNum * 4) ** 2} - ${4 * qNum * qNum * 3}`,
                `= ${(qNum * 4) ** 2 - 4 * qNum * qNum * 3}`,
                '\\text{Root 1 calculation...}',
                '\\text{Root 2 calculation...}',
                '\\text{Sum verification confirms result}',
                '\\therefore \\text{ proven}'
            ];
            const longWorking = qNum === 3 || qNum === 5 ? generateLongWorking(baseWorking, 55) : baseWorking;
            return {
                id: `c${qNum}`,
                type: 'single',
                question: `Prove that for the quadratic equation \\(${qNum}x^2 - ${qNum * 4}x + ${qNum * 3} = 0\\), the sum of the roots equals \\(\\frac{${qNum * 4}}{${qNum}}\\)`,
                answer: `Sum of roots = \\(${(qNum * 4 / qNum).toFixed(1)}\\)`,
                working: longWorking,
                defaultExpanded: false
            };
        })
  }
};

        // Deep nesting for question 30
        papers.standard[29] = {
            id: 'q30',
            type: 'parent',
            question: 'Consider the function \\(f(x) = x^3 - 6x^2 + 11x - 6\\)',
            subs: [
                {
                    id: 'q30a',
                    type: 'parent',
                    question: 'Find the roots of the function:',
                    subs: [
                        { id: 'q30ai', question: 'Show that \\(x = 1\\) is a root.', answer: 'Proven', working: ['f(1) = 1^3 - 6(1)^2 + 11(1) - 6', '= 1 - 6 + 11 - 6', '= 0', '\\therefore x = 1 \\text{ is a root}'] },
                        { id: 'q30aii', question: 'Find all other roots.', answer: '\\(x = 2, x = 3\\)', working: ['\\text{Factor: } (x-1)(x^2 - 5x + 6)', '(x-1)(x-2)(x-3)', '\\therefore x = 2, x = 3'] }
                    ]
                },
                { id: 'q30b', question: 'Sketch the graph, showing all intercepts.', answer: 'Graph crosses x-axis at \\(x = 1, 2, 3\\)', working: ['\\text{x-intercepts: } (1,0), (2,0), (3,0)', '\\text{y-intercept: } (0,-6)', '\\text{Cubic with positive leading coefficient}'] }
            ]
        };

        function renderMath(text) {
            const tempDiv = document.createElement('div');
            tempDiv.textContent = text;
            try {
                if (window.katex) {
                    return window.katex.renderToString(text, {
                        throwOnError: false,
                        displayMode: text.includes('\\frac') || text.includes('\\sqrt') || text.includes('\\text{')
                    });
                }
            } catch (e) {
                return text;
            }
            return text;
        }

        function renderQuestion(q, parentQuestion = null, depth = 0) {
            const qClass = depth === 0 ? 'question-block' : depth === 1 ? 'question-block sub-question' : 'question-block sub-sub-question';
            const diagramHtml = q.diagram ? diagrams[q.diagram] : '';
            const defaultExpanded = q.defaultExpanded === true;

            let html = `
    <div class="${qClass}" id="${q.id}">
      <div class="question-prompt">
        <div class="question-number">Question ${q.id.toUpperCase()}</div>
        ${parentQuestion ? `<div class="question-text" style="color:#666;font-size:0.9rem;margin-bottom:0.5rem;">${parentQuestion}</div>` : ''}
        <div class="question-text math-content">${q.question}</div>
        ${diagramHtml}
      </div>
      <div class="answer-block">
        <div class="answer-label">Answer</div>
        <div class="answer-content math-content">${q.answer}</div>
      </div>
      <div class="working-block">
        <button class="working-toggle" onclick="toggleWorking('${q.id}')">
          <span>Working</span>
          <span class="working-toggle-icon" id="${q.id}-icon">${defaultExpanded ? 'Hide ▲' : 'Show ▼'}</span>
        </button>
        <div class="working-content ${defaultExpanded ? 'expanded' : ''}" id="${q.id}-working">
          ${q.working.map(step => `<div class="working-step math-content">${step}</div>`).join('')}
        </div>
      </div>
    </div>
  `;

            return html;
        }

        function renderPaper(paperData, containerId) {
            const container = document.getElementById(containerId);
            let html = '';

            function renderQuestionTree(q, parentQ = null, depth = 0) {
                let result = '';
                if (q.type === 'parent') {
                    if (depth === 0) {
                        result += `<div class="question-block" id="${q.id}">
          <div class="question-prompt">
            <div class="question-number">Question ${q.id.toUpperCase().replace(/^Q/, '')}</div>
            <div class="question-text math-content">${q.question}</div>
          </div>
        </div>`;
                    }
                    q.subs.forEach(sub => {
                        result += renderQuestionTree(sub, q.question, depth + 1);
                    });
                } else {
                    result += renderQuestion(q, parentQ, depth);
                }
                return result;
            }

            if (Array.isArray(paperData)) {
                paperData.forEach(q => {
                    html += renderQuestionTree(q);
                });
            } else {
                Object.keys(paperData).forEach(section => {
                    html += `<div class="section-header">${section}</div>`;
                    paperData[section].forEach(q => {
                        html += renderQuestionTree(q);
                    });
                });
            }

            container.innerHTML = html;

            setTimeout(() => {
                if (window.renderMathInElement) {
                    window.renderMathInElement(container, {
                        delimiters: [
                            { left: '\\(', right: '\\)', display: false },
                            { left: '\\[', right: '\\]', display: true }
                        ],
                        throwOnError: false
                    });
                }
            }, 100);
        }

        function generateNav(paperData, isSection = false) {
            let navHtml = '<h2>Questions</h2><ul class="nav-list">';

            function addNavItems(q, depth = 0) {
                if (q.type === 'parent') {
                    if (depth === 0) {
                        navHtml += `<li><a href="#${q.id}">${q.id.toUpperCase().replace(/^Q/, '')}</a></li>`;
                    }
                    q.subs.forEach(sub => addNavItems(sub, depth + 1));
                } else {
                    navHtml += `<li><a href="#${q.id}">${q.id.toUpperCase()}</a></li>`;
                }
            }

            if (Array.isArray(paperData)) {
                paperData.forEach(q => {
                    addNavItems(q);
                });
            } else {
                Object.keys(paperData).forEach(section => {
                    navHtml += `<li class="nav-separator">${section}</li>`;
                    paperData[section].forEach(q => {
                        addNavItems(q);
                    });
                });
            }

            navHtml += '</ul>';
            return navHtml;
        }

        function toggleWorking(id) {
            const content = document.getElementById(`${id}-working`);
            const icon = document.getElementById(`${id}-icon`);

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.textContent = 'Show ▼';
            } else {
                content.classList.add('expanded');
                icon.textContent = 'Hide ▲';
            }
        }

        function switchPaper(paperKey) {
            document.querySelectorAll('.paper').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.paper-selector button').forEach(b => b.classList.remove('active'));

            const button = document.querySelector(`[data-paper="${paperKey}"]`);
            button.classList.add('active');

            let paperId, paperData;

            switch (paperKey) {
                case 'short':
                    paperId = 'paperShort';
                    paperData = papers.short;
                    break;
                case 'standard':
                    paperId = 'paperStandard';
                    paperData = papers.standard;
                    break;
                case 'standard-expanded':
                    paperId = 'paperStandardExpanded';
                    paperData = JSON.parse(JSON.stringify(papers.standard));
                    paperData.forEach(q => { q.defaultExpanded = true; });
                    break;
                case 'diagram':
                    paperId = 'paperDiagram';
                    paperData = papers.diagram;
                    break;
                case 'sectioned':
                    paperId = 'paperSectioned';
                    paperData = papers.sectioned;
                    break;
            }

            document.getElementById(paperId).classList.remove('hidden');

            const navContent = generateNav(paperData, paperKey === 'sectioned');
            document.getElementById('navRail').innerHTML = navContent;
            document.getElementById('navDrawerContent').innerHTML = navContent;
        }

        document.querySelectorAll('.paper-selector button').forEach(button => {
            button.addEventListener('click', () => {
                switchPaper(button.dataset.paper);
            });
        });

        document.getElementById('navToggle').addEventListener('click', () => {
            document.getElementById('navDrawer').classList.add('open');
            document.getElementById('navOverlay').classList.add('open');
        });

        document.getElementById('navDrawerClose').addEventListener('click', () => {
            document.getElementById('navDrawer').classList.remove('open');
            document.getElementById('navOverlay').classList.remove('open');
        });

        document.getElementById('navOverlay').addEventListener('click', () => {
            document.getElementById('navDrawer').classList.remove('open');
            document.getElementById('navOverlay').classList.remove('open');
        });

        document.getElementById('navDrawer').addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                document.getElementById('navDrawer').classList.remove('open');
                document.getElementById('navOverlay').classList.remove('open');
            }
        });

        renderPaper(papers.short, 'paperShort');
        renderPaper(papers.standard, 'paperStandard');
        renderPaper(JSON.parse(JSON.stringify(papers.standard)).map(q => ({ ...q, defaultExpanded: true })), 'paperStandardExpanded');
        renderPaper(papers.diagram, 'paperDiagram');
        renderPaper(papers.sectioned, 'paperSectioned');

        switchPaper('short');
    </script>

</body>

</html>