<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ - Maths Paper Solution Viewer (Stress Test)</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <style>
        /* * CORE VARIABLES & RESET 
         * Grayscale, minimal, focused on spacing and rhythm.
         */
        :root {
            --bg-body: #fdfdfd;
            --bg-paper: #ffffff;
            --text-primary: #111111;
            --text-secondary: #555555;
            --text-tertiary: #767676;
            --border-light: #e0e0e0;
            --border-focus: #333333;

            --space-xs: 0.25rem;
            /* 4px */
            --space-s: 0.5rem;
            /* 8px */
            --space-m: 1rem;
            /* 16px */
            --space-l: 1.5rem;
            /* 24px */
            --space-xl: 3rem;
            /* 48px - Between Questions */

            --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --max-width: 1024px;
            --nav-width: 160px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-stack);
            background-color: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* * LAYOUT ARCHITECTURE 
         * Single centered frame containing Nav and Content side-by-side.
         */
        .app-shell {
            width: 100%;
            max-width: var(--max-width);
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* TOP CONTROLS */
        .controls-area {
            padding: var(--space-m) var(--space-l);
            border-bottom: 1px solid var(--border-light);
            background: var(--bg-body);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .paper-selector {
            font-size: 1rem;
            padding: var(--space-s);
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-light);
            border-radius: 4px;
            background: white;
            color: var(--text-primary);
        }

        /* MAIN CONTENT FRAME */
        .content-frame {
            display: grid;
            grid-template-columns: var(--nav-width) 1fr;
            gap: var(--space-l);
            padding: var(--space-l);
            align-items: start;
        }

        /* NAVIGATION RAIL */
        .nav-rail {
            position: sticky;
            top: 80px;
            /* Accounts for controls height */
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            /* Hidden Scrollbar Logic */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE 10+ */
        }

        .nav-rail::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-section-label {
            font-weight: bold;
            font-size: 0.85rem;
            color: var(--text-tertiary);
            padding: var(--space-s) 0;
            margin-top: var(--space-s);
            border-bottom: 1px solid var(--border-light);
        }

        .nav-item {
            display: block;
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.1s, color 0.1s;
        }

        .nav-item:hover {
            background-color: #f0f0f0;
            color: var(--text-primary);
        }

        .nav-item:focus-visible {
            outline: 2px solid var(--text-primary);
        }

        /* PAPER CONTENT COLUMN */
        .paper-content {
            /* No max-width restriction here, controlled by grid */
            min-width: 0;
            /* Prevents grid blowout from wide content */
        }

        /* * QUESTION COMPONENT STRUCTURE 
         */
        .question-block {
            margin-bottom: var(--space-xl);
            scroll-margin-top: 100px;
            /* For anchor jumping */
        }

        /* Indentation for nesting */
        .question-block.depth-0 {
            margin-left: 0;
        }

        .question-block.depth-1 {
            margin-left: var(--space-l);
        }

        .question-block.depth-2 {
            margin-left: calc(var(--space-l) * 2);
        }

        .q-header {
            display: flex;
            gap: var(--space-s);
            margin-bottom: var(--space-m);
        }

        .q-id {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 2.5rem;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .q-prompt {
            font-size: 1.1rem;
            color: var(--text-primary);
            width: 100%;
        }

        /* DIAGRAMS */
        .diagram-container {
            margin: var(--space-m) 0;
            padding: var(--space-m);
            border: 1px solid #eee;
            background: #fafafa;
            display: flex;
            justify-content: center;
        }

        .diagram-svg {
            max-width: 100%;
            height: auto;
            stroke: #333;
            stroke-width: 2;
            fill: none;
        }

        .diagram-text {
            font-size: 12px;
            fill: #333;
            stroke: none;
        }

        /* ANSWER BLOCK */
        .answer-block {
            margin-left: 3rem;
            /* Visual indent relative to ID */
            margin-bottom: var(--space-m);
            font-size: 1.1rem;
        }

        .answer-label {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-right: var(--space-s);
            letter-spacing: 0.05em;
        }

        /* DISCLOSURE CONTROL */
        .disclosure-control {
            margin-left: 3rem;
            margin-bottom: var(--space-s);
        }

        .toggle-btn {
            background: none;
            border: none;
            padding: var(--space-s) 0;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
            /* Neutral interaction color */
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            text-decoration: underline;
            text-decoration-color: transparent;
            transition: color 0.2s, text-decoration-color 0.2s;
        }

        .toggle-btn:hover {
            color: var(--text-primary);
            text-decoration-color: var(--text-primary);
        }

        .toggle-btn:focus-visible {
            outline: 2px solid var(--text-primary);
            border-radius: 2px;
        }

        .toggle-icon {
            font-size: 0.8em;
            transition: transform 0.2s ease;
        }

        .toggle-btn[aria-expanded="true"] .toggle-icon {
            transform: rotate(180deg);
        }

        /* SOLUTION DETAILS REGION */
        .solution-details {
            margin-left: 3rem;
            display: none;
            /* Hidden by default */
            border-left: 2px solid #eee;
            padding-left: var(--space-m);
            margin-top: var(--space-s);
        }

        .solution-details.is-visible {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* SEMANTIC SUB-BLOCKS WITHIN SOLUTION */
        .sol-component {
            margin-bottom: var(--space-m);
        }

        .sol-label {
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: var(--space-xs);
            font-weight: 600;
        }

        .sol-content {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* MATH OVERFLOW HANDLING */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 4px;
            /* Space for scrollbar */
            /* Hidden scrollbar logic for math */
            scrollbar-width: thin;
        }

        /* * MOBILE RESPONSIVENESS 
         */
        @media (max-width: 768px) {
            .content-frame {
                display: block;
                /* Stack columns */
                padding: var(--space-m);
            }

            .nav-rail {
                display: none;
                /* Default hidden on mobile */
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 80%;
                max-width: 300px;
                background: white;
                z-index: 200;
                padding: var(--space-l);
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
                border-right: 1px solid var(--border-light);
            }

            .nav-rail.is-open {
                display: block;
            }

            .mobile-nav-toggle {
                display: inline-block;
                margin-top: var(--space-s);
                padding: 8px 12px;
                background: #f0f0f0;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 0.9rem;
            }

            /* Overlay backdrop for mobile nav */
            .nav-backdrop {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.4);
                z-index: 150;
            }

            .nav-backdrop.is-open {
                display: block;
            }

            .q-id {
                min-width: 2rem;
            }

            .question-block.depth-1 {
                margin-left: var(--space-m);
            }

            .question-block.depth-2 {
                margin-left: var(--space-l);
            }

            .answer-block,
            .disclosure-control,
            .solution-details {
                margin-left: 0;
                margin-top: var(--space-m);
            }
        }

        @media (min-width: 769px) {
            .mobile-nav-toggle {
                display: none;
            }

            .nav-backdrop {
                display: none !important;
            }
        }
    </style>
</head>

<body>

    <div class="app-shell">

        <header class="controls-area">
            <label for="paper-select" style="display:block; font-size: 0.8rem; color:#666; margin-bottom: 4px;">Select
                Paper Dataset:</label>
            <select id="paper-select" class="paper-selector" onchange="loadPaper(this.value)">
                <option value="short">1. Short Paper (6 Qs)</option>
                <option value="standard">2. Standard Paper (35 Qs)</option>
                <option value="diagrams">3. Diagram Heavy (20 Qs)</option>
                <option value="sectioned">4. Sectioned Paper (Structure)</option>
                <option value="expanded">ADD-ON: Standard (Workings Expanded)</option>
            </select>

            <button class="mobile-nav-toggle" onclick="toggleMobileNav()">
                Jump to Question...
            </button>
        </header>

        <div class="content-frame">

            <nav class="nav-rail" id="nav-rail" aria-label="Paper Navigation">
                <ul class="nav-list" id="nav-list"></ul>
            </nav>
            <div class="nav-backdrop" onclick="toggleMobileNav()"></div>

            <main class="paper-content" id="paper-container">
            </main>

        </div>
    </div>

    <script>
        /**
         * DATA GENERATION & CONFIG
         */

        // SVG Diagram Templates (Inline strings)
        const DIAGRAMS = {
            geometry: `<svg viewBox="0 0 200 150" class="diagram-svg"><path d="M20,130 L100,20 L180,130 Z" stroke="#333" fill="none"/><text x="95" y="145" class="diagram-text">12cm</text><text x="40" y="70" class="diagram-text">x</text></svg>`,
            bar: `<svg viewBox="0 0 200 100" class="diagram-svg"><rect x="10" y="20" width="50" height="60" fill="#ddd"/><rect x="70" y="40" width="50" height="40" fill="#bbb"/><rect x="130" y="10" width="50" height="70" fill="#999"/><line x1="10" y1="80" x2="190" y2="80" stroke="#333"/></svg>`,
            coords: `<svg viewBox="0 0 200 200" class="diagram-svg"><line x1="10" y1="100" x2="190" y2="100" stroke="#333"/><line x1="100" y1="10" x2="100" y2="190" stroke="#333"/><circle cx="140" cy="60" r="3" fill="#333"/><text x="145" y="55" class="diagram-text">P(4, 4)</text></svg>`,
            grid: `<svg viewBox="0 0 150 100" class="diagram-svg"><rect x="10" y="10" width="130" height="80" stroke="#333" fill="none"/><line x1="10" y1="50" x2="140" y2="50" stroke="#ccc"/><line x1="75" y1="10" x2="75" y2="90" stroke="#ccc"/></svg>`
        };

        // Generates specific paper datasets based on rules
        function generateDataset(type) {
            const questions = [];

            // Helper to add Q
            const addQ = (id, prompt, ans, workingLines, depth = 0, opts = {}) => {
                questions.push({
                    id: id,
                    depth: depth,
                    prompt: prompt,
                    diagram: opts.diagram || null,
                    answer: ans,
                    solution: {
                        keepInMind: opts.keepInMind || null,
                        formulas: opts.formulas || null,
                        working: workingLines, // Array of latex strings
                        altWorking: opts.altWorking || null
                    },
                    section: opts.section || null,
                    forceExpanded: opts.forceExpanded || false
                });
            };

            // Long Working Text Generator
            const longWorking = [];
            for (let i = 0; i < 55; i++) {
                longWorking.push(`x_{${i}} = \\frac{${i}^2 - 4ac}{2a} + \\int_0^\\infty e^{-x} dx`); // Nonsense math for layout stress
            }

            if (type === 'short') {
                addQ('1', 'Calculate $14 + 28$.', '42', ['14 + 28 = 42']);
                addQ('2', 'Simplify $\\frac{12}{36}$.', '\\frac{1}{3}', ['12 \\div 12 = 1', '36 \\div 12 = 3', '\\text{Result: } \\frac{1}{3}']);
                addQ('3(a)', 'Find $x$ if $2x = 10$.', 'x = 5', ['2x = 10', 'x = 10 \\div 2', 'x = 5'], 1);
                addQ('3(b)', 'Find $y$ if $y + 4 = 12$.', 'y = 8', ['y = 12 - 4', 'y = 8'], 1);
                addQ('4', 'Calculate the area.', '24 \\text{ cm}^2', ['A = \\frac{1}{2}bh', 'A = 0.5 \\times 6 \\times 8', 'A = 24'], 0, { diagram: DIAGRAMS.geometry });
                addQ('5', 'Solve for $z$: $3z - 5 = 16$.', 'z = 7', ['3z = 21', 'z = 7'], 0, {
                    keepInMind: "Remember to add 5 to both sides first.",
                    formulas: "Linear equation rules"
                });
            }
            else if (type === 'standard' || type === 'expanded') {
                const isExp = type === 'expanded';
                for (let i = 1; i <= 35; i++) {
                    let working = [`\\text{Step 1 for Q${i}}`, `\\text{Step 2 for Q${i}}`];
                    let opts = { forceExpanded: isExp };

                    // Stress Test: Deep Nesting at Q18 & Q30
                    if (i === 18) {
                        addQ('18(a)(i)', 'Expand $(x+2)(x-2)$.', 'x^2 - 4', ['x^2 - 2x + 2x - 4', 'x^2 - 4'], 2, opts);
                        addQ('18(a)(ii)', 'Hence solve $x^2 - 4 = 0$.', 'x = \\pm 2', ['(x-2)(x+2)=0', 'x=2, x=-2'], 2, opts);
                        addQ('18(b)', 'Explain the symmetry.', 'Even function', ['f(x) = f(-x)'], 1, opts);
                        continue;
                    }
                    if (i === 30) {
                        addQ('30(a)', 'Calculate mean.', '15.5', ['\\frac{\\sum x}{n}'], 1, opts);
                        addQ('30(b)(i)', 'Find standard deviation.', '2.1', ['\\sqrt{Var}'], 2, opts);
                        continue;
                    }

                    // Stress Test: Long Workings Q26-35
                    if (i >= 26) {
                        working = longWorking; // 50+ lines
                    }

                    // Stress Test: Coverage (Keep in Mind, formulas, Alt working)
                    if (i === 5 || i === 10 || i === 15) opts.keepInMind = "Watch out for negative signs.";
                    if (i === 10 || i === 20 || i === 25) opts.formulas = "Area = \\pi r^2";
                    if (i === 15 || i === 25 || i === 35) opts.altWorking = ["\\text{Graphical method...}", "y = mx + c"];
                    if (i === 33) { // The 'All Included' stress test
                        opts.keepInMind = "Crucial context note.";
                        opts.formulas = "Quad Formula: x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}";
                        opts.altWorking = ["\\text{Trial and improvement method}", "Guess 1: ..."];
                    }

                    addQ(`${i}`, `Question text for number ${i}... solve for $x$.`, `x = ${i * 2}`, working, 0, opts);
                }
            }
            else if (type === 'diagrams') {
                const types = [DIAGRAMS.geometry, DIAGRAMS.bar, DIAGRAMS.coords, DIAGRAMS.grid];
                for (let i = 1; i <= 20; i++) {
                    let diag = (i % 2 === 0 || i % 5 === 0) ? types[i % 4] : null; // Frequent diagrams
                    addQ(`${i}`, `Analyze the diagram and solve.`, '42', [`\\text{Working for Q${i}}`], 0, { diagram: diag });
                }
            }
            else if (type === 'sectioned') {
                // Section A
                for (let i = 1; i <= 10; i++) addQ(`${i}`, `Section A Q${i}`, 'Ans', ['Work'], 0, { section: (i === 1 ? 'Section A' : null) });
                // Section B
                for (let i = 11; i <= 18; i++) addQ(`${i}`, `Section B Q${i}`, 'Ans', ['Work'], 0, { section: (i === 11 ? 'Section B' : null) });
                // Section C (Long)
                for (let i = 19; i <= 25; i++) addQ(`${i}`, `Section C Q${i} (Long)`, 'Ans', longWorking, 0, { section: (i === 19 ? 'Section C' : null) });
            }

            return questions;
        }

        /**
         * RENDERING LOGIC
         */

        function renderPaper(type) {
            const data = generateDataset(type);
            const container = document.getElementById('paper-container');
            const navList = document.getElementById('nav-list');

            // Clear existing
            container.innerHTML = '';
            navList.innerHTML = '';
            window.scrollTo(0, 0);

            data.forEach(q => {
                // 1. Build Navigation Item
                if (q.section) {
                    const secLabel = document.createElement('li');
                    secLabel.className = 'nav-section-label';
                    secLabel.textContent = q.section;
                    navList.appendChild(secLabel);
                }

                const navLi = document.createElement('li');
                const navLink = document.createElement('a');
                navLink.href = `#q-${q.id}`;
                navLink.className = 'nav-item';
                navLink.textContent = q.id;
                // Navigation interaction: Close mobile drawer if open
                navLink.onclick = (e) => {
                    if (window.innerWidth <= 768) toggleMobileNav();
                };
                navLi.appendChild(navLink);
                navList.appendChild(navLi);

                // 2. Build Paper Content
                const qBlock = document.createElement('div');
                qBlock.className = `question-block depth-${q.depth}`;
                qBlock.id = `q-${q.id}`;

                // Header (ID + Prompt)
                const header = document.createElement('div');
                header.className = 'q-header';
                header.innerHTML = `
            <div class="q-id">${q.id}</div>
            <div class="q-prompt">
                <div>${q.prompt}</div>
                ${q.diagram ? `<div class="diagram-container">${q.diagram}</div>` : ''}
            </div>
        `;

                // Answer
                const ansBlock = document.createElement('div');
                ansBlock.className = 'answer-block';
                ansBlock.innerHTML = `<span class="answer-label">Answer</span> $${q.answer}$`;

                // Disclosure Control
                const controlDiv = document.createElement('div');
                controlDiv.className = 'disclosure-control';
                const btn = document.createElement('button');
                btn.className = 'toggle-btn';
                btn.setAttribute('aria-expanded', q.forceExpanded ? 'true' : 'false');
                btn.setAttribute('aria-controls', `sol-${q.id}`);
                btn.innerHTML = `<span>${q.forceExpanded ? 'Hide' : 'Show'} working</span> <span class="toggle-icon">â–¼</span>`;
                btn.onclick = () => {
                    const isExpanded = btn.getAttribute('aria-expanded') === 'true';
                    btn.setAttribute('aria-expanded', !isExpanded);
                    btn.querySelector('span').textContent = !isExpanded ? 'Hide working' : 'Show working';

                    const details = document.getElementById(`sol-${q.id}`);
                    if (!isExpanded) {
                        details.classList.add('is-visible');
                    } else {
                        details.classList.remove('is-visible');
                    }
                };
                controlDiv.appendChild(btn);

                // Solution Details
                const detailsDiv = document.createElement('div');
                detailsDiv.id = `sol-${q.id}`;
                detailsDiv.className = `solution-details ${q.forceExpanded ? 'is-visible' : ''}`;

                // Helper for sub-components
                const addComponent = (label, contentArray) => {
                    if (!contentArray) return;
                    const wrap = document.createElement('div');
                    wrap.className = 'sol-component';
                    wrap.innerHTML = `<span class="sol-label">${label}</span>`;

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'sol-content';

                    // Handle array of lines (math) or single string
                    if (Array.isArray(contentArray)) {
                        contentArray.forEach(line => {
                            const p = document.createElement('div');
                            p.innerHTML = `$${line}$`; // Wrap in inline math delimiters
                            contentDiv.appendChild(p);
                        });
                    } else {
                        contentDiv.innerHTML = contentArray; // Text or mixed
                    }
                    wrap.appendChild(contentDiv);
                    detailsDiv.appendChild(wrap);
                };

                addComponent('Keep in mind', q.solution.keepInMind);
                addComponent('Formulas used', q.solution.formulas);
                addComponent('Working', q.solution.working);
                addComponent('Alternative working', q.solution.altWorking);

                // Assemble
                qBlock.appendChild(header);
                qBlock.appendChild(ansBlock);
                qBlock.appendChild(controlDiv);
                qBlock.appendChild(detailsDiv);

                container.appendChild(qBlock);
            });

            // 3. Trigger KaTeX Render
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ],
                throwOnError: false
            });
        }

        /**
         * UTILITIES
         */
        function loadPaper(val) {
            renderPaper(val);
        }

        function toggleMobileNav() {
            const nav = document.getElementById('nav-rail');
            const bg = document.querySelector('.nav-backdrop');
            nav.classList.toggle('is-open');
            bg.classList.toggle('is-open');
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            loadPaper('short');
        });

    </script>

</body>

</html>