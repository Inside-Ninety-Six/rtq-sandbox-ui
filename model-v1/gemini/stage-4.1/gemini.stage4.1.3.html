<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTQ – Maths Paper Solution Viewer</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <style>
        /* * STAGE 4: VISUAL & INTERACTION INTENT 
         * Typography, Spacing, and Grayscale System 
         */

        :root {
            /* Semantic Colour Roles (Grayscale) */
            --c-base-bg: #F5F5F5;
            /* Page background */
            --c-surface: #FFFFFF;
            /* Content surface */
            --c-text-primary: #111111;
            /* Question text */
            --c-text-secondary: #444444;
            /* Answers, labels */
            --c-text-tertiary: #666666;
            /* Meta, navigation */
            --c-border-subtle: #E5E5E5;
            --c-focus-ring: #000000;
            --c-interactive: #000000;

            /* Typography Scale (Modern Sans-Serif) */
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --f-size-nav: 14px;
            --f-size-body: 16px;
            --f-size-h3: 18px;
            /* Sub-questions */
            --f-size-h2: 20px;
            /* Question prompts */

            /* Spacing Rhythm */
            --space-xs: 4px;
            --space-s: 8px;
            --space-m: 16px;
            --space-l: 24px;
            --space-xl: 48px;
            /* Between top-level questions */

            /* Layout Dimensions */
            --w-frame: 1024px;
            --w-nav: 220px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background-color: var(--c-base-bg);
            color: var(--c-text-primary);
            font-family: var(--font-family);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* * PAGE SHELL & ALIGNMENT 
         * Single centered content frame containing Nav and Paper 
         */

        .app-shell {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .top-controls {
            width: 100%;
            max-width: var(--w-frame);
            padding: var(--space-m) var(--space-l);
            background-color: var(--c-base-bg);
            /* Blend with page */
            display: flex;
            justify-content: flex-start;
            z-index: 100;
        }

        .paper-selector {
            font-family: inherit;
            font-size: var(--f-size-body);
            padding: var(--space-s);
            border: 1px solid var(--c-text-tertiary);
            border-radius: 4px;
            background: var(--c-surface);
            color: var(--c-text-primary);
            cursor: pointer;
        }

        .main-frame {
            display: flex;
            width: 100%;
            max-width: var(--w-frame);
            flex-grow: 1;
            background-color: var(--c-base-bg);
            /* Unified surface foundation */
            position: relative;
        }

        /* * NAVIGATION COLUMN 
         * Left sibling, sticky 
         */

        .nav-column {
            width: var(--w-nav);
            flex-shrink: 0;
            padding: var(--space-l) var(--space-m) var(--space-l) 0;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            /* Scrollbar hiding techniques */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE/Edge */
        }

        .nav-column::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-section-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--c-text-tertiary);
            margin-top: var(--space-m);
            margin-bottom: var(--space-s);
            padding-left: var(--space-s);
            font-weight: 600;
        }

        .nav-item {
            display: block;
            padding: var(--space-xs) var(--space-s);
            color: var(--c-text-tertiary);
            text-decoration: none;
            font-size: var(--f-size-nav);
            border-left: 2px solid transparent;
            cursor: pointer;
            transition: color 0.2s ease, border-color 0.2s ease;
        }

        .nav-item:hover {
            color: var(--c-text-primary);
        }

        .nav-item.active {
            color: var(--c-text-primary);
            border-left-color: var(--c-text-primary);
            font-weight: 600;
        }

        /* * PAPER CONTENT COLUMN 
         * Right sibling, dominates layout 
         */

        .paper-content {
            flex-grow: 1;
            background-color: var(--c-surface);
            padding: var(--space-xl);
            min-height: 100vh;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.02);
            /* Very subtle lift */
        }

        /* * QUESTION STRUCTURE 
         * Question -> Answer -> Solution Details 
         */

        .question-block {
            margin-bottom: var(--space-xl);
            /* Large spacing between questions */
            scroll-margin-top: var(--space-xl);
            /* For anchor jumping */
        }

        /* Nesting indentation - purely structural */
        .question-block[data-depth="1"] {
            margin-left: var(--space-l);
            margin-bottom: var(--space-l);
        }

        .question-block[data-depth="2"] {
            margin-left: var(--space-l);
            margin-bottom: var(--space-m);
        }

        .q-header {
            display: flex;
            align-items: baseline;
            gap: var(--space-m);
            margin-bottom: var(--space-m);
        }

        .q-number {
            font-weight: 700;
            color: var(--c-text-secondary);
            font-size: var(--f-size-h3);
            min-width: 24px;
        }

        .q-prompt {
            font-size: var(--f-size-h2);
            color: var(--c-text-primary);
            max-width: 65ch;
            /* Comfortable reading length */
        }

        .q-prompt p {
            margin-top: 0;
        }

        .diagram-container {
            margin: var(--space-m) 0;
            display: block;
            max-width: 100%;
        }

        .diagram-svg {
            display: block;
            max-width: 100%;
            height: auto;
            border: 1px solid var(--c-border-subtle);
        }

        /* ANSWER SECTION */
        .answer-section {
            margin-left: calc(24px + var(--space-m));
            /* Align with prompt text */
            margin-bottom: var(--space-s);
        }

        .answer-label {
            font-weight: 600;
            color: var(--c-text-secondary);
            font-size: var(--f-size-body);
            margin-right: var(--space-s);
        }

        .answer-value {
            font-family: inherit;
            font-size: var(--f-size-h3);
            color: var(--c-text-primary);
        }

        /* SOLUTION DETAILS & DISCLOSURE */
        .details-wrapper {
            margin-left: calc(24px + var(--space-m));
        }

        .toggle-btn {
            background: none;
            border: none;
            padding: 0;
            font-family: inherit;
            font-size: var(--f-size-body);
            color: var(--c-interactive);
            cursor: pointer;
            text-decoration: underline;
            text-underline-offset: 4px;
            margin-bottom: var(--space-s);
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .toggle-btn:hover {
            color: var(--c-text-tertiary);
        }

        .toggle-btn:focus-visible {
            outline: 2px solid var(--c-focus-ring);
            outline-offset: 2px;
            border-radius: 2px;
        }

        /* The expandable region */
        .solution-details {
            display: none;
            /* Collapsed by default */
            margin-top: var(--space-s);
            padding-left: var(--space-m);
            border-left: 2px solid var(--c-border-subtle);
        }

        .solution-details.expanded {
            display: block;
        }

        /* Sub-sections within Solution Details */
        .detail-block {
            margin-bottom: var(--space-m);
        }

        .detail-label {
            display: block;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--c-text-tertiary);
            margin-bottom: var(--space-xs);
            font-weight: 600;
        }

        .detail-content {
            font-size: var(--f-size-body);
            color: var(--c-text-secondary);
        }

        /* KaTeX Overrides for Layout Stability (Invariant: No page horizontal scroll) */
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0.5em 0;
            margin: 0.5em 0;
            max-width: 100%;
            /* Scrollbar hiding for math block cleaner look */
            scrollbar-width: thin;
        }

        /* * MOBILE / RESPONSIVE 
         */

        .mobile-nav-toggle {
            display: none;
            background: none;
            border: 1px solid var(--c-text-tertiary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .app-shell {
                align-items: stretch;
            }

            .main-frame {
                flex-direction: column;
            }

            /* Nav becomes overlay/drawer */
            .nav-column {
                position: fixed;
                top: 0;
                left: 0;
                width: 80%;
                max-width: 300px;
                height: 100%;
                background: var(--c-base-bg);
                z-index: 200;
                padding-left: var(--space-m);
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            .nav-column.open {
                transform: translateX(0);
            }

            .mobile-nav-toggle {
                display: block;
            }

            .paper-content {
                padding: var(--space-m) var(--space-m) var(--space-xl) var(--space-m);
            }

            .q-header {
                gap: var(--space-s);
            }

            .q-prompt {
                font-size: var(--f-size-h3);
            }

            .answer-section,
            .details-wrapper {
                margin-left: 0;
                /* Align left on small screens to save space */
                padding-left: var(--space-l);
                /* Indent slightly */
            }

            /* Add backdrop for mobile nav */
            .nav-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 150;
            }

            .nav-backdrop.active {
                display: block;
            }
        }
    </style>
</head>

<body>

    <div class="app-shell">
        <div class="top-controls">
            <select id="paperSelector" class="paper-selector" aria-label="Select Paper">
                <option value="short">Short Paper (6 Questions)</option>
                <option value="standard">Standard Paper (35 Questions)</option>
                <option value="diagram">Diagram-Heavy Paper</option>
                <option value="sectioned">Sectioned Paper (A/B/C)</option>
                <option value="workings-expanded">Standard (Stress Test: Expanded)</option>
            </select>
            <button class="mobile-nav-toggle" id="mobileNavToggle">Jump to...</button>
        </div>

        <div class="main-frame">
            <div class="nav-backdrop" id="navBackdrop"></div>
            <nav class="nav-column" id="navColumn" aria-label="Question Navigation">
            </nav>

            <main class="paper-content" id="paperContent">
            </main>
        </div>
    </div>

    <script>
        // --- STAGE 5: LOGIC & DATA ---

        // SVG Generators for Grayscale Diagrams
        const SVGs = {
            geometry: () => `
            <svg class="diagram-svg" viewBox="0 0 300 150" width="300" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" fill="#fff"/>
                <path d="M50,120 L250,120 L150,20 Z" fill="none" stroke="#000" stroke-width="2"/>
                <text x="140" y="140" font-family="sans-serif" font-size="14" fill="#000">20 cm</text>
                <text x="90" y="70" font-family="sans-serif" font-size="14" fill="#000">a</text>
                <text x="200" y="70" font-family="sans-serif" font-size="14" fill="#000">b</text>
            </svg>`,
            bar: () => `
            <svg class="diagram-svg" viewBox="0 0 300 150" width="300" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" fill="#fff"/>
                <line x1="40" y1="130" x2="280" y2="130" stroke="#000" stroke-width="1"/>
                <line x1="40" y1="130" x2="40" y2="20" stroke="#000" stroke-width="1"/>
                <rect x="60" y="50" width="40" height="80" fill="#ddd"/>
                <rect x="120" y="30" width="40" height="100" fill="#bbb"/>
                <rect x="180" y="80" width="40" height="50" fill="#999"/>
            </svg>`,
            grid: () => `
            <svg class="diagram-svg" viewBox="0 0 200 200" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" fill="#fff"/>
                <defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#eee" stroke-width="1"/></pattern></defs>
                <rect width="100%" height="100%" fill="url(#grid)" />
                <line x1="100" y1="0" x2="100" y2="200" stroke="#000" stroke-width="1"/>
                <line x1="0" y1="100" x2="200" y2="100" stroke="#000" stroke-width="1"/>
                <circle cx="140" cy="60" r="3" fill="#000"/>
                <text x="145" y="55" font-family="sans-serif" font-size="12">P</text>
            </svg>`,
            cube: () => `
            <svg class="diagram-svg" viewBox="0 0 200 150" width="200" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" fill="#fff"/>
                <path d="M50,50 L110,50 L110,110 L50,110 Z" fill="none" stroke="#000" stroke-width="2"/>
                <path d="M50,50 L80,20 L140,20 L140,80 L110,110" fill="none" stroke="#000" stroke-width="2"/>
                <path d="M140,20 L110,50" fill="none" stroke="#000" stroke-width="2"/>
                <path d="M80,20 L80,55" fill="none" stroke="#000" stroke-width="1" stroke-dasharray="4"/>
                <path d="M50,110 L80,80 L140,80" fill="none" stroke="#000" stroke-width="1" stroke-dasharray="4"/>
                <path d="M80,55 L80,80" fill="none" stroke="#000" stroke-width="1" stroke-dasharray="4"/>
            </svg>`
        };

        // Helper to generate Math
        const math = (tex, display = false) => display ? `$$${tex}$$` : `$${tex}$`;

        // Helper to create questions
        const createQ = (id, prompt, answer, working, opts = {}) => ({
            id,
            prompt,
            answer,
            working,
            depth: 0,
            keepInMind: opts.keepInMind || null,
            formulas: opts.formulas || null,
            altWorking: opts.altWorking || null,
            diagram: opts.diagram || null,
            subQuestions: []
        });

        // Content Generators (Exemplar-style)

        // Dataset 1: Short Paper
        const getShortPaper = () => [
            createQ("1", `Fill in the missing number: ${math("124 + \\boxed{\\phantom{0}} = 200")}`, "76",
                `Let the missing number be $a$.
            ${math("\\begin{aligned} 124 + a &= 200 \\\\ a &= 200 - 124 \\\\ a &= 76 \\end{aligned}", true)}`),
            createQ("2", "Subtract 45 from 102.", "57",
                `${math("102 - 45 = 57", true)}`),
            createQ("3", "A bag of sweets contains 4 red, 5 blue and 6 green sweets. What is the probability of picking a blue sweet?", "1/3",
                `Total sweets = $4 + 5 + 6 = 15$.
             Blue sweets = 5.
             ${math("\\text{Probability} = \\frac{5}{15} = \\frac{1}{3}", true)}`,
                { keepInMind: "Always simplify fractions." }),
            createQ("4", "Calculate the perimeter of the shape.", "60 cm",
                `Perimeter is the sum of all sides.
             ${math("P = 20 + 20 + 10 + 10 = 60\\text{ cm}", true)}`,
                { diagram: SVGs.geometry(), formulas: "P = sum of sides" }),
            createQ("5", "Solve for $x$: $3x + 5 = 20$", "5",
                `${math("\\begin{aligned} 3x &= 20 - 5 \\\\ 3x &= 15 \\\\ x &= 5 \\end{aligned}", true)}`),
            {
                ...createQ("6", "James travels to work.", "£450", "See sub-questions."),
                subQuestions: [
                    createQ("6a", "He works 45 weeks a year. His weekly travel cost is £10. What is his total annual cost?", "£450",
                        `${math("45 \\times 10 = 450")}`, { depth: 1 }),
                    createQ("6b", "If he saves 10% by buying a pass, how much does the pass cost?", "£405",
                        `$10\\%$ of $450 = 45$.
                     ${math("450 - 45 = 405")}`, { depth: 1 })
                ]
            }
        ];

        // Dataset 2: Standard Paper (35 Qs, Algebra focus at end)
        const getStandardPaper = (expandedDefault = false) => {
            const questions = [];

            // 1-10 Basic
            for (let i = 1; i <= 10; i++) {
                questions.push(createQ(`${i}`, `Calculate ${math(`${i} \\times 12`)}`, `${i * 12}`, `${math(`${i} \\times 10 = ${i * 10}`)}, ${math(`${i} \\times 2 = ${i * 2}`)}, Total = ${i * 12}`));
            }

            // 11-20 Geometry/Word
            for (let i = 11; i <= 20; i++) {
                questions.push(createQ(`${i}`, `Find the area of a square with side ${i}cm.`, `${i * i} cm²`, `${math(`Area = ${i} \\times ${i} = ${i * i}`)}`, { diagram: SVGs.geometry() }));
            }

            // 21-25 Mixed
            questions.push(createQ("21", "Add together 308, 86 and 4444.", "4838", math("\\begin{array}{r}308\\\\86\\\\+4444\\\\\\hline 4838\\end{array}", true)));

            // 26-35 Long Algebra (Stress Test)
            for (let i = 26; i <= 35; i++) {
                questions.push(createQ(`${i}`,
                    `Solve the simultaneous equations: ${math("2x + y = 10")} and ${math("x - y = 2")}`,
                    "x=4, y=2",
                    `Add the two equations:
                ${math("\\begin{aligned} (2x+y) + (x-y) &= 10 + 2 \\\\ 3x &= 12 \\\\ x &= 4 \\end{aligned}", true)}
                Substitute $x=4$ into second equation:
                ${math("4 - y = 2 \\implies y = 2", true)}`,
                    {
                        keepInMind: "Check your answers by substituting back into both equations.",
                        formulas: "Elimination method",
                        altWorking: `Rearrange the second equation: $x = y + 2$.
                    Substitute into first:
                    ${math("2(y+2) + y = 10 \\\\ 2y + 4 + y = 10 \\\\ 3y = 6 \\\\ y = 2", true)}`
                    }
                ));
            }

            // Apply expanded default if requested
            if (expandedDefault) {
                questions.forEach(q => q.expanded = true);
            }
            return questions;
        };

        // Dataset 3: Diagram Heavy
        const getDiagramPaper = () => {
            const questions = [];
            for (let i = 1; i <= 20; i++) {
                const type = i % 4;
                let svg, prompt, ans, working;
                if (type === 0) { svg = SVGs.geometry(); prompt = "Find angle a."; ans = "60"; working = "Angles in triangle sum to 180."; }
                else if (type === 1) { svg = SVGs.bar(); prompt = "Which category is largest?"; ans = "B"; working = "Compare heights."; }
                else if (type === 2) { svg = SVGs.grid(); prompt = "Coordinates of P?"; ans = "(7,3)"; working = "Read x then y."; }
                else { svg = SVGs.cube(); prompt = "Surface area?"; ans = "150"; working = "6 faces."; }

                questions.push(createQ(`${i}`, prompt, ans, working, { diagram: svg }));
            }
            return questions;
        };

        // Dataset 4: Sectioned Paper
        const getSectionedPaper = () => {
            const sections = [
                { label: "Section A", qs: getStandardPaper().slice(0, 15) }, // 15 qs
                { label: "Section B", qs: getStandardPaper().slice(15, 23) }, // 8 qs
                { label: "Section C", qs: [] }
            ];

            // Section C: Long Workings & Stress Tests
            // Deep nesting example
            const q1 = createQ("24", "Deep nesting test.", "See parts", "Main working");
            q1.subQuestions.push(createQ("24(a)", "Part A", "10", "Work A", { depth: 1 }));
            const q1b = createQ("24(b)", "Part B", "20", "Work B", { depth: 1 });
            q1b.subQuestions.push(createQ("24(b)(i)", "Part B-i", "5", "Work Bi", { depth: 2 }));
            q1b.subQuestions.push(createQ("24(b)(ii)", "Part B-ii", "15", "Work Bii", { depth: 2 }));
            q1.subQuestions.push(q1b);
            sections[2].qs.push(q1);

            // Extremely Long Working
            let longMath = "\\begin{aligned} ";
            for (let k = 0; k < 50; k++) { longMath += `Line \\ ${k + 1} &= x^2 + ${k}y \\\\ `; }
            longMath += "\\end{aligned}";

            sections[2].qs.push(createQ("25", "Extremely long derivation.", "42", longMath, { keepInMind: "Patience required." }));

            // Coverage Stress Test (All fields)
            sections[2].qs.push(createQ("26", "Full features.", "100", "Primary method", {
                keepInMind: "Don't forget units.",
                formulas: "E = mc^2",
                altWorking: "Alternative method here.",
                diagram: SVGs.geometry()
            }));

            return sections; // Returns array of sections { label, qs[] }
        };

        // --- RENDER LOGIC ---

        const elements = {
            selector: document.getElementById('paperSelector'),
            nav: document.getElementById('navColumn'),
            content: document.getElementById('paperContent'),
            mobileToggle: document.getElementById('mobileNavToggle'),
            backdrop: document.getElementById('navBackdrop')
        };

        let currentPaperData = [];
        let isSectioned = false;

        function renderPaper(type) {
            // Reset
            elements.nav.innerHTML = '<ul class="nav-list" id="navList"></ul>';
            elements.content.innerHTML = '';
            currentPaperData = [];
            isSectioned = false;

            let rawData;
            if (type === 'short') rawData = getShortPaper();
            else if (type === 'standard') rawData = getStandardPaper();
            else if (type === 'diagram') rawData = getDiagramPaper();
            else if (type === 'workings-expanded') rawData = getStandardPaper(true);
            else if (type === 'sectioned') {
                rawData = getSectionedPaper();
                isSectioned = true;
            }

            const navList = document.getElementById('navList');

            // Recursive function to render questions and sub-questions
            const processQuestion = (q) => {
                renderQuestionBlock(q, elements.content);
                addToNav(q, navList);
                if (q.subQuestions) {
                    q.subQuestions.forEach(sq => {
                        renderQuestionBlock(sq, elements.content);
                        addToNav(sq, navList);
                        if (sq.subQuestions) {
                            sq.subQuestions.forEach(ssq => {
                                renderQuestionBlock(ssq, elements.content);
                                addToNav(ssq, navList);
                            });
                        }
                    });
                }
            };

            if (isSectioned) {
                rawData.forEach(section => {
                    // Nav Section Header
                    const li = document.createElement('li');
                    li.className = 'nav-section-label';
                    li.textContent = section.label;
                    navList.appendChild(li);

                    // Section Header in Content (Optional/Structural)
                    const h2 = document.createElement('h2');
                    h2.textContent = section.label;
                    h2.style.borderBottom = "1px solid #ccc";
                    h2.style.paddingTop = "24px";
                    elements.content.appendChild(h2);

                    section.qs.forEach(q => processQuestion(q));
                });
            } else {
                rawData.forEach(q => processQuestion(q));
            }

            // Render Math
            renderMathInElement(document.body, {
                delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false }
                ],
                throwOnError: false
            });
        }

        function addToNav(q, list) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.className = 'nav-item';
            a.textContent = q.id; // Identifier only
            a.onclick = () => {
                document.getElementById(`q-${q.id}`).scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Mobile: close drawer
                elements.nav.classList.remove('open');
                elements.backdrop.classList.remove('active');

                // Update active state
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                a.classList.add('active');
            };
            li.appendChild(a);
            list.appendChild(li);
        }

        function renderQuestionBlock(q, container) {
            const block = document.createElement('div');
            block.className = 'question-block';
            block.id = `q-${q.id}`;
            block.dataset.depth = q.depth;

            // Header
            let html = `
            <div class="q-header">
                <span class="q-number">${q.id}</span>
                <div class="q-prompt">
                    ${q.prompt}
                    ${q.diagram ? `<div class="diagram-container">${q.diagram}</div>` : ''}
                </div>
            </div>
            <div class="answer-section">
                <span class="answer-label">Answer</span>
                <span class="answer-value">${q.answer}</span>
            </div>
            <div class="details-wrapper">
                <button class="toggle-btn" aria-expanded="${!!q.expanded}">
                    ${q.expanded ? 'Hide working' : 'Show working'}
                </button>
                <div class="solution-details ${q.expanded ? 'expanded' : ''}">
        `;

            // Details Content
            if (q.keepInMind) {
                html += `<div class="detail-block"><span class="detail-label">Keep in mind</span><div class="detail-content">${q.keepInMind}</div></div>`;
            }
            if (q.formulas) {
                html += `<div class="detail-block"><span class="detail-label">Formulas used</span><div class="detail-content">${q.formulas}</div></div>`;
            }

            html += `<div class="detail-block"><span class="detail-label">Working</span><div class="detail-content">${q.working}</div></div>`;

            if (q.altWorking) {
                html += `<div class="detail-block"><span class="detail-label">Alternative working</span><div class="detail-content">${q.altWorking}</div></div>`;
            }

            html += `</div></div>`; // Close details-wrapper
            block.innerHTML = html;

            // Event Listener for Toggle
            const btn = block.querySelector('.toggle-btn');
            const details = block.querySelector('.solution-details');

            btn.onclick = () => {
                const isExpanded = details.classList.contains('expanded');
                if (isExpanded) {
                    details.classList.remove('expanded');
                    btn.textContent = 'Show working';
                    btn.setAttribute('aria-expanded', 'false');
                } else {
                    details.classList.add('expanded');
                    btn.textContent = 'Hide working';
                    btn.setAttribute('aria-expanded', 'true');
                }
            };

            container.appendChild(block);
        }

        // --- EVENTS ---

        elements.selector.addEventListener('change', (e) => {
            renderPaper(e.target.value);
        });

        elements.mobileToggle.addEventListener('click', () => {
            elements.nav.classList.add('open');
            elements.backdrop.classList.add('active');
        });

        elements.backdrop.addEventListener('click', () => {
            elements.nav.classList.remove('open');
            elements.backdrop.classList.remove('active');
        });

        // Init
        renderPaper('short');

    </script>

</body>

</html>